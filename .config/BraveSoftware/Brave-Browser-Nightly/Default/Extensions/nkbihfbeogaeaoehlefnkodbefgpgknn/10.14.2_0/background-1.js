LavaPack.loadBundle([[1303,{"bn.js":1292,buffer:2081,"js-sha3":1312,"number-to-bn":5298},function(){with(this)return function(){"use strict";return function(e,t,n){(function(n){(function(){var r=e("bn.js"),s=e("number-to-bn"),i=e("js-sha3").keccak_256;function a(e){for(var t=e,n=t[0];t.length>0&&"0"===n.toString();)n=(t=t.slice(1))[0];return t}function o(e){var t=e.toString(16);return t.length%2&&(t="0"+t),a(new n(t,"hex"))}function c(e,t){return!("string"!=typeof e||!e.match(/^0x[0-9A-Fa-f]*$/))&&(!t||e.length===2+2*t)}function u(e,t){var r=e;if(!n.isBuffer(r)){if(!c(r)){var s=new Error(t?"[ethjs-abi] invalid "+t:"[ethjs-abi] invalid hex or buffer, must be a prefixed alphanumeric even length hex string");throw s.reason="[ethjs-abi] invalid hex string, hex must be prefixed and alphanumeric (e.g. 0x023..)",s.value=r,s}(r=r.substring(2)).length%2&&(r="0"+r),r=new n(r,"hex")}return r}function l(e,t){return{encode:function(r){var i=r;return"object"==typeof i&&i.toString&&(i.toTwos||i.dividedToIntegerBy)&&(i=i.toString(10).split(".")[0]),"string"!=typeof i&&"number"!=typeof i||(i=String(i).split(".")[0]),i=(i=s(i)).toTwos(8*e).maskn(8*e),t&&(i=i.fromTwos(8*e).toTwos(256)),i.toArrayLike(n,"be",32)},decode:function(n,s){var i=32-e,a=new r(n.slice(s+i,s+32));return a=t?a.fromTwos(8*e):a.maskn(8*e),{consumed:32,value:new r(a.toString(10))}}}}var d=l(32,!1),h={encode:function(e){return d.encode(e?1:0)},decode:function(e,t){var n=d.decode(e,t);return{consumed:n.consumed,value:!n.value.isZero()}}};function f(e){return{encode:function(e){var t=e;if(32===(t=u(t)).length)return t;var r=new n(32);return r.fill(0),t.copy(r),r},decode:function(t,n){if(0!==t.length&&t.length<n+32)throw new Error("[ethjs-abi] while decoding fixed bytes, invalid bytes data length: "+e);return{consumed:32,value:"0x"+t.slice(n,n+e).toString("hex")}}}}var p={encode:function(e){var t=e,r=new n(32);if(!c(t,20))throw new Error("[ethjs-abi] while encoding address, invalid address value, not alphanumeric 20 byte hex string");return t=u(t),r.fill(0),t.copy(r,12),r},decode:function(e,t){if(0===e.length)return{consumed:32,value:"0x"};if(0!==e.length&&e.length<t+32)throw new Error("[ethjs-abi] while decoding address data, invalid address data, invalid byte length "+e.length);return{consumed:32,value:"0x"+e.slice(t+12,t+32).toString("hex")}}};function m(e){var t=parseInt(32*Math.ceil(e.length/32)),r=new n(t-e.length);return r.fill(0),n.concat([d.encode(e.length),e,r])}function g(e,t){if(0!==e.length&&e.length<t+32)throw new Error("[ethjs-abi] while decoding dynamic bytes data, invalid bytes length: "+e.length+" should be less than "+(t+32));var n=d.decode(e,t).value;if(n=n.toNumber(),0!==e.length&&e.length<t+32+n)throw new Error("[ethjs-abi] while decoding dynamic bytes data, invalid bytes length: "+e.length+" should be less than "+(t+32+n));return{consumed:parseInt(32+32*Math.ceil(n/32),10),value:e.slice(t+32,t+32+n)}}var y={encode:function(e){return m(u(e))},decode:function(e,t){var n=g(e,t);return n.value="0x"+n.value.toString("hex"),n},dynamic:!0},v={encode:function(e){return m(new n(e,"utf8"))},decode:function(e,t){var n=g(e,t);return n.value=n.value.toString("utf8"),n},dynamic:!0};function b(e,t){return{encode:function(r){var s=new n(0),i=t;if(!Array.isArray(r))throw new Error("[ethjs-abi] while encoding array, invalid array data, not type Object (Array)");if(-1===i&&(i=r.length,s=d.encode(i)),i!==r.length)throw new Error("[ethjs-abi] while encoding array, size mismatch array length "+i+" does not equal "+r.length);return r.forEach((function(t){s=n.concat([s,e.encode(t)])})),s},decode:function(n,r){var s,i=t,a=r,o=0;-1===i&&(i=(s=d.decode(n,a)).value.toNumber(),o+=s.consumed,a+=s.consumed);for(var c=[],u=0;u<i;u++){var l=e.decode(n,a);o+=l.consumed,a+=l.consumed,c.push(l.value)}return{consumed:o,value:c}},dynamic:-1===t}}var w=new RegExp(/^((u?int|bytes)([0-9]*)|(address|bool|string)|(\[([0-9]*)\]))/);t.exports={BN:r,bnToBuffer:o,isHexString:c,hexOrBuffer:u,hexlify:function(e){return"number"==typeof e?"0x"+o(new r(e)).toString("hex"):e.mod||e.modulo?"0x"+o(e).toString("hex"):"0x"+u(e).toString("hex")},stripZeros:a,keccak256:i,getKeys:function(e,t,n){var r=[];if(!Array.isArray(e))throw new Error("[ethjs-abi] while getting keys, invalid params value "+JSON.stringify(e));for(var s=0;s<e.length;s++){var i=e[s][t];if(n&&!i)i="";else if("string"!=typeof i)throw new Error("[ethjs-abi] while getKeys found invalid ABI data structure, type value not string");r.push(i)}return r},numberToBN:s,coderNumber:l,uint256Coder:d,coderBoolean:h,coderFixedBytes:f,coderAddress:p,coderDynamicBytes:y,coderString:v,coderArray:b,paramTypePart:w,getParamCoder:function(e){for(var t=e,n=null,r="[ethjs-abi] while getting param coder (getParamCoder) type value "+JSON.stringify(t)+" is either invalid or unsupported by ethjs-abi.";t;){var s=t.match(w);if(!s)throw new Error(r);t=t.substring(s[0].length);var i=s[2]||s[4]||s[5];switch(i){case"int":case"uint":if(n)throw new Error(r);var a=parseInt(s[3]||256);if(0===a||a>256||a%8!=0)throw new Error("[ethjs-abi] while getting param coder for type "+t+", invalid "+i+"<N> width: "+t);n=l(a/8,"int"===i);break;case"bool":if(n)throw new Error(r);n=h;break;case"string":if(n)throw new Error(r);n=v;break;case"bytes":if(n)throw new Error(r);if(s[3]){var o=parseInt(s[3]);if(0===o||o>32)throw new Error("[ethjs-abi] while getting param coder for prefix bytes, invalid type "+t+", size "+o+" should be 0 or greater than 32");n=f(o)}else n=y;break;case"address":if(n)throw new Error(r);n=p;break;case"[]":if(!n||n.dynamic)throw new Error(r);n=b(n,-1);break;default:if(!n||n.dynamic)throw new Error(r);n=b(n,parseInt(s[6]))}}if(!n)throw new Error(r);return n}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"ethjs-abi",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/rpc-methods/node_modules/ethjs-abi/lib/utils/index.js"}],[1304,{"./has-tx-object":1305,"babel-runtime/core-js/json/stringify":1816,"babel-runtime/core-js/object/assign":1817,"babel-runtime/helpers/asyncToGenerator":1825,"babel-runtime/regenerator":1942,"ethjs-abi":1307,"ethjs-filter":2567,"ethjs-util":2575,"js-sha3":1312,"promise-to-callback":5422},function(){with(this)return function(){"use strict";return function(e,t,n){var r=o(e("babel-runtime/regenerator")),s=o(e("babel-runtime/core-js/json/stringify")),i=o(e("babel-runtime/helpers/asyncToGenerator")),a=o(e("babel-runtime/core-js/object/assign"));function o(e){return e&&e.__esModule?e:{default:e}}var c=e("ethjs-abi"),u=e("ethjs-filter"),l=e("ethjs-util").getKeys,d=e("js-sha3").keccak_256,h=e("./has-tx-object"),f=e("promise-to-callback");function p(e){return e.filter((function(e){return("function"===e.type||"event"===e.type)&&e.name.length>0}))}t.exports=function(){var e=(o=(0,i.default)(r.default.mark((function e(t){var i,o,u,l,d,f=t.methodObject,p=t.methodArgs;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="call",o={},h(p)&&(o=p.pop()),(u=(0,a.default)({},n.defaultTxObject,o,{to:n.address})).data=c.encodeMethod(f,p),!1===f.constant&&(i="sendTransaction"),e.next=8,n.query[i](u);case 8:if(l=e.sent,"call"!==i){e.next=19;break}return e.prev=10,d=c.decodeMethod(f,l),e.abrupt("return",d);case 15:throw e.prev=15,e.t0=e.catch(10),new Error("[ethjs-contract] while formatting incoming raw call data "+(0,s.default)(l)+" "+e.t0);case 19:return e.abrupt("return",l);case 20:case"end":return e.stop()}}),e,this,[[10,15]])}))),function(e){return o.apply(this,arguments)}),t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},n=this;var o;function m(e){return function(){var t=[].slice.call(arguments),r=l(e.inputs,"type",!1),s="0x"+d(e.name+"("+r.join(",")+")"),i=[s],o=(0,a.default)({},t[0])||{},u=(0,a.default)({},t[0]||{},{to:n.address,topics:i}),h=(0,a.default)({},o,{decoder:function(t){return c.decodeEvent(e,t,i)},defaultFilterObject:u});return new n.filters.Filter(h)}}function g(t){return function(){var n=void 0,r=[].slice.call(arguments);"function"==typeof r[r.length-1]&&(n=r.pop());var s=e({methodObject:t,methodArgs:r});return n?f(s)(n):s}}n.abi=t.contractABI||[],n.query=t.query,n.address=t.address||"0x",n.bytecode=t.contractBytecode||"0x",n.defaultTxObject=t.contractDefaultTxObject||{},n.filters=new u(n.query),p(n.abi).forEach((function(e){"function"===e.type?n[e.name]=g(e):"event"===e.type&&(n[e.name]=m(e))}))}}}},{package:"ethjs-contract",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/rpc-methods/node_modules/ethjs-contract/lib/contract.js"}],[1305,{"babel-runtime/core-js/object/keys":1820},function(){with(this)return function(){"use strict";return function(e,t,n){var r,s=e("babel-runtime/core-js/object/keys"),i=(r=s)&&r.__esModule?r:{default:r};var a=["from","to","data","value","gasPrice","gas"];t.exports=function(e){if(!Array.isArray(e)||0===e.length)return!1;var t=e[e.length-1];if(!t)return!1;if("object"!=typeof t)return!1;if(0===(0,i.default)(t).length)return!0;var n=(0,i.default)(t);if(a.some((function(e){return n.includes(e)})))return!0;return!1}}}},{package:"ethjs-contract",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/rpc-methods/node_modules/ethjs-contract/lib/has-tx-object.js"}],[1306,{"./contract":1304,"./has-tx-object":1305,"babel-runtime/core-js/object/assign":1817,"ethjs-abi":1307,"ethjs-filter":2567,"ethjs-util":2575,"js-sha3":1312},function(){with(this)return function(){"use strict";return function(e,t,n){var r,s=e("babel-runtime/core-js/object/assign"),i=(r=s)&&r.__esModule?r:{default:r};var a=e("ethjs-abi"),o=(e("js-sha3").keccak_256,e("ethjs-filter"),e("ethjs-util").getKeys),c=e("./contract"),u=e("./has-tx-object");function l(e){return e.filter((function(e){return"constructor"===e.type}))[0]}t.exports=function(e){return function(t,n,r){if(!Array.isArray(t))throw new Error("[ethjs-contract] Contract ABI must be type Array, got type "+typeof t);if(void 0!==n&&"string"!=typeof n)throw new Error("[ethjs-contract] Contract bytecode must be type String, got type "+typeof n);if(void 0!==r&&"object"!=typeof r)throw new Error("[ethjs-contract] Contract default tx object must be type Object, got type "+typeof t);var s={at:function(s){return new c({address:s,query:e,contractBytecode:n,contractDefaultTxObject:r,contractABI:t})},new:function(){var s={},c=null,d=[].slice.call(arguments);"function"==typeof d[d.length-1]&&(c=d.pop()),u(d)&&(s=d.pop());var h=l(t),f=(0,i.default)({},r,s);if(n&&(f.data=n),h){var p=a.encodeParams(o(h.inputs,"type"),d).substring(2);f.data=""+f.data+p}return c?e.sendTransaction(f,c):e.sendTransaction(f)}};return s}}}}},{package:"ethjs-contract",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/rpc-methods/node_modules/ethjs-contract/lib/index.js"}],[1307,{"./utils/index.js":1308,buffer:2081},function(){with(this)return function(){"use strict";return function(e,t,n){(function(n){(function(){var r=e("./utils/index.js"),s=r.uint256Coder,i=(r.coderBoolean,r.coderFixedBytes,r.coderAddress,r.coderDynamicBytes,r.coderString,r.coderArray,r.paramTypePart,r.getParamCoder);function a(){}function o(e,t){if(e.length!==t.length)throw new Error("[ethjs-abi] while encoding params, types/values mismatch, Your contract requires "+e.length+" types (arguments), and you passed in "+t.length);var r=[];function a(e){return parseInt(32*Math.ceil(e/32))}e.forEach((function(e,n){var s=i(e);r.push({dynamic:s.dynamic,value:s.encode(t[n])})}));var o=0,c=0;r.forEach((function(e){e.dynamic?(o+=32,c+=a(e.value.length)):o+=a(e.value.length)}));var u=0,l=o,d=new n(o+c);return r.forEach((function(e,t){e.dynamic?(s.encode(l).copy(d,u),u+=32,e.value.copy(d,l),l+=a(e.value.length)):(e.value.copy(d,u),u+=a(e.value.length))})),"0x"+d.toString("hex")}function c(e,t,n){var o=!(arguments.length>3&&arguments[3]!==undefined)||arguments[3];arguments.length<3&&(n=t,t=e,e=[]),n=r.hexOrBuffer(n);var c=new a,u=0;return t.forEach((function(t,r){var a=i(t);if(a.dynamic){var l=s.decode(n,u),d=a.decode(n,l.value.toNumber());u+=l.consumed}else{d=a.decode(n,u);u+=d.consumed}o&&(c[r]=d.value),e[r]&&(c[e[r]]=d.value)})),c}function u(e,t){var s=e.name+"("+r.getKeys(e.inputs,"type").join(",")+")";return""+("0x"+new n(r.keccak256(s),"hex").slice(0,4).toString("hex"))+o(r.getKeys(e.inputs,"type"),t).substring(2)}function l(e){var t=e.name+"("+r.getKeys(e.inputs,"type").join(",")+")";return"0x"+r.keccak256(t)}function d(e,t,s){var a=!(arguments.length>3&&arguments[3]!==undefined)||arguments[3],o=e.inputs.filter((function(e){return!e.indexed})),u=r.getKeys(o,"name",!0),l=r.getKeys(o,"type"),d=c(u,l,r.hexOrBuffer(t),a),h=e.anonymous?0:1;return e.inputs.filter((function(e){return e.indexed})).map((function(e,t){var r=new n(s[t+h].slice(2),"hex"),a=i(e.type);d[e.name]=a.decode(r,0).value})),d._eventName=e.name,d}function h(e,t){var n=!(arguments.length>2&&arguments[2]!==undefined)||arguments[2];if(e&&t.topics[0]===l(e))return d(e,t.data,t.topics,n)}t.exports={encodeParams:o,decodeParams:c,encodeMethod:u,decodeMethod:function(e,t){return c(r.getKeys(e.outputs,"name",!0),r.getKeys(e.outputs,"type"),r.hexOrBuffer(t))},encodeEvent:function(e,t){return u(e,t)},decodeEvent:d,decodeLogItem:h,logDecoder:function(e){var t=!(arguments.length>1&&arguments[1]!==undefined)||arguments[1],n={};return e.filter((function(e){return"event"===e.type})).map((function(e){n[l(e)]=e})),function(e){return e.map((function(e){return h(n[e.topics[0]],e,t)})).filter((function(e){return e}))}},eventSignature:l}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"ethjs-abi",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/rpc-methods/node_modules/ethjs-contract/node_modules/ethjs-abi/lib/index.js"}],[1308,{"bn.js":1292,buffer:2081,"js-sha3":1312,"number-to-bn":5298},function(){with(this)return function(){"use strict";return function(e,t,n){(function(n){(function(){var r=e("bn.js"),s=e("number-to-bn"),i=e("js-sha3").keccak_256;function a(e){for(var t=e,n=t[0];t.length>0&&"0"===n.toString();)n=(t=t.slice(1))[0];return t}function o(e){var t=e.toString(16);return t.length%2&&(t="0"+t),a(new n(t,"hex"))}function c(e,t){return!("string"!=typeof e||!e.match(/^0x[0-9A-Fa-f]*$/))&&(!t||e.length===2+2*t)}function u(e,t){var r=e;if(!n.isBuffer(r)){if(!c(r)){var s=new Error(t?"[ethjs-abi] invalid "+t:"[ethjs-abi] invalid hex or buffer, must be a prefixed alphanumeric even length hex string");throw s.reason="[ethjs-abi] invalid hex string, hex must be prefixed and alphanumeric (e.g. 0x023..)",s.value=r,s}(r=r.substring(2)).length%2&&(r="0"+r),r=new n(r,"hex")}return r}function l(e,t){return{encode:function(r){var i=r;return"object"==typeof i&&i.toString&&(i.toTwos||i.dividedToIntegerBy)&&(i=i.toString(10).split(".")[0]),"string"!=typeof i&&"number"!=typeof i||(i=String(i).split(".")[0]),i=(i=s(i)).toTwos(8*e).maskn(8*e),t&&(i=i.fromTwos(8*e).toTwos(256)),i.toArrayLike(n,"be",32)},decode:function(n,s){var i=32-e,a=new r(n.slice(s+i,s+32));return a=t?a.fromTwos(8*e):a.maskn(8*e),{consumed:32,value:new r(a.toString(10))}}}}var d=l(32,!1),h={encode:function(e){return d.encode(e?1:0)},decode:function(e,t){var n=d.decode(e,t);return{consumed:n.consumed,value:!n.value.isZero()}}};function f(e){return{encode:function(e){var t=e;if(32===(t=u(t)).length)return t;var r=new n(32);return r.fill(0),t.copy(r),r},decode:function(t,n){if(0!==t.length&&t.length<n+32)throw new Error("[ethjs-abi] while decoding fixed bytes, invalid bytes data length: "+e);return{consumed:32,value:"0x"+t.slice(n,n+e).toString("hex")}}}}var p={encode:function(e){var t=e,r=new n(32);if(!c(t,20))throw new Error("[ethjs-abi] while encoding address, invalid address value, not alphanumeric 20 byte hex string");return t=u(t),r.fill(0),t.copy(r,12),r},decode:function(e,t){if(0===e.length)return{consumed:32,value:"0x"};if(0!==e.length&&e.length<t+32)throw new Error("[ethjs-abi] while decoding address data, invalid address data, invalid byte length "+e.length);return{consumed:32,value:"0x"+e.slice(t+12,t+32).toString("hex")}}};function m(e){var t=parseInt(32*Math.ceil(e.length/32)),r=new n(t-e.length);return r.fill(0),n.concat([d.encode(e.length),e,r])}function g(e,t){if(0!==e.length&&e.length<t+32)throw new Error("[ethjs-abi] while decoding dynamic bytes data, invalid bytes length: "+e.length+" should be less than "+(t+32));var n=d.decode(e,t).value;if(n=n.toNumber(),0!==e.length&&e.length<t+32+n)throw new Error("[ethjs-abi] while decoding dynamic bytes data, invalid bytes length: "+e.length+" should be less than "+(t+32+n));return{consumed:parseInt(32+32*Math.ceil(n/32),10),value:e.slice(t+32,t+32+n)}}var y={encode:function(e){return m(u(e))},decode:function(e,t){var n=g(e,t);return n.value="0x"+n.value.toString("hex"),n},dynamic:!0},v={encode:function(e){return m(new n(e,"utf8"))},decode:function(e,t){var n=g(e,t);return n.value=n.value.toString("utf8"),n},dynamic:!0};function b(e,t){return{encode:function(r){var s=new n(0),i=t;if(!Array.isArray(r))throw new Error("[ethjs-abi] while encoding array, invalid array data, not type Object (Array)");if(-1===i&&(i=r.length,s=d.encode(i)),i!==r.length)throw new Error("[ethjs-abi] while encoding array, size mismatch array length "+i+" does not equal "+r.length);return r.forEach((function(t){s=n.concat([s,e.encode(t)])})),s},decode:function(n,r){var s,i=t,a=r,o=0;-1===i&&(i=(s=d.decode(n,a)).value.toNumber(),o+=s.consumed,a+=s.consumed);for(var c=[],u=0;u<i;u++){var l=e.decode(n,a);o+=l.consumed,a+=l.consumed,c.push(l.value)}return{consumed:o,value:c}},dynamic:-1===t}}var w=new RegExp(/^((u?int|bytes)([0-9]*)|(address|bool|string)|(\[([0-9]*)\]))/);t.exports={BN:r,bnToBuffer:o,isHexString:c,hexOrBuffer:u,hexlify:function(e){return"number"==typeof e?"0x"+o(new r(e)).toString("hex"):e.mod||e.modulo?"0x"+o(e).toString("hex"):"0x"+u(e).toString("hex")},stripZeros:a,keccak256:i,getKeys:function(e,t,n){var r=[];if(!Array.isArray(e))throw new Error("[ethjs-abi] while getting keys, invalid params value "+JSON.stringify(e));for(var s=0;s<e.length;s++){var i=e[s][t];if(n&&!i)i="";else if("string"!=typeof i)throw new Error("[ethjs-abi] while getKeys found invalid ABI data structure, type value not string");r.push(i)}return r},numberToBN:s,coderNumber:l,uint256Coder:d,coderBoolean:h,coderFixedBytes:f,coderAddress:p,coderDynamicBytes:y,coderString:v,coderArray:b,paramTypePart:w,getParamCoder:function(e){for(var t=e,n=null,r="[ethjs-abi] while getting param coder (getParamCoder) type value "+JSON.stringify(t)+" is either invalid or unsupported by ethjs-abi.";t;){var s=t.match(w);if(!s)throw new Error(r);t=t.substring(s[0].length);var i=s[2]||s[4]||s[5];switch(i){case"int":case"uint":if(n)throw new Error(r);var a=parseInt(s[3]||256);if(0===a||a>256||a%8!=0)throw new Error("[ethjs-abi] while getting param coder for type "+t+", invalid "+i+"<N> width: "+t);n=l(a/8,"int"===i);break;case"bool":if(n)throw new Error(r);n=h;break;case"string":if(n)throw new Error(r);n=v;break;case"bytes":if(n)throw new Error(r);if(s[3]){var o=parseInt(s[3]);if(0===o||o>32)throw new Error("[ethjs-abi] while getting param coder for prefix bytes, invalid type "+t+", size "+o+" should be 0 or greater than 32");n=f(o)}else n=y;break;case"address":if(n)throw new Error(r);n=p;break;case"[]":if(!n||n.dynamic)throw new Error(r);n=b(n,-1);break;default:if(!n||n.dynamic)throw new Error(r);n=b(n,parseInt(s[6]))}}if(!n)throw new Error(r);return n}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"ethjs-abi",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/rpc-methods/node_modules/ethjs-contract/node_modules/ethjs-abi/lib/utils/index.js"}],[1309,{"babel-runtime/core-js/json/stringify":1816,"babel-runtime/core-js/object/assign":1817,"babel-runtime/core-js/object/define-property":1819,"babel-runtime/core-js/object/keys":1820,"babel-runtime/helpers/asyncToGenerator":1825,"babel-runtime/regenerator":1942,"ethjs-format":2568,"ethjs-rpc":2571,"promise-to-callback":5422},function(){with(this)return function(){"use strict";return function(e,t,n){var r=u(e("babel-runtime/regenerator")),s=u(e("babel-runtime/core-js/json/stringify")),i=u(e("babel-runtime/helpers/asyncToGenerator")),a=u(e("babel-runtime/core-js/object/define-property")),o=u(e("babel-runtime/core-js/object/keys")),c=u(e("babel-runtime/core-js/object/assign"));function u(e){return e&&e.__esModule?e:{default:e}}var l=e("ethjs-format"),d=e("ethjs-rpc"),h=e("promise-to-callback");function f(e,t){var n=this,r=t||{};if(!(this instanceof f))throw new Error('[ethjs-query] the Eth object requires the "new" flag in order to function normally (i.e. `const eth = new Eth(provider);`).');if("object"!=typeof e)throw new Error("[ethjs-query] the Eth object requires that the first input 'provider' must be an object, got '"+typeof e+"' (i.e. 'const eth = new Eth(provider);')");n.options=(0,c.default)({debug:r.debug||!1,logger:r.logger||console,jsonSpace:r.jsonSpace||0}),n.rpc=new d(e),n.setProvider=n.rpc.setProvider}function p(e,t){return function(){var n,a=(n=(0,i.default)(r.default.mark((function n(){var i,a;return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(d.length<t[2])){n.next=2;break}throw new Error("[ethjs-query] method '"+f+"' requires at least "+t[2]+" input (format type "+t[0][0]+"), "+d.length+" provided. For more information visit: https://github.com/ethereum/wiki/wiki/JSON-RPC#"+e.toLowerCase());case 2:if(!(d.length>t[0].length)){n.next=4;break}throw new Error("[ethjs-query] method '"+f+"' requires at most "+t[0].length+" params, "+d.length+" provided '"+(0,s.default)(d,null,u.options.jsonSpace)+"'. For more information visit: https://github.com/ethereum/wiki/wiki/JSON-RPC#"+e.toLowerCase());case 4:t[3]&&d.length<t[3]&&d.push("latest"),this.log("attempting method formatting for '"+f+"' with inputs "+(0,s.default)(d,null,this.options.jsonSpace)),n.prev=6,c=l.formatInputs(e,d),this.log("method formatting success for '"+f+"' with formatted result: "+(0,s.default)(c,null,this.options.jsonSpace)),n.next=14;break;case 11:throw n.prev=11,n.t0=n.catch(6),new Error("[ethjs-query] while formatting inputs '"+(0,s.default)(d,null,this.options.jsonSpace)+"' for method '"+f+"' error: "+n.t0);case 14:return n.next=16,this.rpc.sendAsync({method:e,params:c});case 16:return i=n.sent,n.prev=17,this.log("attempting method formatting for '"+f+"' with raw outputs: "+(0,s.default)(i,null,this.options.jsonSpace)),a=l.formatOutputs(e,i),this.log("method formatting success for '"+f+"' formatted result: "+(0,s.default)(a,null,this.options.jsonSpace)),n.abrupt("return",a);case 24:throw n.prev=24,n.t1=n.catch(17),new Error("[ethjs-query] while formatting outputs from RPC '"+(0,s.default)(i,null,this.options.jsonSpace)+"' for method '"+f+"' "+n.t1);case 28:case"end":return n.stop()}}),n,this,[[6,11],[17,24]])}))),function(){return n.apply(this,arguments)}),o=null,c=null,u=this,d=[].slice.call(arguments),f=e.replace("eth_","");d.length>0&&"function"==typeof d[d.length-1]&&(o=d.pop());var p=a.call(this);return o?h(p)(o):p}}t.exports=f,f.prototype.log=function(e){this.options.debug&&this.options.logger.log("[ethjs-query log] "+e)},(0,o.default)(l.schema.methods).forEach((function(e){(0,a.default)(f.prototype,e.replace("eth_",""),{enumerable:!0,value:p(e,l.schema.methods[e])})}))}}},{package:"ethjs-query",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/rpc-methods/node_modules/ethjs-query/lib/index.js"}],[131,{lodash:5172},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("lodash");const s=["METASWAP_GAS_PRICE_ESTIMATES_LAST_RETRIEVED","METASWAP_GAS_PRICE_ESTIMATES","cachedFetch","BASIC_PRICE_ESTIMATES_LAST_RETRIEVED","BASIC_PRICE_ESTIMATES","BASIC_GAS_AND_TIME_API_ESTIMATES","BASIC_GAS_AND_TIME_API_ESTIMATES_LAST_RETRIEVED","GAS_API_ESTIMATES_LAST_RETRIEVED","GAS_API_ESTIMATES"];var i={version:50,async migrate(e){const t=(0,r.cloneDeep)(e);return t.meta.version=50,s.forEach((e=>{var t;return null===(t=window.localStorage)||void 0===t?void 0:t.removeItem(e)})),t}};n.default=i}}},{package:"<root>",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/app/scripts/migrations/050.js"}],[1310,{"./lib/getTransactionSuccess.js":1311,"bn.js":1292,buffer:2081,"ethjs-abi":1302,"ethjs-contract":1306,"ethjs-filter":2567,"ethjs-provider-http":2569,"ethjs-query":1309,"ethjs-unit":2573,"ethjs-util":2575,"js-sha3":1312,"number-to-bn":5298},function(){with(this)return function(){"use strict";return function(e,t,n){(function(n){(function(){var r=e("ethjs-query"),s=e("ethjs-filter"),i=e("ethjs-contract"),a=e("ethjs-provider-http"),o=e("ethjs-abi"),c=e("ethjs-unit"),u=e("js-sha3").keccak_256,l=e("number-to-bn"),d=e("bn.js"),h=e("ethjs-util"),f=e("./lib/getTransactionSuccess.js");function p(e,t){if(!(this instanceof p))throw new Error('[ethjs] the Eth object requires you construct it with the "new" flag (i.e. `const eth = new Eth(...);`).');var n=this;n.options=t||{};var a=new r(e,n.options.query);Object.keys(Object.getPrototypeOf(a)).forEach((function(e){n[e]=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return a[e].apply(a,n)}})),n.filter=new s(a,n.options.query),n.contract=new i(a,n.options.query),n.currentProvider=a.rpc.currentProvider,n.setProvider=a.setProvider,n.getTransactionSuccess=f(n)}t.exports=p,p.BN=d,p.isAddress=function(e){return h.isHexString(e,20)},p.keccak256=function(e){return"0x"+u(e)},p.Buffer=n,p.isHexString=h.isHexString,p.fromWei=c.fromWei,p.toWei=c.toWei,p.toBN=l,p.abi=o,p.fromAscii=h.fromAscii,p.toAscii=h.toAscii,p.fromUtf8=h.fromUtf8,p.toUtf8=h.toUtf8,p.HttpProvider=a}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"ethjs",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/rpc-methods/node_modules/ethjs/lib/index.js"}],[1311,{},function(){with(this)return function(){"use strict";return function(e,t,n){t.exports=function(e){return function(t,n){var r=0,s=e.options.timeout||8e5,i=e.options.interval||7e3,a=new Promise((function(n,a){var o=setInterval((function(){(e.getTransactionReceipt(t,(function(e,t){e&&(clearInterval(o),a(e)),!e&&t&&(clearInterval(o),n(t))})),r>=s)&&(clearInterval(o),a("Receipt timeout waiting for tx hash: "+t));r+=i}),i)}));return n&&a.then((function(e){return n(null,e)})).catch((function(e){return n(e,null)})),n?null:a}}}}},{package:"ethjs",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/rpc-methods/node_modules/ethjs/lib/lib/getTransactionSuccess.js"}],[1312,{_process:5420},function(){with(this)return function(){"use strict";return function(e,t,n){(function(e){(function(){
/**
 * [js-sha3]{@link https://github.com/emn178/js-sha3}
 *
 * @version 0.5.5
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2015-2016
 * @license MIT
 */
!function(n){"object"==typeof e&&e.versions&&e.versions.node&&(n=global);for(var r=!n.JS_SHA3_TEST&&"object"==typeof t&&t.exports,s="0123456789abcdef".split(""),i=[0,8,16,24],a=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648],o=[224,256,384,512],c=["hex","buffer","arrayBuffer","array"],u=function(e,t,n){return function(r){return new v(e,t,e).update(r)[n]()}},l=function(e,t,n){return function(r,s){return new v(e,t,s).update(r)[n]()}},d=function(e,t){var n=u(e,t,"hex");n.create=function(){return new v(e,t,e)},n.update=function(e){return n.create().update(e)};for(var r=0;r<c.length;++r){var s=c[r];n[s]=u(e,t,s)}return n},h=[{name:"keccak",padding:[1,256,65536,16777216],bits:o,createMethod:d},{name:"sha3",padding:[6,1536,393216,100663296],bits:o,createMethod:d},{name:"shake",padding:[31,7936,2031616,520093696],bits:[128,256],createMethod:function(e,t){var n=l(e,t,"hex");n.create=function(n){return new v(e,t,n)},n.update=function(e,t){return n.create(t).update(e)};for(var r=0;r<c.length;++r){var s=c[r];n[s]=l(e,t,s)}return n}}],f={},p=0;p<h.length;++p)for(var m=h[p],g=m.bits,y=0;y<g.length;++y)f[m.name+"_"+g[y]]=m.createMethod(g[y],m.padding);function v(e,t,n){this.blocks=[],this.s=[],this.padding=t,this.outputBits=n,this.reset=!0,this.block=0,this.start=0,this.blockCount=1600-(e<<1)>>5,this.byteCount=this.blockCount<<2,this.outputBlocks=n>>5,this.extraBytes=(31&n)>>3;for(var r=0;r<50;++r)this.s[r]=0}v.prototype.update=function(e){var t="string"!=typeof e;t&&e.constructor==n.ArrayBuffer&&(e=new Uint8Array(e));for(var r,s,a=e.length,o=this.blocks,c=this.byteCount,u=this.blockCount,l=0,d=this.s;l<a;){if(this.reset)for(this.reset=!1,o[0]=this.block,r=1;r<u+1;++r)o[r]=0;if(t)for(r=this.start;l<a&&r<c;++l)o[r>>2]|=e[l]<<i[3&r++];else for(r=this.start;l<a&&r<c;++l)(s=e.charCodeAt(l))<128?o[r>>2]|=s<<i[3&r++]:s<2048?(o[r>>2]|=(192|s>>6)<<i[3&r++],o[r>>2]|=(128|63&s)<<i[3&r++]):s<55296||s>=57344?(o[r>>2]|=(224|s>>12)<<i[3&r++],o[r>>2]|=(128|s>>6&63)<<i[3&r++],o[r>>2]|=(128|63&s)<<i[3&r++]):(s=65536+((1023&s)<<10|1023&e.charCodeAt(++l)),o[r>>2]|=(240|s>>18)<<i[3&r++],o[r>>2]|=(128|s>>12&63)<<i[3&r++],o[r>>2]|=(128|s>>6&63)<<i[3&r++],o[r>>2]|=(128|63&s)<<i[3&r++]);if(this.lastByteIndex=r,r>=c){for(this.start=r-c,this.block=o[u],r=0;r<u;++r)d[r]^=o[r];b(d),this.reset=!0}else this.start=r}return this},v.prototype.finalize=function(){var e=this.blocks,t=this.lastByteIndex,n=this.blockCount,r=this.s;if(e[t>>2]|=this.padding[3&t],this.lastByteIndex==this.byteCount)for(e[0]=e[n],t=1;t<n+1;++t)e[t]=0;for(e[n-1]|=2147483648,t=0;t<n;++t)r[t]^=e[t];b(r)},v.prototype.toString=v.prototype.hex=function(){this.finalize();for(var e,t=this.blockCount,n=this.s,r=this.outputBlocks,i=this.extraBytes,a=0,o=0,c="";o<r;){for(a=0;a<t&&o<r;++a,++o)e=n[a],c+=s[e>>4&15]+s[15&e]+s[e>>12&15]+s[e>>8&15]+s[e>>20&15]+s[e>>16&15]+s[e>>28&15]+s[e>>24&15];o%t==0&&(b(n),a=0)}return i&&(e=n[a],i>0&&(c+=s[e>>4&15]+s[15&e]),i>1&&(c+=s[e>>12&15]+s[e>>8&15]),i>2&&(c+=s[e>>20&15]+s[e>>16&15])),c},v.prototype.arrayBuffer=function(){this.finalize();var e,t=this.blockCount,n=this.s,r=this.outputBlocks,s=this.extraBytes,i=0,a=0,o=this.outputBits>>3;e=s?new ArrayBuffer(r+1<<2):new ArrayBuffer(o);for(var c=new Uint32Array(e);a<r;){for(i=0;i<t&&a<r;++i,++a)c[a]=n[i];a%t==0&&b(n)}return s&&(c[i]=n[i],e=e.slice(0,o)),e},v.prototype.buffer=v.prototype.arrayBuffer,v.prototype.digest=v.prototype.array=function(){this.finalize();for(var e,t,n=this.blockCount,r=this.s,s=this.outputBlocks,i=this.extraBytes,a=0,o=0,c=[];o<s;){for(a=0;a<n&&o<s;++a,++o)e=o<<2,t=r[a],c[e]=255&t,c[e+1]=t>>8&255,c[e+2]=t>>16&255,c[e+3]=t>>24&255;o%n==0&&b(r)}return i&&(e=o<<2,t=r[a],i>0&&(c[e]=255&t),i>1&&(c[e+1]=t>>8&255),i>2&&(c[e+2]=t>>16&255)),c};var b=function(e){var t,n,r,s,i,o,c,u,l,d,h,f,p,m,g,y,v,b,w,k,_,E,S,P,x,M,j,C,T,A,O,I,R,N,D,B,L,U,F,q,$,H,G,K,V,z,W,J,Z,Y,Q,X,ee,te,ne,re,se,ie,ae,oe,ce,ue,le;for(r=0;r<48;r+=2)s=e[0]^e[10]^e[20]^e[30]^e[40],i=e[1]^e[11]^e[21]^e[31]^e[41],o=e[2]^e[12]^e[22]^e[32]^e[42],c=e[3]^e[13]^e[23]^e[33]^e[43],u=e[4]^e[14]^e[24]^e[34]^e[44],l=e[5]^e[15]^e[25]^e[35]^e[45],d=e[6]^e[16]^e[26]^e[36]^e[46],h=e[7]^e[17]^e[27]^e[37]^e[47],t=(f=e[8]^e[18]^e[28]^e[38]^e[48])^(o<<1|c>>>31),n=(p=e[9]^e[19]^e[29]^e[39]^e[49])^(c<<1|o>>>31),e[0]^=t,e[1]^=n,e[10]^=t,e[11]^=n,e[20]^=t,e[21]^=n,e[30]^=t,e[31]^=n,e[40]^=t,e[41]^=n,t=s^(u<<1|l>>>31),n=i^(l<<1|u>>>31),e[2]^=t,e[3]^=n,e[12]^=t,e[13]^=n,e[22]^=t,e[23]^=n,e[32]^=t,e[33]^=n,e[42]^=t,e[43]^=n,t=o^(d<<1|h>>>31),n=c^(h<<1|d>>>31),e[4]^=t,e[5]^=n,e[14]^=t,e[15]^=n,e[24]^=t,e[25]^=n,e[34]^=t,e[35]^=n,e[44]^=t,e[45]^=n,t=u^(f<<1|p>>>31),n=l^(p<<1|f>>>31),e[6]^=t,e[7]^=n,e[16]^=t,e[17]^=n,e[26]^=t,e[27]^=n,e[36]^=t,e[37]^=n,e[46]^=t,e[47]^=n,t=d^(s<<1|i>>>31),n=h^(i<<1|s>>>31),e[8]^=t,e[9]^=n,e[18]^=t,e[19]^=n,e[28]^=t,e[29]^=n,e[38]^=t,e[39]^=n,e[48]^=t,e[49]^=n,m=e[0],g=e[1],z=e[11]<<4|e[10]>>>28,W=e[10]<<4|e[11]>>>28,C=e[20]<<3|e[21]>>>29,T=e[21]<<3|e[20]>>>29,oe=e[31]<<9|e[30]>>>23,ce=e[30]<<9|e[31]>>>23,H=e[40]<<18|e[41]>>>14,G=e[41]<<18|e[40]>>>14,N=e[2]<<1|e[3]>>>31,D=e[3]<<1|e[2]>>>31,y=e[13]<<12|e[12]>>>20,v=e[12]<<12|e[13]>>>20,J=e[22]<<10|e[23]>>>22,Z=e[23]<<10|e[22]>>>22,A=e[33]<<13|e[32]>>>19,O=e[32]<<13|e[33]>>>19,ue=e[42]<<2|e[43]>>>30,le=e[43]<<2|e[42]>>>30,te=e[5]<<30|e[4]>>>2,ne=e[4]<<30|e[5]>>>2,B=e[14]<<6|e[15]>>>26,L=e[15]<<6|e[14]>>>26,b=e[25]<<11|e[24]>>>21,w=e[24]<<11|e[25]>>>21,Y=e[34]<<15|e[35]>>>17,Q=e[35]<<15|e[34]>>>17,I=e[45]<<29|e[44]>>>3,R=e[44]<<29|e[45]>>>3,P=e[6]<<28|e[7]>>>4,x=e[7]<<28|e[6]>>>4,re=e[17]<<23|e[16]>>>9,se=e[16]<<23|e[17]>>>9,U=e[26]<<25|e[27]>>>7,F=e[27]<<25|e[26]>>>7,k=e[36]<<21|e[37]>>>11,_=e[37]<<21|e[36]>>>11,X=e[47]<<24|e[46]>>>8,ee=e[46]<<24|e[47]>>>8,K=e[8]<<27|e[9]>>>5,V=e[9]<<27|e[8]>>>5,M=e[18]<<20|e[19]>>>12,j=e[19]<<20|e[18]>>>12,ie=e[29]<<7|e[28]>>>25,ae=e[28]<<7|e[29]>>>25,q=e[38]<<8|e[39]>>>24,$=e[39]<<8|e[38]>>>24,E=e[48]<<14|e[49]>>>18,S=e[49]<<14|e[48]>>>18,e[0]=m^~y&b,e[1]=g^~v&w,e[10]=P^~M&C,e[11]=x^~j&T,e[20]=N^~B&U,e[21]=D^~L&F,e[30]=K^~z&J,e[31]=V^~W&Z,e[40]=te^~re&ie,e[41]=ne^~se&ae,e[2]=y^~b&k,e[3]=v^~w&_,e[12]=M^~C&A,e[13]=j^~T&O,e[22]=B^~U&q,e[23]=L^~F&$,e[32]=z^~J&Y,e[33]=W^~Z&Q,e[42]=re^~ie&oe,e[43]=se^~ae&ce,e[4]=b^~k&E,e[5]=w^~_&S,e[14]=C^~A&I,e[15]=T^~O&R,e[24]=U^~q&H,e[25]=F^~$&G,e[34]=J^~Y&X,e[35]=Z^~Q&ee,e[44]=ie^~oe&ue,e[45]=ae^~ce&le,e[6]=k^~E&m,e[7]=_^~S&g,e[16]=A^~I&P,e[17]=O^~R&x,e[26]=q^~H&N,e[27]=$^~G&D,e[36]=Y^~X&K,e[37]=Q^~ee&V,e[46]=oe^~ue&te,e[47]=ce^~le&ne,e[8]=E^~m&y,e[9]=S^~g&v,e[18]=I^~P&M,e[19]=R^~x&j,e[28]=H^~N&B,e[29]=G^~D&L,e[38]=X^~K&z,e[39]=ee^~V&W,e[48]=ue^~te&re,e[49]=le^~ne&se,e[0]^=a[r],e[1]^=a[r+1]};if(r)t.exports=f;else if(n)for(var w in f)n[w]=f[w]}(this)}).call(this)}).call(this,e("_process"))}}},{package:"js-sha3",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/rpc-methods/node_modules/js-sha3/src/sha3.js"}],[1313,{"./url-alphabet/index.cjs":1314},function(){with(this)return function(){"use strict";return function(e,t,n){let{urlAlphabet:r}=e("./url-alphabet/index.cjs");let s=e=>crypto.getRandomValues(new Uint8Array(e)),i=(e,t,n)=>{let r=(2<<Math.log(e.length-1)/Math.LN2)-1,s=-~(1.6*r*t/e.length);return()=>{let i="";for(;;){let a=n(s),o=s;for(;o--;)if(i+=e[a[o]&r]||"",i.length===t)return i}}};t.exports={nanoid:(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;){let r=63&n[e];t+=r<36?r.toString(36):r<62?(r-26).toString(36).toUpperCase():r<63?"_":"-"}return t},customAlphabet:(e,t)=>i(e,t,s),customRandom:i,urlAlphabet:r,random:s}}}},{package:"nanoid",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/rpc-methods/node_modules/nanoid/index.browser.cjs"}],[1314,{},function(){with(this)return function(){"use strict";return function(e,t,n){t.exports={urlAlphabet:"useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"}}}},{package:"nanoid",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/rpc-methods/node_modules/nanoid/url-alphabet/index.cjs"}],[1317,{"./constants":1318,"./types":1320,"./utils":1321,"@metamask/controllers":1042,"bignumber.js":1322,ethers:2545,"lodash/cloneDeep":5148,"lodash/mapValues":5173},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.CANCELLABLE_INTERVAL=n.DEFAULT_INTERVAL=void 0;const s=e("@metamask/controllers"),i=e("bignumber.js"),a=e("ethers"),o=r(e("lodash/mapValues")),c=r(e("lodash/cloneDeep")),u=e("./types"),l=e("./utils"),d=e("./constants"),{safelyExecute:h}=s.util;n.DEFAULT_INTERVAL=5e3,n.CANCELLABLE_INTERVAL=6e4;class f extends s.BaseController{constructor({onNetworkStateChange:e,getNonceLock:t,getNetwork:r,provider:s,confirmExternalTransaction:i,trackMetaMetricsEvent:o},c,u){super(c,u),this.defaultConfig={interval:n.DEFAULT_INTERVAL,chainId:d.CHAIN_IDS.ETHEREUM,clientId:"default",supportedChainIds:[d.CHAIN_IDS.ETHEREUM,d.CHAIN_IDS.RINKEBY]},this.defaultState={smartTransactionsState:{smartTransactions:{},userOptIn:undefined,fees:undefined,liveness:!0,estimatedGas:{txData:undefined,approvalTxData:undefined}}},this.getNonceLock=t,this.getNetwork=r,this.ethersProvider=new a.ethers.providers.Web3Provider(s),this.confirmExternalTransaction=i,this.trackMetaMetricsEvent=o,this.initialize(),this.initializeSmartTransactionsForChainId(),e((({provider:e})=>{const{chainId:t}=e;this.configure({chainId:t}),this.initializeSmartTransactionsForChainId(),this.checkPoll(this.state),this.ethersProvider=new a.ethers.providers.Web3Provider(s)})),this.subscribe((e=>this.checkPoll(e)))}async fetch(e,t){const{clientId:n}=this.config,r=Object.assign(Object.assign({},t),{headers:Object.assign({"Content-Type":"application/json"},n&&{"X-Client-Id":n})});return l.handleFetch(e,r)}checkPoll(e){const{smartTransactions:t}=e.smartTransactionsState,n=t[this.config.chainId],r=null==n?void 0:n.filter(l.isSmartTransactionPending);!this.timeoutHandle&&(null==r?void 0:r.length)>0?this.poll():this.timeoutHandle&&0===(null==r?void 0:r.length)&&this.stop()}initializeSmartTransactionsForChainId(){var e;if(this.config.supportedChainIds.includes(this.config.chainId)){const{smartTransactionsState:t}=this.state;this.update({smartTransactionsState:Object.assign(Object.assign({},t),{smartTransactions:Object.assign(Object.assign({},t.smartTransactions),{[this.config.chainId]:null!==(e=t.smartTransactions[this.config.chainId])&&void 0!==e?e:[]})})})}}async poll(e){const{chainId:t,supportedChainIds:n}=this.config;e&&this.configure({interval:e},!1,!1),this.timeoutHandle&&clearInterval(this.timeoutHandle),n.includes(t)&&(await h((()=>this.updateSmartTransactions())),this.timeoutHandle=setInterval((()=>{h((()=>this.updateSmartTransactions()))}),this.config.interval))}async stop(){this.timeoutHandle&&clearInterval(this.timeoutHandle),this.timeoutHandle=undefined}setOptInState(e){this.update({smartTransactionsState:Object.assign(Object.assign({},this.state.smartTransactionsState),{userOptIn:e})})}trackStxStatusChange(e,t){var n,r;if(!t)return;let s=c.default(e);if(s=Object.assign(Object.assign({},c.default(t)),s),!s.swapMetaData||s.status===t.status&&t.swapMetaData)return;const i={uuid:s.uuid,stx_status:s.status,token_from_address:null===(n=s.txParams)||void 0===n?void 0:n.from,token_from_symbol:s.sourceTokenSymbol,token_to_address:null===(r=s.txParams)||void 0===r?void 0:r.to,token_to_symbol:s.destinationTokenSymbol,processing_time:l.getStxProcessingTime(s.time),stx_enabled:!0,current_stx_enabled:!0,stx_user_opt_in:!0};this.trackMetaMetricsEvent({event:"STX Status Updated",category:"swaps",sensitiveProperties:i})}isNewSmartTransaction(e){const{chainId:t}=this.config,{smartTransactionsState:n}=this.state,{smartTransactions:r}=n,s=r[t],i=null==s?void 0:s.findIndex((t=>t.uuid===e));return-1===i||i===undefined}updateSmartTransaction(e){const{chainId:t}=this.config,{smartTransactionsState:n}=this.state,{smartTransactions:r}=n,s=r[t],i=null==s?void 0:s.findIndex((t=>t.uuid===e.uuid)),a=this.isNewSmartTransaction(e.uuid);if(this.trackStxStatusChange(e,a?undefined:s[i]),a){const r=s.findIndex((t=>{var n,r,s;return(null===(n=t.txParams)||void 0===n?void 0:n.nonce)===(null===(r=e.txParams)||void 0===r?void 0:r.nonce)&&(null===(s=t.status)||void 0===s?void 0:s.startsWith("cancelled"))})),i=[c.default(e)],a=Object.assign(Object.assign({},e),{history:i}),o=r>-1?s.slice(0,r).concat(s.slice(r+1)).concat(a):s.concat(a);this.update({smartTransactionsState:Object.assign(Object.assign({},n),{smartTransactions:Object.assign(Object.assign({},n.smartTransactions),{[t]:o})})})}else{if((e.status===u.SmartTransactionStatuses.SUCCESS||e.status===u.SmartTransactionStatuses.REVERTED)&&!e.confirmed){const t=s[i],n=Object.assign(Object.assign({},t),e);this.confirmSmartTransaction(n)}this.update({smartTransactionsState:Object.assign(Object.assign({},n),{smartTransactions:Object.assign(Object.assign({},n.smartTransactions),{[t]:n.smartTransactions[t].map(((t,n)=>n===i?Object.assign(Object.assign({},t),e):t))})})})}}async updateSmartTransactions(){const{smartTransactions:e}=this.state.smartTransactionsState,{chainId:t}=this.config,n=(null==e?void 0:e[t]).filter(l.isSmartTransactionPending).map((e=>e.uuid));n.length>0&&this.fetchSmartTransactionsStatus(n)}async confirmSmartTransaction(e){var t,n,r;const s=null===(t=e.statusMetadata)||void 0===t?void 0:t.minedHash;try{const t=await this.ethersProvider.getTransactionReceipt(s),i=await this.ethersProvider.getTransaction(s),c=null===(n=i.maxFeePerGas)||void 0===n?void 0:n.toHexString(),u=null===(r=i.maxPriorityFeePerGas)||void 0===r?void 0:r.toHexString();if(null==t?void 0:t.blockNumber){const n=await this.ethersProvider.getBlock(null==t?void 0:t.blockNumber,!1),r=null==n?void 0:n.baseFeePerGas.toHexString(),i=o.default(t,(e=>e instanceof a.ethers.BigNumber?e.toHexString():e)),d=Object.assign(Object.assign({},e.txParams),{maxFeePerGas:c,maxPriorityFeePerGas:u}),h=Object.assign(Object.assign({},e),{id:e.uuid,status:"confirmed",hash:s,txParams:d}),f=l.snapshotFromTxMeta(h),p=l.replayHistory(h.history),m=l.generateHistoryEntry(p,f,"txStateManager: setting status to confirmed"),g=m.length>0?Object.assign(Object.assign({},h),{history:h.history.concat(m)}):h;this.confirmExternalTransaction(g,i,r),this.trackMetaMetricsEvent({event:"STX Confirmed",category:"swaps"}),this.updateSmartTransaction(Object.assign(Object.assign({},e),{confirmed:!0}))}}catch(e){this.trackMetaMetricsEvent({event:"STX Confirmation Failed",category:"swaps"}),console.error("confirm error",e)}}async fetchSmartTransactionsStatus(e){const{chainId:t}=this.config,n=new URLSearchParams({uuids:e.join(",")}),r=`${l.getAPIRequestURL(u.APIType.BATCH_STATUS,t)}?${n.toString()}`,s=await this.fetch(r);return Object.entries(s).forEach((([e,t])=>{this.updateSmartTransaction({statusMetadata:t,status:l.calculateStatus(t),uuid:e})})),s}async addNonceToTransaction(e){const t=await this.getNonceLock(e.from),n=t.nextNonce;return t.releaseLock(),Object.assign(Object.assign({},e),{nonce:`0x${n.toString(16)}`})}async getFees(e){const{chainId:t}=this.config,n=await this.addNonceToTransaction(e),r=await this.fetch(l.getAPIRequestURL(u.APIType.GET_FEES,t),{method:"POST",body:JSON.stringify({tx:n})});return this.update({smartTransactionsState:Object.assign(Object.assign({},this.state.smartTransactionsState),{fees:r})}),r}async estimateGas(e,t){const{chainId:n}=this.config;let r;if(t){const e=await this.addNonceToTransaction(t);r=await this.fetch(l.getAPIRequestURL(u.APIType.ESTIMATE_GAS,n),{method:"POST",body:JSON.stringify({tx:e})})}const s=await this.addNonceToTransaction(e),i=await this.fetch(l.getAPIRequestURL(u.APIType.ESTIMATE_GAS,n),{method:"POST",body:JSON.stringify(Object.assign({tx:s},t&&{pending_txs:[t]}))});return this.update({smartTransactionsState:Object.assign(Object.assign({},this.state.smartTransactionsState),{estimatedGas:{txData:i,approvalTxData:r}})}),i}async submitSignedTransactions({txParams:e,signedTransactions:t,signedCanceledTransactions:r}){const{chainId:s}=this.config,o=await this.fetch(l.getAPIRequestURL(u.APIType.SUBMIT_TRANSACTIONS,s),{method:"POST",body:JSON.stringify({rawTxs:t,rawCancelTxs:r})}),c=Date.now(),d=this.getNetwork();let h;try{const t=await this.ethersProvider.getBalance(null==e?void 0:e.from);h=new i.BigNumber(t.toHexString()).toString(16)}catch(e){console.error("ethers error",e)}const f=await this.getNonceLock(null==e?void 0:e.from),p=a.ethers.utils.hexlify(f.nextNonce);e&&!(null==e?void 0:e.nonce)&&(e.nonce=p);const{nonceDetails:m}=f;return this.updateSmartTransaction({chainId:s,nonceDetails:m,metamaskNetworkId:d,preTxBalance:h,status:u.SmartTransactionStatuses.PENDING,time:c,txParams:e,uuid:o.uuid,cancellable:!0}),setTimeout((()=>{this.isNewSmartTransaction(o.uuid)||this.updateSmartTransaction({uuid:o.uuid,cancellable:!1})}),n.CANCELLABLE_INTERVAL),f.releaseLock(),o}async cancelSmartTransaction(e){const{chainId:t}=this.config;await this.fetch(l.getAPIRequestURL(u.APIType.CANCEL,t),{method:"POST",body:JSON.stringify({uuid:e})})}async fetchLiveness(){const{chainId:e}=this.config;let t=!1;try{const n=await this.fetch(l.getAPIRequestURL(u.APIType.LIVENESS,e));t=Boolean(n.lastBlock)}catch(e){console.log('"fetchLiveness" API call failed')}return this.update({smartTransactionsState:Object.assign(Object.assign({},this.state.smartTransactionsState),{liveness:t})}),t}async setStatusRefreshInterval(e){e!==this.config.interval&&this.configure({interval:e},!1,!1)}getTransactions({addressFrom:e,status:t}){const{smartTransactions:n}=this.state.smartTransactionsState,{chainId:r}=this.config,s=null==n?void 0:n[r];return s&&0!==s.length?s.filter((n=>{var r;return n.status===t&&(null===(r=n.txParams)||void 0===r?void 0:r.from)===e})):[]}}n.default=f}}},{package:"@metamask/smart-transactions-controller",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/smart-transactions-controller/dist/SmartTransactionsController.js"}],[1318,{},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.CHAIN_IDS=n.API_BASE_URL=void 0,n.API_BASE_URL="https://transaction.metaswap.codefi.network",n.CHAIN_IDS={ETHEREUM:"0x1",RINKEBY:"0x4",BSC:"0x38"}}}},{package:"@metamask/smart-transactions-controller",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/smart-transactions-controller/dist/constants.js"}],[1319,{"./SmartTransactionsController":1317,"isomorphic-fetch":4714},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),e("isomorphic-fetch");const s=r(e("./SmartTransactionsController"));n.default=s.default}}},{package:"@metamask/smart-transactions-controller",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/smart-transactions-controller/dist/index.js"}],[132,{"../../../shared/constants/network":6189,lodash:5172},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("lodash"),s=e("../../../shared/constants/network");var i={version:51,async migrate(e){const t=(0,r.cloneDeep)(e);t.meta.version=51;const n=t.data;return t.data=function(e){var t,n;const{chainId:r,type:i}=(null==e||null===(t=e.NetworkController)||void 0===t?void 0:t.provider)||{},a=null===(n=s.NETWORK_TYPE_TO_ID_MAP[i])||void 0===n?void 0:n.chainId;a&&r!==a&&(e.NetworkController.provider.chainId=a);return e}(n),t}};n.default=i}}},{package:"<root>",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/app/scripts/migrations/051.js"}],[1320,{},function(){with(this)return function(){"use strict";return function(e,t,n){var r,s;Object.defineProperty(n,"__esModule",{value:!0}),n.cancellationReasonToStatusMap=n.SmartTransactionStatuses=n.SmartTransactionCancellationReason=n.SmartTransactionMinedTx=n.APIType=void 0,function(e){e[e.GET_FEES=0]="GET_FEES",e[e.ESTIMATE_GAS=1]="ESTIMATE_GAS",e[e.SUBMIT_TRANSACTIONS=2]="SUBMIT_TRANSACTIONS",e[e.CANCEL=3]="CANCEL",e[e.BATCH_STATUS=4]="BATCH_STATUS",e[e.LIVENESS=5]="LIVENESS"}(n.APIType||(n.APIType={})),function(e){e.NOT_MINED="not_mined",e.SUCCESS="success",e.CANCELLED="cancelled",e.REVERTED="reverted",e.UNKNOWN="unknown"}(n.SmartTransactionMinedTx||(n.SmartTransactionMinedTx={})),function(e){e.WOULD_REVERT="would_revert",e.TOO_CHEAP="too_cheap",e.DEADLINE_MISSED="deadline_missed",e.INVALID_NONCE="invalid_nonce",e.USER_CANCELLED="user_cancelled",e.NOT_CANCELLED="not_cancelled"}(r=n.SmartTransactionCancellationReason||(n.SmartTransactionCancellationReason={})),function(e){e.PENDING="pending",e.SUCCESS="success",e.REVERTED="reverted",e.UNKNOWN="unknown",e.CANCELLED="cancelled",e.CANCELLED_WOULD_REVERT="cancelled_would_revert",e.CANCELLED_TOO_CHEAP="cancelled_too_cheap",e.CANCELLED_DEADLINE_MISSED="cancelled_deadline_missed",e.CANCELLED_INVALID_NONCE="cancelled_invalid_nonce",e.CANCELLED_USER_CANCELLED="cancelled_user_cancelled",e.RESOLVED="resolved"}(s=n.SmartTransactionStatuses||(n.SmartTransactionStatuses={})),n.cancellationReasonToStatusMap={[r.WOULD_REVERT]:s.CANCELLED_WOULD_REVERT,[r.TOO_CHEAP]:s.CANCELLED_TOO_CHEAP,[r.DEADLINE_MISSED]:s.CANCELLED_DEADLINE_MISSED,[r.INVALID_NONCE]:s.CANCELLED_INVALID_NONCE,[r.USER_CANCELLED]:s.CANCELLED_USER_CANCELLED}}}},{package:"@metamask/smart-transactions-controller",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/smart-transactions-controller/dist/types.js"}],[1321,{"./constants":1318,"./types":1320,"fast-json-patch":1326,lodash:5172},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.handleFetch=n.getStxProcessingTime=n.snapshotFromTxMeta=n.replayHistory=n.generateHistoryEntry=n.calculateStatus=n.getAPIRequestURL=n.isSmartTransactionStatusResolved=n.isSmartTransactionPending=void 0;const s=r(e("fast-json-patch")),i=e("lodash"),a=e("./types"),o=e("./constants");n.isSmartTransactionPending=function(e){return e.status===a.SmartTransactionStatuses.PENDING};n.isSmartTransactionStatusResolved=e=>"uuid_not_found"===e,n.getAPIRequestURL=function(e,t){const n=parseInt(t,16);switch(e){case a.APIType.GET_FEES:return`${o.API_BASE_URL}/networks/${n}/getFees`;case a.APIType.ESTIMATE_GAS:return`${o.API_BASE_URL}/networks/${n}/estimateGas`;case a.APIType.SUBMIT_TRANSACTIONS:return`${o.API_BASE_URL}/networks/${n}/submitTransactions`;case a.APIType.CANCEL:return`${o.API_BASE_URL}/networks/${n}/cancel`;case a.APIType.BATCH_STATUS:return`${o.API_BASE_URL}/networks/${n}/batchStatus`;case a.APIType.LIVENESS:return`${o.API_BASE_URL}/networks/${n}/health`;default:throw new Error("Invalid APIType")}};n.calculateStatus=e=>{if(n.isSmartTransactionStatusResolved(e))return a.SmartTransactionStatuses.RESOLVED;const t=[a.SmartTransactionCancellationReason.WOULD_REVERT,a.SmartTransactionCancellationReason.TOO_CHEAP,a.SmartTransactionCancellationReason.DEADLINE_MISSED,a.SmartTransactionCancellationReason.INVALID_NONCE,a.SmartTransactionCancellationReason.USER_CANCELLED];if((null==e?void 0:e.minedTx)===a.SmartTransactionMinedTx.NOT_MINED){if(e.cancellationReason===a.SmartTransactionCancellationReason.NOT_CANCELLED)return a.SmartTransactionStatuses.PENDING;const n=t.findIndex((t=>t===e.cancellationReason))>-1;if(e.cancellationReason&&n)return a.cancellationReasonToStatusMap[e.cancellationReason]}else{if((null==e?void 0:e.minedTx)===a.SmartTransactionMinedTx.SUCCESS)return a.SmartTransactionStatuses.SUCCESS;if((null==e?void 0:e.minedTx)===a.SmartTransactionMinedTx.CANCELLED)return a.SmartTransactionStatuses.CANCELLED;if((null==e?void 0:e.minedTx)===a.SmartTransactionMinedTx.REVERTED)return a.SmartTransactionStatuses.REVERTED;if((null==e?void 0:e.minedTx)===a.SmartTransactionMinedTx.UNKNOWN)return a.SmartTransactionStatuses.UNKNOWN}return a.SmartTransactionStatuses.UNKNOWN},n.generateHistoryEntry=function(e,t,n){const r=s.default.compare(e,t);return r[0]&&(n&&(r[0].note=n),r[0].timestamp=Date.now()),r},n.replayHistory=function(e){return i.cloneDeep(e).reduce(((e,t)=>s.default.applyPatch(e,t).newDocument))},n.snapshotFromTxMeta=function(e){const t=Object.assign({},e);return delete t.history,i.cloneDeep(t)};n.getStxProcessingTime=e=>e?Math.round((Date.now()-e)/1e3):undefined,n.handleFetch=async function(e,t){const n=await fetch(e,t),r=await n.json();if(!n.ok){const{error:e,error_details:t}=r;throw console.log("response",n),new Error(`Fetch error:${JSON.stringify({status:n.status,type:e,message:t})}`)}return r}}}},{package:"@metamask/smart-transactions-controller",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/smart-transactions-controller/dist/utils.js"}],[1322,{},function(){with(this)return function(){"use strict";return function(e,t,n){!function(e){var n,r=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,s=Math.ceil,i=Math.floor,a="[BigNumber Error] ",o=a+"Number primitive has more than 15 significant digits: ",c=1e14,u=14,l=9007199254740991,d=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],h=1e7,f=1e9;function p(e){var t=0|e;return e>0||e===t?t:t-1}function m(e){for(var t,n,r=1,s=e.length,i=e[0]+"";r<s;){for(t=e[r++]+"",n=u-t.length;n--;t="0"+t);i+=t}for(s=i.length;48===i.charCodeAt(--s););return i.slice(0,s+1||1)}function g(e,t){var n,r,s=e.c,i=t.c,a=e.s,o=t.s,c=e.e,u=t.e;if(!a||!o)return null;if(n=s&&!s[0],r=i&&!i[0],n||r)return n?r?0:-o:a;if(a!=o)return a;if(n=a<0,r=c==u,!s||!i)return r?0:!s^n?1:-1;if(!r)return c>u^n?1:-1;for(o=(c=s.length)<(u=i.length)?c:u,a=0;a<o;a++)if(s[a]!=i[a])return s[a]>i[a]^n?1:-1;return c==u?0:c>u^n?1:-1}function y(e,t,n,r){if(e<t||e>n||e!==i(e))throw Error(a+(r||"Argument")+("number"==typeof e?e<t||e>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function v(e){var t=e.c.length-1;return p(e.e/u)==t&&e.c[t]%2!=0}function b(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function w(e,t,n){var r,s;if(t<0){for(s=n+".";++t;s+=n);e=s+e}else if(++t>(r=e.length)){for(s=n,t-=r;--t;s+=n);e+=s}else t<r&&(e=e.slice(0,t)+"."+e.slice(t));return e}n=function e(t){var n,k,_,E,S,P,x,M,j,C,T=H.prototype={constructor:H,toString:null,valueOf:null},A=new H(1),O=20,I=4,R=-7,N=21,D=-1e7,B=1e7,L=!1,U=1,F=0,q={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},$="0123456789abcdefghijklmnopqrstuvwxyz";function H(e,t){var n,s,a,c,d,h,f,p,m=this;if(!(m instanceof H))return new H(e,t);if(null==t){if(e&&!0===e._isBigNumber)return m.s=e.s,void(!e.c||e.e>B?m.c=m.e=null:e.e<D?m.c=[m.e=0]:(m.e=e.e,m.c=e.c.slice()));if((h="number"==typeof e)&&0*e==0){if(m.s=1/e<0?(e=-e,-1):1,e===~~e){for(c=0,d=e;d>=10;d/=10,c++);return void(c>B?m.c=m.e=null:(m.e=c,m.c=[e]))}p=String(e)}else{if(!r.test(p=String(e)))return _(m,p,h);m.s=45==p.charCodeAt(0)?(p=p.slice(1),-1):1}(c=p.indexOf("."))>-1&&(p=p.replace(".","")),(d=p.search(/e/i))>0?(c<0&&(c=d),c+=+p.slice(d+1),p=p.substring(0,d)):c<0&&(c=p.length)}else{if(y(t,2,$.length,"Base"),10==t)return z(m=new H(e),O+m.e+1,I);if(p=String(e),h="number"==typeof e){if(0*e!=0)return _(m,p,h,t);if(m.s=1/e<0?(p=p.slice(1),-1):1,H.DEBUG&&p.replace(/^0\.0*|\./,"").length>15)throw Error(o+e)}else m.s=45===p.charCodeAt(0)?(p=p.slice(1),-1):1;for(n=$.slice(0,t),c=d=0,f=p.length;d<f;d++)if(n.indexOf(s=p.charAt(d))<0){if("."==s){if(d>c){c=f;continue}}else if(!a&&(p==p.toUpperCase()&&(p=p.toLowerCase())||p==p.toLowerCase()&&(p=p.toUpperCase()))){a=!0,d=-1,c=0;continue}return _(m,String(e),h,t)}h=!1,(c=(p=k(p,t,10,m.s)).indexOf("."))>-1?p=p.replace(".",""):c=p.length}for(d=0;48===p.charCodeAt(d);d++);for(f=p.length;48===p.charCodeAt(--f););if(p=p.slice(d,++f)){if(f-=d,h&&H.DEBUG&&f>15&&(e>l||e!==i(e)))throw Error(o+m.s*e);if((c=c-d-1)>B)m.c=m.e=null;else if(c<D)m.c=[m.e=0];else{if(m.e=c,m.c=[],d=(c+1)%u,c<0&&(d+=u),d<f){for(d&&m.c.push(+p.slice(0,d)),f-=u;d<f;)m.c.push(+p.slice(d,d+=u));d=u-(p=p.slice(d)).length}else d-=f;for(;d--;p+="0");m.c.push(+p)}}else m.c=[m.e=0]}function G(e,t,n,r){var s,i,a,o,c;if(null==n?n=I:y(n,0,8),!e.c)return e.toString();if(s=e.c[0],a=e.e,null==t)c=m(e.c),c=1==r||2==r&&(a<=R||a>=N)?b(c,a):w(c,a,"0");else if(i=(e=z(new H(e),t,n)).e,o=(c=m(e.c)).length,1==r||2==r&&(t<=i||i<=R)){for(;o<t;c+="0",o++);c=b(c,i)}else if(t-=a,c=w(c,i,"0"),i+1>o){if(--t>0)for(c+=".";t--;c+="0");}else if((t+=i-o)>0)for(i+1==o&&(c+=".");t--;c+="0");return e.s<0&&s?"-"+c:c}function K(e,t){for(var n,r=1,s=new H(e[0]);r<e.length;r++){if(!(n=new H(e[r])).s){s=n;break}t.call(s,n)&&(s=n)}return s}function V(e,t,n){for(var r=1,s=t.length;!t[--s];t.pop());for(s=t[0];s>=10;s/=10,r++);return(n=r+n*u-1)>B?e.c=e.e=null:n<D?e.c=[e.e=0]:(e.e=n,e.c=t),e}function z(e,t,n,r){var a,o,l,h,f,p,m,g=e.c,y=d;if(g){e:{for(a=1,h=g[0];h>=10;h/=10,a++);if((o=t-a)<0)o+=u,l=t,m=(f=g[p=0])/y[a-l-1]%10|0;else if((p=s((o+1)/u))>=g.length){if(!r)break e;for(;g.length<=p;g.push(0));f=m=0,a=1,l=(o%=u)-u+1}else{for(f=h=g[p],a=1;h>=10;h/=10,a++);m=(l=(o%=u)-u+a)<0?0:f/y[a-l-1]%10|0}if(r=r||t<0||null!=g[p+1]||(l<0?f:f%y[a-l-1]),r=n<4?(m||r)&&(0==n||n==(e.s<0?3:2)):m>5||5==m&&(4==n||r||6==n&&(o>0?l>0?f/y[a-l]:0:g[p-1])%10&1||n==(e.s<0?8:7)),t<1||!g[0])return g.length=0,r?(t-=e.e+1,g[0]=y[(u-t%u)%u],e.e=-t||0):g[0]=e.e=0,e;if(0==o?(g.length=p,h=1,p--):(g.length=p+1,h=y[u-o],g[p]=l>0?i(f/y[a-l]%y[l])*h:0),r)for(;;){if(0==p){for(o=1,l=g[0];l>=10;l/=10,o++);for(l=g[0]+=h,h=1;l>=10;l/=10,h++);o!=h&&(e.e++,g[0]==c&&(g[0]=1));break}if(g[p]+=h,g[p]!=c)break;g[p--]=0,h=1}for(o=g.length;0===g[--o];g.pop());}e.e>B?e.c=e.e=null:e.e<D&&(e.c=[e.e=0])}return e}function W(e){var t,n=e.e;return null===n?e.toString():(t=m(e.c),t=n<=R||n>=N?b(t,n):w(t,n,"0"),e.s<0?"-"+t:t)}return H.clone=e,H.ROUND_UP=0,H.ROUND_DOWN=1,H.ROUND_CEIL=2,H.ROUND_FLOOR=3,H.ROUND_HALF_UP=4,H.ROUND_HALF_DOWN=5,H.ROUND_HALF_EVEN=6,H.ROUND_HALF_CEIL=7,H.ROUND_HALF_FLOOR=8,H.EUCLID=9,H.config=H.set=function(e){var t,n;if(null!=e){if("object"!=typeof e)throw Error(a+"Object expected: "+e);if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(y(n=e[t],0,f,t),O=n),e.hasOwnProperty(t="ROUNDING_MODE")&&(y(n=e[t],0,8,t),I=n),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((n=e[t])&&n.pop?(y(n[0],-f,0,t),y(n[1],0,f,t),R=n[0],N=n[1]):(y(n,-f,f,t),R=-(N=n<0?-n:n))),e.hasOwnProperty(t="RANGE"))if((n=e[t])&&n.pop)y(n[0],-f,-1,t),y(n[1],1,f,t),D=n[0],B=n[1];else{if(y(n,-f,f,t),!n)throw Error(a+t+" cannot be zero: "+n);D=-(B=n<0?-n:n)}if(e.hasOwnProperty(t="CRYPTO")){if((n=e[t])!==!!n)throw Error(a+t+" not true or false: "+n);if(n){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw L=!n,Error(a+"crypto unavailable");L=n}else L=n}if(e.hasOwnProperty(t="MODULO_MODE")&&(y(n=e[t],0,9,t),U=n),e.hasOwnProperty(t="POW_PRECISION")&&(y(n=e[t],0,f,t),F=n),e.hasOwnProperty(t="FORMAT")){if("object"!=typeof(n=e[t]))throw Error(a+t+" not an object: "+n);q=n}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(n=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(n))throw Error(a+t+" invalid: "+n);$=n}}return{DECIMAL_PLACES:O,ROUNDING_MODE:I,EXPONENTIAL_AT:[R,N],RANGE:[D,B],CRYPTO:L,MODULO_MODE:U,POW_PRECISION:F,FORMAT:q,ALPHABET:$}},H.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!H.DEBUG)return!0;var t,n,r=e.c,s=e.e,o=e.s;e:if("[object Array]"=={}.toString.call(r)){if((1===o||-1===o)&&s>=-f&&s<=f&&s===i(s)){if(0===r[0]){if(0===s&&1===r.length)return!0;break e}if((t=(s+1)%u)<1&&(t+=u),String(r[0]).length==t){for(t=0;t<r.length;t++)if((n=r[t])<0||n>=c||n!==i(n))break e;if(0!==n)return!0}}}else if(null===r&&null===s&&(null===o||1===o||-1===o))return!0;throw Error(a+"Invalid BigNumber: "+e)},H.maximum=H.max=function(){return K(arguments,T.lt)},H.minimum=H.min=function(){return K(arguments,T.gt)},H.random=(E=9007199254740992,S=Math.random()*E&2097151?function(){return i(Math.random()*E)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(e){var t,n,r,o,c,l=0,h=[],p=new H(A);if(null==e?e=O:y(e,0,f),o=s(e/u),L)if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(o*=2));l<o;)(c=131072*t[l]+(t[l+1]>>>11))>=9e15?(n=crypto.getRandomValues(new Uint32Array(2)),t[l]=n[0],t[l+1]=n[1]):(h.push(c%1e14),l+=2);l=o/2}else{if(!crypto.randomBytes)throw L=!1,Error(a+"crypto unavailable");for(t=crypto.randomBytes(o*=7);l<o;)(c=281474976710656*(31&t[l])+1099511627776*t[l+1]+4294967296*t[l+2]+16777216*t[l+3]+(t[l+4]<<16)+(t[l+5]<<8)+t[l+6])>=9e15?crypto.randomBytes(7).copy(t,l):(h.push(c%1e14),l+=7);l=o/7}if(!L)for(;l<o;)(c=S())<9e15&&(h[l++]=c%1e14);for(o=h[--l],e%=u,o&&e&&(c=d[u-e],h[l]=i(o/c)*c);0===h[l];h.pop(),l--);if(l<0)h=[r=0];else{for(r=-1;0===h[0];h.splice(0,1),r-=u);for(l=1,c=h[0];c>=10;c/=10,l++);l<u&&(r-=u-l)}return p.e=r,p.c=h,p}),H.sum=function(){for(var e=1,t=arguments,n=new H(t[0]);e<t.length;)n=n.plus(t[e++]);return n},k=function(){var e="0123456789";function t(e,t,n,r){for(var s,i,a=[0],o=0,c=e.length;o<c;){for(i=a.length;i--;a[i]*=t);for(a[0]+=r.indexOf(e.charAt(o++)),s=0;s<a.length;s++)a[s]>n-1&&(null==a[s+1]&&(a[s+1]=0),a[s+1]+=a[s]/n|0,a[s]%=n)}return a.reverse()}return function(r,s,i,a,o){var c,u,l,d,h,f,p,g,y=r.indexOf("."),v=O,b=I;for(y>=0&&(d=F,F=0,r=r.replace(".",""),f=(g=new H(s)).pow(r.length-y),F=d,g.c=t(w(m(f.c),f.e,"0"),10,i,e),g.e=g.c.length),l=d=(p=t(r,s,i,o?(c=$,e):(c=e,$))).length;0==p[--d];p.pop());if(!p[0])return c.charAt(0);if(y<0?--l:(f.c=p,f.e=l,f.s=a,p=(f=n(f,g,v,b,i)).c,h=f.r,l=f.e),y=p[u=l+v+1],d=i/2,h=h||u<0||null!=p[u+1],h=b<4?(null!=y||h)&&(0==b||b==(f.s<0?3:2)):y>d||y==d&&(4==b||h||6==b&&1&p[u-1]||b==(f.s<0?8:7)),u<1||!p[0])r=h?w(c.charAt(1),-v,c.charAt(0)):c.charAt(0);else{if(p.length=u,h)for(--i;++p[--u]>i;)p[u]=0,u||(++l,p=[1].concat(p));for(d=p.length;!p[--d];);for(y=0,r="";y<=d;r+=c.charAt(p[y++]));r=w(r,l,c.charAt(0))}return r}}(),n=function(){function e(e,t,n){var r,s,i,a,o=0,c=e.length,u=t%h,l=t/h|0;for(e=e.slice();c--;)o=((s=u*(i=e[c]%h)+(r=l*i+(a=e[c]/h|0)*u)%h*h+o)/n|0)+(r/h|0)+l*a,e[c]=s%n;return o&&(e=[o].concat(e)),e}function t(e,t,n,r){var s,i;if(n!=r)i=n>r?1:-1;else for(s=i=0;s<n;s++)if(e[s]!=t[s]){i=e[s]>t[s]?1:-1;break}return i}function n(e,t,n,r){for(var s=0;n--;)e[n]-=s,s=e[n]<t[n]?1:0,e[n]=s*r+e[n]-t[n];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(r,s,a,o,l){var d,h,f,m,g,y,v,b,w,k,_,E,S,P,x,M,j,C=r.s==s.s?1:-1,T=r.c,A=s.c;if(!(T&&T[0]&&A&&A[0]))return new H(r.s&&s.s&&(T?!A||T[0]!=A[0]:A)?T&&0==T[0]||!A?0*C:C/0:NaN);for(w=(b=new H(C)).c=[],C=a+(h=r.e-s.e)+1,l||(l=c,h=p(r.e/u)-p(s.e/u),C=C/u|0),f=0;A[f]==(T[f]||0);f++);if(A[f]>(T[f]||0)&&h--,C<0)w.push(1),m=!0;else{for(P=T.length,M=A.length,f=0,C+=2,(g=i(l/(A[0]+1)))>1&&(A=e(A,g,l),T=e(T,g,l),M=A.length,P=T.length),S=M,_=(k=T.slice(0,M)).length;_<M;k[_++]=0);j=A.slice(),j=[0].concat(j),x=A[0],A[1]>=l/2&&x++;do{if(g=0,(d=t(A,k,M,_))<0){if(E=k[0],M!=_&&(E=E*l+(k[1]||0)),(g=i(E/x))>1)for(g>=l&&(g=l-1),v=(y=e(A,g,l)).length,_=k.length;1==t(y,k,v,_);)g--,n(y,M<v?j:A,v,l),v=y.length,d=1;else 0==g&&(d=g=1),v=(y=A.slice()).length;if(v<_&&(y=[0].concat(y)),n(k,y,_,l),_=k.length,-1==d)for(;t(A,k,M,_)<1;)g++,n(k,M<_?j:A,_,l),_=k.length}else 0===d&&(g++,k=[0]);w[f++]=g,k[0]?k[_++]=T[S]||0:(k=[T[S]],_=1)}while((S++<P||null!=k[0])&&C--);m=null!=k[0],w[0]||w.splice(0,1)}if(l==c){for(f=1,C=w[0];C>=10;C/=10,f++);z(b,a+(b.e=f+h*u-1)+1,o,m)}else b.e=h,b.r=+m;return b}}(),P=/^(-?)0([xbo])(?=\w[\w.]*$)/i,x=/^([^.]+)\.$/,M=/^\.([^.]+)$/,j=/^-?(Infinity|NaN)$/,C=/^\s*\+(?=[\w.])|^\s+|\s+$/g,_=function(e,t,n,r){var s,i=n?t:t.replace(C,"");if(j.test(i))e.s=isNaN(i)?null:i<0?-1:1;else{if(!n&&(i=i.replace(P,(function(e,t,n){return s="x"==(n=n.toLowerCase())?16:"b"==n?2:8,r&&r!=s?e:t})),r&&(s=r,i=i.replace(x,"$1").replace(M,"0.$1")),t!=i))return new H(i,s);if(H.DEBUG)throw Error(a+"Not a"+(r?" base "+r:"")+" number: "+t);e.s=null}e.c=e.e=null},T.absoluteValue=T.abs=function(){var e=new H(this);return e.s<0&&(e.s=1),e},T.comparedTo=function(e,t){return g(this,new H(e,t))},T.decimalPlaces=T.dp=function(e,t){var n,r,s,i=this;if(null!=e)return y(e,0,f),null==t?t=I:y(t,0,8),z(new H(i),e+i.e+1,t);if(!(n=i.c))return null;if(r=((s=n.length-1)-p(this.e/u))*u,s=n[s])for(;s%10==0;s/=10,r--);return r<0&&(r=0),r},T.dividedBy=T.div=function(e,t){return n(this,new H(e,t),O,I)},T.dividedToIntegerBy=T.idiv=function(e,t){return n(this,new H(e,t),0,1)},T.exponentiatedBy=T.pow=function(e,t){var n,r,o,c,l,d,h,f,p=this;if((e=new H(e)).c&&!e.isInteger())throw Error(a+"Exponent not an integer: "+W(e));if(null!=t&&(t=new H(t)),l=e.e>14,!p.c||!p.c[0]||1==p.c[0]&&!p.e&&1==p.c.length||!e.c||!e.c[0])return f=new H(Math.pow(+W(p),l?2-v(e):+W(e))),t?f.mod(t):f;if(d=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new H(NaN);(r=!d&&p.isInteger()&&t.isInteger())&&(p=p.mod(t))}else{if(e.e>9&&(p.e>0||p.e<-1||(0==p.e?p.c[0]>1||l&&p.c[1]>=24e7:p.c[0]<8e13||l&&p.c[0]<=9999975e7)))return c=p.s<0&&v(e)?-0:0,p.e>-1&&(c=1/c),new H(d?1/c:c);F&&(c=s(F/u+2))}for(l?(n=new H(.5),d&&(e.s=1),h=v(e)):h=(o=Math.abs(+W(e)))%2,f=new H(A);;){if(h){if(!(f=f.times(p)).c)break;c?f.c.length>c&&(f.c.length=c):r&&(f=f.mod(t))}if(o){if(0===(o=i(o/2)))break;h=o%2}else if(z(e=e.times(n),e.e+1,1),e.e>14)h=v(e);else{if(0===(o=+W(e)))break;h=o%2}p=p.times(p),c?p.c&&p.c.length>c&&(p.c.length=c):r&&(p=p.mod(t))}return r?f:(d&&(f=A.div(f)),t?f.mod(t):c?z(f,F,I,undefined):f)},T.integerValue=function(e){var t=new H(this);return null==e?e=I:y(e,0,8),z(t,t.e+1,e)},T.isEqualTo=T.eq=function(e,t){return 0===g(this,new H(e,t))},T.isFinite=function(){return!!this.c},T.isGreaterThan=T.gt=function(e,t){return g(this,new H(e,t))>0},T.isGreaterThanOrEqualTo=T.gte=function(e,t){return 1===(t=g(this,new H(e,t)))||0===t},T.isInteger=function(){return!!this.c&&p(this.e/u)>this.c.length-2},T.isLessThan=T.lt=function(e,t){return g(this,new H(e,t))<0},T.isLessThanOrEqualTo=T.lte=function(e,t){return-1===(t=g(this,new H(e,t)))||0===t},T.isNaN=function(){return!this.s},T.isNegative=function(){return this.s<0},T.isPositive=function(){return this.s>0},T.isZero=function(){return!!this.c&&0==this.c[0]},T.minus=function(e,t){var n,r,s,i,a=this,o=a.s;if(t=(e=new H(e,t)).s,!o||!t)return new H(NaN);if(o!=t)return e.s=-t,a.plus(e);var l=a.e/u,d=e.e/u,h=a.c,f=e.c;if(!l||!d){if(!h||!f)return h?(e.s=-t,e):new H(f?a:NaN);if(!h[0]||!f[0])return f[0]?(e.s=-t,e):new H(h[0]?a:3==I?-0:0)}if(l=p(l),d=p(d),h=h.slice(),o=l-d){for((i=o<0)?(o=-o,s=h):(d=l,s=f),s.reverse(),t=o;t--;s.push(0));s.reverse()}else for(r=(i=(o=h.length)<(t=f.length))?o:t,o=t=0;t<r;t++)if(h[t]!=f[t]){i=h[t]<f[t];break}if(i&&(s=h,h=f,f=s,e.s=-e.s),(t=(r=f.length)-(n=h.length))>0)for(;t--;h[n++]=0);for(t=c-1;r>o;){if(h[--r]<f[r]){for(n=r;n&&!h[--n];h[n]=t);--h[n],h[r]+=c}h[r]-=f[r]}for(;0==h[0];h.splice(0,1),--d);return h[0]?V(e,h,d):(e.s=3==I?-1:1,e.c=[e.e=0],e)},T.modulo=T.mod=function(e,t){var r,s,i=this;return e=new H(e,t),!i.c||!e.s||e.c&&!e.c[0]?new H(NaN):!e.c||i.c&&!i.c[0]?new H(i):(9==U?(s=e.s,e.s=1,r=n(i,e,0,3),e.s=s,r.s*=s):r=n(i,e,0,U),(e=i.minus(r.times(e))).c[0]||1!=U||(e.s=i.s),e)},T.multipliedBy=T.times=function(e,t){var n,r,s,i,a,o,l,d,f,m,g,y,v,b,w,k=this,_=k.c,E=(e=new H(e,t)).c;if(!(_&&E&&_[0]&&E[0]))return!k.s||!e.s||_&&!_[0]&&!E||E&&!E[0]&&!_?e.c=e.e=e.s=null:(e.s*=k.s,_&&E?(e.c=[0],e.e=0):e.c=e.e=null),e;for(r=p(k.e/u)+p(e.e/u),e.s*=k.s,(l=_.length)<(m=E.length)&&(v=_,_=E,E=v,s=l,l=m,m=s),s=l+m,v=[];s--;v.push(0));for(b=c,w=h,s=m;--s>=0;){for(n=0,g=E[s]%w,y=E[s]/w|0,i=s+(a=l);i>s;)n=((d=g*(d=_[--a]%w)+(o=y*d+(f=_[a]/w|0)*g)%w*w+v[i]+n)/b|0)+(o/w|0)+y*f,v[i--]=d%b;v[i]=n}return n?++r:v.splice(0,1),V(e,v,r)},T.negated=function(){var e=new H(this);return e.s=-e.s||null,e},T.plus=function(e,t){var n,r=this,s=r.s;if(t=(e=new H(e,t)).s,!s||!t)return new H(NaN);if(s!=t)return e.s=-t,r.minus(e);var i=r.e/u,a=e.e/u,o=r.c,l=e.c;if(!i||!a){if(!o||!l)return new H(s/0);if(!o[0]||!l[0])return l[0]?e:new H(o[0]?r:0*s)}if(i=p(i),a=p(a),o=o.slice(),s=i-a){for(s>0?(a=i,n=l):(s=-s,n=o),n.reverse();s--;n.push(0));n.reverse()}for((s=o.length)-(t=l.length)<0&&(n=l,l=o,o=n,t=s),s=0;t;)s=(o[--t]=o[t]+l[t]+s)/c|0,o[t]=c===o[t]?0:o[t]%c;return s&&(o=[s].concat(o),++a),V(e,o,a)},T.precision=T.sd=function(e,t){var n,r,s,i=this;if(null!=e&&e!==!!e)return y(e,1,f),null==t?t=I:y(t,0,8),z(new H(i),e,t);if(!(n=i.c))return null;if(r=(s=n.length-1)*u+1,s=n[s]){for(;s%10==0;s/=10,r--);for(s=n[0];s>=10;s/=10,r++);}return e&&i.e+1>r&&(r=i.e+1),r},T.shiftedBy=function(e){return y(e,-9007199254740991,l),this.times("1e"+e)},T.squareRoot=T.sqrt=function(){var e,t,r,s,i,a=this,o=a.c,c=a.s,u=a.e,l=O+4,d=new H("0.5");if(1!==c||!o||!o[0])return new H(!c||c<0&&(!o||o[0])?NaN:o?a:1/0);if(0==(c=Math.sqrt(+W(a)))||c==1/0?(((t=m(o)).length+u)%2==0&&(t+="0"),c=Math.sqrt(+t),u=p((u+1)/2)-(u<0||u%2),r=new H(t=c==1/0?"5e"+u:(t=c.toExponential()).slice(0,t.indexOf("e")+1)+u)):r=new H(c+""),r.c[0])for((c=(u=r.e)+l)<3&&(c=0);;)if(i=r,r=d.times(i.plus(n(a,i,l,1))),m(i.c).slice(0,c)===(t=m(r.c)).slice(0,c)){if(r.e<u&&--c,"9999"!=(t=t.slice(c-3,c+1))&&(s||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(z(r,r.e+O+2,1),e=!r.times(r).eq(a));break}if(!s&&(z(i,i.e+O+2,0),i.times(i).eq(a))){r=i;break}l+=4,c+=4,s=1}return z(r,r.e+O+1,I,e)},T.toExponential=function(e,t){return null!=e&&(y(e,0,f),e++),G(this,e,t,1)},T.toFixed=function(e,t){return null!=e&&(y(e,0,f),e=e+this.e+1),G(this,e,t)},T.toFormat=function(e,t,n){var r,s=this;if(null==n)null!=e&&t&&"object"==typeof t?(n=t,t=null):e&&"object"==typeof e?(n=e,e=t=null):n=q;else if("object"!=typeof n)throw Error(a+"Argument not an object: "+n);if(r=s.toFixed(e,t),s.c){var i,o=r.split("."),c=+n.groupSize,u=+n.secondaryGroupSize,l=n.groupSeparator||"",d=o[0],h=o[1],f=s.s<0,p=f?d.slice(1):d,m=p.length;if(u&&(i=c,c=u,u=i,m-=i),c>0&&m>0){for(i=m%c||c,d=p.substr(0,i);i<m;i+=c)d+=l+p.substr(i,c);u>0&&(d+=l+p.slice(i)),f&&(d="-"+d)}r=h?d+(n.decimalSeparator||"")+((u=+n.fractionGroupSize)?h.replace(new RegExp("\\d{"+u+"}\\B","g"),"$&"+(n.fractionGroupSeparator||"")):h):d}return(n.prefix||"")+r+(n.suffix||"")},T.toFraction=function(e){var t,r,s,i,o,c,l,h,f,p,g,y,v=this,b=v.c;if(null!=e&&(!(l=new H(e)).isInteger()&&(l.c||1!==l.s)||l.lt(A)))throw Error(a+"Argument "+(l.isInteger()?"out of range: ":"not an integer: ")+W(l));if(!b)return new H(v);for(t=new H(A),f=r=new H(A),s=h=new H(A),y=m(b),o=t.e=y.length-v.e-1,t.c[0]=d[(c=o%u)<0?u+c:c],e=!e||l.comparedTo(t)>0?o>0?t:f:l,c=B,B=1/0,l=new H(y),h.c[0]=0;p=n(l,t,0,1),1!=(i=r.plus(p.times(s))).comparedTo(e);)r=s,s=i,f=h.plus(p.times(i=f)),h=i,t=l.minus(p.times(i=t)),l=i;return i=n(e.minus(r),s,0,1),h=h.plus(i.times(f)),r=r.plus(i.times(s)),h.s=f.s=v.s,g=n(f,s,o*=2,I).minus(v).abs().comparedTo(n(h,r,o,I).minus(v).abs())<1?[f,s]:[h,r],B=c,g},T.toNumber=function(){return+W(this)},T.toPrecision=function(e,t){return null!=e&&y(e,1,f),G(this,e,t,2)},T.toString=function(e){var t,n=this,r=n.s,s=n.e;return null===s?r?(t="Infinity",r<0&&(t="-"+t)):t="NaN":(null==e?t=s<=R||s>=N?b(m(n.c),s):w(m(n.c),s,"0"):10===e?t=w(m((n=z(new H(n),O+s+1,I)).c),n.e,"0"):(y(e,2,$.length,"Base"),t=k(w(m(n.c),s,"0"),10,e,r,!0)),r<0&&n.c[0]&&(t="-"+t)),t},T.valueOf=T.toJSON=function(){return W(this)},T._isBigNumber=!0,null!=t&&H.set(t),H}(),n.default=n.BigNumber=n,"function"==typeof define&&define.amd?define((function(){return n})):void 0!==t&&t.exports?t.exports=n:(e||(e="undefined"!=typeof self&&self?self:window),e.BigNumber=n)}(this)}}},{package:"bignumber.js",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/smart-transactions-controller/node_modules/bignumber.js/bignumber.js"}],[1323,{"./helpers.js":1325},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r=e("./helpers.js");n.JsonPatchError=r.PatchError,n.deepClone=r._deepClone;var s={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var s=a(n,this.path);s&&(s=r._deepClone(s));var i=o(n,{op:"remove",path:this.from}).removed;return o(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:s}},copy:function(e,t,n){var s=a(n,this.from);return o(n,{op:"add",path:this.path,value:r._deepClone(s)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:d(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},i={add:function(e,t,n){return r.isInteger(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:s.move,copy:s.copy,test:s.test,_get:s._get};function a(e,t){if(""==t)return e;var n={op:"_get",path:t};return o(e,n),n.value}function o(e,t,o,c,l,h){if(void 0===o&&(o=!1),void 0===c&&(c=!0),void 0===l&&(l=!0),void 0===h&&(h=0),o&&("function"==typeof o?o(t,0,e,t.path):u(t,0)),""===t.path){var f={newDocument:e};if("add"===t.op)return f.newDocument=t.value,f;if("replace"===t.op)return f.newDocument=t.value,f.removed=e,f;if("move"===t.op||"copy"===t.op)return f.newDocument=a(e,t.from),"move"===t.op&&(f.removed=e),f;if("test"===t.op){if(f.test=d(e,t.value),!1===f.test)throw new n.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",h,t,e);return f.newDocument=e,f}if("remove"===t.op)return f.removed=e,f.newDocument=null,f;if("_get"===t.op)return t.value=e,f;if(o)throw new n.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",h,t,e);return f}c||(e=r._deepClone(e));var p=(t.path||"").split("/"),m=e,g=1,y=p.length,v=undefined,b=void 0,w=void 0;for(w="function"==typeof o?o:u;;){if((b=p[g])&&-1!=b.indexOf("~")&&(b=r.unescapePathComponent(b)),l&&"__proto__"==b)throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(o&&v===undefined&&(m[b]===undefined?v=p.slice(0,g).join("/"):g==y-1&&(v=t.path),v!==undefined&&w(t,0,e,v)),g++,Array.isArray(m)){if("-"===b)b=m.length;else{if(o&&!r.isInteger(b))throw new n.JsonPatchError("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",h,t,e);r.isInteger(b)&&(b=~~b)}if(g>=y){if(o&&"add"===t.op&&b>m.length)throw new n.JsonPatchError("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",h,t,e);if(!1===(f=i[t.op].call(t,m,b,e)).test)throw new n.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",h,t,e);return f}}else if(g>=y){if(!1===(f=s[t.op].call(t,m,b,e)).test)throw new n.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",h,t,e);return f}if(m=m[b],o&&g<y&&(!m||"object"!=typeof m))throw new n.JsonPatchError("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",h,t,e)}}function c(e,t,s,i,a){if(void 0===i&&(i=!0),void 0===a&&(a=!0),s&&!Array.isArray(t))throw new n.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");i||(e=r._deepClone(e));for(var c=new Array(t.length),u=0,l=t.length;u<l;u++)c[u]=o(e,t[u],s,!0,a,u),e=c[u].newDocument;return c.newDocument=e,c}function u(e,t,i,a){if("object"!=typeof e||null===e||Array.isArray(e))throw new n.JsonPatchError("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,i);if(!s[e.op])throw new n.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,i);if("string"!=typeof e.path)throw new n.JsonPatchError("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,i);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new n.JsonPatchError('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,i);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new n.JsonPatchError("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,i);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&e.value===undefined)throw new n.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,i);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&r.hasUndefined(e.value))throw new n.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,i);if(i)if("add"==e.op){var o=e.path.split("/").length,c=a.split("/").length;if(o!==c+1&&o!==c)throw new n.JsonPatchError("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,i)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==a)throw new n.JsonPatchError("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,i)}else if("move"===e.op||"copy"===e.op){var u=l([{op:"_get",path:e.from,value:undefined}],i);if(u&&"OPERATION_PATH_UNRESOLVABLE"===u.name)throw new n.JsonPatchError("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,i)}}function l(e,t,s){try{if(!Array.isArray(e))throw new n.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)c(r._deepClone(t),r._deepClone(e),s||!0);else{s=s||u;for(var i=0;i<e.length;i++)s(e[i],i,t,undefined)}}catch(e){if(e instanceof n.JsonPatchError)return e;throw e}}function d(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var n,r,s,i=Array.isArray(e),a=Array.isArray(t);if(i&&a){if((r=e.length)!=t.length)return!1;for(n=r;0!=n--;)if(!d(e[n],t[n]))return!1;return!0}if(i!=a)return!1;var o=Object.keys(e);if((r=o.length)!==Object.keys(t).length)return!1;for(n=r;0!=n--;)if(!t.hasOwnProperty(o[n]))return!1;for(n=r;0!=n--;)if(!d(e[s=o[n]],t[s]))return!1;return!0}return e!=e&&t!=t}n.getValueByPointer=a,n.applyOperation=o,n.applyPatch=c,n.applyReducer=function(e,t,r){var s=o(e,t);if(!1===s.test)throw new n.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",r,t,e);return s.newDocument},n.validator=u,n.validate=l,n._areEquals=d}}},{package:"fast-json-patch",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/smart-transactions-controller/node_modules/fast-json-patch/commonjs/core.js"}],[1324,{"./core.js":1323,"./helpers.js":1325},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});
/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */
var r=e("./helpers.js"),s=e("./core.js"),i=new WeakMap,a=function(e){this.observers=new Map,this.obj=e},o=function(e,t){this.callback=e,this.observer=t};function c(e,t){void 0===t&&(t=!1);var n=i.get(e.object);u(n.value,e.object,e.patches,"",t),e.patches.length&&s.applyPatch(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function u(e,t,n,s,i){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var a=r._objectKeys(t),o=r._objectKeys(e),c=!1,l=o.length-1;l>=0;l--){var d=e[f=o[l]];if(!r.hasOwnProperty(t,f)||t[f]===undefined&&d!==undefined&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:s+"/"+r.escapePathComponent(f),value:r._deepClone(d)}),n.push({op:"remove",path:s+"/"+r.escapePathComponent(f)}),c=!0):(i&&n.push({op:"test",path:s,value:e}),n.push({op:"replace",path:s,value:t}),!0);else{var h=t[f];"object"==typeof d&&null!=d&&"object"==typeof h&&null!=h&&Array.isArray(d)===Array.isArray(h)?u(d,h,n,s+"/"+r.escapePathComponent(f),i):d!==h&&(!0,i&&n.push({op:"test",path:s+"/"+r.escapePathComponent(f),value:r._deepClone(d)}),n.push({op:"replace",path:s+"/"+r.escapePathComponent(f),value:r._deepClone(h)}))}}if(c||a.length!=o.length)for(l=0;l<a.length;l++){var f=a[l];r.hasOwnProperty(e,f)||t[f]===undefined||n.push({op:"add",path:s+"/"+r.escapePathComponent(f),value:r._deepClone(t[f])})}}}n.unobserve=function(e,t){t.unobserve()},n.observe=function(e,t){var n,s=function(e){return i.get(e)}(e);if(s){var u=function(e,t){return e.observers.get(t)}(s,t);n=u&&u.observer}else s=new a(e),i.set(e,s);if(n)return n;if(n={},s.value=r._deepClone(e),t){n.callback=t,n.next=null;var l=function(){c(n)},d=function(){clearTimeout(n.next),n.next=setTimeout(l)};"undefined"!=typeof window&&(window.addEventListener("mouseup",d),window.addEventListener("keyup",d),window.addEventListener("mousedown",d),window.addEventListener("keydown",d),window.addEventListener("change",d))}return n.patches=[],n.object=e,n.unobserve=function(){c(n),clearTimeout(n.next),function(e,t){e.observers.delete(t.callback)}(s,n),"undefined"!=typeof window&&(window.removeEventListener("mouseup",d),window.removeEventListener("keyup",d),window.removeEventListener("mousedown",d),window.removeEventListener("keydown",d),window.removeEventListener("change",d))},s.observers.set(t,new o(t,n)),n},n.generate=c,n.compare=function(e,t,n){void 0===n&&(n=!1);var r=[];return u(e,t,r,"",n),r}}}},{package:"fast-json-patch",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/smart-transactions-controller/node_modules/fast-json-patch/commonjs/duplex.js"}],[1325,{},function(){with(this)return function(){"use strict";return function(e,t,n){
/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */
var r,s=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},r(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var i=Object.prototype.hasOwnProperty;function a(e,t){return i.call(e,t)}function o(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);t=[];for(var r in e)a(e,r)&&t.push(r);return t}function c(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function u(e,t){var n;for(var r in e)if(a(e,r)){if(e[r]===t)return c(r)+"/";if("object"==typeof e[r]&&""!=(n=u(e[r],t)))return c(r)+"/"+n}return""}function l(e,t){var n=[e];for(var r in t){var s="object"==typeof t[r]?JSON.stringify(t[r],null,2):t[r];void 0!==s&&n.push(r+": "+s)}return n.join("\n")}Object.defineProperty(n,"hasOwnProperty",{value:a}),n._objectKeys=o,n._deepClone=function(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}},n.isInteger=function(e){for(var t,n=0,r=e.length;n<r;){if(!((t=e.charCodeAt(n))>=48&&t<=57))return!1;n++}return!0},n.escapePathComponent=c,n.unescapePathComponent=function(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")},n._getPathRecursive=u,n.getPath=function(e,t){if(e===t)return"/";var n=u(e,t);if(""===n)throw new Error("Object not found in root");return"/"+n},n.hasUndefined=function e(t){if(t===undefined)return!0;if(t)if(Array.isArray(t)){for(var n=0,r=t.length;n<r;n++)if(e(t[n]))return!0}else if("object"==typeof t){var s=o(t),i=s.length;for(n=0;n<i;n++)if(e(t[s[n]]))return!0}return!1};var d=function(e){function t(t,n,r,s,i){var a=this.constructor,o=e.call(this,l(t,{name:n,index:r,operation:s,tree:i}))||this;return o.name=n,o.index=r,o.operation=s,o.tree=i,Object.setPrototypeOf(o,a.prototype),o.message=l(t,{name:n,index:r,operation:s,tree:i}),o}return s(t,e),t}(Error);n.PatchError=d}}},{package:"fast-json-patch",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/smart-transactions-controller/node_modules/fast-json-patch/commonjs/helpers.js"}],[1326,{"./commonjs/core.js":1323,"./commonjs/duplex.js":1324,"./commonjs/helpers.js":1325},function(){with(this)return function(){"use strict";return function(e,t,n){var r=e("./commonjs/core.js");Object.assign(n,r);var s=e("./commonjs/duplex.js");Object.assign(n,s);var i=e("./commonjs/helpers.js");n.JsonPatchError=i.PatchError,n.deepClone=i._deepClone,n.escapePathComponent=i.escapePathComponent,n.unescapePathComponent=i.unescapePathComponent}}},{package:"fast-json-patch",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/smart-transactions-controller/node_modules/fast-json-patch/index.js"}],[1327,{"./resource":1329,"./services":1333,"./snaps":1335,"./utils":1340},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),s(e("./resource"),n),s(e("./services"),n),s(e("./snaps"),n),s(e("./utils"),n)}}},{package:"@metamask/snap-controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/dist/index.js"}],[1328,{"@metamask/obs-store":1409,"@metamask/safe-event-emitter":1315,"eth-rpc-errors":2455,nanoid:1453},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.ExternalResourceController=void 0;const s=e("@metamask/obs-store"),i=r(e("@metamask/safe-event-emitter")),a=e("eth-rpc-errors"),o=e("nanoid"),c=e=>`Not authorized to access resource with id "${e}".`;class u extends i.default{constructor({storageKey:e,requiredFields:t,initialResources:n}){super(),this.requiredFields=t,this.storageKey=e,this.store=new s.ObservableStore(((e,t)=>({[e]:t}))(e,n))}getResources(){return Object.assign({},this.store.getState()[this.storageKey])}setResources(e){this.store.updateState({[this.storageKey]:e})}clearResources(){this.setResources({})}deleteResourcesFor(e){const t=this.getResources(),n=Object.entries(t).reduce(((t,[n,r])=>(r.fromDomain!==e&&(t[n]=r),t)),{});this.setResources(n)}get(e,t){const n=this.getResources()[t];if(n&&n.fromDomain!==e)throw a.ethErrors.provider.unauthorized({message:c(t)});return n?Object.assign({},n):null}getAllResources(e){return Object.values(this.getResources()).filter((t=>t.fromDomain===e))}add(e,t){const n=this.processNewResource(e,t),{id:r}=n,s=this.getResources();if(s[r])throw new Error(`Resource with id "${r}" already exists.`);return s[r]=n,this.setResources(s),n.id}update(e,t){const{id:n}=t,r=this.getResources(),s=r[n];if(!s)throw a.ethErrors.rpc.resourceNotFound({message:`Resource with id "${n}" not found.`});if(s.fromDomain!==e)throw a.ethErrors.provider.unauthorized({message:c(n)});return r[n]=this.processNewResource(e,Object.assign(Object.assign({},r[n]),t)),this.setResources(r),n}processNewResource(e,t){return this.requiredFields.forEach((n=>{if(!(n in t))throw a.ethErrors.rpc.invalidParams(`Resource from "${e}" missing required field: ${n}`)})),Object.assign(Object.assign({},t),{fromDomain:e,id:t.id||o.nanoid()})}delete(e,t){const n=this.getResources(),r=n[t];if(!r)throw a.ethErrors.rpc.invalidParams({message:`Resource with id "${t}" not found.`});if(r.fromDomain!==e)throw a.ethErrors.provider.unauthorized({message:c(t)});return delete n[t],this.setResources(n),null}handleRpcRequest(e,t,n){if(!e||"string"!=typeof e)throw new Error("Invalid fromDomain.");switch(t){case"get":return this.get(e,n);case"getAll":return this.getAllResources(e);case"add":return this.add(e,n);case"update":return this.update(e,n);case"delete":return this.delete(e,n);default:throw a.ethErrors.rpc.methodNotFound({message:`Not an asset method: ${t}`})}}}n.ExternalResourceController=u}}},{package:"@metamask/snap-controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/dist/resource/ExternalResourceController.js"}],[1329,{"./ExternalResourceController":1328},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),s(e("./ExternalResourceController"),n)}}},{package:"@metamask/snap-controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/dist/resource/index.js"}],[133,{"../../../shared/constants/network":6189,lodash:5172},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("lodash"),s=e("../../../shared/constants/network");var i={version:52,async migrate(e){const t=(0,r.cloneDeep)(e);t.meta.version=52;const n=t.data;return t.data=function(e={}){if(e.PreferencesController){const{accountTokens:t,accountHiddenTokens:n,frequentRpcListDetail:r}=e.PreferencesController,i={},a={};if(t&&Object.keys(t).length>0){for(const e of Object.keys(t)){i[e]={},t[e][s.NETWORK_TYPE_RPC]&&r.forEach((n=>{i[e][n.chainId]=t[e][s.NETWORK_TYPE_RPC]}));for(const n of Object.keys(t[e]))switch(n){case s.MAINNET:i[e][s.MAINNET_CHAIN_ID]=t[e][s.MAINNET];break;case s.ROPSTEN:i[e][s.ROPSTEN_CHAIN_ID]=t[e][s.ROPSTEN];break;case s.RINKEBY:i[e][s.RINKEBY_CHAIN_ID]=t[e][s.RINKEBY];break;case s.GOERLI:i[e][s.GOERLI_CHAIN_ID]=t[e][s.GOERLI];break;case s.KOVAN:i[e][s.KOVAN_CHAIN_ID]=t[e][s.KOVAN]}}e.PreferencesController.accountTokens=i}if(n&&Object.keys(n).length>0){for(const e of Object.keys(n)){a[e]={},n[e][s.NETWORK_TYPE_RPC]&&r.forEach((t=>{a[e][t.chainId]=n[e][s.NETWORK_TYPE_RPC]}));for(const t of Object.keys(n[e]))switch(t){case s.MAINNET:a[e][s.MAINNET_CHAIN_ID]=n[e][s.MAINNET];break;case s.ROPSTEN:a[e][s.ROPSTEN_CHAIN_ID]=n[e][s.ROPSTEN];break;case s.RINKEBY:a[e][s.RINKEBY_CHAIN_ID]=n[e][s.RINKEBY];break;case s.GOERLI:a[e][s.GOERLI_CHAIN_ID]=n[e][s.GOERLI];break;case s.KOVAN:a[e][s.KOVAN_CHAIN_ID]=n[e][s.KOVAN]}}e.PreferencesController.accountHiddenTokens=a}}return e}(n),t}};n.default=i}}},{package:"<root>",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/app/scripts/migrations/052.js"}],[1330,{"@metamask/object-multiplex":1187,nanoid:1453,pump:5519},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.setupMultiplex=n.AbstractExecutionService=void 0;const s=r(e("@metamask/object-multiplex")),i=e("nanoid"),a=r(e("pump"));n.AbstractExecutionService=class{constructor({setupSnapProvider:e,messenger:t,unresponsivePollingInterval:n=5e3,unresponsiveTimeout:r=3e4}){this._snapRpcHooks=new Map,this.jobs=new Map,this.setupSnapProvider=e,this.snapToJobMap=new Map,this.jobToSnapMap=new Map,this._messenger=t,this._unresponsivePollingInterval=n,this._unresponsiveTimeout=r,this._timeoutForUnresponsiveMap=new Map}terminate(e){const t=this.jobs.get(e);if(!t)throw new Error(`Job with id "${e}" not found.`);Object.values(t.streams).forEach((e=>{try{!e.destroyed&&e.destroy(),e.removeAllListeners()}catch(e){console.log("Error while destroying stream",e)}})),this._terminate(t);const n=this.jobToSnapMap.get(e);if(!n)throw new Error(`Failed to find a snap for job with id "${e}"`);clearTimeout(this._timeoutForUnresponsiveMap.get(n)),this._timeoutForUnresponsiveMap.delete(n),this._removeSnapAndJobMapping(e),this.jobs.delete(e),console.log(`job: "${e}" terminated`)}async terminateSnap(e){const t=this.snapToJobMap.get(e);if(!t)throw new Error(`Job not found for snap with id "${e}".`);this.terminate(t)}async terminateAllSnaps(){for(const e of this.jobs.keys())this.terminate(e);this._snapRpcHooks.clear()}async getRpcMessageHandler(e){return this._snapRpcHooks.get(e)}async executeSnap(e){if(this.snapToJobMap.has(e.snapId))throw new Error(`Snap "${e.snapId}" is already being executed.`);const t=await this._initJob();this._mapSnapAndJob(e.snapId,t.id),this.setupSnapProvider(e.snapId,t.streams.rpc);const n=await this._command(t.id,{jsonrpc:"2.0",method:"executeSnap",params:e,id:i.nanoid()});return this._pollForJobStatus(e.snapId),this._createSnapHooks(e.snapId,t.id),n}async _command(e,t){if("object"!=typeof t)throw new Error("Must send object.");const n=this.jobs.get(e);if(!n)throw new Error(`Job with id "${e}" not found.`);console.log("Parent: Sending Command",t);const r=await n.rpcEngine.handle(t);if(r.error)throw new Error(r.error.message);return r.result}_removeSnapHooks(e){this._snapRpcHooks.delete(e)}_createSnapHooks(e,t){this._snapRpcHooks.set(e,(async(n,r)=>await this._command(t,{id:i.nanoid(),jsonrpc:"2.0",method:"snapRpc",params:{origin:n,request:r,target:e}})))}_pollForJobStatus(e){const t=this.snapToJobMap.get(e);if(!t)throw new Error("no job id found for snap");const n=setTimeout((async()=>{try{await this._getJobStatus(t),this._pollForJobStatus(e)}catch(t){this.snapToJobMap.has(e)&&this._messenger.publish("ExecutionService:unresponsive",e)}}),this._unresponsivePollingInterval);this._timeoutForUnresponsiveMap.set(e,n)}async _getJobStatus(e){let t,n;const r=new Promise(((e,r)=>{t=e,n=r})),s=setTimeout((()=>{n(new Error("ping request timed out"))}),this._unresponsiveTimeout);return Promise.race([this._command(e,{jsonrpc:"2.0",method:"ping",params:[],id:i.nanoid()}).then((()=>{clearTimeout(s),t()})),r])}_getJobForSnap(e){return this.snapToJobMap.get(e)}_getSnapForJob(e){return this.jobToSnapMap.get(e)}_mapSnapAndJob(e,t){this.snapToJobMap.set(e,t),this.jobToSnapMap.set(t,e)}_removeSnapAndJobMapping(e){const t=this.jobToSnapMap.get(e);if(!t)throw new Error(`job: "${e}" has no mapped snap.`);this.jobToSnapMap.delete(e),this.snapToJobMap.delete(t),this._removeSnapHooks(t)}},n.setupMultiplex=function(e,t){const n=new s.default;return a.default(e,n,e,(e=>{e&&(t?console.error(`"${t}" stream failure.`,e):console.error(e))})),n}}}},{package:"@metamask/snap-controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/dist/services/AbstractExecutionService.js"}],[1331,{},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0})}}},{package:"@metamask/snap-controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/dist/services/ExecutionService.js"}],[1332,{"./AbstractExecutionService":1330,"@metamask/execution-environments":1153,"@metamask/obs-store":1409,"@metamask/post-message-stream":1201,"json-rpc-engine":4727,"json-rpc-middleware-stream":1452,nanoid:1453,pump:5519},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.WebWorkerExecutionService=void 0;const s=e("@metamask/obs-store"),i=e("@metamask/post-message-stream"),a=e("@metamask/execution-environments"),o=e("json-rpc-engine"),c=e("json-rpc-middleware-stream"),u=e("nanoid"),l=r(e("pump")),d=e("./AbstractExecutionService");class h extends d.AbstractExecutionService{constructor({setupSnapProvider:e,workerUrl:t,messenger:n,unresponsivePollingInterval:r=5e3,unresponsiveTimeout:i=3e4}){super({setupSnapProvider:e,messenger:n,unresponsivePollingInterval:r,unresponsiveTimeout:i}),this.workerUrl=t,this.store=new s.ObservableStore({workers:{}})}_setWorker(e,t){this.jobs.set(e,t);const n=Object.assign(Object.assign({},this.store.getState().workers),{[e]:t});this.store.updateState({workers:n})}_deleteWorker(e){const t=Object.assign({},this.store.getState().workers);delete t[e],this.store.updateState({workers:t})}_terminate(e){e.worker.terminate(),this._deleteWorker(e.id)}async _initJob(){const e=u.nanoid(),t=new Worker(this.workerUrl,{name:e});t.addEventListener("error",(t=>{if(this._messenger){const n=this.jobToSnapMap.get(e);n&&this._messenger.publish("ExecutionService:unhandledError",n,{code:t.error.code,message:t.error.message,data:t.error.data})}}),{once:!0});const n=this._initWorkerStreams(t,e),r=new o.JsonRpcEngine,s=c.createStreamMiddleware();l.default(s.stream,n.command,s.stream),r.push(s.middleware);const i={id:e,streams:n,rpcEngine:r,worker:t};return this._setWorker(e,i),await this._command(e,{jsonrpc:"2.0",method:"ping",id:u.nanoid()}),i}_initWorkerStreams(e,t){const n=new i.WorkerParentPostMessageStream({worker:e}),r=d.setupMultiplex(n,`Worker:${t}`);return{command:r.createStream(a.SNAP_STREAM_NAMES.COMMAND),rpc:r.createStream(a.SNAP_STREAM_NAMES.JSON_RPC),_connection:n}}}n.WebWorkerExecutionService=h}}},{package:"@metamask/snap-controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/dist/services/WebWorkerExecutionService.js"}],[1333,{"./AbstractExecutionService":1330,"./ExecutionService":1331,"./WebWorkerExecutionService":1332},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),s(e("./AbstractExecutionService"),n),s(e("./ExecutionService"),n),s(e("./WebWorkerExecutionService"),n)}}},{package:"@metamask/snap-controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/dist/services/index.js"}],[1334,{"..":1327,"../utils":1340,"./json-schemas":1336,"./utils":1339,"@metamask/controllers":1377,"eth-rpc-errors":2455,nanoid:1453,semver:5781},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SnapController=n.SnapStatusEvent=n.SnapStatus=n.DEFAULT_EXPOSED_APIS=n.SNAP_PREFIX_REGEX=n.SNAP_PREFIX=n.controllerName=void 0;const r=e("@metamask/controllers"),s=e("eth-rpc-errors"),i=e("nanoid"),a=e("semver"),o=e(".."),c=e("../utils"),u=e("./json-schemas"),l=e("./utils");n.controllerName="SnapController",n.SNAP_PREFIX="wallet_snap_",n.SNAP_PREFIX_REGEX=new RegExp(`^${n.SNAP_PREFIX}`,"u"),n.DEFAULT_EXPOSED_APIS=["atob","btoa","BigInt","Buffer","console","crypto","Date","Math","setTimeout","clearTimeout","SubtleCrypto","TextDecoder","TextEncoder","URL","WebAssembly"];const d=new Set(["initialPermissions","id","permissionName","version"]),h={snapErrors:{},snaps:{},snapStates:{}};var f,p;!function(e){e.installing="installing",e.running="running",e.stopped="stopped",e.crashed="crashed"}(f=n.SnapStatus||(n.SnapStatus={})),function(e){e.start="start",e.stop="stop",e.crash="crash",e.update="update"}(p=n.SnapStatusEvent||(n.SnapStatusEvent={}));const m=e=>e.enabled,g={initial:f.installing,states:{[f.installing]:{on:{[p.start]:{target:f.running,cond:m}}},[f.running]:{on:{[p.stop]:f.stopped,[p.crash]:f.crashed}},[f.stopped]:{on:{[p.start]:{target:f.running,cond:m},[p.update]:f.installing}},[f.crashed]:{on:{[p.start]:{target:f.running,cond:m}}}}};class y extends r.BaseControllerV2{constructor({closeAllConnections:e,executeSnap:t,getRpcMessageHandler:n,messenger:r,state:s,terminateAllSnaps:i,terminateSnap:a,endowmentPermissionNames:o=[],npmRegistryUrl:c,idleTimeCheckInterval:u=5e3,maxIdleTime:l=3e4,maxRequestTime:d=6e4}){super({messenger:r,metadata:{snapErrors:{persist:!1,anonymous:!1},snapStates:{persist:!0,anonymous:!1},snaps:{persist:e=>Object.values(e).map((e=>Object.assign(Object.assign({},e),{status:f.stopped}))).reduce(((e,t)=>(e[t.id]=t,e)),{}),anonymous:!1}},name:"SnapController",state:Object.assign(Object.assign({},h),s)}),this._closeAllConnections=e,this._endowmentPermissionNames=o,this._executeSnap=t,this._getRpcMessageHandler=n,this._onUnhandledSnapError=this._onUnhandledSnapError.bind(this),this._onUnresponsiveSnap=this._onUnresponsiveSnap.bind(this),this._terminateSnap=a,this._terminateAllSnaps=i,this._idleTimeCheckInterval=u,this._maxIdleTime=l,this._maxRequestTime=d,this._pollForLastRequestStatus(),this._snapsRuntimeData=new Map,this._npmRegistryUrl=c,this.messagingSystem.subscribe("ExecutionService:unhandledError",this._onUnhandledSnapError),this.messagingSystem.subscribe("ExecutionService:unresponsive",this._onUnresponsiveSnap),this.registerMessageHandlers()}registerMessageHandlers(){this.messagingSystem.registerActionHandler(`${n.controllerName}:add`,((...e)=>this.add(...e))),this.messagingSystem.registerActionHandler(`${n.controllerName}:get`,((...e)=>this.get(...e))),this.messagingSystem.registerActionHandler(`${n.controllerName}:getRpcMessageHandler`,((...e)=>this.getRpcMessageHandler(...e))),this.messagingSystem.registerActionHandler(`${n.controllerName}:getSnapState`,((...e)=>this.getSnapState(...e))),this.messagingSystem.registerActionHandler(`${n.controllerName}:has`,((...e)=>this.has(...e))),this.messagingSystem.registerActionHandler(`${n.controllerName}:updateSnapState`,((...e)=>this.updateSnapState(...e)))}_pollForLastRequestStatus(){this._timeoutForLastRequestStatus=setTimeout((async()=>{this._stopSnapsLastRequestPastMax(),this._pollForLastRequestStatus()}),this._idleTimeCheckInterval)}_stopSnapsLastRequestPastMax(){this._snapsRuntimeData.forEach((async(e,t)=>{e.lastRequest&&this._maxIdleTime&&c.timeSince(e.lastRequest)>this._maxIdleTime&&this.stopSnap(t,p.stop)}))}async _onUnresponsiveSnap(e){await this.stopSnap(e,p.crash),this.addSnapError({code:s.errorCodes.rpc.internal,message:"Snap Unresponsive",data:{snapId:e}})}async _onUnhandledSnapError(e,t){await this.stopSnap(e,p.crash),this.addSnapError(t)}_transitionSnapState(e,t){var n;const r=this.state.snaps[e].status;let s=null!==(n=g.states[r].on[t])&&void 0!==n?n:r;if(s.cond){if(!1===s.cond(this.state.snaps[e]))throw new Error(`Condition failed for state transition "${e}" with event "${t}".`)}s.target&&(s=s.target),s!==r&&this.update((t=>{t.snaps[e].status=s}))}async startSnap(e){const t=this.get(e);if(!t)throw new Error(`Snap "${e}" not found.`);if(!1===this.state.snaps[e].enabled)throw new Error(`Snap "${e}" is disabled.`);await this._startSnap({snapId:e,sourceCode:t.sourceCode})}enableSnap(e){this.update((t=>{t.snaps[e].enabled=!0}))}disableSnap(e){return this.update((t=>{if(!t.snaps[e])throw new Error(`Snap "${e}" not found.`);t.snaps[e].enabled=!1})),this.isRunning(e)?this.stopSnap(e,p.stop):Promise.resolve()}async stopSnap(e,t=p.stop){const n=this._getSnapRuntimeData(e);if(n){n.lastRequest=null;try{this.isRunning(e)&&(this._closeAllConnections(e),await this._terminateSnap(e))}finally{this.isRunning(e)&&this._transitionSnapState(e,t)}}}isRunning(e){const t=this.get(e);if(!t)throw new Error(`Snap "${e}" not found.`);return t.status===f.running}has(e){return Boolean(this.get(e))}get(e){return this.state.snaps[e]}getTruncated(e){const t=this.get(e);return t?Object.keys(t).reduce(((e,n)=>(d.has(n)&&(e[n]=t[n]),e)),{}):null}async updateSnapState(e,t){this.update((n=>{n.snapStates[e]=t}))}addSnapError(e){this.update((t=>{const n=i.nanoid();t.snapErrors[n]=Object.assign(Object.assign({},e),{internalID:n})}))}async removeSnapError(e){this.update((t=>{delete t.snapErrors[e]}))}async clearSnapErrors(){this.update((e=>{e.snapErrors={}}))}async getSnapState(e){var t;return null!==(t=this.state.snapStates[e])&&void 0!==t?t:null}clearState(){const e=Object.keys(this.state.snaps);e.forEach((e=>{this._closeAllConnections(e)})),this._terminateAllSnaps(),e.forEach(this.revokeAllSnapPermissions),this.update((e=>{e.snaps={},e.snapStates={}}))}async removeSnap(e){return this.removeSnaps([e])}async removeSnaps(e){if(!Array.isArray(e))throw new Error("Expected array of snap ids.");await Promise.all(e.map((async e=>{await this.disableSnap(e),this.revokeAllSnapPermissions(e),this._snapsRuntimeData.delete(e),this.update((t=>{delete t.snaps[e],delete t.snapStates[e]})),this.messagingSystem.publish("SnapController:snapRemoved",e)})))}revokeAllSnapPermissions(e){this.messagingSystem.call("PermissionController:hasPermissions",e)&&this.messagingSystem.call("PermissionController:revokeAllPermissions",e)}getPermittedSnaps(e){var t;return Object.values(null!==(t=this.messagingSystem.call("PermissionController:getPermissions",e))&&void 0!==t?t:{}).reduce(((e,t)=>{if(t.parentCapability.startsWith(n.SNAP_PREFIX)){const r=t.parentCapability.replace(n.SNAP_PREFIX_REGEX,""),i=this.getTruncated(r);e[r]=i||{error:s.serializeError(new Error("Snap permitted but not installed."))}}return e}),{})}async installSnaps(e,t){const r={};return await Promise.all(Object.entries(t).map((async([t,{version:i}])=>{const a=l.resolveVersion(i),o=n.SNAP_PREFIX+t;v(a)?this.messagingSystem.call("PermissionController:hasPermission",e,o)?r[t]=Object.assign({},await this.processRequestedSnap(t,a)):r[t]={error:s.ethErrors.provider.unauthorized(`Not authorized to install snap "${t}". Request the permission for the snap before attempting to install it.`)}:r[t]={error:s.ethErrors.rpc.invalidParams(`The "version" field must be a valid SemVer version range if specified. Received: "${a}".`)}}))),r}async processRequestedSnap(e,t){const n=this.getTruncated(e);if(n&&!e.startsWith(l.SnapIdPrefixes.local))return a.satisfies(n.version,t)?n:{error:s.ethErrors.rpc.invalidParams(`Version mismatch with already installed snap. ${e}@${n.version} doesn't satisfy requested version ${t}`)};n&&this.isRunning(e)&&await this.stopSnap(e,p.stop);try{const{sourceCode:n}=await this.add({id:e,versionRange:t});return await this.authorize(e),await this._startSnap({snapId:e,sourceCode:n}),this.messagingSystem.publish("SnapController:snapInstalled",e),this.getTruncated(e)}catch(t){return console.error("Error when adding snap.",t),this.has(e)&&this.removeSnap(e),{error:s.serializeError(t)}}}async updateSnap(e,t=l.DEFAULT_REQUESTED_SNAP_VERSION){const n=this.get(e);if(n===undefined)throw new Error(`Could not find snap ${e}. Install the snap before attempting to update it.`);if(!v(t))throw new Error(`Received invalid Snap version range: "${t}".`);const r=await this._fetchSnap(e,t);return a.gt(r.manifest.version,n.version)?(this.isRunning(e)&&this.stopSnap(e,p.stop),this._transitionSnapState(e,p.update),await this._set({id:e,manifest:r.manifest,sourceCode:r.sourceCode,versionRange:t}),await this.authorize(e),await this._startSnap({snapId:e,sourceCode:r.sourceCode}),this.messagingSystem.publish("SnapController:snapUpdated",e,r.manifest.version,n.version),this.getTruncated(e)):(console.warn(`Tried updating snap "${e}" within "${t}" version range, but newer version "${n.version}" is already installed`),null)}async add(e){const{id:t}=e;this.validateSnapId(t);const n=t;if(!e||!("id"in e)||!("manifest"in e)&&"sourceCode"in e||"manifest"in e&&!("sourceCode"in e))throw new Error(`Invalid add snap args for snap "${n}".`);const r=this._getSnapRuntimeData(n);r.installPromise||(console.log(`Adding snap: ${n}`),r.installPromise=this._set(e));try{return await r.installPromise}catch(e){throw r.installPromise=null,e}}validateSnapId(e){if(!e||"string"!=typeof e)throw new Error(`Invalid snap id: Not a string. Received "${e}"`);for(const t of Object.values(l.SnapIdPrefixes))if(e.startsWith(t)&&e.replace(t,"").length>0)return;throw new Error(`Invalid snap id. Received: "${e}"`)}async _startSnap(e){const{snapId:t}=e;if(this.isRunning(t))throw new Error(`Snap "${t}" is already started.`);const n=await this._executeSnap(Object.assign(Object.assign({},e),{endowments:await this._getEndowments(t)}));return this._transitionSnapState(t,p.start),n}async _getEndowments(e){let t=[];for(const n of this._endowmentPermissionNames)if(this.messagingSystem.call("PermissionController:hasPermission",e,n)){const r=await this.messagingSystem.call("PermissionController:getEndowments",e,n);if(r){if(!Array.isArray(r)||r.some((e=>"string"!=typeof e)))throw new Error("Expected an array of string endowment names.");t=t.concat(r)}}const r=[...new Set([...n.DEFAULT_EXPOSED_APIS,...t])];return r.length<n.DEFAULT_EXPOSED_APIS.length+t.length&&console.error("Duplicates found in endowments, default APIs should not be requested.",t),r}async _set(e){const{id:t,versionRange:r=l.DEFAULT_REQUESTED_SNAP_VERSION}=e;let s,i,o;if("manifest"in e?(s=e.manifest,i=e.sourceCode,u.validateSnapJsonFile(l.NpmSnapFileNames.Manifest,s)):({manifest:s,sourceCode:i,svgIcon:o}=await this._fetchSnap(t,r)),!a.satisfies(s.version,r))throw new Error(`Version mismatch. Manifest for ${t} specifies version ${s.version} which doesn't satisfy requested version range ${r}`);if("string"!=typeof i||0===i.length)throw new Error(`Invalid source code for snap "${t}".`);const c=null==s?void 0:s.initialPermissions;if(!c||"object"!=typeof c||Array.isArray(c))throw new Error(`Invalid initial permissions for snap "${t}".`);let d={enabled:!0,id:t,initialPermissions:c,manifest:s,permissionName:n.SNAP_PREFIX+t,sourceCode:i,status:g.initial,version:s.version};const h=this.state.snaps;return h[t]&&(d=Object.assign(Object.assign({},h[t]),d)),this.update((e=>{e.snaps[t]=d})),this.messagingSystem.publish("SnapController:snapAdded",t,d,o),d}async _fetchSnap(e,t=l.DEFAULT_REQUESTED_SNAP_VERSION){try{const n=function(e){const t=Object.values(l.SnapIdPrefixes).find((t=>e.startsWith(t)));if(t!==undefined)return t;throw new Error(`Invalid or no prefix found for "${e}"`)}(e);switch(n){case l.SnapIdPrefixes.local:return this._fetchLocalSnap(e.replace(l.SnapIdPrefixes.local,""));case l.SnapIdPrefixes.npm:return this._fetchNpmSnap(e.replace(l.SnapIdPrefixes.npm,""),t);default:return o.assertExhaustive(n)}}catch(t){throw new Error(`Failed to fetch Snap "${e}": ${t.message}`)}}async _fetchNpmSnap(e,t){if(!v(t))throw new Error(`Received invalid Snap version range: "${t}".`);const{manifest:n,sourceCode:r,svgIcon:s}=await l.fetchNpmSnap(e,t,this._npmRegistryUrl);return{manifest:n,sourceCode:r,svgIcon:s}}async _fetchLocalSnap(e){const t={cache:"no-cache"},n=new URL(l.NpmSnapFileNames.Manifest,e);if(!l.LOCALHOST_HOSTNAMES.has(n.hostname))throw new Error(`Invalid URL: Locally hosted Snaps must be hosted on localhost. Received URL: "${n.toString()}"`);const r=await(await l.fetchContent(n.toString(),t)).json();u.validateSnapJsonFile(l.NpmSnapFileNames.Manifest,r);const s=r,{source:{location:{npm:{filePath:i,iconPath:a}}}}=s,[o,c]=await Promise.all([(await l.fetchContent(new URL(i,e).toString(),t)).text(),a?(await l.fetchContent(new URL(a,e).toString(),t)).text():undefined]);return l.validateSnapShasum(s,o),{manifest:s,sourceCode:o,svgIcon:c}}async authorize(e){console.log(`Authorizing snap: ${e}`);const t=this.state.snaps[e],{initialPermissions:n}=t;if(0===Object.keys(n).length)return[];if(null===n)return[];try{const t=await this.messagingSystem.call("PermissionController:getPermissions",e),r=c.setDiff(n,null!=t?t:{}),s=Object.keys(c.setDiff(null!=t?t:{},n));if(c.isNonEmptyArray(s)&&await this.messagingSystem.call("PermissionController:revokePermissions",{[origin]:s}),c.isNonEmptyArray(Object.keys(r))){const[t]=await this.messagingSystem.call("PermissionController:requestPermissions",{origin:e},r);return Object.values(t).map((e=>e.parentCapability))}return[]}finally{this._getSnapRuntimeData(e).installPromise=null}}destroy(){super.destroy(),this._timeoutForLastRequestStatus&&clearTimeout(this._timeoutForLastRequestStatus),this.messagingSystem.unsubscribe("ExecutionService:unhandledError",this._onUnhandledSnapError),this.messagingSystem.unsubscribe("ExecutionService:unresponsive",this._onUnresponsiveSnap)}async getRpcMessageHandler(e){const t=this._getSnapRuntimeData(e),n=null==t?void 0:t.rpcHandler;if(n)return n;const r=async(t,n)=>{let r=await this._getRpcMessageHandler(e);if(!1===this.state.snaps[e].enabled)throw new Error(`Snap "${e}" is disabled.`);if(this.state.snaps[e].status===f.installing)throw new Error(`Snap "${e}" has not been started yet.`);if(r||!1!==this.isRunning(e)||(await this.startSnap(e),r=await this._getRpcMessageHandler(e)),!r)throw new Error(`Snap execution service returned no RPC handler for running snap "${e}".`);let i,a=n;if(Object.hasOwnProperty.call(n,"jsonrpc")){if("2.0"!==n.jsonrpc)throw s.ethErrors.rpc.invalidRequest({message:'Invalid "jsonrpc" property. Must be "2.0" if provided.',data:n.jsonrpc})}else a=Object.assign(Object.assign({},n),{jsonrpc:"2.0"});this._recordSnapRpcRequest(e);const o=new Promise(((t,n)=>{i=setTimeout((()=>{this.stopSnap(e,p.stop),n(new Error("The request timed out."))}),this._maxRequestTime)})),c=await Promise.race([r(t,a),o]);return clearTimeout(i),c};return t.rpcHandler=r,r}_recordSnapRpcRequest(e){this._getSnapRuntimeData(e).lastRequest=Date.now()}_getSnapRuntimeData(e){return this._snapsRuntimeData.has(e)||this._snapsRuntimeData.set(e,{lastRequest:null,rpcHandler:null,installPromise:null}),this._snapsRuntimeData.get(e)}}function v(e){return Boolean("string"==typeof e&&null!==a.validRange(e))}n.SnapController=y}}},{package:"@metamask/snap-controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/dist/snaps/SnapController.js"}],[1335,{"./SnapController":1334,"./json-schemas":1336,"./utils":1339},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),s(e("./SnapController"),n),s(e("./json-schemas"),n),s(e("./utils"),n)}}},{package:"@metamask/snap-controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/dist/snaps/index.js"}],[1336,{"../utils":1339,"./validateNpmSnapPackageJson.js":1337,"./validateSnapManifest.js":1338},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.validateSnapJsonFile=void 0;const s=r(e("./validateNpmSnapPackageJson.js")),i=r(e("./validateSnapManifest.js")),a=e("../utils");n.validateSnapJsonFile=function(e,t){let n;switch(e){case a.NpmSnapFileNames.Manifest:t&&"object"==typeof t&&!Array.isArray(t)&&t.repository===undefined&&(t.repository=null),n=i.default(t);break;case a.NpmSnapFileNames.PackageJson:n=s.default(t);break;default:throw new Error(`Unrecognized file name "${e}".`)}if(n&&0!==n.length)throw new Error(`${n.reduce(((e,t={})=>{const{instancePath:n,message:r="unknown error"}=t;return`${e}${n?`\t${n}\n\t${r}\n\n`:`\t${r}\n\n`}`}),"").replace(/\n$/u,"")}`)}}}},{package:"@metamask/snap-controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/dist/snaps/json-schemas/index.js"}],[1337,{"ajv/dist/runtime/equal":1411,"ajv/dist/runtime/ucs2length":1412},function(){with(this)return function(){"use strict";return function(e,t,n){t.exports=o,t.exports.default=o;const r={title:"npm Snap package.json",type:"object",required:["version","name"],properties:{version:{type:"string",title:"Version",pattern:"^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"},name:{type:"string",title:"Package Name",minLength:1,maxLength:214,pattern:"^(?:@[a-z0-9-*~][a-z0-9-*._~]*/)?[a-z0-9-~][a-z0-9-._~]*$"},private:{type:"boolean",title:"Private"},main:{type:"string",title:"Main",minLength:1},publishConfig:{type:"object",title:"Publish Config",required:["registry"],properties:{access:{type:"string",minLength:1},registry:{type:"string",enum:["https://registry.npmjs.org","https://registry.npmjs.org/"]}}},repository:{type:"object",title:"Repository",additionalProperties:!1,required:["type","url"],properties:{type:{type:"string",minLength:1},url:{type:"string",minLength:1}}}}},s=new RegExp("^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$","u"),i=new RegExp("^(?:@[a-z0-9-*~][a-z0-9-*._~]*/)?[a-z0-9-~][a-z0-9-._~]*$","u"),a=e("ajv/dist/runtime/ucs2length").default;e("ajv/dist/runtime/equal").default;function o(e,{instancePath:t="",parentData:n,parentDataProperty:c,rootData:u=e}={}){let l=null;if(e&&"object"==typeof e&&!Array.isArray(e)){if(e.version===undefined){const e={instancePath:t,schemaPath:"#/required",keyword:"required",params:{missingProperty:"version"},message:"must have required property '"+"version"+"'"};null===l?l=[e]:l.push(e)}if(e.name===undefined){const e={instancePath:t,schemaPath:"#/required",keyword:"required",params:{missingProperty:"name"},message:"must have required property '"+"name"+"'"};null===l?l=[e]:l.push(e)}if(e.version!==undefined){let n=e.version;if("string"==typeof n){if(!s.test(n)){const e={instancePath:t+"/version",schemaPath:"#/properties/version/pattern",keyword:"pattern",params:{pattern:"^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"},message:'must match pattern "'+"^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"+'"'};null===l?l=[e]:l.push(e)}}else{const e={instancePath:t+"/version",schemaPath:"#/properties/version/type",keyword:"type",params:{type:"string"},message:"must be string"};null===l?l=[e]:l.push(e)}}if(e.name!==undefined){let n=e.name;if("string"==typeof n){if(a(n)>214){const e={instancePath:t+"/name",schemaPath:"#/properties/name/maxLength",keyword:"maxLength",params:{limit:214},message:"must NOT have more than 214 characters"};null===l?l=[e]:l.push(e)}if(a(n)<1){const e={instancePath:t+"/name",schemaPath:"#/properties/name/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===l?l=[e]:l.push(e)}if(!i.test(n)){const e={instancePath:t+"/name",schemaPath:"#/properties/name/pattern",keyword:"pattern",params:{pattern:"^(?:@[a-z0-9-*~][a-z0-9-*._~]*/)?[a-z0-9-~][a-z0-9-._~]*$"},message:'must match pattern "'+"^(?:@[a-z0-9-*~][a-z0-9-*._~]*/)?[a-z0-9-~][a-z0-9-._~]*$"+'"'};null===l?l=[e]:l.push(e)}}else{const e={instancePath:t+"/name",schemaPath:"#/properties/name/type",keyword:"type",params:{type:"string"},message:"must be string"};null===l?l=[e]:l.push(e)}}if(e.private!==undefined&&"boolean"!=typeof e.private){const e={instancePath:t+"/private",schemaPath:"#/properties/private/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"};null===l?l=[e]:l.push(e)}if(e.main!==undefined){let n=e.main;if("string"==typeof n){if(a(n)<1){const e={instancePath:t+"/main",schemaPath:"#/properties/main/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===l?l=[e]:l.push(e)}}else{const e={instancePath:t+"/main",schemaPath:"#/properties/main/type",keyword:"type",params:{type:"string"},message:"must be string"};null===l?l=[e]:l.push(e)}}if(e.publishConfig!==undefined){let n=e.publishConfig;if(n&&"object"==typeof n&&!Array.isArray(n)){if(n.registry===undefined){const e={instancePath:t+"/publishConfig",schemaPath:"#/properties/publishConfig/required",keyword:"required",params:{missingProperty:"registry"},message:"must have required property '"+"registry"+"'"};null===l?l=[e]:l.push(e)}if(n.access!==undefined){let e=n.access;if("string"==typeof e){if(a(e)<1){const e={instancePath:t+"/publishConfig/access",schemaPath:"#/properties/publishConfig/properties/access/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===l?l=[e]:l.push(e)}}else{const e={instancePath:t+"/publishConfig/access",schemaPath:"#/properties/publishConfig/properties/access/type",keyword:"type",params:{type:"string"},message:"must be string"};null===l?l=[e]:l.push(e)}}if(n.registry!==undefined){let e=n.registry;if("string"!=typeof e){const e={instancePath:t+"/publishConfig/registry",schemaPath:"#/properties/publishConfig/properties/registry/type",keyword:"type",params:{type:"string"},message:"must be string"};null===l?l=[e]:l.push(e)}if("https://registry.npmjs.org"!==e&&"https://registry.npmjs.org/"!==e){const e={instancePath:t+"/publishConfig/registry",schemaPath:"#/properties/publishConfig/properties/registry/enum",keyword:"enum",params:{allowedValues:r.properties.publishConfig.properties.registry.enum},message:"must be equal to one of the allowed values"};null===l?l=[e]:l.push(e)}}}else{const e={instancePath:t+"/publishConfig",schemaPath:"#/properties/publishConfig/type",keyword:"type",params:{type:"object"},message:"must be object"};null===l?l=[e]:l.push(e)}}if(e.repository!==undefined){let n=e.repository;if(n&&"object"==typeof n&&!Array.isArray(n)){if(n.type===undefined){const e={instancePath:t+"/repository",schemaPath:"#/properties/repository/required",keyword:"required",params:{missingProperty:"type"},message:"must have required property '"+"type"+"'"};null===l?l=[e]:l.push(e)}if(n.url===undefined){const e={instancePath:t+"/repository",schemaPath:"#/properties/repository/required",keyword:"required",params:{missingProperty:"url"},message:"must have required property '"+"url"+"'"};null===l?l=[e]:l.push(e)}for(const e in n)if("type"!==e&&"url"!==e){const n={instancePath:t+"/repository",schemaPath:"#/properties/repository/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:e},message:"must NOT have additional properties"};null===l?l=[n]:l.push(n)}if(n.type!==undefined){let e=n.type;if("string"==typeof e){if(a(e)<1){const e={instancePath:t+"/repository/type",schemaPath:"#/properties/repository/properties/type/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===l?l=[e]:l.push(e)}}else{const e={instancePath:t+"/repository/type",schemaPath:"#/properties/repository/properties/type/type",keyword:"type",params:{type:"string"},message:"must be string"};null===l?l=[e]:l.push(e)}}if(n.url!==undefined){let e=n.url;if("string"==typeof e){if(a(e)<1){const e={instancePath:t+"/repository/url",schemaPath:"#/properties/repository/properties/url/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===l?l=[e]:l.push(e)}}else{const e={instancePath:t+"/repository/url",schemaPath:"#/properties/repository/properties/url/type",keyword:"type",params:{type:"string"},message:"must be string"};null===l?l=[e]:l.push(e)}}}else{const e={instancePath:t+"/repository",schemaPath:"#/properties/repository/type",keyword:"type",params:{type:"object"},message:"must be object"};null===l?l=[e]:l.push(e)}}}else{const e={instancePath:t,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"};null===l?l=[e]:l.push(e)}return o.errors=l,l}}}},{package:"@metamask/snap-controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/dist/snaps/json-schemas/validateNpmSnapPackageJson.js"}],[1338,{"ajv/dist/runtime/equal":1411,"ajv/dist/runtime/ucs2length":1412},function(){with(this)return function(){"use strict";return function(e,t,n){t.exports=u,t.exports.default=u;const r={title:"Snap Manifest",description:"The Snap manifest file MUST be named `snap.manifest.json` and located in the package root directory.",type:"object",additionalProperties:!1,required:["version","description","proposedName","source","initialPermissions","manifestVersion"],properties:{version:{type:"string",title:"Version",description:"MUST be a valid SemVer version string and equal to the corresponding `package.json` field.",pattern:"^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"},description:{type:"string",title:"Description",description:"MUST be a non-empty string less than or equal to 280 characters. A short description of the Snap.",minLength:1,maxLength:280},proposedName:{type:"string",title:"Proposed Name",description:"MUST be a string less than or equal to 214 characters. The Snap author's proposed name for the Snap. The Snap host application may display this name unmodified in its user interface. The proposed name SHOULD be human-readable.",minLength:1,maxLength:214,pattern:"^(?:[A-Za-z0-9-_]+( [A-Za-z0-9-_]+)*)|(?:(?:@[A-Za-z0-9-*~][A-Za-z0-9-*._~]*/)?[A-Za-z0-9-~][A-Za-z0-9-._~]*)$"},repository:{title:"Repository",description:"MAY be omitted. If present, MUST be equal to the corresponding package.json field.",oneOf:[{type:"null"},{type:"object",additionalProperties:!1,required:["type","url"],properties:{type:{type:"string",minLength:1},url:{type:"string",minLength:1}}}]},source:{type:"object",title:"Source",description:"Specifies some Snap metadata and where to fetch the Snap during installation.",additionalProperties:!1,required:["shasum","location"],properties:{shasum:{type:"string",description:"MUST be the Base64-encoded string representation of the SHA-256 hash of the Snap source file.",minLength:44,maxLength:44,pattern:"^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$"},location:{title:"Source Location",type:"object",additionalProperties:!1,required:["npm"],properties:{npm:{title:"npm",type:"object",additionalProperties:!1,required:["filePath","packageName","registry"],properties:{filePath:{type:"string",title:"File Path",description:"The path to the Snap bundle file from the project root directory.",minLength:1},iconPath:{type:"string",title:"Icon Path",description:"The path to an .svg file from the project root directory.",pattern:"\\w+\\.svg$"},packageName:{type:"string",title:"Package Name",description:"The Snap's npm package name.",minLength:1},registry:{type:"string",title:"npm Registry",description:"The npm registry URL.",enum:["https://registry.npmjs.org","https://registry.npmjs.org/"]}}}}}}},initialPermissions:{type:"object",title:"Initial Permissions",description:"MUST be a valid EIP-2255 wallet_requestPermissions parameter object, specifying the initial permissions that will be requested when the Snap is added to the host application."},manifestVersion:{type:"string",title:"Manifest Version",description:"The Snap manifest specification version targeted by the manifest.",enum:["0.1"]}}},s=new RegExp("^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$","u"),i=new RegExp("^(?:[A-Za-z0-9-_]+( [A-Za-z0-9-_]+)*)|(?:(?:@[A-Za-z0-9-*~][A-Za-z0-9-*._~]*/)?[A-Za-z0-9-~][A-Za-z0-9-._~]*)$","u"),a=new RegExp("^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$","u"),o=new RegExp("\\w+\\.svg$","u"),c=e("ajv/dist/runtime/ucs2length").default;e("ajv/dist/runtime/equal").default;function u(e,{instancePath:t="",parentData:n,parentDataProperty:l,rootData:d=e}={}){let h=null,f=0;if(e&&"object"==typeof e&&!Array.isArray(e)){if(e.version===undefined){const e={instancePath:t,schemaPath:"#/required",keyword:"required",params:{missingProperty:"version"},message:"must have required property '"+"version"+"'"};null===h?h=[e]:h.push(e),f++}if(e.description===undefined){const e={instancePath:t,schemaPath:"#/required",keyword:"required",params:{missingProperty:"description"},message:"must have required property '"+"description"+"'"};null===h?h=[e]:h.push(e),f++}if(e.proposedName===undefined){const e={instancePath:t,schemaPath:"#/required",keyword:"required",params:{missingProperty:"proposedName"},message:"must have required property '"+"proposedName"+"'"};null===h?h=[e]:h.push(e),f++}if(e.source===undefined){const e={instancePath:t,schemaPath:"#/required",keyword:"required",params:{missingProperty:"source"},message:"must have required property '"+"source"+"'"};null===h?h=[e]:h.push(e),f++}if(e.initialPermissions===undefined){const e={instancePath:t,schemaPath:"#/required",keyword:"required",params:{missingProperty:"initialPermissions"},message:"must have required property '"+"initialPermissions"+"'"};null===h?h=[e]:h.push(e),f++}if(e.manifestVersion===undefined){const e={instancePath:t,schemaPath:"#/required",keyword:"required",params:{missingProperty:"manifestVersion"},message:"must have required property '"+"manifestVersion"+"'"};null===h?h=[e]:h.push(e),f++}for(const n in e)if("version"!==n&&"description"!==n&&"proposedName"!==n&&"repository"!==n&&"source"!==n&&"initialPermissions"!==n&&"manifestVersion"!==n){const e={instancePath:t,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:n},message:"must NOT have additional properties"};null===h?h=[e]:h.push(e),f++}if(e.version!==undefined){let n=e.version;if("string"==typeof n){if(!s.test(n)){const e={instancePath:t+"/version",schemaPath:"#/properties/version/pattern",keyword:"pattern",params:{pattern:"^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"},message:'must match pattern "'+"^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"+'"'};null===h?h=[e]:h.push(e),f++}}else{const e={instancePath:t+"/version",schemaPath:"#/properties/version/type",keyword:"type",params:{type:"string"},message:"must be string"};null===h?h=[e]:h.push(e),f++}}if(e.description!==undefined){let n=e.description;if("string"==typeof n){if(c(n)>280){const e={instancePath:t+"/description",schemaPath:"#/properties/description/maxLength",keyword:"maxLength",params:{limit:280},message:"must NOT have more than 280 characters"};null===h?h=[e]:h.push(e),f++}if(c(n)<1){const e={instancePath:t+"/description",schemaPath:"#/properties/description/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===h?h=[e]:h.push(e),f++}}else{const e={instancePath:t+"/description",schemaPath:"#/properties/description/type",keyword:"type",params:{type:"string"},message:"must be string"};null===h?h=[e]:h.push(e),f++}}if(e.proposedName!==undefined){let n=e.proposedName;if("string"==typeof n){if(c(n)>214){const e={instancePath:t+"/proposedName",schemaPath:"#/properties/proposedName/maxLength",keyword:"maxLength",params:{limit:214},message:"must NOT have more than 214 characters"};null===h?h=[e]:h.push(e),f++}if(c(n)<1){const e={instancePath:t+"/proposedName",schemaPath:"#/properties/proposedName/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===h?h=[e]:h.push(e),f++}if(!i.test(n)){const e={instancePath:t+"/proposedName",schemaPath:"#/properties/proposedName/pattern",keyword:"pattern",params:{pattern:"^(?:[A-Za-z0-9-_]+( [A-Za-z0-9-_]+)*)|(?:(?:@[A-Za-z0-9-*~][A-Za-z0-9-*._~]*/)?[A-Za-z0-9-~][A-Za-z0-9-._~]*)$"},message:'must match pattern "'+"^(?:[A-Za-z0-9-_]+( [A-Za-z0-9-_]+)*)|(?:(?:@[A-Za-z0-9-*~][A-Za-z0-9-*._~]*/)?[A-Za-z0-9-~][A-Za-z0-9-._~]*)$"+'"'};null===h?h=[e]:h.push(e),f++}}else{const e={instancePath:t+"/proposedName",schemaPath:"#/properties/proposedName/type",keyword:"type",params:{type:"string"},message:"must be string"};null===h?h=[e]:h.push(e),f++}}if(e.repository!==undefined){let n=e.repository;const r=f;let s=!1,i=null;const a=f;if(null!==n){const e={instancePath:t+"/repository",schemaPath:"#/properties/repository/oneOf/0/type",keyword:"type",params:{type:"null"},message:"must be null"};null===h?h=[e]:h.push(e),f++}(p=a===f)&&(s=!0,i=0);const o=f;if(n&&"object"==typeof n&&!Array.isArray(n)){if(n.type===undefined){const e={instancePath:t+"/repository",schemaPath:"#/properties/repository/oneOf/1/required",keyword:"required",params:{missingProperty:"type"},message:"must have required property '"+"type"+"'"};null===h?h=[e]:h.push(e),f++}if(n.url===undefined){const e={instancePath:t+"/repository",schemaPath:"#/properties/repository/oneOf/1/required",keyword:"required",params:{missingProperty:"url"},message:"must have required property '"+"url"+"'"};null===h?h=[e]:h.push(e),f++}for(const e in n)if("type"!==e&&"url"!==e){const n={instancePath:t+"/repository",schemaPath:"#/properties/repository/oneOf/1/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:e},message:"must NOT have additional properties"};null===h?h=[n]:h.push(n),f++}if(n.type!==undefined){let e=n.type;if("string"==typeof e){if(c(e)<1){const e={instancePath:t+"/repository/type",schemaPath:"#/properties/repository/oneOf/1/properties/type/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===h?h=[e]:h.push(e),f++}}else{const e={instancePath:t+"/repository/type",schemaPath:"#/properties/repository/oneOf/1/properties/type/type",keyword:"type",params:{type:"string"},message:"must be string"};null===h?h=[e]:h.push(e),f++}}if(n.url!==undefined){let e=n.url;if("string"==typeof e){if(c(e)<1){const e={instancePath:t+"/repository/url",schemaPath:"#/properties/repository/oneOf/1/properties/url/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===h?h=[e]:h.push(e),f++}}else{const e={instancePath:t+"/repository/url",schemaPath:"#/properties/repository/oneOf/1/properties/url/type",keyword:"type",params:{type:"string"},message:"must be string"};null===h?h=[e]:h.push(e),f++}}}else{const e={instancePath:t+"/repository",schemaPath:"#/properties/repository/oneOf/1/type",keyword:"type",params:{type:"object"},message:"must be object"};null===h?h=[e]:h.push(e),f++}var p;if((p=o===f)&&s?(s=!1,i=[i,1]):p&&(s=!0,i=1),s)f=r,null!==h&&(r?h.length=r:h=null);else{const e={instancePath:t+"/repository",schemaPath:"#/properties/repository/oneOf",keyword:"oneOf",params:{passingSchemas:i},message:"must match exactly one schema in oneOf"};null===h?h=[e]:h.push(e),f++}}if(e.source!==undefined){let n=e.source;if(n&&"object"==typeof n&&!Array.isArray(n)){if(n.shasum===undefined){const e={instancePath:t+"/source",schemaPath:"#/properties/source/required",keyword:"required",params:{missingProperty:"shasum"},message:"must have required property '"+"shasum"+"'"};null===h?h=[e]:h.push(e),f++}if(n.location===undefined){const e={instancePath:t+"/source",schemaPath:"#/properties/source/required",keyword:"required",params:{missingProperty:"location"},message:"must have required property '"+"location"+"'"};null===h?h=[e]:h.push(e),f++}for(const e in n)if("shasum"!==e&&"location"!==e){const n={instancePath:t+"/source",schemaPath:"#/properties/source/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:e},message:"must NOT have additional properties"};null===h?h=[n]:h.push(n),f++}if(n.shasum!==undefined){let e=n.shasum;if("string"==typeof e){if(c(e)>44){const e={instancePath:t+"/source/shasum",schemaPath:"#/properties/source/properties/shasum/maxLength",keyword:"maxLength",params:{limit:44},message:"must NOT have more than 44 characters"};null===h?h=[e]:h.push(e),f++}if(c(e)<44){const e={instancePath:t+"/source/shasum",schemaPath:"#/properties/source/properties/shasum/minLength",keyword:"minLength",params:{limit:44},message:"must NOT have fewer than 44 characters"};null===h?h=[e]:h.push(e),f++}if(!a.test(e)){const e={instancePath:t+"/source/shasum",schemaPath:"#/properties/source/properties/shasum/pattern",keyword:"pattern",params:{pattern:"^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$"},message:'must match pattern "'+"^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$"+'"'};null===h?h=[e]:h.push(e),f++}}else{const e={instancePath:t+"/source/shasum",schemaPath:"#/properties/source/properties/shasum/type",keyword:"type",params:{type:"string"},message:"must be string"};null===h?h=[e]:h.push(e),f++}}if(n.location!==undefined){let e=n.location;if(e&&"object"==typeof e&&!Array.isArray(e)){if(e.npm===undefined){const e={instancePath:t+"/source/location",schemaPath:"#/properties/source/properties/location/required",keyword:"required",params:{missingProperty:"npm"},message:"must have required property '"+"npm"+"'"};null===h?h=[e]:h.push(e),f++}for(const n in e)if("npm"!==n){const e={instancePath:t+"/source/location",schemaPath:"#/properties/source/properties/location/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:n},message:"must NOT have additional properties"};null===h?h=[e]:h.push(e),f++}if(e.npm!==undefined){let n=e.npm;if(n&&"object"==typeof n&&!Array.isArray(n)){if(n.filePath===undefined){const e={instancePath:t+"/source/location/npm",schemaPath:"#/properties/source/properties/location/properties/npm/required",keyword:"required",params:{missingProperty:"filePath"},message:"must have required property '"+"filePath"+"'"};null===h?h=[e]:h.push(e),f++}if(n.packageName===undefined){const e={instancePath:t+"/source/location/npm",schemaPath:"#/properties/source/properties/location/properties/npm/required",keyword:"required",params:{missingProperty:"packageName"},message:"must have required property '"+"packageName"+"'"};null===h?h=[e]:h.push(e),f++}if(n.registry===undefined){const e={instancePath:t+"/source/location/npm",schemaPath:"#/properties/source/properties/location/properties/npm/required",keyword:"required",params:{missingProperty:"registry"},message:"must have required property '"+"registry"+"'"};null===h?h=[e]:h.push(e),f++}for(const e in n)if("filePath"!==e&&"iconPath"!==e&&"packageName"!==e&&"registry"!==e){const n={instancePath:t+"/source/location/npm",schemaPath:"#/properties/source/properties/location/properties/npm/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:e},message:"must NOT have additional properties"};null===h?h=[n]:h.push(n),f++}if(n.filePath!==undefined){let e=n.filePath;if("string"==typeof e){if(c(e)<1){const e={instancePath:t+"/source/location/npm/filePath",schemaPath:"#/properties/source/properties/location/properties/npm/properties/filePath/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===h?h=[e]:h.push(e),f++}}else{const e={instancePath:t+"/source/location/npm/filePath",schemaPath:"#/properties/source/properties/location/properties/npm/properties/filePath/type",keyword:"type",params:{type:"string"},message:"must be string"};null===h?h=[e]:h.push(e),f++}}if(n.iconPath!==undefined){let e=n.iconPath;if("string"==typeof e){if(!o.test(e)){const e={instancePath:t+"/source/location/npm/iconPath",schemaPath:"#/properties/source/properties/location/properties/npm/properties/iconPath/pattern",keyword:"pattern",params:{pattern:"\\w+\\.svg$"},message:'must match pattern "'+"\\w+\\.svg$"+'"'};null===h?h=[e]:h.push(e),f++}}else{const e={instancePath:t+"/source/location/npm/iconPath",schemaPath:"#/properties/source/properties/location/properties/npm/properties/iconPath/type",keyword:"type",params:{type:"string"},message:"must be string"};null===h?h=[e]:h.push(e),f++}}if(n.packageName!==undefined){let e=n.packageName;if("string"==typeof e){if(c(e)<1){const e={instancePath:t+"/source/location/npm/packageName",schemaPath:"#/properties/source/properties/location/properties/npm/properties/packageName/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===h?h=[e]:h.push(e),f++}}else{const e={instancePath:t+"/source/location/npm/packageName",schemaPath:"#/properties/source/properties/location/properties/npm/properties/packageName/type",keyword:"type",params:{type:"string"},message:"must be string"};null===h?h=[e]:h.push(e),f++}}if(n.registry!==undefined){let e=n.registry;if("string"!=typeof e){const e={instancePath:t+"/source/location/npm/registry",schemaPath:"#/properties/source/properties/location/properties/npm/properties/registry/type",keyword:"type",params:{type:"string"},message:"must be string"};null===h?h=[e]:h.push(e),f++}if("https://registry.npmjs.org"!==e&&"https://registry.npmjs.org/"!==e){const e={instancePath:t+"/source/location/npm/registry",schemaPath:"#/properties/source/properties/location/properties/npm/properties/registry/enum",keyword:"enum",params:{allowedValues:r.properties.source.properties.location.properties.npm.properties.registry.enum},message:"must be equal to one of the allowed values"};null===h?h=[e]:h.push(e),f++}}}else{const e={instancePath:t+"/source/location/npm",schemaPath:"#/properties/source/properties/location/properties/npm/type",keyword:"type",params:{type:"object"},message:"must be object"};null===h?h=[e]:h.push(e),f++}}}else{const e={instancePath:t+"/source/location",schemaPath:"#/properties/source/properties/location/type",keyword:"type",params:{type:"object"},message:"must be object"};null===h?h=[e]:h.push(e),f++}}}else{const e={instancePath:t+"/source",schemaPath:"#/properties/source/type",keyword:"type",params:{type:"object"},message:"must be object"};null===h?h=[e]:h.push(e),f++}}if(e.initialPermissions!==undefined){let n=e.initialPermissions;if(!n||"object"!=typeof n||Array.isArray(n)){const e={instancePath:t+"/initialPermissions",schemaPath:"#/properties/initialPermissions/type",keyword:"type",params:{type:"object"},message:"must be object"};null===h?h=[e]:h.push(e),f++}}if(e.manifestVersion!==undefined){let n=e.manifestVersion;if("string"!=typeof n){const e={instancePath:t+"/manifestVersion",schemaPath:"#/properties/manifestVersion/type",keyword:"type",params:{type:"string"},message:"must be string"};null===h?h=[e]:h.push(e),f++}if("0.1"!==n){const e={instancePath:t+"/manifestVersion",schemaPath:"#/properties/manifestVersion/enum",keyword:"enum",params:{allowedValues:r.properties.manifestVersion.enum},message:"must be equal to one of the allowed values"};null===h?h=[e]:h.push(e),f++}}}else{const e={instancePath:t,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"};null===h?h=[e]:h.push(e),f++}return u.errors=h,h}}}},{package:"@metamask/snap-controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/dist/snaps/json-schemas/validateSnapManifest.js"}],[1339,{"../utils":1340,"./json-schemas":1336,buffer:2081,"concat-stream":1414,"cross-fetch":2189,crypto:2191,"fast-deep-equal":4293,"gunzip-maybe":4333,pump:5519,"readable-web-to-node-stream":5703,semver:5781,"tar-stream":5913},function(){with(this)return function(){"use strict";return function(e,t,n){(function(t){(function(){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.resolveVersion=n.validateSnapShasum=n.validateNpmSnapManifest=n.validateNpmSnap=n.ProgrammaticallyFixableSnapError=n.SnapValidationFailureReason=n.fetchNpmSnap=n.getSnapSourceShasum=n.fetchContent=n.PROPOSED_NAME_REGEX=n.DEFAULT_REQUESTED_SNAP_VERSION=n.DEFAULT_NPM_REGISTRY=n.LOCALHOST_HOSTNAMES=n.NpmSnapFileNames=n.SnapIdPrefixes=void 0;const s=e("crypto"),i=r(e("concat-stream")),a=r(e("cross-fetch")),o=r(e("fast-deep-equal")),c=r(e("gunzip-maybe")),u=r(e("pump")),l=e("readable-web-to-node-stream"),d=e("semver"),h=e("tar-stream"),f=e("../utils"),p=e("./json-schemas");var m;!function(e){e.npm="npm:",e.local="local:"}(n.SnapIdPrefixes||(n.SnapIdPrefixes={})),function(e){e.PackageJson="package.json",e.Manifest="snap.manifest.json"}(m=n.NpmSnapFileNames||(n.NpmSnapFileNames={})),n.LOCALHOST_HOSTNAMES=new Set(["localhost","127.0.0.1","::1"]),n.DEFAULT_NPM_REGISTRY="https://registry.npmjs.org",n.DEFAULT_REQUESTED_SNAP_VERSION="*";const g=1e5,y=`${Math.floor(100)}kb`;function v(e){return s.createHash("sha256").update(e,"utf8").digest("base64")}n.PROPOSED_NAME_REGEX=/^(?:[A-Za-z0-9-_]+( [A-Za-z0-9-_]+)*)|(?:(?:@[A-Za-z0-9-*~][A-Za-z0-9-*._~]*\/)?[A-Za-z0-9-~][A-Za-z0-9-._~]*)$/u,n.fetchContent=a.default,n.getSnapSourceShasum=v;const b=["manifest","packageJson","sourceCode"],w={manifest:m.Manifest,packageJson:m.PackageJson,sourceCode:"source code bundle"};var k;n.fetchNpmSnap=async function(e,t,r=n.DEFAULT_NPM_REGISTRY,s=n.fetchContent){const[a,o]=await async function(e,t,r=n.DEFAULT_NPM_REGISTRY,s=n.fetchContent){var i,a,o,c,u;const l=await(await s(new URL(e,r).toString())).json();if(!f.isPlainObject(l))throw new Error(`Failed to fetch package "${e}" metadata from npm.`);const h=d.maxSatisfying(Object.keys(null!==(a=null===(i=l)||void 0===i?void 0:i.versions)&&void 0!==a?a:{}),t);if(null===h)throw new Error(`Failed to find a matching version in npm metadata for package "${e}" and requested semver range "${t}"`);const p=null===(u=null===(c=null===(o=l.versions)||void 0===o?void 0:o[h])||void 0===c?void 0:c.dist)||void 0===u?void 0:u.tarball;if(!function(e){try{return Boolean(new URL(e))}catch(e){return!1}}(p)||!p.endsWith(".tgz"))throw new Error(`Failed to find valid tarball URL in npm metadata for package "${e}".`);const m=new URL(r),g=new URL(p);g.hostname=m.hostname,g.protocol=m.protocol;const y=await s(g.toString());if(!y.ok)throw new Error(`Failed to fetch tarball for package "${e}".`);return[await y.blob().then((e=>e.stream())),h]}(e,t,r,s),p={};return await new Promise(((e,t)=>{u.default(function(e){if("function"!=typeof e.getReader)return e;return new l.ReadableWebToNodeStream(e)}(a),c.default(),function(e){const t=h.extract(),n=new Map;return t.on("entry",((r,s,a)=>{const{name:o,type:c}=r;if("file"===c){const r=o.replace(P,"");if(r===m.PackageJson)return s.pipe(i.default((n=>{try{e.packageJson=JSON.parse(n.toString())}catch(e){return t.destroy(new Error(`Failed to parse "${m.PackageJson}".`))}return a()})));if(r===m.Manifest)return s.pipe(i.default((n=>{try{e.manifest=JSON.parse(n.toString())}catch(e){return t.destroy(new Error(`Failed to parse "${m.Manifest}".`))}return a()})));if(/\w+\.(?:js|svg)$/u.test(r))return s.pipe(i.default((e=>(n.set(r,e),a()))))}return s.on("end",(()=>a())),s.resume()})),t.on("finish",(()=>{var t,r,s,i,a;if(f.isPlainObject(e.manifest)){const{filePath:o,iconPath:c}=null!==(s=null===(r=null===(t=e.manifest.source)||void 0===t?void 0:t.location)||void 0===r?void 0:r.npm)&&void 0!==s?s:{};o&&(e.sourceCode=null===(i=n.get(o))||void 0===i?void 0:i.toString("utf8")),"string"==typeof c&&c.endsWith(".svg")&&(e.svgIcon=null===(a=n.get(c))||void 0===a?void 0:a.toString("utf8"))}n.clear()})),t}(p),(n=>{n?t(n):e()}))})),E(p,`npm Snap "${e}@${o}" validation error: `)},function(e){e.NameMismatch='"name" field mismatch',e.VersionMismatch='"version" field mismatch',e.RepositoryMismatch='"repository" field mismatch',e.ShasumMismatch='"shasum" field mismatch'}(k=n.SnapValidationFailureReason||(n.SnapValidationFailureReason={}));class _ extends Error{constructor(e,t){super(e),this.reason=t}}function E(e,n){b.forEach((t=>{if(!e[t])throw new Error(`${n}Missing file "${w[t]}".`)}));const{manifest:r,packageJson:s,sourceCode:i,svgIcon:a}=e;try{p.validateSnapJsonFile(m.Manifest,r)}catch(e){throw new Error(`${n}"${m.Manifest}" is invalid:\n${e.message}`)}const o=r,{iconPath:c}=o.source.location.npm;if(c&&!a)throw new Error(`${n}Missing file "${c}".`);try{p.validateSnapJsonFile(m.PackageJson,s)}catch(e){throw new Error(`${n}"${m.PackageJson}" is invalid:\n${e.message}`)}const u=s;if(S({manifest:o,packageJson:u,sourceCode:i},n),a&&t.byteLength(a,"utf8")>g)throw new Error(`${n}The specified SVG icon exceeds the maximum size of ${y}.`);return{manifest:o,packageJson:u,sourceCode:i,svgIcon:a}}function S({manifest:e,packageJson:t,sourceCode:n},r){const s=t.name,i=t.version,a=t.repository,c=e.source.location.npm.packageName,u=e.version,l=e.repository;if(s!==c)throw new _(`${r}"${m.Manifest}" npm package name ("${c}") does not match the "${m.PackageJson}" "name" field ("${s}").`,k.NameMismatch);if(i!==u)throw new _(`${r}"${m.Manifest}" npm package version ("${u}") does not match the "${m.PackageJson}" "version" field ("${i}").`,k.VersionMismatch);if((a||l)&&!o.default(a,l))throw new _(`${r}"${m.Manifest}" "repository" field does not match the "${m.PackageJson}" "repository" field.`,k.RepositoryMismatch);return x(e,n,`${r}"${m.Manifest}" "shasum" field does not match computed shasum.`),[e,n,t]}n.ProgrammaticallyFixableSnapError=_,n.validateNpmSnap=E,n.validateNpmSnapManifest=S;const P=/^package\//u;function x(e,t,n="Invalid Snap manifest: manifest shasum does not match computed shasum."){if(e.source.shasum!==v(t))throw new _(n,k.ShasumMismatch)}n.validateSnapShasum=x,n.resolveVersion=function(e){return e===undefined||"latest"===e?n.DEFAULT_REQUESTED_SNAP_VERSION:e}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/snap-controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/dist/snaps/utils.js"}],[134,{"../../../shared/constants/transaction":6193,"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,lodash:5172},function(){with(this)return function(){"use strict";return function(e,t,n){var r=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=r(e("@babel/runtime/helpers/defineProperty")),i=e("lodash"),a=e("../../../shared/constants/transaction");function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){(0,s.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var u={version:53,async migrate(e){const t=(0,i.cloneDeep)(e);t.meta.version=53;const n=t.data;return t.data=function(e){var t,n;const r=null==e||null===(t=e.TransactionController)||void 0===t?void 0:t.transactions,s=null==e||null===(n=e.IncomingTransactionsController)||void 0===n?void 0:n.incomingTransactions;Array.isArray(r)&&r.forEach((e=>{e&&(e.type!==a.TRANSACTION_TYPES.RETRY&&e.type!==a.TRANSACTION_TYPES.CANCEL&&(e.type=e.transactionCategory),delete e.transactionCategory)}));if(s){Object.entries(s).forEach((([t,n])=>{n&&(delete n.transactionCategory,e.IncomingTransactionsController.incomingTransactions[t]=c(c({},n),{},{type:a.TRANSACTION_TYPES.INCOMING}))}))}return e}(n),t}};n.default=u}}},{package:"<root>",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/app/scripts/migrations/053.js"}],[1340,{"fast-deep-equal":4293},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.assertExhaustive=n.setDiff=n.isValidJson=n.isNonEmptyArray=n.hasProperty=n.isPlainObject=n.timeSince=void 0;const s=r(e("fast-deep-equal"));n.timeSince=function(e){return Date.now()-e},n.isPlainObject=function(e){return Boolean(e)&&"object"==typeof e&&!Array.isArray(e)};n.hasProperty=(e,t)=>Reflect.hasOwnProperty.call(e,t),n.isNonEmptyArray=function(e){return Array.isArray(e)&&e.length>0},n.isValidJson=function(e){try{return s.default(e,JSON.parse(JSON.stringify(e)))}catch(e){return!1}},n.setDiff=function(e,t){return Object.entries(e).reduce(((e,[n,r])=>(n in t||(e[n]=r),e)),{})},n.assertExhaustive=function(e){throw new Error("Invalid branch reached. Should be detected during compilation")}}}},{package:"@metamask/snap-controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/dist/utils.js"}],[1341,{},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.BaseController=void 0;class r{constructor(e={},t={}){this.defaultConfig={},this.defaultState={},this.disabled=!1,this.name="BaseController",this.internalConfig=this.defaultConfig,this.internalState=this.defaultState,this.internalListeners=[],this.initialState=t,this.initialConfig=e}initialize(){return this.internalState=this.defaultState,this.internalConfig=this.defaultConfig,this.configure(this.initialConfig),this.update(this.initialState),this}get config(){return this.internalConfig}get state(){return this.internalState}configure(e,t=!1,n=!0){if(n){this.internalConfig=t?e:Object.assign(this.internalConfig,e);for(const e in this.internalConfig)void 0!==this.internalConfig[e]&&(this[e]=this.internalConfig[e])}else for(const t in e)void 0!==this.internalConfig[t]&&(this.internalConfig[t]=e[t],this[t]=e[t])}notify(){this.disabled||this.internalListeners.forEach((e=>{e(this.internalState)}))}subscribe(e){this.internalListeners.push(e)}unsubscribe(e){const t=this.internalListeners.findIndex((t=>e===t));return t>-1&&this.internalListeners.splice(t,1),t>-1}update(e,t=!1){this.internalState=t?Object.assign({},e):Object.assign({},this.internalState,e),this.notify()}}n.BaseController=r,n.default=r}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/BaseController.js"}],[1342,{immer:4402},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getPersistentState=n.getAnonymizedState=n.BaseController=void 0;const r=e("immer");r.enablePatches();function s(e,t,n){return Object.keys(e).reduce(((r,s)=>{const i=t[s][n],a=e[s];return"function"==typeof i?r[s]=i(a):i&&(r[s]=a),r}),{})}n.BaseController=class{constructor({messenger:e,metadata:t,name:n,state:r}){this.messagingSystem=e,this.name=n,this.internalState=r,this.metadata=t,this.messagingSystem.registerActionHandler(`${n}:getState`,(()=>this.state))}get state(){return this.internalState}set state(e){throw new Error("Controller state cannot be directly mutated; use 'update' method instead.")}update(e){const[t,n]=r.produceWithPatches(this.internalState,e);this.internalState=t,this.messagingSystem.publish(`${this.name}:stateChange`,t,n)}destroy(){this.messagingSystem.clearEventSubscriptions(`${this.name}:stateChange`)}},n.getAnonymizedState=function(e,t){return s(e,t,"anonymous")},n.getPersistentState=function(e,t){return s(e,t,"persist")}}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/BaseControllerV2.js"}],[1343,{"./BaseController":1341},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ComposableController=void 0;const r=e("./BaseController");class s extends r.BaseController{constructor(e,t){super(undefined,e.reduce(((e,t)=>(e[t.name]=t.state,e)),{})),this.controllers=[],this.name="ComposableController",this.initialize(),this.controllers=e,this.messagingSystem=t,this.controllers.forEach((e=>{const{name:t}=e;if(e.subscribe!==undefined)e.subscribe((e=>{this.update({[t]:e})}));else{if(!this.messagingSystem)throw new Error("Messaging system required if any BaseControllerV2 controllers are used");this.messagingSystem.subscribe(`${t}:stateChange`,(e=>{this.update({[t]:e})}))}}))}get flatState(){let e={};for(const t of this.controllers)e=Object.assign(Object.assign({},e),t.state);return e}}n.ComposableController=s,n.default=s}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/ComposableController.js"}],[1344,{},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ControllerMessenger=n.RestrictedControllerMessenger=void 0;class r{constructor({controllerMessenger:e,name:t,allowedActions:n,allowedEvents:r}){this.controllerMessenger=e,this.controllerName=t,this.allowedActions=n||null,this.allowedEvents=r||null}registerActionHandler(e,t){if(!e.startsWith(`${this.controllerName}:`))throw new Error(`Only allowed registering action handlers prefixed by '${this.controllerName}:'`);this.controllerMessenger.registerActionHandler(e,t)}unregisterActionHandler(e){if(!e.startsWith(`${this.controllerName}:`))throw new Error(`Only allowed unregistering action handlers prefixed by '${this.controllerName}:'`);this.controllerMessenger.unregisterActionHandler(e)}call(e,...t){if(null===this.allowedActions)throw new Error("No actions allowed");if(!this.allowedActions.includes(e))throw new Error(`Action missing from allow list: ${e}`);return this.controllerMessenger.call(e,...t)}publish(e,...t){if(!e.startsWith(`${this.controllerName}:`))throw new Error(`Only allowed publishing events prefixed by '${this.controllerName}:'`);this.controllerMessenger.publish(e,...t)}subscribe(e,t,n){if(null===this.allowedEvents)throw new Error("No events allowed");if(!this.allowedEvents.includes(e))throw new Error(`Event missing from allow list: ${e}`);return n?this.controllerMessenger.subscribe(e,t,n):this.controllerMessenger.subscribe(e,t)}unsubscribe(e,t){if(null===this.allowedEvents)throw new Error("No events allowed");if(!this.allowedEvents.includes(e))throw new Error(`Event missing from allow list: ${e}`);this.controllerMessenger.unsubscribe(e,t)}clearEventSubscriptions(e){if(!e.startsWith(`${this.controllerName}:`))throw new Error(`Only allowed clearing events prefixed by '${this.controllerName}:'`);this.controllerMessenger.clearEventSubscriptions(e)}}n.RestrictedControllerMessenger=r;n.ControllerMessenger=class{constructor(){this.actions=new Map,this.events=new Map,this.eventPayloadCache=new Map}registerActionHandler(e,t){if(this.actions.has(e))throw new Error(`A handler for ${e} has already been registered`);this.actions.set(e,t)}unregisterActionHandler(e){this.actions.delete(e)}clearActions(){this.actions.clear()}call(e,...t){const n=this.actions.get(e);if(!n)throw new Error(`A handler for ${e} has not been registered`);return n(...t)}publish(e,...t){const n=this.events.get(e);if(n)for(const[e,r]of n.entries())if(r){const n=this.eventPayloadCache.get(e),s=r(...t);s!==n&&(this.eventPayloadCache.set(e,s),e(s,n))}else e(...t)}subscribe(e,t,n){let r=this.events.get(e);r||(r=new Map,this.events.set(e,r)),r.set(t,n)}unsubscribe(e,t){const n=this.events.get(e);if(!n||!n.has(t))throw new Error(`Subscription not found for event: ${e}`);n.get(t)&&this.eventPayloadCache.delete(t),n.delete(t)}clearEventSubscriptions(e){this.events.delete(e)}clearSubscriptions(){this.events.clear()}getRestricted({name:e,allowedActions:t,allowedEvents:n}){return new r({controllerMessenger:this,name:e,allowedActions:t,allowedEvents:n})}}}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/ControllerMessenger.js"}],[1345,{"../util":1404},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.fetchExchangeRate=void 0;const s=e("../util");n.fetchExchangeRate=function(e,t,n){return r(this,void 0,void 0,(function*(){const r=yield s.handleFetch(function(e,t,n){return`https://min-api.cryptocompare.com/data/price?fsym=${t.toUpperCase()}&tsyms=${e.toUpperCase()}`+(n&&"USD"!==e.toUpperCase()?",USD":"")}(e,t,n));if("Error"===r.Response)throw new Error(r.Message);const i=Number(r[e.toUpperCase()]),a=Number(r.USD);if(!Number.isFinite(i))throw new Error(`Invalid response for ${e.toUpperCase()}: ${r[e.toUpperCase()]}`);if(n&&!Number.isFinite(a))throw new Error(`Invalid response for usdConversionRate: ${r.USD}`);return{conversionRate:i,usdConversionRate:a}}))}}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/apis/crypto-compare.js"}],[1346,{"../util":1404},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.fetchTokenMetadata=n.fetchTokenList=void 0;const s=e("../util"),i="https://token-api.metaswap.codefi.network";function a(e,t){return r(this,void 0,void 0,(function*(){const n={referrer:e,referrerPolicy:"no-referrer-when-downgrade",method:"GET",mode:"cors",signal:t,cache:"default"};n.headers=new window.Headers,n.headers.set("Content-Type","application/json");try{return yield s.timeoutFetch(e,n,1e4)}catch(e){"AbortError"===e.name&&console.log("Request is aborted")}return undefined}))}function o(e){return r(this,void 0,void 0,(function*(){const t=yield e.json();if(null==t?void 0:t.error)throw new Error(`TokenService Error: ${t.error}`);return t}))}n.fetchTokenList=function(e,t){return r(this,void 0,void 0,(function*(){const n=function(e){return`${i}/tokens/${e}`}(e),r=yield a(n,t);return r?o(r):undefined}))},n.fetchTokenMetadata=function(e,t,n){return r(this,void 0,void 0,(function*(){const r=function(e,t){return`${i}/token/${e}?address=${t}`}(e,t),s=yield a(r,n);return s?o(s):undefined}))}}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/apis/token-service.js"}],[1347,{"../BaseControllerV2":1342,"eth-rpc-errors":2455,nanoid:1453},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ApprovalController=void 0;const r=e("eth-rpc-errors"),s=e("nanoid"),i=e("../BaseControllerV2"),a="ApprovalController",o={pendingApprovals:{persist:!1,anonymous:!0},pendingApprovalCount:{persist:!1,anonymous:!1}};class c extends i.BaseController{constructor({messenger:e,showApprovalRequest:t,state:n={}}){super({name:a,metadata:o,messenger:e,state:Object.assign(Object.assign({},{pendingApprovals:{},pendingApprovalCount:0}),n)}),this._approvals=new Map,this._origins=new Map,this._showApprovalRequest=t,this.registerMessageHandlers()}registerMessageHandlers(){this.messagingSystem.registerActionHandler(`${a}:clearRequests`,this.clear.bind(this)),this.messagingSystem.registerActionHandler(`${a}:addRequest`,((e,t)=>t?this.addAndShowApprovalRequest(e):this.add(e))),this.messagingSystem.registerActionHandler(`${a}:hasRequest`,this.has.bind(this)),this.messagingSystem.registerActionHandler(`${a}:acceptRequest`,this.accept.bind(this)),this.messagingSystem.registerActionHandler(`${a}:rejectRequest`,this.reject.bind(this))}addAndShowApprovalRequest(e){const t=this._add(e.origin,e.type,e.id,e.requestData);return this._showApprovalRequest(),t}add(e){return this._add(e.origin,e.type,e.id,e.requestData)}get(e){return this.state.pendingApprovals[e]}getApprovalCount(e={}){var t,n;if(!e.origin&&!e.type)throw new Error("Must specify origin, type, or both.");const{origin:r,type:s}=e;if(r&&s)return Number(Boolean(null===(t=this._origins.get(r))||void 0===t?void 0:t.has(s)));if(r)return(null===(n=this._origins.get(r))||void 0===n?void 0:n.size)||0;let i=0;for(const e of Object.values(this.state.pendingApprovals))e.type===s&&(i+=1);return i}getTotalApprovalCount(){return this.state.pendingApprovalCount}has(e={}){var t;const{id:n,origin:r,type:s}=e;if(n){if("string"!=typeof n)throw new Error("May not specify non-string id.");return this._approvals.has(n)}if(s&&"string"!=typeof s)throw new Error("May not specify non-string type.");if(r){if("string"!=typeof r)throw new Error("May not specify non-string origin.");return s?Boolean(null===(t=this._origins.get(r))||void 0===t?void 0:t.has(s)):this._origins.has(r)}if(s){for(const e of Object.values(this.state.pendingApprovals))if(e.type===s)return!0;return!1}throw new Error("Must specify a valid combination of id, origin, and type.")}accept(e,t){this._deleteApprovalAndGetCallbacks(e).resolve(t)}reject(e,t){this._deleteApprovalAndGetCallbacks(e).reject(t)}clear(e){for(const t of this._approvals.keys())this.reject(t,e);this._origins.clear(),this.update((()=>({pendingApprovals:{},pendingApprovalCount:0})))}_add(e,t,n=s.nanoid(),i){var a;if(this._validateAddParams(n,e,t,i),null===(a=this._origins.get(e))||void 0===a?void 0:a.has(t))throw r.ethErrors.rpc.resourceUnavailable(((e,t)=>`Request of type '${t}' already pending for origin ${e}. Please wait.`)(e,t));return new Promise(((r,s)=>{this._approvals.set(n,{resolve:r,reject:s}),this._addPendingApprovalOrigin(e,t),this._addToStore(n,e,t,i)}))}_validateAddParams(e,t,n,s){let i=null;if(e&&"string"==typeof e?this._approvals.has(e)?i=`Approval request with id '${e}' already exists.`:t&&"string"==typeof t?n&&"string"==typeof n?s&&("object"!=typeof s||Array.isArray(s))&&(i="Request data must be a plain object if specified."):i="Must specify non-empty string type.":i="Must specify non-empty string origin.":i="Must specify non-empty string id.",i)throw r.ethErrors.rpc.internal(i)}_addPendingApprovalOrigin(e,t){const n=this._origins.get(e)||new Set;n.add(t),this._origins.has(e)||this._origins.set(e,n)}_addToStore(e,t,n,r){const s={id:e,origin:t,type:n,time:Date.now(),requestData:r||null};this.update((t=>{t.pendingApprovals[e]=s,t.pendingApprovalCount=Object.keys(t.pendingApprovals).length}))}_delete(e){this._approvals.delete(e);const{origin:t,type:n}=this.state.pendingApprovals[e];this._origins.get(t).delete(n),this._isEmptyOrigin(t)&&this._origins.delete(t),this.update((t=>{delete t.pendingApprovals[e],t.pendingApprovalCount=Object.keys(t.pendingApprovals).length}))}_deleteApprovalAndGetCallbacks(e){const t=this._approvals.get(e);if(!t)throw new Error(`Approval request with id '${e}' not found.`);return this._delete(e),t}_isEmptyOrigin(e){var t;return!(null===(t=this._origins.get(e))||void 0===t?void 0:t.size)}}n.ApprovalController=c,n.default=c}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/approval/ApprovalController.js"}],[1348,{"../BaseController":1341,"../util":1404,"async-mutex":1727,"eth-query":2451},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.AccountTrackerController=void 0;const i=s(e("eth-query")),a=e("async-mutex"),o=e("../BaseController"),c=e("../util");class u extends o.BaseController{constructor({onPreferencesStateChange:e,getIdentities:t},n,s){super(n,s),this.mutex=new a.Mutex,this.name="AccountTrackerController",this.refresh=()=>r(this,void 0,void 0,(function*(){this.syncAccounts();const{accounts:e}=this.state;for(const t in e)yield c.safelyExecuteWithTimeout((()=>r(this,void 0,void 0,(function*(){const n=yield c.query(this.ethQuery,"getBalance",[t]);e[t]={balance:c.BNToHex(n)},this.update({accounts:Object.assign({},e)})}))))})),this.defaultConfig={interval:1e4},this.defaultState={accounts:{}},this.initialize(),this.getIdentities=t,e((()=>{this.refresh()})),this.poll()}syncAccounts(){const{accounts:e}=this.state,t=Object.keys(this.getIdentities()),n=Object.keys(e),r=t.filter((e=>-1===n.indexOf(e))),s=n.filter((e=>-1===t.indexOf(e)));r.forEach((t=>{e[t]={balance:"0x0"}})),s.forEach((t=>{delete e[t]})),this.update({accounts:Object.assign({},e)})}set provider(e){this.ethQuery=new i.default(e)}get provider(){throw new Error("Property only used for setting")}poll(e){return r(this,void 0,void 0,(function*(){const t=yield this.mutex.acquire();e&&this.configure({interval:e},!1,!1),this.handle&&clearTimeout(this.handle),yield this.refresh(),this.handle=setTimeout((()=>{t(),this.poll(this.config.interval)}),this.config.interval)}))}}n.AccountTrackerController=u,n.default=u}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/assets/AccountTrackerController.js"}],[1349,{"../BaseController":1341,"../constants":1362,"./Standards/CollectibleStandards/ERC1155/ERC1155Standard":1353,"./Standards/CollectibleStandards/ERC721/ERC721Standard":1354,"./Standards/ERC20Standard":1355,"single-call-balance-checker-abi":5836,web3:6108},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.AssetsContractController=void 0;const i=s(e("web3")),a=s(e("single-call-balance-checker-abi")),o=e("../BaseController"),c=e("../constants"),u=e("./Standards/CollectibleStandards/ERC721/ERC721Standard"),l=e("./Standards/CollectibleStandards/ERC1155/ERC1155Standard"),d=e("./Standards/ERC20Standard"),h="AssetsContractController failed to set the provider correctly. A provider must be set for this method to be available";class f extends o.BaseController{constructor({onPreferencesStateChange:e},t,n){super(t,n),this.name="AssetsContractController",this.defaultConfig={provider:undefined,ipfsGateway:c.IPFS_DEFAULT_GATEWAY_URL},this.initialize(),e((({ipfsGateway:e})=>{this.configure({ipfsGateway:e})}))}set provider(e){this.web3=new i.default(e),this.erc721Standard=new u.ERC721Standard(this.web3),this.erc1155Standard=new l.ERC1155Standard(this.web3),this.erc20Standard=new d.ERC20Standard(this.web3)}get provider(){throw new Error("Property only used for setting")}getERC20BalanceOf(e,t){return r(this,void 0,void 0,(function*(){if(!this.erc20Standard)throw new Error(h);return this.erc20Standard.getBalanceOf(e,t)}))}getERC20TokenDecimals(e){return r(this,void 0,void 0,(function*(){if(this.erc20Standard===undefined)throw new Error(h);return yield this.erc20Standard.getTokenDecimals(e)}))}getERC721CollectibleTokenId(e,t,n){if(this.erc721Standard===undefined)throw new Error(h);return this.erc721Standard.getCollectibleTokenId(e,t,n)}getTokenStandardAndDetails(e,t,n){return r(this,void 0,void 0,(function*(){if(this.erc721Standard===undefined||this.erc1155Standard===undefined||this.erc20Standard===undefined)throw new Error(h);const{ipfsGateway:r}=this.config;try{return Object.assign({},yield this.erc721Standard.getDetails(e,r,n))}catch(e){}try{return Object.assign({},yield this.erc1155Standard.getDetails(e,r,n))}catch(e){}try{return Object.assign({},yield this.erc20Standard.getDetails(e,t))}catch(e){}throw new Error("Unable to determine contract standard")}))}getERC721TokenURI(e,t){return r(this,void 0,void 0,(function*(){if(this.erc721Standard===undefined)throw new Error(h);return this.erc721Standard.getTokenURI(e,t)}))}getERC721AssetName(e){return r(this,void 0,void 0,(function*(){if(this.erc721Standard===undefined)throw new Error(h);return this.erc721Standard.getAssetName(e)}))}getERC721AssetSymbol(e){return r(this,void 0,void 0,(function*(){if(this.erc721Standard===undefined)throw new Error(h);return this.erc721Standard.getAssetSymbol(e)}))}getERC721OwnerOf(e,t){return r(this,void 0,void 0,(function*(){if(this.erc721Standard===undefined)throw new Error(h);return this.erc721Standard.getOwnerOf(e,t)}))}getERC1155TokenURI(e,t){return r(this,void 0,void 0,(function*(){if(this.erc1155Standard===undefined)throw new Error(h);return this.erc1155Standard.getTokenURI(e,t)}))}getERC1155BalanceOf(e,t,n){return r(this,void 0,void 0,(function*(){if(this.erc1155Standard===undefined)throw new Error(h);return yield this.erc1155Standard.getBalanceOf(t,e,n)}))}transferSingleERC1155(e,t,n,s,i){return r(this,void 0,void 0,(function*(){if(this.erc1155Standard===undefined)throw new Error(h);return yield this.erc1155Standard.transferSingle(e,t,n,s,i)}))}getBalancesInSingleCall(e,t){return r(this,void 0,void 0,(function*(){const n=this.web3.eth.contract(a.default).at("0xb1f8e55c7f64d203c1400b9d8555d050f94adf39");return new Promise(((r,s)=>{n.balances([e],t,((e,n)=>{if(e)return void s(e);const i={};n.length>0&&t.forEach(((e,t)=>{const r=n[t];r.isZero()||(i[e]=r)})),r(i)}))}))}))}}n.AssetsContractController=f,n.default=f}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/assets/AssetsContractController.js"}],[135,{lodash:5172},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("lodash");function s(e){return"number"==typeof e||"string"==typeof e&&e.match(/^(0x)?\d+$/u)}var i={version:54,async migrate(e){const t=(0,r.cloneDeep)(e);t.meta.version=54;const n=function(e){const t=e;if(!t.PreferencesController)return t;const n=(t.PreferencesController.tokens||[]).filter((({decimals:e})=>s(e)));for(const e of n)"string"==typeof e.decimals&&(e.decimals=parseInt(e.decimals));t.PreferencesController.tokens=n;const{accountTokens:r}=t.PreferencesController;if(r&&"object"==typeof r)for(const e of Object.keys(r)){const t=r[e];if(t&&"object"==typeof t)for(const e of Object.keys(t)){const n=(t[e]||[]).filter((({decimals:e})=>s(e)));for(const e of n)"string"==typeof e.decimals&&(e.decimals=parseInt(e.decimals));t[e]=n}}return t.PreferencesController.accountTokens=r,t}(t.data);return t.data=n,t}};n.default=i}}},{package:"<root>",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/app/scripts/migrations/054.js"}],[1350,{"../BaseController":1341,"../constants":1362,"../util":1404},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.CollectibleDetectionController=void 0;const s=e("../BaseController"),i=e("../util"),a=e("../constants");class o extends s.BaseController{constructor({onPreferencesStateChange:e,onNetworkStateChange:t,getOpenSeaApiKey:n,addCollectible:r,getCollectiblesState:s},i,o){super(i,o),this.name="CollectibleDetectionController",this.isMainnet=()=>this.config.networkType===a.MAINNET,this.defaultConfig={interval:18e4,networkType:a.MAINNET,chainId:"1",selectedAddress:"",disabled:!0},this.initialize(),this.getCollectiblesState=s,e((({selectedAddress:e,useCollectibleDetection:t})=>{const{selectedAddress:n,disabled:r}=this.config;e===n&&!t===r||this.configure({selectedAddress:e,disabled:!t}),t!==undefined&&(t?this.start():this.stop())})),t((({provider:e})=>{this.configure({networkType:e.type,chainId:e.chainId})})),this.getOpenSeaApiKey=n,this.addCollectible=r}getOwnerCollectiblesApi(e,t){return`https://api.opensea.io/api/v1/assets?owner=${e}&offset=${t}&limit=50`}getOwnerCollectibles(e){var t;return r(this,void 0,void 0,(function*(){let n,r=[];const s=this.getOpenSeaApiKey();try{let a=0,o=!1;do{const c=this.getOwnerCollectiblesApi(e,a);n=yield i.timeoutFetch(c,s?{headers:{"X-API-KEY":s}}:{},15e3);const u=yield n.json();0!==(null===(t=u.assets)||void 0===t?void 0:t.length)?r=[...r,...u.assets]:o=!0,a+=50}while(!o)}catch(e){return[]}return r}))}start(){return r(this,void 0,void 0,(function*(){this.isMainnet()&&!this.disabled&&(yield this.startPolling())}))}stop(){this.stopPolling()}stopPolling(){this.intervalId&&clearInterval(this.intervalId)}startPolling(e){return r(this,void 0,void 0,(function*(){e&&this.configure({interval:e},!1,!1),this.stopPolling(),yield this.detectCollectibles(),this.intervalId=setInterval((()=>r(this,void 0,void 0,(function*(){yield this.detectCollectibles()}))),this.config.interval)}))}detectCollectibles(){return r(this,void 0,void 0,(function*(){if(!this.isMainnet()||this.disabled)return;const{selectedAddress:e,chainId:t}=this.config;e&&(yield i.safelyExecute((()=>r(this,void 0,void 0,(function*(){const n=(yield this.getOwnerCollectibles(e)).map((n=>r(this,void 0,void 0,(function*(){const{token_id:r,num_sales:s,background_color:a,image_url:o,image_preview_url:c,image_thumbnail_url:u,image_original_url:l,animation_url:d,animation_original_url:h,name:f,description:p,external_link:m,creator:g,asset_contract:{address:y,schema_name:v},last_sale:b}=n;let w;const{ignoredCollectibles:k}=this.getCollectiblesState();if(k.length&&(w=k.find((e=>e.address===i.toChecksumHexAddress(y)&&e.tokenId===r))),!w){const n=Object.assign({},{name:f},g&&{creator:g},p&&{description:p},o&&{image:o},s&&{numberOfSales:s},a&&{backgroundColor:a},c&&{imagePreview:c},u&&{imageThumbnail:u},l&&{imageOriginal:l},d&&{animation:d},h&&{animationOriginal:h},v&&{standard:v},m&&{externalLink:m},b&&{lastSale:b});yield this.addCollectible(y,r,n,{userAddress:e,chainId:t})}}))));yield Promise.all(n)})))))}))}}n.CollectibleDetectionController=o,n.default=o}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/assets/CollectibleDetectionController.js"}],[1351,{"../BaseController":1341,"../constants":1362,"../util":1404,"./assetsUtil":1361,"async-mutex":1727,"ethereumjs-util":2521,events:2082},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.CollectiblesController=void 0;const s=e("events"),i=e("ethereumjs-util"),a=e("async-mutex"),o=e("../BaseController"),c=e("../util"),u=e("../constants"),l=e("./assetsUtil"),d="allCollectibles",h="allCollectibleContracts";class f extends o.BaseController{constructor({onPreferencesStateChange:e,onNetworkStateChange:t,getERC721AssetName:n,getERC721AssetSymbol:r,getERC721TokenURI:i,getERC721OwnerOf:o,getERC1155BalanceOf:c,getERC1155TokenURI:l},d,h){super(d,h),this.mutex=new a.Mutex,this.hub=new s.EventEmitter,this.name="CollectiblesController",this.defaultConfig={networkType:u.MAINNET,selectedAddress:"",chainId:"",ipfsGateway:u.IPFS_DEFAULT_GATEWAY_URL,openSeaEnabled:!1,useIPFSSubdomains:!0},this.defaultState={allCollectibleContracts:{},allCollectibles:{},ignoredCollectibles:[]},this.initialize(),this.getERC721AssetName=n,this.getERC721AssetSymbol=r,this.getERC721TokenURI=i,this.getERC721OwnerOf=o,this.getERC1155BalanceOf=c,this.getERC1155TokenURI=l,e((({selectedAddress:e,ipfsGateway:t,openSeaEnabled:n})=>{this.configure({selectedAddress:e,ipfsGateway:t,openSeaEnabled:n})})),t((({provider:e})=>{const{chainId:t}=e;this.configure({chainId:t})}))}getCollectibleApi(e,t){const{chainId:n}=this.config;return n===u.RINKEBY_CHAIN_ID?`https://testnets-api.opensea.io/api/v1/asset/${e}/${t}`:`https://api.opensea.io/api/v1/asset/${e}/${t}`}getCollectibleContractInformationApi(e){const{chainId:t}=this.config;return t===u.RINKEBY_CHAIN_ID?`https://testnets-api.opensea.io/api/v1/asset_contract/${e}`:`https://api.opensea.io/api/v1/asset_contract/${e}`}updateNestedCollectibleState(e,t,{userAddress:n,chainId:r}={userAddress:this.config.selectedAddress,chainId:this.config.chainId}){const{[t]:s}=this.state,i=s[n],a=Object.assign(Object.assign({},i),{[r]:e}),o=Object.assign(Object.assign({},s),{[n]:a});this.update({[t]:o})}getCollectibleInformationFromApi(e,t){return r(this,void 0,void 0,(function*(){const n=this.getCollectibleApi(e,t);let r;r=this.openSeaApiKey?yield c.handleFetch(n,{headers:{"X-API-KEY":this.openSeaApiKey}}):yield c.handleFetch(n);const{num_sales:s,background_color:i,image_url:a,image_preview_url:o,image_thumbnail_url:u,image_original_url:l,animation_url:d,animation_original_url:h,name:f,description:p,external_link:m,creator:g,last_sale:y,asset_contract:{schema_name:v}}=r;return Object.assign({},{name:f||null},{description:p||null},{image:a||null},g&&{creator:g},s&&{numberOfSales:s},i&&{backgroundColor:i},o&&{imagePreview:o},u&&{imageThumbnail:u},l&&{imageOriginal:l},d&&{animation:d},h&&{animationOriginal:h},m&&{externalLink:m},y&&{lastSale:y},v&&{standard:v})}))}getCollectibleInformationFromTokenURI(e,t){return r(this,void 0,void 0,(function*(){const{ipfsGateway:n,useIPFSSubdomains:r}=this.config,s=yield this.getCollectibleURIAndStandard(e,t);let i=s[0];const a=s[1];i.startsWith("ipfs://")&&(i=c.getFormattedIpfsUrl(n,i,r));try{const e=yield c.handleFetch(i);return{image:e[Object.prototype.hasOwnProperty.call(e,"image")?"image":"image_url"],name:e.name,description:e.description,standard:a,favorite:!1}}catch(e){return{image:null,name:null,description:null,standard:a||null,favorite:!1}}}))}getCollectibleURIAndStandard(e,t){return r(this,void 0,void 0,(function*(){try{return[yield this.getERC721TokenURI(e,t),u.ERC721]}catch(e){}try{const n=yield this.getERC1155TokenURI(e,t);if(!n.includes("{id}"))return[n,u.ERC1155];const r=i.stripHexPrefix(c.BNToHex(new i.BN(t))).padStart(64,"0").toLowerCase();return[n.replace("{id}",r),u.ERC1155]}catch(e){}return["",""]}))}getCollectibleInformation(e,t){var n,s,i,a,o,u,l,d;return r(this,void 0,void 0,(function*(){const h=yield c.safelyExecute((()=>r(this,void 0,void 0,(function*(){return yield this.getCollectibleInformationFromTokenURI(e,t)}))));let f;return this.config.openSeaEnabled&&(f=yield c.safelyExecute((()=>r(this,void 0,void 0,(function*(){return yield this.getCollectibleInformationFromApi(e,t)}))))),Object.assign(Object.assign({},f),{name:null!==(s=null!==(n=h.name)&&void 0!==n?n:null==f?void 0:f.name)&&void 0!==s?s:null,description:null!==(a=null!==(i=h.description)&&void 0!==i?i:null==f?void 0:f.description)&&void 0!==a?a:null,image:null!==(u=null!==(o=h.image)&&void 0!==o?o:null==f?void 0:f.image)&&void 0!==u?u:null,standard:null!==(d=null!==(l=h.standard)&&void 0!==l?l:null==f?void 0:f.standard)&&void 0!==d?d:null})}))}getCollectibleContractInformationFromApi(e){return r(this,void 0,void 0,(function*(){const t=this.getCollectibleContractInformationApi(e);let n;return n=this.openSeaApiKey?yield c.handleFetch(t,{headers:{"X-API-KEY":this.openSeaApiKey}}):yield c.handleFetch(t),n}))}getCollectibleContractInformationFromContract(e){return r(this,void 0,void 0,(function*(){return{collection:{name:yield this.getERC721AssetName(e)},symbol:yield this.getERC721AssetSymbol(e),address:e}}))}getCollectibleContractInformation(e){return r(this,void 0,void 0,(function*(){const t=yield c.safelyExecute((()=>r(this,void 0,void 0,(function*(){return yield this.getCollectibleContractInformationFromContract(e)}))));let n;return this.config.openSeaEnabled&&(n=yield c.safelyExecute((()=>r(this,void 0,void 0,(function*(){return yield this.getCollectibleContractInformationFromApi(e)}))))),t||n?Object.assign(Object.assign(Object.assign({},n),t),{collection:Object.assign(Object.assign({image_url:null},null==n?void 0:n.collection),null==t?void 0:t.collection)}):{address:e,asset_contract_type:null,created_date:null,schema_name:null,symbol:null,total_supply:null,description:null,external_link:null,collection:{name:null,image_url:null}}}))}addIndividualCollectible(e,t,n,s){var i;return r(this,void 0,void 0,(function*(){const r=yield this.mutex.acquire();try{e=c.toChecksumHexAddress(e);const{allCollectibles:a}=this.state;let o,u;s?(o=s.chainId,u=s.userAddress):(o=this.config.chainId,u=this.config.selectedAddress);const h=(null===(i=a[u])||void 0===i?void 0:i[o])||[],f=h.find((n=>n.address.toLowerCase()===e.toLowerCase()&&n.tokenId===t));if(f){if(!l.compareCollectiblesMetadata(n,f))return h;{const n=h.findIndex((n=>n.address.toLowerCase()===e.toLowerCase()&&n.tokenId===t));-1!==n&&h.splice(n,1)}}const p=Object.assign({address:e,tokenId:t,favorite:(null==f?void 0:f.favorite)||!1,isCurrentlyOwned:!0},n),m=[...h,p];return this.updateNestedCollectibleState(m,d,{chainId:o,userAddress:u}),m}finally{r()}}))}addCollectibleContract(e,t){var n;return r(this,void 0,void 0,(function*(){const r=yield this.mutex.acquire();try{e=c.toChecksumHexAddress(e);const{allCollectibleContracts:s}=this.state;let i,a;t?(i=t.chainId,a=t.userAddress):(i=this.config.chainId,a=this.config.selectedAddress);const o=(null===(n=s[a])||void 0===n?void 0:n[i])||[];if(o.find((t=>t.address.toLowerCase()===e.toLowerCase())))return o;const u=yield this.getCollectibleContractInformation(e),{asset_contract_type:l,created_date:d,schema_name:f,symbol:p,total_supply:m,description:g,external_link:y,collection:{name:v,image_url:b}}=u;if(t&&!v||0===Object.keys(u).length)return o;const w=Object.assign({},{address:e},g&&{description:g},v&&{name:v},b&&{logo:b},p&&{symbol:p},null!=m&&{totalSupply:m},l&&{assetContractType:l},d&&{createdDate:d},f&&{schemaName:f},y&&{externalLink:y}),k=[...o,w];return this.updateNestedCollectibleState(k,h,{chainId:i,userAddress:a}),k}finally{r()}}))}removeAndIgnoreIndividualCollectible(e,t){var n;e=c.toChecksumHexAddress(e);const{allCollectibles:r,ignoredCollectibles:s}=this.state,{chainId:i,selectedAddress:a}=this.config,o=[...s],u=((null===(n=r[a])||void 0===n?void 0:n[i])||[]).filter((n=>{if(n.address.toLowerCase()===e.toLowerCase()&&n.tokenId===t){return!o.find((n=>n.address===e&&n.tokenId===t))&&o.push(n),!1}return!0}));this.updateNestedCollectibleState(u,d),this.update({ignoredCollectibles:o})}removeIndividualCollectible(e,t){var n;e=c.toChecksumHexAddress(e);const{allCollectibles:r}=this.state,{chainId:s,selectedAddress:i}=this.config,a=((null===(n=r[i])||void 0===n?void 0:n[s])||[]).filter((n=>!(n.address.toLowerCase()===e.toLowerCase()&&n.tokenId===t)));this.updateNestedCollectibleState(a,d)}removeCollectibleContract(e){var t;e=c.toChecksumHexAddress(e);const{allCollectibleContracts:n}=this.state,{chainId:r,selectedAddress:s}=this.config,i=((null===(t=n[s])||void 0===t?void 0:t[r])||[]).filter((t=>!(t.address.toLowerCase()===e.toLowerCase())));return this.updateNestedCollectibleState(i,h),i}setApiKey(e){this.openSeaApiKey=e}isCollectibleOwner(e,t,n){return r(this,void 0,void 0,(function*(){try{const r=yield this.getERC721OwnerOf(t,n);return e.toLowerCase()===r.toLowerCase()}catch(e){}try{return(yield this.getERC1155BalanceOf(e,t,n))>0}catch(e){}throw new Error("Unable to verify ownership. Probably because the standard is not supported or the chain is incorrect.")}))}addCollectibleVerifyOwnership(e,t){return r(this,void 0,void 0,(function*(){const{selectedAddress:n}=this.config;if(!(yield this.isCollectibleOwner(n,e,t)))throw new Error("This collectible is not owned by the user");yield this.addCollectible(e,t)}))}addCollectible(e,t,n,s){return r(this,void 0,void 0,(function*(){e=c.toChecksumHexAddress(e);const r=yield this.addCollectibleContract(e,s);n=n||(yield this.getCollectibleInformation(e,t));r.find((t=>t.address.toLowerCase()===e.toLowerCase()))&&(yield this.addIndividualCollectible(e,t,n,s))}))}removeCollectible(e,t){var n;e=c.toChecksumHexAddress(e),this.removeIndividualCollectible(e,t);const{allCollectibles:r}=this.state,{chainId:s,selectedAddress:i}=this.config;((null===(n=r[i])||void 0===n?void 0:n[s])||[]).find((t=>t.address.toLowerCase()===e.toLowerCase()))||this.removeCollectibleContract(e)}removeAndIgnoreCollectible(e,t){var n;e=c.toChecksumHexAddress(e),this.removeAndIgnoreIndividualCollectible(e,t);const{allCollectibles:r}=this.state,{chainId:s,selectedAddress:i}=this.config;((null===(n=r[i])||void 0===n?void 0:n[s])||[]).find((t=>t.address.toLowerCase()===e.toLowerCase()))||this.removeCollectibleContract(e)}clearIgnoredCollectibles(){this.update({ignoredCollectibles:[]})}checkAndUpdateSingleCollectibleOwnershipStatus(e,t,{userAddress:n,chainId:s}={userAddress:this.config.selectedAddress,chainId:this.config.chainId}){var i;return r(this,void 0,void 0,(function*(){const{address:r,tokenId:a}=e;let o=e.isCurrentlyOwned;try{o=yield this.isCollectibleOwner(n,r,a)}catch(e){if(!e.message.includes("Unable to verify ownership"))throw e}if(e.isCurrentlyOwned=o,!0===t)return e;const{allCollectibles:c}=this.state,u=(null===(i=c[n])||void 0===i?void 0:i[s])||[],l=u.find((e=>e.tokenId===a&&e.address.toLowerCase()===r.toLowerCase()));return l&&(l.isCurrentlyOwned=o,this.updateNestedCollectibleState(u,d,{userAddress:n,chainId:s})),e}))}checkAndUpdateAllCollectiblesOwnershipStatus(){var e;return r(this,void 0,void 0,(function*(){const{allCollectibles:t}=this.state,{chainId:n,selectedAddress:s}=this.config,i=(null===(e=t[s])||void 0===e?void 0:e[n])||[],a=yield Promise.all(i.map((e=>r(this,void 0,void 0,(function*(){var t;return null!==(t=yield this.checkAndUpdateSingleCollectibleOwnershipStatus(e,!0))&&void 0!==t?t:e})))));this.updateNestedCollectibleState(a,d)}))}updateCollectibleFavoriteStatus(e,t,n){var r;const{allCollectibles:s}=this.state,{chainId:i,selectedAddress:a}=this.config,o=(null===(r=s[a])||void 0===r?void 0:r[i])||[],c=o.findIndex((n=>n.address===e&&n.tokenId===t));if(-1===c)return;const u=Object.assign(Object.assign({},o[c]),{favorite:n});o[c]=u,this.updateNestedCollectibleState(o,d)}}n.CollectiblesController=f,n.default=f}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/assets/CollectiblesController.js"}],[1352,{"../BaseControllerV2":1342,"../apis/crypto-compare":1345,"../util":1404,"async-mutex":1727},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.CurrencyRateController=void 0;const s=e("async-mutex"),i=e("../BaseControllerV2"),a=e("../util"),o=e("../apis/crypto-compare"),c={conversionDate:{persist:!0,anonymous:!0},conversionRate:{persist:!0,anonymous:!0},currentCurrency:{persist:!0,anonymous:!0},nativeCurrency:{persist:!0,anonymous:!0},pendingCurrentCurrency:{persist:!1,anonymous:!0},pendingNativeCurrency:{persist:!1,anonymous:!0},usdConversionRate:{persist:!0,anonymous:!0}},u={conversionDate:0,conversionRate:0,currentCurrency:"usd",nativeCurrency:"ETH",pendingCurrentCurrency:null,pendingNativeCurrency:null,usdConversionRate:null};class l extends i.BaseController{constructor({includeUsdRate:e=!1,interval:t=18e4,messenger:n,state:r,fetchExchangeRate:i=o.fetchExchangeRate}){super({name:"CurrencyRateController",metadata:c,messenger:n,state:Object.assign(Object.assign({},u),r)}),this.mutex=new s.Mutex,this.includeUsdRate=e,this.intervalDelay=t,this.fetchExchangeRate=i}start(){return r(this,void 0,void 0,(function*(){yield this.startPolling()}))}stop(){this.stopPolling()}destroy(){super.destroy(),this.stopPolling()}setCurrentCurrency(e){return r(this,void 0,void 0,(function*(){this.update((t=>{t.pendingCurrentCurrency=e})),yield this.updateExchangeRate()}))}setNativeCurrency(e){return r(this,void 0,void 0,(function*(){this.update((t=>{t.pendingNativeCurrency=e})),yield this.updateExchangeRate()}))}stopPolling(){this.intervalId&&clearInterval(this.intervalId)}startPolling(){return r(this,void 0,void 0,(function*(){this.stopPolling(),yield a.safelyExecute((()=>this.updateExchangeRate())),this.intervalId=setInterval((()=>r(this,void 0,void 0,(function*(){yield a.safelyExecute((()=>this.updateExchangeRate()))}))),this.intervalDelay)}))}updateExchangeRate(){return r(this,void 0,void 0,(function*(){const e=yield this.mutex.acquire(),{currentCurrency:t,nativeCurrency:n,pendingCurrentCurrency:r,pendingNativeCurrency:s}=this.state;let i=null,a=null,o=null;const c=null!=r?r:t,u=null!=s?s:n;try{c&&u&&""!==c&&""!==u&&(({conversionRate:a,usdConversionRate:o}=yield this.fetchExchangeRate(c,u,this.includeUsdRate)),i=Date.now()/1e3)}catch(e){if(!e.message.includes("market does not exist for this coin pair"))throw e}finally{try{this.update((()=>({conversionDate:i,conversionRate:a,nativeCurrency:u,currentCurrency:c,pendingCurrentCurrency:null,pendingNativeCurrency:null,usdConversionRate:o})))}finally{e()}}return this.state}))}}n.CurrencyRateController=l,n.default=l}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/assets/CurrencyRateController.js"}],[1353,{"../../../../constants":1362,"../../../../util":1404,"@metamask/metamask-eth-abis":1184},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.ERC1155Standard=void 0;const s=e("@metamask/metamask-eth-abis"),i=e("../../../../constants"),a=e("../../../../util");n.ERC1155Standard=class{constructor(e){this.contractSupportsURIMetadataInterface=e=>r(this,void 0,void 0,(function*(){return this.contractSupportsInterface(e,i.ERC1155_METADATA_URI_INTERFACE_ID)})),this.contractSupportsTokenReceiverInterface=e=>r(this,void 0,void 0,(function*(){return this.contractSupportsInterface(e,i.ERC1155_TOKEN_RECEIVER_INTERFACE_ID)})),this.contractSupportsBase1155Interface=e=>r(this,void 0,void 0,(function*(){return this.contractSupportsInterface(e,i.ERC1155_INTERFACE_ID)})),this.getTokenURI=(e,t)=>r(this,void 0,void 0,(function*(){const n=this.web3.eth.contract(s.abiERC1155).at(e);return new Promise(((e,r)=>{n.uri(t,((t,n)=>{t?r(t):e(n)}))}))})),this.getBalanceOf=(e,t,n)=>r(this,void 0,void 0,(function*(){const r=this.web3.eth.contract(s.abiERC1155).at(e);return new Promise(((e,s)=>{r.balanceOf(t,n,((t,n)=>{t?s(t):e(n)}))}))})),this.transferSingle=(e,t,n,i,a)=>r(this,void 0,void 0,(function*(){const r=this.web3.eth.contract(s.abiERC1155).at(e);return new Promise(((s,o)=>{r.transferSingle(e,t,n,i,a,((e,t)=>{e?o(e):s(t)}))}))})),this.contractSupportsInterface=(e,t)=>r(this,void 0,void 0,(function*(){const n=this.web3.eth.contract(s.abiERC1155).at(e);return new Promise(((e,r)=>{n.supportsInterface(t,((t,n)=>{t?r(t):e(n)}))}))})),this.getDetails=(e,t,n)=>r(this,void 0,void 0,(function*(){const r=yield this.contractSupportsBase1155Interface(e);let s,o;if(n){s=yield this.getTokenURI(e,n),s.startsWith("ipfs://")&&(s=a.getFormattedIpfsUrl(t,s,!0));try{const e=yield a.timeoutFetch(s),n=yield e.json();o=null==n?void 0:n.image,(null==o?void 0:o.startsWith("ipfs://"))&&(o=a.getFormattedIpfsUrl(t,o,!0))}catch(e){}}if(r)return{standard:i.ERC1155,tokenURI:s,image:o};throw new Error("This isn't a valid ERC1155 contract")})),this.web3=e}}}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/assets/Standards/CollectibleStandards/ERC1155/ERC1155Standard.js"}],[1354,{"../../../../constants":1362,"../../../../util":1404,"@metamask/metamask-eth-abis":1184},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.ERC721Standard=void 0;const s=e("@metamask/metamask-eth-abis"),i=e("../../../../util"),a=e("../../../../constants");n.ERC721Standard=class{constructor(e){this.contractSupportsMetadataInterface=e=>r(this,void 0,void 0,(function*(){return this.contractSupportsInterface(e,a.ERC721_METADATA_INTERFACE_ID)})),this.contractSupportsEnumerableInterface=e=>r(this,void 0,void 0,(function*(){return this.contractSupportsInterface(e,a.ERC721_ENUMERABLE_INTERFACE_ID)})),this.contractSupportsBase721Interface=e=>r(this,void 0,void 0,(function*(){return this.contractSupportsInterface(e,a.ERC721_INTERFACE_ID)})),this.getCollectibleTokenId=(e,t,n)=>r(this,void 0,void 0,(function*(){const r=this.web3.eth.contract(s.abiERC721).at(e);return new Promise(((e,s)=>{r.tokenOfOwnerByIndex(t,n,((t,n)=>{t?s(t):e(n)}))}))})),this.getTokenURI=(e,t)=>r(this,void 0,void 0,(function*(){const n=this.web3.eth.contract(s.abiERC721).at(e);if(!(yield this.contractSupportsMetadataInterface(e)))throw new Error("Contract does not support ERC721 metadata interface.");return new Promise(((e,r)=>{n.tokenURI(t,((t,n)=>{t?r(t):e(n)}))}))})),this.getAssetName=e=>r(this,void 0,void 0,(function*(){const t=this.web3.eth.contract(s.abiERC721).at(e);return new Promise(((e,n)=>{t.name(((t,r)=>{t?n(t):e(r)}))}))})),this.getAssetSymbol=e=>r(this,void 0,void 0,(function*(){const t=this.web3.eth.contract(s.abiERC721).at(e);return new Promise(((e,n)=>{t.symbol(((t,r)=>{t?n(t):e(r)}))}))})),this.contractSupportsInterface=(e,t)=>r(this,void 0,void 0,(function*(){const n=this.web3.eth.contract(s.abiERC721).at(e);return new Promise(((e,r)=>{n.supportsInterface(t,((t,n)=>{t?r(t):e(n)}))}))})),this.getDetails=(e,t,n)=>r(this,void 0,void 0,(function*(){const[r,s]=yield Promise.all([this.contractSupportsBase721Interface(e),this.contractSupportsMetadataInterface(e)]);let o,c,u,l;if(s&&([c,u]=yield Promise.all([this.getAssetSymbol(e),this.getAssetName(e)]),n)){o=yield this.getTokenURI(e,n),o.startsWith("ipfs://")&&(o=i.getFormattedIpfsUrl(t,o,!0));try{const e=yield i.timeoutFetch(o),n=yield e.json();l=null==n?void 0:n.image,(null==l?void 0:l.startsWith("ipfs://"))&&(l=i.getFormattedIpfsUrl(t,l,!0))}catch(e){}}if(r)return{standard:a.ERC721,tokenURI:o,symbol:c,name:u,image:l};throw new Error("This isn't a valid ERC721 contract")})),this.web3=e}getOwnerOf(e,t){return r(this,void 0,void 0,(function*(){const n=this.web3.eth.contract(s.abiERC721).at(e);return new Promise(((e,r)=>{n.ownerOf(t,((t,n)=>{t?r(t):e(n)}))}))}))}}}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/assets/Standards/CollectibleStandards/ERC721/ERC721Standard.js"}],[1355,{"../../constants":1362,"@metamask/metamask-eth-abis":1184},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.ERC20Standard=void 0;const s=e("@metamask/metamask-eth-abis"),i=e("../../constants");n.ERC20Standard=class{constructor(e){this.web3=e}getBalanceOf(e,t){return r(this,void 0,void 0,(function*(){const n=this.web3.eth.contract(s.abiERC20).at(e);return new Promise(((e,r)=>{n.balanceOf(t,((t,n)=>{t?r(t):e(n)}))}))}))}getTokenDecimals(e){return r(this,void 0,void 0,(function*(){const t=this.web3.eth.contract(s.abiERC20).at(e);return new Promise(((e,n)=>{t.decimals(((t,r)=>{t?n(t):e(r)}))}))}))}getTokenSymbol(e){return r(this,void 0,void 0,(function*(){const t=this.web3.eth.contract(s.abiERC20).at(e);return new Promise(((e,n)=>{t.symbol(((t,r)=>{t?n(t):e(r)}))}))}))}getDetails(e,t){return r(this,void 0,void 0,(function*(){const[n,r]=yield Promise.all([this.getTokenDecimals(e),this.getTokenSymbol(e)]);let s;return t&&(s=yield this.getBalanceOf(e,t)),{decimals:n,symbol:r,balance:s,standard:i.ERC20}}))}}}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/assets/Standards/ERC20Standard.js"}],[1356,{"../BaseController":1341,"../util":1404,"ethereumjs-util":2521},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.TokenBalancesController=n.BN=void 0;const s=e("ethereumjs-util");Object.defineProperty(n,"BN",{enumerable:!0,get:function(){return s.BN}});const i=e("../BaseController"),a=e("../util");class o extends i.BaseController{constructor({onTokensStateChange:e,getSelectedAddress:t,getERC20BalanceOf:n},r,s){super(r,s),this.name="TokenBalancesController",this.defaultConfig={interval:18e4,tokens:[]},this.defaultState={contractBalances:{}},this.initialize(),e((({tokens:e})=>{this.configure({tokens:e}),this.updateBalances()})),this.getSelectedAddress=t,this.getERC20BalanceOf=n,this.poll()}poll(e){return r(this,void 0,void 0,(function*(){e&&this.configure({interval:e},!1,!1),this.handle&&clearTimeout(this.handle),yield a.safelyExecute((()=>this.updateBalances())),this.handle=setTimeout((()=>{this.poll(this.config.interval)}),this.config.interval)}))}updateBalances(){return r(this,void 0,void 0,(function*(){if(this.disabled)return;const{tokens:e}=this.config,t={};for(const n in e){const{address:r}=e[n];try{t[r]=yield this.getERC20BalanceOf(r,this.getSelectedAddress()),e[n].balanceError=null}catch(i){t[r]=new s.BN(0),e[n].balanceError=i}}this.update({contractBalances:t})}))}}n.TokenBalancesController=o,n.default=o}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/assets/TokenBalancesController.js"}],[1357,{"../BaseController":1341,"../constants":1362,"../util":1404},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.TokenDetectionController=void 0;const s=e("../BaseController"),i=e("../util"),a=e("../constants");class o extends s.BaseController{constructor({onTokensStateChange:e,onPreferencesStateChange:t,onNetworkStateChange:n,getBalancesInSingleCall:r,addTokens:s,getTokenListState:i,getTokensState:o},c,u){super(c,u),this.name="TokenDetectionController",this.isMainnet=()=>this.config.networkType===a.MAINNET,this.defaultConfig={interval:18e4,networkType:a.MAINNET,selectedAddress:"",tokens:[]},this.initialize(),this.getTokensState=o,this.getTokenListState=i,this.addTokens=s,e((({tokens:e})=>{this.configure({tokens:e})})),t((({selectedAddress:e})=>{e!==this.config.selectedAddress&&(this.configure({selectedAddress:e}),this.detectTokens())})),n((({provider:e})=>{this.configure({networkType:e.type})})),this.getBalancesInSingleCall=r}start(){return r(this,void 0,void 0,(function*(){this.isMainnet()&&!this.disabled&&(yield this.startPolling())}))}stop(){this.stopPolling()}stopPolling(){this.intervalId&&clearInterval(this.intervalId)}startPolling(e){return r(this,void 0,void 0,(function*(){e&&this.configure({interval:e},!1,!1),this.stopPolling(),yield this.detectTokens(),this.intervalId=setInterval((()=>r(this,void 0,void 0,(function*(){yield this.detectTokens()}))),this.config.interval)}))}detectTokens(){return r(this,void 0,void 0,(function*(){if(!this.isMainnet()||this.disabled)return;const e=this.config.tokens.map((e=>e.address.toLowerCase())),{tokenList:t}=this.getTokenListState(),n=[];for(const r in t)e.includes(r)||n.push(r);const s=[];s[0]=n.slice(0,1e3),s[1]=n.slice(1e3,n.length-1);const{selectedAddress:a}=this.config;if(a)for(const e of s){if(0===e.length)break;yield i.safelyExecute((()=>r(this,void 0,void 0,(function*(){const n=yield this.getBalancesInSingleCall(a,e),r=[];for(const e in n){let n;const{ignoredTokens:s}=this.getTokensState();s.length&&(n=s.find((t=>t===i.toChecksumHexAddress(e))));const a=Object.keys(t).find((t=>t.toLowerCase()===e.toLowerCase()))||"";n===undefined&&r.push({address:e,decimals:t[a].decimals,symbol:t[a].symbol})}r.length&&(yield this.addTokens(r))}))))}}))}}n.TokenDetectionController=o,n.default=o}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/assets/TokenDetectionController.js"}],[1358,{"../BaseControllerV2":1342,"../apis/token-service":1346,"../util":1404,"@metamask/contract-metadata":1011,"abort-controller":1669,"async-mutex":1727},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(n[r[s]]=e[r[s]])}return n},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.TokenListController=void 0;const a=i(e("@metamask/contract-metadata")),o=e("async-mutex"),c=i(e("abort-controller")),u=e("../BaseControllerV2"),l=e("../util"),d=e("../apis/token-service"),h={tokenList:{persist:!0,anonymous:!0},tokensChainsCache:{persist:!0,anonymous:!0}},f={tokenList:{},tokensChainsCache:{}};class p extends u.BaseController{constructor({chainId:e,useStaticTokenList:t,onNetworkStateChange:n,onPreferencesStateChange:s,interval:i=36e5,cacheRefreshThreshold:a=18e5,messenger:u,state:l}){super({name:"TokenListController",metadata:h,messenger:u,state:Object.assign(Object.assign({},f),l)}),this.mutex=new o.Mutex,this.intervalDelay=i,this.cacheRefreshThreshold=a,this.chainId=e,this.useStaticTokenList=t,this.abortController=new c.default,n((e=>r(this,void 0,void 0,(function*(){this.chainId!==e.provider.chainId&&(this.abortController.abort(),this.abortController=new c.default,this.chainId=e.provider.chainId,yield this.restart())})))),s((e=>r(this,void 0,void 0,(function*(){this.useStaticTokenList!==e.useStaticTokenList&&(this.abortController.abort(),this.abortController=new c.default,this.useStaticTokenList=e.useStaticTokenList,yield this.restart())}))))}start(){return r(this,void 0,void 0,(function*(){yield this.startPolling()}))}restart(){return r(this,void 0,void 0,(function*(){this.stopPolling(),yield this.startPolling()}))}stop(){this.stopPolling()}destroy(){super.destroy(),this.stopPolling()}stopPolling(){this.intervalId&&clearInterval(this.intervalId)}startPolling(){return r(this,void 0,void 0,(function*(){yield l.safelyExecute((()=>this.fetchTokenList())),this.intervalId=setInterval((()=>r(this,void 0,void 0,(function*(){yield l.safelyExecute((()=>this.fetchTokenList()))}))),this.intervalDelay)}))}fetchTokenList(){return r(this,void 0,void 0,(function*(){this.useStaticTokenList?yield this.fetchFromStaticTokenList():yield this.fetchFromDynamicTokenList()}))}fetchFromStaticTokenList(){return r(this,void 0,void 0,(function*(){const e={};for(const t in a.default){const n=a.default[t],{erc20:r,logo:i}=n,o=s(n,["erc20","logo"]);r&&(e[t]=Object.assign(Object.assign({},o),{address:t,iconUrl:i,occurrences:null}))}this.update((()=>({tokenList:e,tokensChainsCache:{}})))}))}fetchFromDynamicTokenList(){return r(this,void 0,void 0,(function*(){const e=yield this.mutex.acquire();try{const t=yield l.safelyExecute((()=>this.fetchFromCache())),n=this.state,{tokensChainsCache:r}=n,i=s(n,["tokensChainsCache"]),a={};if(t)for(const e of t)a[e.address]=e;else{const e=yield l.safelyExecute((()=>d.fetchTokenList(this.chainId,this.abortController.signal)));if(!e){const e=r[this.chainId]?r[this.chainId].data:[];for(const t of e)a[t.address]=t;return void this.update((()=>Object.assign(Object.assign({},i),{tokenList:a,tokensChainsCache:r})))}const t=e.filter((e=>e.occurrences&&e.occurrences>=2)),n=t.map((e=>e.symbol)),s=[...new Set(n.filter(((e,t)=>n.indexOf(e)!==t)))],o=t.filter((e=>!s.includes(e.symbol)));for(const e of o)a[e.address]=e}const o=Object.assign(Object.assign({},r),{[this.chainId]:{timestamp:Date.now(),data:Object.values(a)}});this.update((()=>Object.assign(Object.assign({},i),{tokenList:a,tokensChainsCache:o})))}finally{e()}}))}fetchFromCache(){return r(this,void 0,void 0,(function*(){const{tokensChainsCache:e}=this.state,t=e[this.chainId],n=Date.now();return(null==t?void 0:t.data)&&n-(null==t?void 0:t.timestamp)<this.cacheRefreshThreshold?t.data:null}))}fetchTokenMetadata(e){return r(this,void 0,void 0,(function*(){const t=yield this.mutex.acquire();try{return yield d.fetchTokenMetadata(this.chainId,e,this.abortController.signal)}finally{t()}}))}}n.TokenListController=p,n.default=p}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/assets/TokenListController.js"}],[1359,{"../BaseController":1341,"../apis/crypto-compare":1345,"../constants":1362,"../util":1404},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.TokenRatesController=void 0;const s=e("../BaseController"),i=e("../util"),a=e("../constants"),o=e("../apis/crypto-compare"),c={BASE_URL:"https://api.coingecko.com/api/v3",getTokenPriceURL(e,t){return`${this.BASE_URL}/simple/token_price/${e}?${t}`},getPlatformsURL(){return`${this.BASE_URL}/asset_platforms`},getSupportedVsCurrencies(){return`${this.BASE_URL}/simple/supported_vs_currencies`}};function u(e,t){var n;if(!t)return null;const r=null!==(n=t.find((({chain_identifier:t})=>null!==t&&String(t)===e)))&&void 0!==n?n:null;return(null==r?void 0:r.id)||null}class l extends s.BaseController{constructor({onTokensStateChange:e,onCurrencyRateStateChange:t,onNetworkStateChange:n},r,s){super(r,s),this.tokenList=[],this.supportedChains={timestamp:0,data:null},this.supportedVsCurrencies={timestamp:0,data:[]},this.name="TokenRatesController",this.defaultConfig={disabled:!0,interval:18e4,nativeCurrency:"eth",chainId:"",tokens:[],threshold:216e5},this.defaultState={contractExchangeRates:{}},this.initialize(),this.configure({disabled:!1},!1,!1),e((e=>{this.configure({tokens:e.tokens})})),t((e=>{this.configure({nativeCurrency:e.nativeCurrency})})),n((({provider:e})=>{const{chainId:t}=e;this.update({contractExchangeRates:{}}),this.configure({chainId:t})})),this.poll()}poll(e){return r(this,void 0,void 0,(function*(){e&&this.configure({interval:e},!1,!1),this.handle&&clearTimeout(this.handle),yield i.safelyExecute((()=>this.updateExchangeRates())),this.handle=setTimeout((()=>{this.poll(this.config.interval)}),this.config.interval)}))}set chainId(e){!this.disabled&&i.safelyExecute((()=>this.updateExchangeRates()))}get chainId(){throw new Error("Property only used for setting")}set tokens(e){this.tokenList=e,!this.disabled&&i.safelyExecute((()=>this.updateExchangeRates()))}get tokens(){throw new Error("Property only used for setting")}fetchExchangeRate(e,t){return r(this,void 0,void 0,(function*(){const n=`contract_addresses=${this.tokenList.map((e=>e.address)).join(",")}&vs_currencies=${t.toLowerCase()}`;return i.handleFetch(c.getTokenPriceURL(e,n))}))}checkIsSupportedVsCurrency(e){return r(this,void 0,void 0,(function*(){const{threshold:t}=this.config,{timestamp:n,data:r}=this.supportedVsCurrencies;if(Date.now()-n>t){const t=yield i.handleFetch(c.getSupportedVsCurrencies());return this.supportedVsCurrencies={data:t,timestamp:Date.now()},t.includes(e.toLowerCase())}return r.includes(e.toLowerCase())}))}getChainSlug(){return r(this,void 0,void 0,(function*(){const{threshold:e,chainId:t}=this.config,{data:n,timestamp:r}=this.supportedChains;if(Date.now()-r>e){const e=yield i.handleFetch(c.getPlatformsURL());return this.supportedChains={data:e,timestamp:Date.now()},u(t,e)}return u(t,n)}))}updateExchangeRates(){return r(this,void 0,void 0,(function*(){if(0===this.tokenList.length||this.disabled)return;const e=yield this.getChainSlug();let t={};if(e){const{nativeCurrency:n}=this.config;t=yield this.fetchAndMapExchangeRates(n,e)}else this.tokenList.forEach((e=>{const n=i.toChecksumHexAddress(e.address);t[n]=undefined}));this.update({contractExchangeRates:t})}))}fetchAndMapExchangeRates(e,t){return r(this,void 0,void 0,(function*(){const n={};if(yield this.checkIsSupportedVsCurrency(e)){const r=yield this.fetchExchangeRate(t,e);this.tokenList.forEach((t=>{const s=r[t.address.toLowerCase()];n[i.toChecksumHexAddress(t.address)]=s?s[e.toLowerCase()]:0}))}else{let r,s=0;try{[r,{conversionRate:s}]=yield Promise.all([this.fetchExchangeRate(t,a.FALL_BACK_VS_CURRENCY),o.fetchExchangeRate(e,a.FALL_BACK_VS_CURRENCY,!1)])}catch(e){if(e.message.includes("market does not exist for this coin pair"))return{};throw e}for(const[e,t]of Object.entries(r)){const r=t[a.FALL_BACK_VS_CURRENCY.toLowerCase()];n[i.toChecksumHexAddress(e)]=r*s}}return n}))}}n.TokenRatesController=l,n.default=l}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/assets/TokenRatesController.js"}],[136,{"../../../shared/constants/network":6189,lodash:5172},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("lodash"),s=e("../../../shared/constants/network");var i={version:55,async migrate(e){const t=(0,r.cloneDeep)(e);t.meta.version=55;const n=t.data;return t.data=function(e){var t;null!=e&&null!==(t=e.IncomingTransactionsController)&&void 0!==t&&t.incomingTxLastFetchedBlocksByNetwork&&(e.IncomingTransactionsController.incomingTxLastFetchedBlockByChainId=(0,r.mapKeys)(e.IncomingTransactionsController.incomingTxLastFetchedBlocksByNetwork,((e,t)=>{var n,r;return null!==(n=null===(r=s.NETWORK_TYPE_TO_ID_MAP[t])||void 0===r?void 0:r.chainId)&&void 0!==n?n:a})),delete e.IncomingTransactionsController.incomingTxLastFetchedBlockByChainId.UNKNOWN,delete e.IncomingTransactionsController.incomingTxLastFetchedBlocksByNetwork);return e}(n),t}};n.default=i;const a="UNKNOWN"}}},{package:"<root>",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/app/scripts/migrations/055.js"}],[1360,{"../BaseController":1341,"../constants":1362,"../util":1404,"@metamask/contract-metadata":1011,"@metamask/metamask-eth-abis":1184,"async-mutex":1727,ethers:2545,events:2082,uuid:6009},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.TokensController=void 0;const i=e("events"),a=s(e("@metamask/contract-metadata")),o=e("@metamask/metamask-eth-abis"),c=e("uuid"),u=e("async-mutex"),l=e("ethers"),d=e("../BaseController"),h=e("../util"),f=e("../constants");var p;!function(e){e.accepted="accepted",e.failed="failed",e.pending="pending",e.rejected="rejected"}(p||(p={}));class m extends d.BaseController{constructor({onPreferencesStateChange:e,onNetworkStateChange:t,config:n,state:r}){super(n,r),this.mutex=new u.Mutex,this.hub=new i.EventEmitter,this.name="TokensController",this.defaultConfig=Object.assign({networkType:f.MAINNET,selectedAddress:"",chainId:"",provider:undefined},n),this.defaultState=Object.assign({allTokens:{},allIgnoredTokens:{},ignoredTokens:[],suggestedAssets:[],tokens:[]},r),this.initialize(),e((({selectedAddress:e})=>{var t,n;const{allTokens:r,allIgnoredTokens:s}=this.state,{chainId:i}=this.config;this.configure({selectedAddress:e}),this.update({tokens:(null===(t=r[i])||void 0===t?void 0:t[e])||[],ignoredTokens:(null===(n=s[i])||void 0===n?void 0:n[e])||[]})})),t((({provider:e})=>{var t,n;const{allTokens:r,allIgnoredTokens:s}=this.state,{selectedAddress:i}=this.config,{chainId:a}=e;this.configure({chainId:a}),this.ethersProvider=this._instantiateNewEthersProvider(),this.update({tokens:(null===(t=r[a])||void 0===t?void 0:t[i])||[],ignoredTokens:(null===(n=s[a])||void 0===n?void 0:n[i])||[]})}))}failSuggestedAsset(e,t){const n=Object.assign(Object.assign({},e),{status:p.failed,error:t});this.hub.emit(`${e.id}:finished`,n)}_instantiateNewEthersProvider(){var e;return new l.ethers.providers.Web3Provider(null===(e=this.config)||void 0===e?void 0:e.provider)}addToken(e,t,n,s){return r(this,void 0,void 0,(function*(){const r=yield this.mutex.acquire();try{e=h.toChecksumHexAddress(e);const{tokens:i,ignoredTokens:a}=this.state,o=yield this._detectIsERC721(e),c={address:e,symbol:t,decimals:n,image:s,isERC721:o},u=i.find((t=>t.address.toLowerCase()===e.toLowerCase()));if(u){const e=i.indexOf(u);i[e]=c}else i.push(c);const l=a.filter((t=>t.toLowerCase()!==e.toLowerCase())),{newAllTokens:d,newAllIgnoredTokens:f}=this._getNewAllTokensState(i,l);return this.update({allTokens:d,tokens:i,allIgnoredTokens:f,ignoredTokens:l}),i}finally{r()}}))}addTokens(e){return r(this,void 0,void 0,(function*(){const t=yield this.mutex.acquire(),{tokens:n,ignoredTokens:s}=this.state;try{e=yield Promise.all(e.map((e=>r(this,void 0,void 0,(function*(){return e.isERC721=yield this._detectIsERC721(e.address),e})))));let i=s;e.forEach((e=>{const{address:t,symbol:r,decimals:s,image:a,isERC721:o}=e,c=h.toChecksumHexAddress(t),u={address:c,symbol:r,decimals:s,image:a,isERC721:o},l=n.find((e=>e.address.toLowerCase()===c.toLowerCase()));if(l){const e=n.indexOf(l);n[e]=u}else n.push(u);i=i.filter((e=>e.toLowerCase()!==t.toLowerCase()))}));const{newAllTokens:a,newAllIgnoredTokens:o}=this._getNewAllTokensState(n,i);return this.update({tokens:n,allTokens:a,allIgnoredTokens:o,ignoredTokens:i}),n}finally{t()}}))}updateTokenType(e){return r(this,void 0,void 0,(function*(){const t=yield this._detectIsERC721(e),{tokens:n}=this.state,r=n.findIndex((t=>t.address.toLowerCase()===e.toLowerCase()));return n[r].isERC721=t,this.update({tokens:n}),n[r]}))}_detectIsERC721(e){var t,n;return r(this,void 0,void 0,(function*(){const r=h.toChecksumHexAddress(e);if(!0===(null===(t=a.default[r])||void 0===t?void 0:t.erc721))return Promise.resolve(!0);if(!0===(null===(n=a.default[r])||void 0===n?void 0:n.erc20))return Promise.resolve(!1);const s=yield this._createEthersContract(e,o.abiERC721,this.ethersProvider);try{return yield s.supportsInterface(f.ERC721_INTERFACE_ID)}catch(e){return!1}}))}_createEthersContract(e,t,n){return r(this,void 0,void 0,(function*(){return yield new l.ethers.Contract(e,t,n)}))}_generateRandomId(){return c.v1()}watchAsset(e,t){return r(this,void 0,void 0,(function*(){const n={asset:e,id:this._generateRandomId(),status:p.pending,time:Date.now(),type:t};try{if("ERC20"!==t)throw new Error(`Asset of type ${t} not supported`);h.validateTokenToWatch(e)}catch(e){return this.failSuggestedAsset(n,e),Promise.reject(e)}const r=new Promise(((e,t)=>{this.hub.once(`${n.id}:finished`,(n=>{switch(n.status){case p.accepted:return e(n.asset.address);case p.rejected:return t(new Error("User rejected to watch the asset."));case p.failed:return t(new Error(n.error.message));default:return t(new Error(`Unknown status: ${n.status}`))}}))})),{suggestedAssets:s}=this.state;return s.push(n),this.update({suggestedAssets:[...s]}),this.hub.emit("pendingSuggestedAsset",n),{result:r,suggestedAssetMeta:n}}))}acceptWatchAsset(e){return r(this,void 0,void 0,(function*(){const{suggestedAssets:t}=this.state,n=t.findIndex((({id:t})=>e===t)),r=t[n];try{if("ERC20"!==r.type)throw new Error(`Asset of type ${r.type} not supported`);{const{address:e,symbol:t,decimals:n,image:s}=r.asset;yield this.addToken(e,t,n,s),r.status=p.accepted,this.hub.emit(`${r.id}:finished`,r)}}catch(e){this.failSuggestedAsset(r,e)}const s=t.filter((({id:t})=>t!==e));this.update({suggestedAssets:[...s]})}))}rejectWatchAsset(e){const{suggestedAssets:t}=this.state,n=t.findIndex((({id:t})=>e===t)),r=t[n];if(!r)return;r.status=p.rejected,this.hub.emit(`${r.id}:finished`,r);const s=t.filter((({id:t})=>t!==e));this.update({suggestedAssets:[...s]})}removeAndIgnoreToken(e){e=h.toChecksumHexAddress(e);const{tokens:t,ignoredTokens:n}=this.state,r=n.find((t=>t.toLowerCase()===e.toLowerCase())),s=t.filter((t=>t.address.toLowerCase()!==e.toLowerCase()||(!r&&n.push(e),!1))),{newAllTokens:i,newAllIgnoredTokens:a}=this._getNewAllTokensState(s,n);this.update({allTokens:i,tokens:s,allIgnoredTokens:a,ignoredTokens:n})}_getNewAllTokensState(e,t){const{allTokens:n,allIgnoredTokens:r}=this.state,{chainId:s,selectedAddress:i}=this.config,a=n[s],o=r[s],c=Object.assign(Object.assign({},a),{[i]:e}),u=Object.assign(Object.assign({},o),{[i]:t});return{newAllTokens:Object.assign(Object.assign({},n),{[s]:c}),newAllIgnoredTokens:Object.assign(Object.assign({},r),{[s]:u})}}clearIgnoredTokens(){this.update({ignoredTokens:[],allIgnoredTokens:{}})}}n.TokensController=m,n.default=m}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/assets/TokensController.js"}],[1361,{},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.compareCollectiblesMetadata=void 0,n.compareCollectiblesMetadata=function(e,t){return["image","backgroundColor","imagePreview","imageThumbnail","imageOriginal","animation","animationOriginal","externalLink"].reduce(((n,r)=>e[r]&&e[r]!==t[r]?n+1:n),0)>0}}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/assets/assetsUtil.js"}],[1362,{},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.GWEI=n.ERC1155_TOKEN_RECEIVER_INTERFACE_ID=n.ERC1155_METADATA_URI_INTERFACE_ID=n.ERC1155_INTERFACE_ID=n.ERC721_ENUMERABLE_INTERFACE_ID=n.ERC721_METADATA_INTERFACE_ID=n.ERC721_INTERFACE_ID=n.ERC20=n.ERC1155=n.ERC721=n.RINKEBY_CHAIN_ID=n.IPFS_DEFAULT_GATEWAY_URL=n.FALL_BACK_VS_CURRENCY=n.RPC=n.MAINNET=void 0,n.MAINNET="mainnet",n.RPC="rpc",n.FALL_BACK_VS_CURRENCY="ETH",n.IPFS_DEFAULT_GATEWAY_URL="https://cloudflare-ipfs.com/ipfs/",n.RINKEBY_CHAIN_ID="4",n.ERC721="ERC721",n.ERC1155="ERC1155",n.ERC20="ERC20",n.ERC721_INTERFACE_ID="0x80ac58cd",n.ERC721_METADATA_INTERFACE_ID="0x5b5e139f",n.ERC721_ENUMERABLE_INTERFACE_ID="0x780e9d63",n.ERC1155_INTERFACE_ID="0xd9b67a26",n.ERC1155_METADATA_URI_INTERFACE_ID="0x0e89341c",n.ERC1155_TOKEN_RECEIVER_INTERFACE_ID="0x4e2312e0",n.GWEI="gwei"}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/constants.js"}],[1363,{"../BaseControllerV2":1342,"../util":1404,"./determineGasFeeCalculations":1364,"./fetchGasEstimatesViaEthFeeHistory":1366,"./gas-util":1376,"eth-query":2451,"ethereumjs-util":2521,uuid:6009},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.GasFeeController=n.GAS_ESTIMATE_TYPES=n.LEGACY_GAS_PRICES_API_URL=void 0;const i=s(e("eth-query")),a=e("uuid"),o=e("ethereumjs-util"),c=e("../BaseControllerV2"),u=e("../util"),l=e("./gas-util"),d=s(e("./determineGasFeeCalculations")),h=s(e("./fetchGasEstimatesViaEthFeeHistory"));n.LEGACY_GAS_PRICES_API_URL="https://api.metaswap.codefi.network/gasPrices",n.GAS_ESTIMATE_TYPES={FEE_MARKET:"fee-market",LEGACY:"legacy",ETH_GASPRICE:"eth_gasPrice",NONE:"none"};const f={gasFeeEstimates:{persist:!0,anonymous:!1},estimatedGasFeeTimeBounds:{persist:!0,anonymous:!1},gasEstimateType:{persist:!0,anonymous:!1}},p={gasFeeEstimates:{},estimatedGasFeeTimeBounds:{},gasEstimateType:n.GAS_ESTIMATE_TYPES.NONE};class m extends c.BaseController{constructor({interval:e=15e3,messenger:t,state:s,getCurrentNetworkEIP1559Compatibility:a,getCurrentAccountEIP1559Compatibility:o,getChainId:c,getCurrentNetworkLegacyGasAPICompatibility:u,getProvider:l,onNetworkStateChange:d,legacyAPIEndpoint:h=n.LEGACY_GAS_PRICES_API_URL,EIP1559APIEndpoint:m="https://mock-gas-server.herokuapp.com/",clientId:g}){super({name:"GasFeeController",metadata:f,messenger:t,state:Object.assign(Object.assign({},p),s)}),this.intervalDelay=e,this.pollTokens=new Set,this.getCurrentNetworkEIP1559Compatibility=a,this.getCurrentNetworkLegacyGasAPICompatibility=u,this.getCurrentAccountEIP1559Compatibility=o,this.EIP1559APIEndpoint=m,this.legacyAPIEndpoint=h,this.getChainId=c,this.currentChainId=this.getChainId();const y=l();this.ethQuery=new i.default(y),this.clientId=g,d((()=>r(this,void 0,void 0,(function*(){const e=l(),t=this.getChainId();this.ethQuery=new i.default(e),this.currentChainId!==t&&(this.currentChainId=t,yield this.resetPolling())}))))}resetPolling(){return r(this,void 0,void 0,(function*(){if(0!==this.pollTokens.size){const e=Array.from(this.pollTokens);this.stopPolling(),yield this.getGasFeeEstimatesAndStartPolling(e[0]),e.slice(1).forEach((e=>{this.pollTokens.add(e)}))}}))}fetchGasFeeEstimates(e){return r(this,void 0,void 0,(function*(){return yield this._fetchGasFeeEstimateData(e)}))}getGasFeeEstimatesAndStartPolling(e){return r(this,void 0,void 0,(function*(){const t=e||a.v1();return this.pollTokens.add(t),1===this.pollTokens.size&&(yield this._fetchGasFeeEstimateData(),this._poll()),t}))}_fetchGasFeeEstimateData(e={}){return r(this,void 0,void 0,(function*(){const{shouldUpdateState:t=!0}=e;let n;const r=this.getCurrentNetworkLegacyGasAPICompatibility();let s=this.getChainId();"string"==typeof s&&o.isHexString(s)&&(s=parseInt(s,16));try{n=yield this.getEIP1559Compatibility()}catch(e){console.error(e),n=!1}const i=yield d.default({isEIP1559Compatible:n,isLegacyGasAPICompatible:r,fetchGasEstimates:l.fetchGasEstimates,fetchGasEstimatesUrl:this.EIP1559APIEndpoint.replace("<chain_id>",`${s}`),fetchGasEstimatesViaEthFeeHistory:h.default,fetchLegacyGasPriceEstimates:l.fetchLegacyGasPriceEstimates,fetchLegacyGasPriceEstimatesUrl:this.legacyAPIEndpoint.replace("<chain_id>",`${s}`),fetchEthGasPriceEstimate:l.fetchEthGasPriceEstimate,calculateTimeEstimate:l.calculateTimeEstimate,clientId:this.clientId,ethQuery:this.ethQuery});return t&&this.update((e=>{e.gasFeeEstimates=i.gasFeeEstimates,e.estimatedGasFeeTimeBounds=i.estimatedGasFeeTimeBounds,e.gasEstimateType=i.gasEstimateType})),i}))}disconnectPoller(e){this.pollTokens.delete(e),0===this.pollTokens.size&&this.stopPolling()}stopPolling(){this.intervalId&&clearInterval(this.intervalId),this.pollTokens.clear(),this.resetState()}destroy(){super.destroy(),this.stopPolling()}_poll(){this.intervalId&&clearInterval(this.intervalId),this.intervalId=setInterval((()=>r(this,void 0,void 0,(function*(){yield u.safelyExecute((()=>this._fetchGasFeeEstimateData()))}))),this.intervalDelay)}resetState(){this.update((()=>p))}getEIP1559Compatibility(){var e,t;return r(this,void 0,void 0,(function*(){const n=yield this.getCurrentNetworkEIP1559Compatibility(),r=null===(t=null===(e=this.getCurrentAccountEIP1559Compatibility)||void 0===e?void 0:e.call(this))||void 0===t||t;return n&&r}))}getTimeEstimate(e,t){return this.state.gasFeeEstimates&&this.state.gasEstimateType===n.GAS_ESTIMATE_TYPES.FEE_MARKET?l.calculateTimeEstimate(e,t,this.state.gasFeeEstimates):{}}}n.GasFeeController=m,n.default=m}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/gas/GasFeeController.js"}],[1364,{"./GasFeeController":1363},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0});const s=e("./GasFeeController");n.default=function({isEIP1559Compatible:e,isLegacyGasAPICompatible:t,fetchGasEstimates:n,fetchGasEstimatesUrl:i,fetchGasEstimatesViaEthFeeHistory:a,fetchLegacyGasPriceEstimates:o,fetchLegacyGasPriceEstimatesUrl:c,fetchEthGasPriceEstimate:u,calculateTimeEstimate:l,clientId:d,ethQuery:h}){return r(this,void 0,void 0,(function*(){try{if(e){let e;try{e=yield n(i,d)}catch(t){e=yield a(h)}const{suggestedMaxPriorityFeePerGas:t,suggestedMaxFeePerGas:r}=e.medium;return{gasFeeEstimates:e,estimatedGasFeeTimeBounds:l(t,r,e),gasEstimateType:s.GAS_ESTIMATE_TYPES.FEE_MARKET}}if(t){return{gasFeeEstimates:yield o(c,d),estimatedGasFeeTimeBounds:{},gasEstimateType:s.GAS_ESTIMATE_TYPES.LEGACY}}throw new Error("Main gas fee/price estimation failed. Use fallback")}catch(e){try{return{gasFeeEstimates:yield u(h),estimatedGasFeeTimeBounds:{},gasEstimateType:s.GAS_ESTIMATE_TYPES.ETH_GASPRICE}}catch(e){throw new Error(`Gas fee/price estimation failed. Message: ${e.message}`)}}}))}}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/gas/determineGasFeeCalculations.js"}],[1365,{"../util":1404,"ethereumjs-util":2521},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0});const s=e("ethereumjs-util"),i=e("../util"),a=1024;function o({ethQuery:e,numberOfBlocks:t,endBlockNumber:n,percentiles:s,includeNextBlock:a}){var o;return r(this,void 0,void 0,(function*(){const r=yield i.query(e,"eth_feeHistory",[i.toHex(t),i.toHex(n),s]),c=i.fromHex(r.oldestBlock);if(r.baseFeePerGas!==undefined&&r.baseFeePerGas.length>0&&r.gasUsedRatio.length>0&&(r.reward===undefined||r.reward.length>0)){const e=a?r.baseFeePerGas:r.baseFeePerGas.slice(0,t),n=r.gasUsedRatio,u=null!==(o=r.reward)&&void 0!==o?o:[],l=n.length;return e.map(((e,t)=>{const r=i.fromHex(e),a=c.addn(t);return t>=l?function({baseFeePerGas:e,number:t}){return{number:t,baseFeePerGas:e,gasUsedRatio:null,priorityFeesByPercentile:null}}({baseFeePerGas:r,number:a}):function({baseFeePerGas:e,number:t,blockIndex:n,gasUsedRatios:r,priorityFeePercentileGroups:s,percentiles:a}){const o=r[n],c=s[n];return{number:t,baseFeePerGas:e,gasUsedRatio:o,priorityFeesByPercentile:a.reduce(((e,t,n)=>{const r=c[n];return Object.assign(Object.assign({},e),{[t]:i.fromHex(r)})}),{})}}({baseFeePerGas:r,number:a,blockIndex:t,gasUsedRatios:n,priorityFeePercentileGroups:u,percentiles:s})}))}return[]}))}n.default=function({ethQuery:e,numberOfBlocks:t,endBlock:n="latest",percentiles:c=[],includeNextBlock:u=!1}){return r(this,void 0,void 0,(function*(){const r=c.length>0?Array.from(new Set(c)).sort(((e,t)=>e-t)):[],l=function(e,t){e.lt(new s.BN(t))&&(t=e.toNumber());const n=[];for(let r=e.subn(t);r.lt(e);r=r.addn(a)){const t=e.sub(r).toNumber(),s=t<a?t:a,i=r.addn(s);n.push({numberOfBlocks:s,endBlockNumber:i})}return n}("latest"===n?i.fromHex(yield i.query(e,"blockNumber")):n,t);return(yield Promise.all(l.map((({numberOfBlocks:t,endBlockNumber:n},s)=>s===l.length-1?o({ethQuery:e,numberOfBlocks:t,endBlockNumber:n,percentiles:r,includeNextBlock:u}):o({ethQuery:e,numberOfBlocks:t,endBlockNumber:n,percentiles:r,includeNextBlock:!1}))))).reduce(((e,t)=>[...e,...t]),[])}))}}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/gas/fetchBlockFeeHistory.js"}],[1366,{"../constants":1362,"./fetchGasEstimatesViaEthFeeHistory/BlockFeeHistoryDatasetFetcher":1367,"./fetchGasEstimatesViaEthFeeHistory/calculateBaseFeeRange":1368,"./fetchGasEstimatesViaEthFeeHistory/calculateBaseFeeTrend":1369,"./fetchGasEstimatesViaEthFeeHistory/calculateGasFeeEstimatesForPriorityLevels":1370,"./fetchGasEstimatesViaEthFeeHistory/calculateNetworkCongestion":1371,"./fetchGasEstimatesViaEthFeeHistory/calculatePriorityFeeRange":1372,"./fetchGasEstimatesViaEthFeeHistory/calculatePriorityFeeTrend":1373,"./fetchGasEstimatesViaEthFeeHistory/fetchLatestBlock":1374,"ethjs-unit":2573},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const i=e("ethjs-unit"),a=e("../constants"),o=s(e("./fetchGasEstimatesViaEthFeeHistory/BlockFeeHistoryDatasetFetcher")),c=s(e("./fetchGasEstimatesViaEthFeeHistory/calculateGasFeeEstimatesForPriorityLevels")),u=s(e("./fetchGasEstimatesViaEthFeeHistory/calculateBaseFeeRange")),l=s(e("./fetchGasEstimatesViaEthFeeHistory/calculateBaseFeeTrend")),d=s(e("./fetchGasEstimatesViaEthFeeHistory/calculatePriorityFeeRange")),h=s(e("./fetchGasEstimatesViaEthFeeHistory/calculatePriorityFeeTrend")),f=s(e("./fetchGasEstimatesViaEthFeeHistory/calculateNetworkCongestion")),p=s(e("./fetchGasEstimatesViaEthFeeHistory/fetchLatestBlock"));n.default=function(e){return r(this,void 0,void 0,(function*(){const t=yield p.default(e),n=new o.default({ethQuery:e,endBlockNumber:t.number}),r=yield n.forAll(),s=c.default(r.smallRange),m=i.fromWei(t.baseFeePerGas,a.GWEI),g=u.default(r.mediumRange),y=l.default(r.latestWithNextBlock),v=d.default(r.latest),b=d.default(r.mediumRange),w=h.default(r.tinyRange),k=f.default([]);return Object.assign(Object.assign({},s),{estimatedBaseFee:m,historicalBaseFeeRange:g,baseFeeTrend:y,latestPriorityFeeRange:v,historicalPriorityFeeRange:b,priorityFeeTrend:w,networkCongestion:k})}))}}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/gas/fetchGasEstimatesViaEthFeeHistory.js"}],[1367,{"../fetchBlockFeeHistory":1365},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const i=s(e("../fetchBlockFeeHistory"));n.default=class{constructor({ethQuery:e,endBlockNumber:t}){this.ethQuery=e,this.endBlockNumber=t}forAll(){return r(this,void 0,void 0,(function*(){const[e,t,n,r]=yield Promise.all([this.forMediumRange(),this.forSmallRange(),this.forTinyRange(),this.forLatestWithNextBlock()]);return{mediumRange:e,smallRange:t,tinyRange:n,latest:r.slice(0,-1),latestWithNextBlock:r}}))}forMediumRange(){return this.fetchExcludingNextBlock({numberOfBlocks:200,percentiles:[10,95]})}forSmallRange(){return this.fetchExcludingNextBlock({numberOfBlocks:5,percentiles:[10,20,30]})}forTinyRange(){return this.fetchExcludingNextBlock({numberOfBlocks:2,percentiles:[50]})}forLatestWithNextBlock(){return this.fetchIncludingNextBlock({numberOfBlocks:1,percentiles:[10,95]})}fetchExcludingNextBlock(e){return i.default(Object.assign({ethQuery:this.ethQuery,endBlock:this.endBlockNumber},e))}fetchIncludingNextBlock(e){return i.default(Object.assign({ethQuery:this.ethQuery,endBlock:this.endBlockNumber,includeNextBlock:!0},e))}}}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/gas/fetchGasEstimatesViaEthFeeHistory/BlockFeeHistoryDatasetFetcher.js"}],[1368,{"../../constants":1362,"ethjs-unit":2573},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});const r=e("ethjs-unit"),s=e("../../constants");n.default=function(e){const t=e.map((e=>e.baseFeePerGas)).sort(((e,t)=>e.cmp(t)));return[r.fromWei(t[0],s.GWEI),r.fromWei(t[t.length-1],s.GWEI)]}}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/gas/fetchGasEstimatesViaEthFeeHistory/calculateBaseFeeRange.js"}],[1369,{},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){const t=e.map((e=>e.baseFeePerGas)),n=t[0],r=t[t.length-1];return r.gt(n)?"up":n.gt(r)?"down":"level"}}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/gas/fetchGasEstimatesViaEthFeeHistory/calculateBaseFeeTrend.js"}],[137,{lodash:5172},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("lodash");var s={version:56,async migrate(e){const t=(0,r.cloneDeep)(e);t.meta.version=56;const{PreferencesController:n}=t.data;return Array.isArray(null==n?void 0:n.tokens)&&(n.tokens=n.tokens.filter((({address:e})=>e))),null!=n&&n.accountTokens&&"object"==typeof n.accountTokens&&Object.keys(n.accountTokens).forEach((e=>{Object.keys(n.accountTokens[e]).forEach((t=>{n.accountTokens[e][t]=n.accountTokens[e][t].filter((({address:e})=>e))}))})),null!=n&&n.assetImages&&"undefined"in n.assetImages&&delete n.assetImages.undefined,t}};n.default=s}}},{package:"<root>",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/app/scripts/migrations/056.js"}],[1370,{"../../constants":1362,"./medianOf":1375,"ethereumjs-util":2521,"ethjs-unit":2573},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const s=e("ethereumjs-util"),i=e("ethjs-unit"),a=e("../../constants"),o=r(e("./medianOf")),c=["low","medium","high"],u={low:{percentile:10,baseFeePercentageMultiplier:new s.BN(110),priorityFeePercentageMultiplier:new s.BN(94),minSuggestedMaxPriorityFeePerGas:new s.BN(1e9),estimatedWaitTimes:{minWaitTimeEstimate:15e3,maxWaitTimeEstimate:3e4}},medium:{percentile:20,baseFeePercentageMultiplier:new s.BN(120),priorityFeePercentageMultiplier:new s.BN(97),minSuggestedMaxPriorityFeePerGas:new s.BN(15e8),estimatedWaitTimes:{minWaitTimeEstimate:15e3,maxWaitTimeEstimate:45e3}},high:{percentile:30,baseFeePercentageMultiplier:new s.BN(125),priorityFeePercentageMultiplier:new s.BN(98),minSuggestedMaxPriorityFeePerGas:new s.BN(2e9),estimatedWaitTimes:{minWaitTimeEstimate:15e3,maxWaitTimeEstimate:6e4}}};n.default=function(e){return c.reduce(((t,n)=>{const r=function(e,t){const n=u[e],r=t[t.length-1].baseFeePerGas.mul(n.baseFeePercentageMultiplier).divn(100),c=t.map((e=>e.priorityFeesByPercentile[n.percentile])),l=o.default(c).mul(n.priorityFeePercentageMultiplier).divn(100),d=s.BN.max(l,n.minSuggestedMaxPriorityFeePerGas),h=r.add(d);return Object.assign(Object.assign({},n.estimatedWaitTimes),{suggestedMaxPriorityFeePerGas:i.fromWei(d,a.GWEI),suggestedMaxFeePerGas:i.fromWei(h,a.GWEI)})}(n,e);return Object.assign(Object.assign({},t),{[n]:r})}),{})}}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/gas/fetchGasEstimatesViaEthFeeHistory/calculateGasFeeEstimatesForPriorityLevels.js"}],[1371,{},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){if(e.length>0){const t=e[e.length-1].baseFeePerGas,n=e.map((e=>e.baseFeePerGas)).sort(((e,t)=>e.cmp(t))).findIndex((e=>e.gte(t)));return-1!==n?n/(e.length-1):0}return.5}}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/gas/fetchGasEstimatesViaEthFeeHistory/calculateNetworkCongestion.js"}],[1372,{"../../constants":1362,"ethereumjs-util":2521,"ethjs-unit":2573},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});const r=e("ethereumjs-util"),s=e("ethjs-unit"),i=e("../../constants");n.default=function(e){const t=e.map((e=>e.priorityFeesByPercentile[10])).filter((e=>!e.eq(new r.BN(0)))).sort(((e,t)=>e.cmp(t))),n=e.map((e=>e.priorityFeesByPercentile[95])).sort(((e,t)=>e.cmp(t)));return[s.fromWei(t[0],i.GWEI),s.fromWei(n[n.length-1],i.GWEI)]}}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/gas/fetchGasEstimatesViaEthFeeHistory/calculatePriorityFeeRange.js"}],[1373,{"ethereumjs-util":2521},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});const r=e("ethereumjs-util");n.default=function(e){const t=e.map((e=>e.priorityFeesByPercentile[50])).filter((e=>!e.eq(new r.BN(0)))),n=t[0],s=t[t.length-1];return s.gt(n)?"up":n.gt(s)?"down":"level"}}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/gas/fetchGasEstimatesViaEthFeeHistory/calculatePriorityFeeTrend.js"}],[1374,{"../../util":1404},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0});const s=e("../../util");n.default=function(e,t=!1){return r(this,void 0,void 0,(function*(){const n=yield s.query(e,"blockNumber"),r=yield s.query(e,"getBlockByNumber",[n,t]);return Object.assign(Object.assign({},r),{number:s.fromHex(r.number),baseFeePerGas:s.fromHex(r.baseFeePerGas)})}))}}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/gas/fetchGasEstimatesViaEthFeeHistory/fetchLatestBlock.js"}],[1375,{},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){const t=e.slice().sort(((e,t)=>e.cmp(t))),n=t.length;return t[Math.floor((n-1)/2)]}}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/gas/fetchGasEstimatesViaEthFeeHistory/medianOf.js"}],[1376,{"../util":1404,"ethereumjs-util":2521},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.calculateTimeEstimate=n.fetchEthGasPriceEstimate=n.fetchLegacyGasPriceEstimates=n.fetchGasEstimates=n.normalizeGWEIDecimalNumbers=void 0;const s=e("ethereumjs-util"),i=e("../util"),a=e=>({"X-Client-Id":e});function o(e){const t=i.gweiDecToWEIBN(e).toString(16);return i.weiHexToGweiDec(t).toString(10)}n.normalizeGWEIDecimalNumbers=o,n.fetchGasEstimates=function(e,t){return r(this,void 0,void 0,(function*(){const n=yield i.handleFetch(e,t?{headers:a(t)}:undefined);return{low:Object.assign(Object.assign({},n.low),{suggestedMaxPriorityFeePerGas:o(n.low.suggestedMaxPriorityFeePerGas),suggestedMaxFeePerGas:o(n.low.suggestedMaxFeePerGas)}),medium:Object.assign(Object.assign({},n.medium),{suggestedMaxPriorityFeePerGas:o(n.medium.suggestedMaxPriorityFeePerGas),suggestedMaxFeePerGas:o(n.medium.suggestedMaxFeePerGas)}),high:Object.assign(Object.assign({},n.high),{suggestedMaxPriorityFeePerGas:o(n.high.suggestedMaxPriorityFeePerGas),suggestedMaxFeePerGas:o(n.high.suggestedMaxFeePerGas)}),estimatedBaseFee:o(n.estimatedBaseFee),historicalBaseFeeRange:n.historicalBaseFeeRange,baseFeeTrend:n.baseFeeTrend,latestPriorityFeeRange:n.latestPriorityFeeRange,historicalPriorityFeeRange:n.historicalPriorityFeeRange,priorityFeeTrend:n.priorityFeeTrend,networkCongestion:n.networkCongestion}}))},n.fetchLegacyGasPriceEstimates=function(e,t){return r(this,void 0,void 0,(function*(){const n=yield i.handleFetch(e,{referrer:e,referrerPolicy:"no-referrer-when-downgrade",method:"GET",mode:"cors",headers:Object.assign({"Content-Type":"application/json"},t&&a(t))});return{low:n.SafeGasPrice,medium:n.ProposeGasPrice,high:n.FastGasPrice}}))},n.fetchEthGasPriceEstimate=function(e){return r(this,void 0,void 0,(function*(){const t=yield i.query(e,"gasPrice");return{gasPrice:i.weiHexToGweiDec(t).toString()}}))},n.calculateTimeEstimate=function(e,t,n){const{low:r,medium:a,high:o,estimatedBaseFee:c}=n,u=i.gweiDecToWEIBN(e),l=i.gweiDecToWEIBN(t),d=i.gweiDecToWEIBN(c),h=s.BN.min(u,l.sub(d)),f=i.gweiDecToWEIBN(r.suggestedMaxPriorityFeePerGas),p=i.gweiDecToWEIBN(a.suggestedMaxPriorityFeePerGas),m=i.gweiDecToWEIBN(o.suggestedMaxPriorityFeePerGas);let g,y;return h.lt(f)?(g=null,y="unknown"):h.gte(f)&&h.lt(p)?(g=r.minWaitTimeEstimate,y=r.maxWaitTimeEstimate):h.gte(p)&&h.lt(m)?(g=a.minWaitTimeEstimate,y=a.maxWaitTimeEstimate):h.eq(m)?(g=o.minWaitTimeEstimate,y=o.maxWaitTimeEstimate):(g=0,y=o.maxWaitTimeEstimate),{lowerTimeBound:g,upperTimeBound:y}}}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/gas/gas-util.js"}],[1377,{"./BaseController":1341,"./BaseControllerV2":1342,"./ComposableController":1343,"./ControllerMessenger":1344,"./approval/ApprovalController":1347,"./assets/AccountTrackerController":1348,"./assets/AssetsContractController":1349,"./assets/CollectibleDetectionController":1350,"./assets/CollectiblesController":1351,"./assets/CurrencyRateController":1352,"./assets/TokenBalancesController":1356,"./assets/TokenDetectionController":1357,"./assets/TokenListController":1358,"./assets/TokenRatesController":1359,"./assets/TokensController":1360,"./gas/GasFeeController":1363,"./keyring/KeyringController":1378,"./message-manager/MessageManager":1380,"./message-manager/PersonalMessageManager":1381,"./message-manager/TypedMessageManager":1382,"./network/NetworkController":1383,"./notification/NotificationController":1384,"./permissions":1391,"./ratelimit/RateLimitController":1397,"./subject-metadata":1399,"./third-party/PhishingController":1400,"./transaction/TransactionController":1401,"./user/AddressBookController":1402,"./user/PreferencesController":1403,"./util":1404,"isomorphic-fetch":4714},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return s(t,e),t},a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),n.util=n.getAnonymizedState=n.getPersistentState=n.BaseControllerV2=void 0,e("isomorphic-fetch");const o=i(e("./util"));n.util=o,a(e("./assets/AccountTrackerController"),n),a(e("./user/AddressBookController"),n),a(e("./approval/ApprovalController"),n),a(e("./assets/AssetsContractController"),n),a(e("./BaseController"),n);var c=e("./BaseControllerV2");Object.defineProperty(n,"BaseControllerV2",{enumerable:!0,get:function(){return c.BaseController}}),Object.defineProperty(n,"getPersistentState",{enumerable:!0,get:function(){return c.getPersistentState}}),Object.defineProperty(n,"getAnonymizedState",{enumerable:!0,get:function(){return c.getAnonymizedState}}),a(e("./ComposableController"),n),a(e("./ControllerMessenger"),n),a(e("./assets/CurrencyRateController"),n),a(e("./keyring/KeyringController"),n),a(e("./message-manager/MessageManager"),n),a(e("./network/NetworkController"),n),a(e("./third-party/PhishingController"),n),a(e("./user/PreferencesController"),n),a(e("./assets/TokenBalancesController"),n),a(e("./assets/TokenRatesController"),n),a(e("./transaction/TransactionController"),n),a(e("./message-manager/PersonalMessageManager"),n),a(e("./message-manager/TypedMessageManager"),n),a(e("./notification/NotificationController"),n),a(e("./assets/TokenListController"),n),a(e("./gas/GasFeeController"),n),a(e("./assets/TokensController"),n),a(e("./assets/CollectiblesController"),n),a(e("./assets/TokenDetectionController"),n),a(e("./assets/CollectibleDetectionController"),n),a(e("./permissions"),n),a(e("./subject-metadata"),n),a(e("./ratelimit/RateLimitController"),n)}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/index.js"}],[1378,{"../BaseController":1341,"../util":1404,"async-mutex":1727,"eth-keyring-controller":2442,"eth-sig-util":2457,"ethereumjs-util":2521,"ethereumjs-wallet":1434},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return s(t,e),t},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.KeyringController=n.SignTypedDataVersion=n.AccountImportStrategy=n.KeyringTypes=void 0;const c=e("ethereumjs-util"),u=e("eth-sig-util"),l=i(e("ethereumjs-wallet")),d=o(e("eth-keyring-controller")),h=e("async-mutex"),f=e("../BaseController"),p=e("../util"),m=new WeakMap;var g,y;!function(e){e.simple="Simple Key Pair",e.hd="HD Key Tree"}(g=n.KeyringTypes||(n.KeyringTypes={})),function(e){e.privateKey="privateKey",e.json="json"}(n.AccountImportStrategy||(n.AccountImportStrategy={})),function(e){e.V1="V1",e.V3="V3",e.V4="V4"}(y=n.SignTypedDataVersion||(n.SignTypedDataVersion={}));class v extends f.BaseController{constructor({removeIdentity:e,syncIdentities:t,updateIdentities:n,setSelectedAddress:r},s,i){super(s,i),this.mutex=new h.Mutex,this.name="KeyringController",m.set(this,{keyring:new d.default(Object.assign({initState:i},s))}),this.defaultState=Object.assign(Object.assign({},m.get(this).keyring.store.getState()),{keyrings:[]}),this.removeIdentity=e,this.syncIdentities=t,this.updateIdentities=n,this.setSelectedAddress=r,this.initialize(),this.fullUpdate()}addNewAccount(){return a(this,void 0,void 0,(function*(){const e=m.get(this).keyring.getKeyringsByType("HD Key Tree")[0];if(!e)throw new Error("No HD keyring found");const t=yield m.get(this).keyring.getAccounts();yield m.get(this).keyring.addNewAccount(e);const n=yield m.get(this).keyring.getAccounts();return yield this.verifySeedPhrase(),this.updateIdentities(n),n.forEach((e=>{t.includes(e)||this.setSelectedAddress(e)})),this.fullUpdate()}))}addNewAccountWithoutUpdate(){return a(this,void 0,void 0,(function*(){const e=m.get(this).keyring.getKeyringsByType("HD Key Tree")[0];if(!e)throw new Error("No HD keyring found");return yield m.get(this).keyring.addNewAccount(e),yield this.verifySeedPhrase(),this.fullUpdate()}))}createNewVaultAndRestore(e,t){return a(this,void 0,void 0,(function*(){const n=yield this.mutex.acquire();try{this.updateIdentities([]);const r=yield m.get(this).keyring.createNewVaultAndRestore(e,t);return this.updateIdentities(yield m.get(this).keyring.getAccounts()),this.fullUpdate(),r}finally{n()}}))}createNewVaultAndKeychain(e){return a(this,void 0,void 0,(function*(){const t=yield this.mutex.acquire();try{const n=yield m.get(this).keyring.createNewVaultAndKeychain(e);return this.updateIdentities(yield m.get(this).keyring.getAccounts()),this.fullUpdate(),n}finally{t()}}))}isUnlocked(){return m.get(this).keyring.memStore.getState().isUnlocked}exportSeedPhrase(e){if(m.get(this).keyring.password===e)return m.get(this).keyring.keyrings[0].mnemonic;throw new Error("Invalid password")}exportAccount(e,t){if(m.get(this).keyring.password===e)return m.get(this).keyring.exportAccount(t);throw new Error("Invalid password")}getAccounts(){return m.get(this).keyring.getAccounts()}importAccountWithStrategy(e,t){return a(this,void 0,void 0,(function*(){let n;switch(e){case"privateKey":const[r]=t;if(!r)throw new Error("Cannot import an empty key.");const s=c.addHexPrefix(r);if(!c.isValidPrivate(c.toBuffer(s)))throw new Error("Cannot import invalid private key.");n=c.stripHexPrefix(s);break;case"json":let i;const[a,o]=t;try{i=l.thirdparty.fromEtherWallet(a,o)}catch(e){i=i||(yield l.default.fromV3(a,o,!0))}n=c.bufferToHex(i.getPrivateKey());break;default:throw new Error(`Unexpected import strategy: '${e}'`)}const r=yield m.get(this).keyring.addNewKeyring(g.simple,[n]),s=yield r.getAccounts(),i=yield m.get(this).keyring.getAccounts();return this.updateIdentities(i),this.setSelectedAddress(s[0]),this.fullUpdate()}))}removeAccount(e){return a(this,void 0,void 0,(function*(){return this.removeIdentity(e),yield m.get(this).keyring.removeAccount(e),this.fullUpdate()}))}setLocked(){return m.get(this).keyring.setLocked()}signMessage(e){return m.get(this).keyring.signMessage(e)}signPersonalMessage(e){return m.get(this).keyring.signPersonalMessage(e)}signTypedMessage(e,t){return a(this,void 0,void 0,(function*(){try{const n=u.normalize(e.from),{password:r}=m.get(this).keyring,s=yield this.exportAccount(r,n),i=c.toBuffer(c.addHexPrefix(s));switch(t){case y.V1:return u.signTypedDataLegacy(i,{data:e.data});case y.V3:return u.signTypedData(i,{data:JSON.parse(e.data)});case y.V4:return u.signTypedData_v4(i,{data:JSON.parse(e.data)});default:throw new Error(`Unexpected signTypedMessage version: '${t}'`)}}catch(e){throw new Error(`Keyring Controller signTypedMessage: ${e}`)}}))}signTransaction(e,t){return m.get(this).keyring.signTransaction(e,t)}submitPassword(e){return a(this,void 0,void 0,(function*(){yield m.get(this).keyring.submitPassword(e);const t=yield m.get(this).keyring.getAccounts();return yield this.syncIdentities(t),this.fullUpdate()}))}subscribe(e){m.get(this).keyring.store.subscribe(e)}unsubscribe(e){return m.get(this).keyring.store.unsubscribe(e)}onLock(e){return m.get(this).keyring.on("lock",e)}onUnlock(e){return m.get(this).keyring.on("unlock",e)}verifySeedPhrase(){return a(this,void 0,void 0,(function*(){const e=m.get(this).keyring.getKeyringsByType(g.hd)[0];if(!e)throw new Error("No HD keyring found.");const t=(yield e.serialize()).mnemonic,n=yield e.getAccounts();if(0===n.length)throw new Error("Cannot verify an empty keyring.");const r=new(m.get(this).keyring.getKeyringClassForType(g.hd))({mnemonic:t,numberOfAccounts:n.length}),s=yield r.getAccounts();if(s.length!==n.length)throw new Error("Seed phrase imported incorrect number of accounts.");return s.forEach(((e,t)=>{if(e.toLowerCase()!==n[t].toLowerCase())throw new Error("Seed phrase imported different accounts.")})),t}))}fullUpdate(){return a(this,void 0,void 0,(function*(){const e=yield Promise.all(m.get(this).keyring.keyrings.map(((e,t)=>a(this,void 0,void 0,(function*(){const n=yield e.getAccounts();return{accounts:Array.isArray(n)?n.map((e=>p.toChecksumHexAddress(e))):[],index:t,type:e.type}})))));return this.update({keyrings:[...e]}),m.get(this).keyring.fullUpdate()}))}}n.KeyringController=v,n.default=v}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/keyring/KeyringController.js"}],[1379,{"../BaseController":1341,events:2082},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.AbstractMessageManager=void 0;const r=e("events"),s=e("../BaseController");class i extends s.BaseController{constructor(e,t){super(e,t),this.hub=new r.EventEmitter,this.name="AbstractMessageManager",this.defaultState={unapprovedMessages:{},unapprovedMessagesCount:0},this.messages=[],this.initialize()}saveMessageList(){const e=this.getUnapprovedMessages(),t=this.getUnapprovedMessagesCount();this.update({unapprovedMessages:e,unapprovedMessagesCount:t}),this.hub.emit("updateBadge")}setMessageStatus(e,t){const n=this.getMessage(e);if(!n)throw new Error(`${this.name}: Message not found for id: ${e}.`);n.status=t,this.updateMessage(n),this.hub.emit(`${e}:${t}`,n),"rejected"!==t&&"signed"!==t&&"errored"!==t||this.hub.emit(`${e}:finished`,n)}updateMessage(e){const t=this.messages.findIndex((t=>e.id===t.id));-1!==t&&(this.messages[t]=e),this.saveMessageList()}getUnapprovedMessagesCount(){return Object.keys(this.getUnapprovedMessages()).length}getUnapprovedMessages(){return this.messages.filter((e=>"unapproved"===e.status)).reduce(((e,t)=>(e[t.id]=t,e)),{})}addMessage(e){this.messages.push(e),this.saveMessageList()}getMessage(e){return this.messages.find((t=>t.id===e))}approveMessage(e){return this.setMessageStatusApproved(e.metamaskId),this.prepMessageForSigning(e)}setMessageStatusApproved(e){this.setMessageStatus(e,"approved")}setMessageStatusSigned(e,t){const n=this.getMessage(e);n&&(n.rawSig=t,this.updateMessage(n),this.setMessageStatus(e,"signed"))}rejectMessage(e){this.setMessageStatus(e,"rejected")}}n.AbstractMessageManager=i,n.default=i}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/message-manager/AbstractMessageManager.js"}],[138,{"../../../shared/modules/random-id":6201,"@babel/runtime/helpers/interopRequireDefault":195,lodash:5172},function(){with(this)return function(){"use strict";return function(e,t,n){var r=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=e("lodash"),i=r(e("../../../shared/modules/random-id"));var a={version:57,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=57;const n=t.data;return t.data=function(e){var t;null!=e&&null!==(t=e.TransactionController)&&void 0!==t&&t.transactions&&Array.isArray(e.TransactionController.transactions)&&!e.TransactionController.transactions.some((e=>"object"!=typeof e||void 0===e.txParams))&&(e.TransactionController.transactions=(0,s.keyBy)(e.TransactionController.transactions,(e=>(void 0!==e.id&&null!==e.id||(e.id=(0,i.default)()),e.id))));return e}(n),t}};n.default=a}}},{package:"<root>",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/app/scripts/migrations/057.js"}],[1380,{"../util":1404,"./AbstractMessageManager":1379,uuid:6009},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.MessageManager=void 0;const r=e("uuid"),s=e("../util"),i=e("./AbstractMessageManager");class a extends i.AbstractMessageManager{constructor(){super(...arguments),this.name="MessageManager"}addUnapprovedMessageAsync(e,t){return new Promise(((n,r)=>{s.validateSignMessageData(e);const i=this.addUnapprovedMessage(e,t);this.hub.once(`${i}:finished`,(t=>{switch(t.status){case"signed":return n(t.rawSig);case"rejected":return r(new Error("MetaMask Message Signature: User denied message signature."));default:return r(new Error(`MetaMask Message Signature: Unknown problem: ${JSON.stringify(e)}`))}}))}))}addUnapprovedMessage(e,t){t&&(e.origin=t.origin),e.data=s.normalizeMessageData(e.data);const n=r.v1(),i={id:n,messageParams:e,status:"unapproved",time:Date.now(),type:"eth_sign"};return this.addMessage(i),this.hub.emit("unapprovedMessage",Object.assign(Object.assign({},e),{metamaskId:n})),n}prepMessageForSigning(e){return delete e.metamaskId,Promise.resolve(e)}}n.MessageManager=a,n.default=a}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/message-manager/MessageManager.js"}],[1381,{"../util":1404,"./AbstractMessageManager":1379,uuid:6009},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.PersonalMessageManager=void 0;const r=e("uuid"),s=e("../util"),i=e("./AbstractMessageManager");class a extends i.AbstractMessageManager{constructor(){super(...arguments),this.name="PersonalMessageManager"}addUnapprovedMessageAsync(e,t){return new Promise(((n,r)=>{s.validateSignMessageData(e);const i=this.addUnapprovedMessage(e,t);this.hub.once(`${i}:finished`,(t=>{switch(t.status){case"signed":return n(t.rawSig);case"rejected":return r(new Error("MetaMask Personal Message Signature: User denied message signature."));default:return r(new Error(`MetaMask Personal Message Signature: Unknown problem: ${JSON.stringify(e)}`))}}))}))}addUnapprovedMessage(e,t){t&&(e.origin=t.origin),e.data=s.normalizeMessageData(e.data);const n=r.v1(),i={id:n,messageParams:e,status:"unapproved",time:Date.now(),type:"personal_sign"};return this.addMessage(i),this.hub.emit("unapprovedMessage",Object.assign(Object.assign({},e),{metamaskId:n})),n}prepMessageForSigning(e){return delete e.metamaskId,Promise.resolve(e)}}n.PersonalMessageManager=a,n.default=a}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/message-manager/PersonalMessageManager.js"}],[1382,{"../util":1404,"./AbstractMessageManager":1379,uuid:6009},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.TypedMessageManager=void 0;const r=e("uuid"),s=e("../util"),i=e("./AbstractMessageManager");class a extends i.AbstractMessageManager{constructor(){super(...arguments),this.name="TypedMessageManager"}addUnapprovedMessageAsync(e,t,n){return new Promise(((r,i)=>{"V1"===t&&s.validateTypedSignMessageDataV1(e),"V3"===t&&s.validateTypedSignMessageDataV3(e);const a=this.addUnapprovedMessage(e,t,n);this.hub.once(`${a}:finished`,(t=>{switch(t.status){case"signed":return r(t.rawSig);case"rejected":return i(new Error("MetaMask Typed Message Signature: User denied message signature."));case"errored":return i(new Error(`MetaMask Typed Message Signature: ${t.error}`));default:return i(new Error(`MetaMask Typed Message Signature: Unknown problem: ${JSON.stringify(e)}`))}}))}))}addUnapprovedMessage(e,t,n){const s=r.v1(),i=Object.assign(Object.assign({},e),{metamaskId:s,version:t});n&&(e.origin=n.origin);const a={id:s,messageParams:e,status:"unapproved",time:Date.now(),type:"eth_signTypedData"};return this.addMessage(a),this.hub.emit("unapprovedMessage",i),s}setMessageStatusErrored(e,t){const n=this.getMessage(e);n&&(n.error=t,this.updateMessage(n),this.setMessageStatus(e,"errored"))}prepMessageForSigning(e){return delete e.metamaskId,delete e.version,Promise.resolve(e)}}n.TypedMessageManager=a,n.default=a}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/message-manager/TypedMessageManager.js"}],[1383,{"../BaseController":1341,"../constants":1362,"async-mutex":1727,"eth-json-rpc-infura/src/createProvider":2399,"eth-query":2451,"web3-provider-engine/subproviders/provider":6090,"web3-provider-engine/zero":6100},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(n[r[s]]=e[r[s]])}return n},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.NetworkController=n.NetworksChainId=void 0;const a=i(e("eth-query")),o=i(e("web3-provider-engine/subproviders/provider")),c=i(e("eth-json-rpc-infura/src/createProvider")),u=i(e("web3-provider-engine/zero")),l=e("async-mutex"),d=e("../BaseController"),h=e("../constants");var f;!function(e){e.mainnet="1",e.kovan="42",e.rinkeby="4",e.goerli="5",e.ropsten="3",e.localhost="",e.rpc="",e.optimism="10",e.optimismTest="69"}(f=n.NetworksChainId||(n.NetworksChainId={}));class p extends d.BaseController{constructor(e,t){super(e,t),this.internalProviderConfig={},this.mutex=new l.Mutex,this.name="NetworkController",this.defaultState={network:"loading",isCustomNetwork:!1,provider:{type:h.MAINNET,chainId:f.mainnet},properties:{isEIP1559Compatible:!1}},this.initialize(),this.getEIP1559Compatibility()}initializeProvider(e,t,n,r,s){switch(this.update({isCustomNetwork:this.getIsCustomNetwork(n)}),e){case"kovan":case h.MAINNET:case"rinkeby":case"goerli":case"optimism":case"optimismTest":case"ropsten":this.setupInfuraProvider(e);break;case"localhost":this.setupStandardProvider("http://localhost:8545");break;case h.RPC:t&&this.setupStandardProvider(t,n,r,s);break;default:throw new Error(`Unrecognized network type: '${e}'`)}}refreshNetwork(){this.update({network:"loading",properties:{}});const{rpcTarget:e,type:t,chainId:n,ticker:r}=this.state.provider;this.initializeProvider(t,e,n,r),this.lookupNetwork()}registerProvider(){this.provider.on("error",this.verifyNetwork.bind(this)),this.ethQuery=new a.default(this.provider)}setupInfuraProvider(e){const t=c.default({network:e,projectId:this.config.infuraProjectId}),n=new o.default(t),r=Object.assign(Object.assign({},this.internalProviderConfig),{dataSubprovider:n,engineParams:{blockTrackerProvider:t,pollingInterval:12e3}});this.updateProvider(u.default(r))}getIsCustomNetwork(e){return e!==f.mainnet&&e!==f.kovan&&e!==f.rinkeby&&e!==f.goerli&&e!==f.ropsten&&e!==f.localhost}setupStandardProvider(e,t,n,r){const s=Object.assign(Object.assign({},this.internalProviderConfig),{chainId:t,engineParams:{pollingInterval:12e3},nickname:r,rpcUrl:e,ticker:n});this.updateProvider(u.default(s))}updateProvider(e){this.safelyStopProvider(this.provider),this.provider=e,this.registerProvider()}safelyStopProvider(e){setTimeout((()=>{null==e||e.stop()}),500)}verifyNetwork(){"loading"===this.state.network&&this.lookupNetwork()}set providerConfig(e){this.internalProviderConfig=e;const{type:t,rpcTarget:n,chainId:r,ticker:s,nickname:i}=this.state.provider;this.initializeProvider(t,n,r,s,i),this.registerProvider(),this.lookupNetwork()}get providerConfig(){throw new Error("Property only used for setting")}lookupNetwork(){return r(this,void 0,void 0,(function*(){if(!this.ethQuery||!this.ethQuery.sendAsync)return;const e=yield this.mutex.acquire();this.ethQuery.sendAsync({method:"net_version"},((t,n)=>{this.update({network:t?"loading":n}),e()}))}))}setProviderType(e){const t=this.state.provider,{rpcTarget:n,chainId:r,nickname:i}=t,a=s(t,["rpcTarget","chainId","nickname"]);this.update({provider:Object.assign(Object.assign({},a),{type:e,ticker:"ETH",chainId:f[e]})}),this.refreshNetwork()}setRpcTarget(e,t,n,r){this.update({provider:Object.assign(Object.assign({},this.state.provider),{type:h.RPC,ticker:n,rpcTarget:e,chainId:t,nickname:r})}),this.refreshNetwork()}getEIP1559Compatibility(){var e;const{properties:t={}}=this.state;return t.isEIP1559Compatible||"function"!=typeof(null===(e=this.ethQuery)||void 0===e?void 0:e.sendAsync)?Promise.resolve(!0):new Promise(((e,n)=>{this.ethQuery.sendAsync({method:"eth_getBlockByNumber",params:["latest",!1]},((r,s)=>{if(r)n(r);else{const n=void 0!==s.baseFeePerGas;t.isEIP1559Compatible!==n&&this.update({properties:{isEIP1559Compatible:n}}),e(n)}}))}))}}n.NetworkController=p,n.default=p}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/network/NetworkController.js"}],[1384,{"../BaseController":1341},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.NotificationController=void 0;const r=e("../BaseController"),s={notifications:{}};class i extends r.BaseController{constructor(e,t){super(e,t||s),this.initialize(),this._addNotifications()}_addNotifications(){const e={},{allNotifications:t}=this.config;Object.values(t).forEach((t=>{e[t.id]=this.state.notifications[t.id]?this.state.notifications[t.id]:Object.assign(Object.assign({},t),{isShown:!1})})),this.update({notifications:e})}updateViewed(e){const t=this.state.notifications;for(const n of Object.keys(e).map(Number))t[n].isShown=e[n];this.update({notifications:t},!0)}}n.NotificationController=i}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/notification/NotificationController.js"}],[1385,{"./errors":1390},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.decorateWithCaveats=void 0;const s=e("./errors");n.decorateWithCaveats=function(e,t,n){const{caveats:i}=t;if(!i)return e;let a=t=>r(this,void 0,void 0,(function*(){return e(t)}));for(const e of i){const t=n[e.type];if(!t)throw new s.UnrecognizedCaveatTypeError(e.type);a=t.decorator(a,e)}return a}}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/permissions/Caveat.js"}],[1386,{nanoid:1453},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.hasSpecificationType=n.PermissionType=n.findCaveat=n.constructPermission=void 0;const r=e("nanoid");n.constructPermission=function(e){const{caveats:t=null,invoker:n,target:s}=e;return{id:r.nanoid(),parentCapability:s,invoker:n,caveats:t,date:(new Date).getTime()}},n.findCaveat=function(e,t){var n;return null===(n=e.caveats)||void 0===n?void 0:n.find((e=>e.type===t))},function(e){e.RestrictedMethod="RestrictedMethod",e.Endowment="Endowment"}(n.PermissionType||(n.PermissionType={})),n.hasSpecificationType=function(e,t){return e.permissionType===t}}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/permissions/Permission.js"}],[1387,{"../BaseControllerV2":1342,"../util":1404,"./Caveat":1385,"./Permission":1386,"./errors":1390,"./permission-middleware":1392,"./utils":1396,"deep-freeze-strict":2257,immer:4402,nanoid:1453},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(n[r[s]]=e[r[s]])}return n},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.PermissionController=n.CaveatMutatorOperation=void 0;const a=i(e("deep-freeze-strict")),o=e("immer"),c=e("nanoid"),u=e("../BaseControllerV2"),l=e("../util"),d=e("./Caveat"),h=e("./errors"),f=e("./Permission"),p=e("./permission-middleware"),m=e("./utils"),g="PermissionController";var y;!function(e){e[e.noop=0]="noop",e[e.updateValue=1]="updateValue",e[e.deleteCaveat=2]="deleteCaveat",e[e.revokePermission=3]="revokePermission"}(y=n.CaveatMutatorOperation||(n.CaveatMutatorOperation={}));class v extends u.BaseController{constructor(e){const{caveatSpecifications:t,permissionSpecifications:n,unrestrictedMethods:r,messenger:s,state:i={}}=e;super({name:g,metadata:{subjects:{anonymous:!0,persist:!0}},messenger:s,state:Object.assign(Object.assign({},{subjects:{}}),i)}),this._unrestrictedMethods=new Set(r),this._caveatSpecifications=a.default(Object.assign({},t)),this.validatePermissionSpecifications(n,this._caveatSpecifications),this._permissionSpecifications=a.default(Object.assign({},n)),this.registerMessageHandlers(),this.createPermissionMiddleware=p.getPermissionMiddlewareFactory({executeRestrictedMethod:this._executeRestrictedMethod.bind(this),getRestrictedMethod:this.getRestrictedMethod.bind(this),isUnrestrictedMethod:this.unrestrictedMethods.has.bind(this.unrestrictedMethods)})}get unrestrictedMethods(){return this._unrestrictedMethods}getPermissionSpecification(e){return this._permissionSpecifications[e]}getCaveatSpecification(e){return this._caveatSpecifications[e]}validatePermissionSpecifications(e,t){Object.entries(e).forEach((([e,{permissionType:n,targetKey:r,allowedCaveats:s}])=>{if(!n||!l.hasProperty(f.PermissionType,n))throw new Error(`Invalid permission type: "${n}"`);if(!e||/_$/u.test(e)||/[^_]\*$/u.test(e))throw new Error(`Invalid permission target key: "${e}"`);if(e!==r)throw new Error(`Invalid permission specification: key "${e}" must match specification.target value "${r}".`);s&&s.forEach((e=>{if(!l.hasProperty(t,e))throw new h.UnrecognizedCaveatTypeError(e)}))}))}registerMessageHandlers(){this.messagingSystem.registerActionHandler(`${g}:clearPermissions`,(()=>this.clearState())),this.messagingSystem.registerActionHandler(`${g}:getEndowments`,((e,t,n)=>this.getEndowments(e,t,n))),this.messagingSystem.registerActionHandler(`${g}:getSubjectNames`,(()=>this.getSubjectNames())),this.messagingSystem.registerActionHandler(`${g}:getPermissions`,(e=>this.getPermissions(e))),this.messagingSystem.registerActionHandler(`${g}:hasPermission`,((e,t)=>this.hasPermission(e,t))),this.messagingSystem.registerActionHandler(`${g}:hasPermissions`,(e=>this.hasPermissions(e))),this.messagingSystem.registerActionHandler(`${g}:revokePermissions`,this.revokePermissions.bind(this)),this.messagingSystem.registerActionHandler(`${g}:revokeAllPermissions`,(e=>this.revokeAllPermissions(e))),this.messagingSystem.registerActionHandler(`${g}:requestPermissions`,((e,t)=>this.requestPermissions(e,t)))}clearState(){this.update((e=>Object.assign({},{subjects:{}})))}getTypedPermissionSpecification(e,t,n){const r=e===f.PermissionType.RestrictedMethod?h.methodNotFound(t,n?{origin:n}:undefined):new h.EndowmentPermissionDoesNotExistError(t,n),s=this.getTargetKey(t);if(!s)throw r;const i=this.getPermissionSpecification(s);if(!f.hasSpecificationType(i,e))throw r;return i}getRestrictedMethod(e,t){return this.getTypedPermissionSpecification(f.PermissionType.RestrictedMethod,e,t).methodImplementation}getSubjectNames(){return Object.keys(this.state.subjects)}getPermission(e,t){var n;return null===(n=this.state.subjects[e])||void 0===n?void 0:n.permissions[t]}getPermissions(e){var t;return null===(t=this.state.subjects[e])||void 0===t?void 0:t.permissions}hasPermission(e,t){return Boolean(this.getPermission(e,t))}hasPermissions(e){return Boolean(this.state.subjects[e])}revokeAllPermissions(e){this.update((t=>{if(!t.subjects[e])throw new h.UnrecognizedSubjectError(e);delete t.subjects[e]}))}revokePermission(e,t){this.revokePermissions({[e]:[t]})}revokePermissions(e){this.update((t=>{Object.keys(e).forEach((n=>{if(!l.hasProperty(t.subjects,n))throw new h.UnrecognizedSubjectError(n);e[n].forEach((e=>{const{permissions:r}=t.subjects[n];if(!l.hasProperty(r,e))throw new h.PermissionDoesNotExistError(n,e);this.deletePermission(t.subjects,n,e)}))}))}))}revokePermissionForAllSubjects(e){0!==this.getSubjectNames().length&&this.update((t=>{Object.entries(t.subjects).forEach((([n,r])=>{const{permissions:s}=r;l.hasProperty(s,e)&&this.deletePermission(t.subjects,n,e)}))}))}deletePermission(e,t,n){const{permissions:r}=e[t];Object.keys(r).length>1?delete r[n]:delete e[t]}hasCaveat(e,t,n){return Boolean(this.getCaveat(e,t,n))}getCaveat(e,t,n){const r=this.getPermission(e,t);if(!r)throw new h.PermissionDoesNotExistError(e,t);return f.findCaveat(r,n)}addCaveat(e,t,n,r){if(this.hasCaveat(e,t,n))throw new h.CaveatAlreadyExistsError(e,t,n);this.setCaveat(e,t,n,r)}updateCaveat(e,t,n,r){if(!this.hasCaveat(e,t,n))throw new h.CaveatDoesNotExistError(e,t,n);this.setCaveat(e,t,n,r)}setCaveat(e,t,n,r){this.update((s=>{const i=s.subjects[e];if(!i)throw new h.UnrecognizedSubjectError(e);const a=i.permissions[t];if(!a)throw new h.PermissionDoesNotExistError(e,t);const o={type:n,value:r};if(this.validateCaveat(o,e,t),a.caveats){const e=a.caveats.findIndex((e=>e.type===o.type));-1===e?a.caveats.push(o):a.caveats.splice(e,1,o)}else a.caveats=[o];this.validateModifiedPermission(a,e,t)}))}updatePermissionsByCaveat(e,t){0!==Object.keys(this.state.subjects).length&&this.update((n=>{Object.values(n.subjects).forEach((r=>{Object.values(r.permissions).forEach((s=>{const{caveats:i}=s,a=null==i?void 0:i.find((({type:t})=>t===e));if(!a)return;const o=t(a.value);switch(o.operation){case y.noop:break;case y.updateValue:a.value=o.value,this.validateCaveat(a,r.origin,s.parentCapability);break;case y.deleteCaveat:this.deleteCaveat(s,e,r.origin,s.parentCapability);break;case y.revokePermission:this.deletePermission(n.subjects,r.origin,s.parentCapability);break;default:throw new Error(`Unrecognized mutation result: "${o.operation}"`)}}))}))}))}removeCaveat(e,t,n){this.update((r=>{var s;const i=null===(s=r.subjects[e])||void 0===s?void 0:s.permissions[t];if(!i)throw new h.PermissionDoesNotExistError(e,t);if(!i.caveats)throw new h.CaveatDoesNotExistError(e,t,n);this.deleteCaveat(i,n,e,t)}))}deleteCaveat(e,t,n,r){if(!e.caveats)throw new h.CaveatDoesNotExistError(n,r,t);const s=e.caveats.findIndex((e=>e.type===t));if(-1===s)throw new h.CaveatDoesNotExistError(n,r,t);1===e.caveats.length?e.caveats=null:e.caveats.splice(s,1),this.validateModifiedPermission(e,n,r)}validateModifiedPermission(e,t,n){const r=this.getTargetKey(e.parentCapability);if(!r)throw new Error(`Fatal: Existing permission target key "${r}" has no specification.`);this.validatePermission(this.getPermissionSpecification(r),e,t,n)}getTargetKey(e){if(l.hasProperty(this._permissionSpecifications,e))return e;const t={};for(const e of Object.keys(this._permissionSpecifications)){const n=e.match(/(.+)\*$/u);n&&(t[n[1]]=!0)}const n=e.split("_");let r="";for(;n.length>0&&!l.hasProperty(this._permissionSpecifications,r)&&!t[r];)r+=`${n.shift()}_`;return t[r]?`${r}*`:undefined}grantPermissions({approvedPermissions:e,requestData:t,preserveExistingPermissions:n=!0,subject:r}){const{origin:s}=r;if(!s||"string"!=typeof s)throw new h.InvalidSubjectIdentifierError(s);const i=n?Object.assign({},this.getPermissions(s)):{};for(const[n,r]of Object.entries(e)){const e=this.getTargetKey(n);if(!e)throw h.methodNotFound(n);if(r.parentCapability!==undefined&&n!==r.parentCapability)throw new h.InvalidApprovedPermissionError(s,n,r);const a=n,o=this.getPermissionSpecification(e),c={caveats:this.constructCaveats(s,a,r.caveats),invoker:s,target:a};let u;o.factory?(u=o.factory(c,t),this.validatePermission(o,u,s,a)):(u=f.constructPermission(c),this.validatePermission(o,u,s,a,{invokePermissionValidator:!0,performCaveatValidation:!1})),i[a]=u}return this.setValidatedPermissions(s,i),i}validatePermission(e,t,n,r,{invokePermissionValidator:s,performCaveatValidation:i}={invokePermissionValidator:!0,performCaveatValidation:!0}){const{allowedCaveats:a,validator:o}=e;if(l.hasProperty(t,"caveats")){const{caveats:e}=t;if(null!==e&&!(Array.isArray(e)&&e.length>0))throw new h.InvalidCaveatsPropertyError(n,r,e);const s=new Set;null==e||e.forEach((e=>{if(i&&this.validateCaveat(e,n,r),!(null==a?void 0:a.includes(e.type)))throw new h.ForbiddenCaveatError(e.type,n,r);if(s.has(e.type))throw new h.DuplicateCaveatError(e.type,n,r);s.add(e.type)}))}s&&o&&o(t,n,r)}setValidatedPermissions(e,t){this.update((n=>{n.subjects[e]||(n.subjects[e]={origin:e,permissions:{}}),n.subjects[e].permissions=o.castDraft(t)}))}constructCaveats(e,t,n){const r=null==n?void 0:n.map((n=>{this.validateCaveat(n,e,t);const{type:r,value:s}=n;return{type:r,value:s}}));return r&&l.isNonEmptyArray(r)?r:undefined}validateCaveat(e,t,n){var r;if(!l.isPlainObject(e))throw new h.InvalidCaveatError(e,t,n);if(2!==Object.keys(e).length)throw new h.InvalidCaveatFieldsError(e,t,n);if("string"!=typeof e.type)throw new h.InvalidCaveatTypeError(e,t,n);const s=this.getCaveatSpecification(e.type);if(!s)throw new h.UnrecognizedCaveatTypeError(e.type,t,n);if(!l.hasProperty(e,"value")||e.value===undefined)throw new h.CaveatMissingValueError(e,t,n);if(!l.isValidJson(e.value))throw new h.CaveatInvalidJsonError(e,t,n);null===(r=s.validator)||void 0===r||r.call(s,e,t,n)}requestPermissions(e,t,n={}){return r(this,void 0,void 0,(function*(){const{origin:r}=e,{id:i=c.nanoid(),preserveExistingPermissions:a=!0}=n;this.validateRequestedPermissions(r,t);const o={id:i,origin:r},u={metadata:o,permissions:t},l=yield this.requestUserApproval(u),{permissions:d}=l,h=s(l,["permissions"]);return[this.grantPermissions({subject:e,approvedPermissions:d,preserveExistingPermissions:a,requestData:h}),o]}))}validateRequestedPermissions(e,t){if(!l.isPlainObject(t))throw h.invalidParams({message:`Requested permissions for origin "${e}" is not a plain object.`,data:{origin:e,requestedPermissions:t}});if(0===Object.keys(t).length)throw h.invalidParams({message:`Permissions request for origin "${e}" contains no permissions.`,data:{requestedPermissions:t}});for(const n of Object.keys(t)){const r=t[n],s=this.getTargetKey(n);if(!s)throw h.methodNotFound(n,{origin:e,requestedPermissions:t});if(!l.isPlainObject(r)||r.parentCapability!==undefined&&n!==r.parentCapability)throw h.invalidParams({message:`Permissions request for origin "${e}" contains invalid requested permission(s).`,data:{origin:e,requestedPermissions:t}});this.validatePermission(this.getPermissionSpecification(s),r,e,n,{invokePermissionValidator:!1,performCaveatValidation:!0})}}requestUserApproval(e){return r(this,void 0,void 0,(function*(){const{origin:t,id:n}=e.metadata,r=yield this.messagingSystem.call("ApprovalController:addRequest",{id:n,origin:t,requestData:e,type:m.MethodNames.requestPermissions},!0);return this.validateApprovedPermissions(r,{id:n,origin:t}),r}))}validateApprovedPermissions(e,t){const{id:n,origin:r}=t;if(!l.isPlainObject(e)||!l.isPlainObject(e.metadata))throw h.internalError(`Approved permissions request for subject "${r}" is invalid.`,{data:{approvedRequest:e}});const{metadata:{id:s,origin:i},permissions:a}=e;if(s!==n)throw h.internalError(`Approved permissions request for subject "${r}" mutated its id.`,{originalId:n,mutatedId:s});if(i!==r)throw h.internalError(`Approved permissions request for subject "${r}" mutated its origin.`,{originalOrigin:r,mutatedOrigin:i});try{this.validateRequestedPermissions(r,a)}catch(e){throw h.internalError(`Invalid approved permissions request: ${e.message}`,e.data)}}acceptPermissionsRequest(e){return r(this,void 0,void 0,(function*(){const{id:t}=e.metadata;if(!this.hasApprovalRequest({id:t}))throw new h.PermissionsRequestNotFoundError(t);if(0!==Object.keys(e.permissions).length)try{this.messagingSystem.call("ApprovalController:acceptRequest",t,e)}catch(e){throw this._rejectPermissionsRequest(t,e),e}else this._rejectPermissionsRequest(t,h.invalidParams({message:"Must request at least one permission."}))}))}rejectPermissionsRequest(e){return r(this,void 0,void 0,(function*(){if(!this.hasApprovalRequest({id:e}))throw new h.PermissionsRequestNotFoundError(e);this._rejectPermissionsRequest(e,h.userRejectedRequest())}))}hasApprovalRequest(e){return this.messagingSystem.call("ApprovalController:hasRequest",e)}_rejectPermissionsRequest(e,t){return this.messagingSystem.call("ApprovalController:rejectRequest",e,t)}getEndowments(e,t,n){return r(this,void 0,void 0,(function*(){if(!this.hasPermission(e,t))throw h.unauthorized({data:{origin:e,targetName:t}});return this.getTypedPermissionSpecification(f.PermissionType.Endowment,t,e).endowmentGetter({origin:e,requestData:n})}))}executeRestrictedMethod(e,t,n){return r(this,void 0,void 0,(function*(){const r=this.getRestrictedMethod(t,e),s=yield this._executeRestrictedMethod(r,{origin:e},t,n);if(s===undefined)throw new Error(`Internal request for method "${t}" as origin "${e}" returned no result.`);return s}))}_executeRestrictedMethod(e,t,n,r=[]){const{origin:s}=t,i=this.getPermission(s,n);if(!i)throw h.unauthorized({data:{origin:s,method:n}});return d.decorateWithCaveats(e,i,this._caveatSpecifications)({method:n,params:r,context:{origin:s}})}}n.PermissionController=v}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/permissions/PermissionController.js"}],[1388,{"./network-access":1389},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.endowmentPermissionBuilders=void 0;const r=e("./network-access");n.endowmentPermissionBuilders={[r.networkAccessEndowmentBuilder.targetKey]:r.networkAccessEndowmentBuilder}}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/permissions/endowments/index.js"}],[1389,{"../Permission":1386},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.networkAccessEndowmentBuilder=void 0;const r=e("../Permission"),s="endowment:network-access";n.networkAccessEndowmentBuilder=Object.freeze({targetKey:s,specificationBuilder:e=>({permissionType:r.PermissionType.Endowment,targetKey:s,allowedCaveats:null,endowmentGetter:e=>["fetch","WebSocket"]})})}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/permissions/endowments/network-access.js"}],[139,{lodash:5172},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("lodash");var s={version:58,async migrate(e){const t=(0,r.cloneDeep)(e);t.meta.version=58;const n=t.data;return t.data=function(e){var t;return null===(t=e.AppStateController)||void 0===t||delete t.swapsWelcomeMessageHasBeenShown,e}(n),t}};n.default=s}}},{package:"<root>",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/app/scripts/migrations/058.js"}],[1390,{"eth-rpc-errors":2455},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.PermissionsRequestNotFoundError=n.DuplicateCaveatError=n.ForbiddenCaveatError=n.InvalidCaveatFieldsError=n.CaveatInvalidJsonError=n.CaveatMissingValueError=n.InvalidCaveatTypeError=n.InvalidCaveatError=n.CaveatAlreadyExistsError=n.CaveatDoesNotExistError=n.InvalidCaveatsPropertyError=n.UnrecognizedCaveatTypeError=n.EndowmentPermissionDoesNotExistError=n.PermissionDoesNotExistError=n.InvalidApprovedPermissionError=n.UnrecognizedSubjectError=n.InvalidSubjectIdentifierError=n.internalError=n.userRejectedRequest=n.invalidParams=n.methodNotFound=n.unauthorized=void 0;const r=e("eth-rpc-errors");n.unauthorized=function(e){return r.ethErrors.provider.unauthorized({message:"Unauthorized to perform action. Try requesting the required permission(s) first. For more information, see: https://docs.metamask.io/guide/rpc-api.html#permissions",data:e.data})},n.methodNotFound=function(e,t){const n={message:`The method "${e}" does not exist / is not available.`};return t!==undefined&&(n.data=t),r.ethErrors.rpc.methodNotFound(n)},n.invalidParams=function(e){return r.ethErrors.rpc.invalidParams({data:e.data,message:e.message})},n.userRejectedRequest=function(e){return r.ethErrors.provider.userRejectedRequest({data:e})},n.internalError=function(e,t){return r.ethErrors.rpc.internal({message:e,data:t})};class s extends Error{constructor(e){super(`Invalid subject identifier: "${"string"==typeof e?e:typeof e}"`)}}n.InvalidSubjectIdentifierError=s;class i extends Error{constructor(e){super(`Unrecognized subject: "${e}" has no permissions.`)}}n.UnrecognizedSubjectError=i;class a extends Error{constructor(e,t,n){super(`Invalid approved permission for origin "${e}" and target "${t}".`),this.data={origin:e,target:t,approvedPermission:n}}}n.InvalidApprovedPermissionError=a;class o extends Error{constructor(e,t){super(`Subject "${e}" has no permission for "${t}".`)}}n.PermissionDoesNotExistError=o;class c extends Error{constructor(e,t){super(`Subject "${t}" has no permission for "${e}".`),t&&(this.data={origin:t})}}n.EndowmentPermissionDoesNotExistError=c;class u extends Error{constructor(e,t,n){super(`Unrecognized caveat type: "${e}"`),this.data={caveatType:e},t!==undefined&&(this.data.origin=t),n!==undefined&&(this.data.target=n)}}n.UnrecognizedCaveatTypeError=u;class l extends Error{constructor(e,t,n){super(`The "caveats" property of permission for "${t}" of subject "${e}" is invalid. It must be a non-empty array if specified.`),this.data={origin:e,target:t,caveatsProperty:n}}}n.InvalidCaveatsPropertyError=l;class d extends Error{constructor(e,t,n){super(`Permission for "${t}" of subject "${e}" has no caveat of type "${n}".`)}}n.CaveatDoesNotExistError=d;class h extends Error{constructor(e,t,n){super(`Permission for "${t}" of subject "${e}" already has a caveat of type "${n}".`)}}n.CaveatAlreadyExistsError=h;class f extends r.EthereumRpcError{constructor(e,t,n){super(r.errorCodes.rpc.invalidParams,"Invalid caveat. Caveats must be plain objects.",{receivedCaveat:e}),this.data={origin:t,target:n}}}n.InvalidCaveatError=f;class p extends Error{constructor(e,t,n){super(`Caveat types must be strings. Received: "${typeof e.type}"`),this.data={caveat:e,origin:t,target:n}}}n.InvalidCaveatTypeError=p;class m extends Error{constructor(e,t,n){super('Caveat is missing "value" field.'),this.data={caveat:e,origin:t,target:n}}}n.CaveatMissingValueError=m;class g extends Error{constructor(e,t,n){super('Caveat "value" is invalid JSON.'),this.data={caveat:e,origin:t,target:n}}}n.CaveatInvalidJsonError=g;class y extends Error{constructor(e,t,n){super(`Caveat has unexpected number of fields: "${Object.keys(e).length}"`),this.data={caveat:e,origin:t,target:n}}}n.InvalidCaveatFieldsError=y;class v extends Error{constructor(e,t,n){super(`Permissions for target "${n}" may not have caveats of type "${e}".`),this.data={caveatType:e,origin:t,target:n}}}n.ForbiddenCaveatError=v;class b extends Error{constructor(e,t,n){super(`Permissions for target "${n}" contains multiple caveats of type "${e}".`),this.data={caveatType:e,origin:t,target:n}}}n.DuplicateCaveatError=b;class w extends Error{constructor(e){super(`Permissions request with id "${e}" not found.`)}}n.PermissionsRequestNotFoundError=w}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/permissions/errors.js"}],[1391,{"./Caveat":1385,"./Permission":1386,"./PermissionController":1387,"./endowments":1388,"./rpc-methods":1394,"./utils":1396},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return s(t,e),t};Object.defineProperty(n,"__esModule",{value:!0}),n.endowmentPermissionBuilders=n.permissionRpcMethods=void 0,i(e("./Caveat"),n),i(e("./Permission"),n),i(e("./PermissionController"),n),i(e("./utils"),n),n.permissionRpcMethods=a(e("./rpc-methods"));var o=e("./endowments");Object.defineProperty(n,"endowmentPermissionBuilders",{enumerable:!0,get:function(){return o.endowmentPermissionBuilders}})}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/permissions/index.js"}],[1392,{"./errors":1390,"json-rpc-engine":4727},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.getPermissionMiddlewareFactory=void 0;const s=e("json-rpc-engine"),i=e("./errors");n.getPermissionMiddlewareFactory=function({executeRestrictedMethod:e,getRestrictedMethod:t,isUnrestrictedMethod:n}){return function(a){const{origin:o}=a;if("string"!=typeof o||!o)throw new Error('The subject "origin" must be a non-empty string.');return s.createAsyncMiddleware(((s,c,u)=>r(this,void 0,void 0,(function*(){const{method:r,params:l}=s;if(n(r))return u();const d=t(r,o),h=yield e(d,a,r,l);return h===undefined?(c.error=i.internalError(`Request for method "${s.method}" returned undefined result.`,{request:s}),undefined):(c.result=h,undefined)}))))}}}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/permissions/permission-middleware.js"}],[1393,{"../utils":1396},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.getPermissionsHandler=void 0;const s=e("../utils");n.getPermissionsHandler={methodNames:[s.MethodNames.getPermissions],implementation:function(e,t,n,s,{getPermissionsForOrigin:i}){return r(this,void 0,void 0,(function*(){return t.result=Object.values(i()||{}),s()}))},hookNames:{getPermissionsForOrigin:!0}}}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/permissions/rpc-methods/getPermissions.js"}],[1394,{"./getPermissions":1393,"./requestPermissions":1395},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.handlers=void 0;const r=e("./requestPermissions"),s=e("./getPermissions");n.handlers=[r.requestPermissionsHandler,s.getPermissionsHandler]}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/permissions/rpc-methods/index.js"}],[1395,{"../../util":1404,"../errors":1390,"../utils":1396,"eth-rpc-errors":2455},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.requestPermissionsHandler=void 0;const s=e("eth-rpc-errors"),i=e("../utils"),a=e("../errors"),o=e("../../util");n.requestPermissionsHandler={methodNames:[i.MethodNames.requestPermissions],implementation:function(e,t,n,i,{requestPermissionsForOrigin:c}){return r(this,void 0,void 0,(function*(){const{id:n,params:r}=e;if("number"!=typeof n&&"string"!=typeof n||"string"==typeof n&&!n)return i(s.ethErrors.rpc.invalidRequest({message:"Invalid request: Must specify a valid id.",data:{request:e}}));if(!Array.isArray(r)||!o.isPlainObject(r[0]))return i(a.invalidParams({data:{request:e}}));const[u]=r,[l]=yield c(u,String(n));return t.result=Object.values(l),i()}))},hookNames:{requestPermissionsForOrigin:!0}}}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/permissions/rpc-methods/requestPermissions.js"}],[1396,{},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.MethodNames=void 0,function(e){e.requestPermissions="wallet_requestPermissions",e.getPermissions="wallet_getPermissions"}(n.MethodNames||(n.MethodNames={}))}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/permissions/utils.js"}],[1397,{"../BaseControllerV2":1342,"eth-rpc-errors":2455},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.RateLimitController=void 0;const s=e("eth-rpc-errors"),i=e("../BaseControllerV2"),a="RateLimitController",o={requests:{persist:!1,anonymous:!1}};class c extends i.BaseController{constructor({rateLimitTimeout:e=5e3,rateLimitCount:t=1,messenger:n,state:r,implementations:s}){const i={requests:Object.keys(s).reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:{}})),{})};super({name:a,metadata:o,messenger:n,state:Object.assign(Object.assign({},i),r)}),this.implementations=s,this.rateLimitTimeout=e,this.rateLimitCount=t,this.messagingSystem.registerActionHandler(`${a}:call`,((e,t,...n)=>this.call(e,t,...n)))}call(e,t,...n){return r(this,void 0,void 0,(function*(){if(this.isRateLimited(t,e))throw s.ethErrors.rpc.limitExceeded({message:`"${t}" is currently rate-limited. Please try again later.`});this.recordRequest(t,e);const r=this.implementations[t];if(!r)throw new Error("Invalid api type");return r(...n)}))}isRateLimited(e,t){return this.state.requests[e][t]>=this.rateLimitCount}recordRequest(e,t){this.update((n=>{var r;n.requests[e][t]=(null!==(r=n.requests[e][t])&&void 0!==r?r:0)+1,setTimeout((()=>this.resetRequestCount(e,t)),this.rateLimitTimeout)}))}resetRequestCount(e,t){this.update((n=>{n.requests[e][t]=0}))}}n.RateLimitController=c}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/ratelimit/RateLimitController.js"}],[1398,{"../BaseControllerV2":1342},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SubjectMetadataController=void 0;const r=e("../BaseControllerV2"),s={subjectMetadata:{persist:!0,anonymous:!1}},i={subjectMetadata:{}};class a extends r.BaseController{constructor({messenger:e,subjectCacheLimit:t,state:n={}}){if(!Number.isInteger(t)||t<1)throw new Error(`subjectCacheLimit must be a positive integer. Received: "${t}"`);const r=t=>e.call("PermissionController:hasPermissions",t);super({name:"SubjectMetadataController",metadata:s,messenger:e,state:Object.assign({},a.getTrimmedState(n,r))}),this.subjectHasPermissions=r,this.subjectCacheLimit=t,this.subjectsWithoutPermissionsEcounteredSinceStartup=new Set}clearState(){this.subjectsWithoutPermissionsEcounteredSinceStartup.clear(),this.update((e=>Object.assign({},i)))}addSubjectMetadata(e){const{origin:t}=e,n=Object.assign(Object.assign({},e),{extensionId:e.extensionId||null,iconUrl:e.iconUrl||null,name:e.name||null});let r=null;if(this.subjectsWithoutPermissionsEcounteredSinceStartup.size>=this.subjectCacheLimit){const e=this.subjectsWithoutPermissionsEcounteredSinceStartup.values().next().value;this.subjectsWithoutPermissionsEcounteredSinceStartup.delete(e),this.subjectHasPermissions(e)||(r=e)}this.subjectsWithoutPermissionsEcounteredSinceStartup.add(t),this.update((e=>{e.subjectMetadata[t]=n,"string"==typeof r&&delete e.subjectMetadata[r]}))}trimMetadataState(){this.update((e=>a.getTrimmedState(e,this.subjectHasPermissions)))}static getTrimmedState(e,t){const{subjectMetadata:n={}}=e;return{subjectMetadata:Object.keys(n).reduce(((e,r)=>(t(r)&&(e[r]=n[r]),e)),{})}}}n.SubjectMetadataController=a}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/subject-metadata/SubjectMetadataController.js"}],[1399,{"./SubjectMetadataController":1398},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),s(e("./SubjectMetadataController"),n)}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/subject-metadata/index.js"}],[14,{"../../../../shared/constants/network":6189,"@babel/runtime/helpers/interopRequireDefault":195,"eth-block-tracker":2361,"eth-json-rpc-infura":2400,"eth-json-rpc-middleware":2406,"json-rpc-engine":4727},function(){with(this)return function(){"use strict";return function(e,t,n){var r=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({network:e,projectId:t}){const n=(0,a.default)({network:e,projectId:t,maxAttempts:5,source:"metamask"}),r=(0,i.providerFromMiddleware)(n),c=new o.PollingBlockTracker({provider:r});return{networkMiddleware:(0,s.mergeMiddleware)([u({network:e}),(0,i.createBlockCacheMiddleware)({blockTracker:c}),(0,i.createInflightCacheMiddleware)(),(0,i.createBlockRefMiddleware)({blockTracker:c,provider:r}),(0,i.createRetryOnEmptyMiddleware)({blockTracker:c,provider:r}),(0,i.createBlockTrackerInspectorMiddleware)({blockTracker:c}),n]),blockTracker:c}};var s=e("json-rpc-engine"),i=e("eth-json-rpc-middleware"),a=r(e("eth-json-rpc-infura")),o=e("eth-block-tracker"),c=e("../../../../shared/constants/network");function u({network:e}){if(!c.NETWORK_TYPE_TO_ID_MAP[e])throw new Error(`createInfuraClient - unknown network "${e}"`);const{chainId:t,networkId:n}=c.NETWORK_TYPE_TO_ID_MAP[e];return(0,s.createScaffoldMiddleware)({eth_chainId:t,net_version:n})}}}},{package:"<root>",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/app/scripts/controllers/network/createInfuraClient.js"}],[140,{"../../../shared/constants/transaction":6193,lodash:5172},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("lodash"),s=e("../../../shared/constants/transaction");var i={version:59,async migrate(e){const t=(0,r.cloneDeep)(e);t.meta.version=59;const n=t.data;return t.data=function(e){var t;const n=null==e||null===(t=e.TransactionController)||void 0===t?void 0:t.transactions;if((0,r.isPlainObject)(n)){const t=(0,r.groupBy)(Object.values(n),(e=>{var t,n;return`${null===(t=e.txParams)||void 0===t?void 0:t.nonce}-${null!==(n=e.chainId)&&void 0!==n?n:e.metamaskNetworkId}`})),i=(0,r.pickBy)(t,(e=>e.some((e=>e.type!==s.TRANSACTION_TYPES.CANCEL&&e.type!==s.TRANSACTION_TYPES.RETRY))));e.TransactionController.transactions=(0,r.keyBy)((0,r.concat)(...Object.values(i)),(e=>e.id))}return e}(n),t}};n.default=i}}},{package:"<root>",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/app/scripts/migrations/059.js"}],[1400,{"../BaseController":1341,"../util":1404,"eth-phishing-detect/src/config.json":2449,"eth-phishing-detect/src/detector":2450,"punycode/":5520},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.PhishingController=void 0;const i=e("punycode/"),a=s(e("eth-phishing-detect/src/config.json")),o=s(e("eth-phishing-detect/src/detector")),c=e("../BaseController"),u=e("../util");class l extends c.BaseController{constructor(e,t){super(e,t),this.configUrl="https://cdn.jsdelivr.net/gh/MetaMask/eth-phishing-detect@master/src/config.json",this.name="PhishingController",this.defaultConfig={interval:36e5},this.defaultState={phishing:a.default,whitelist:[]},this.detector=new o.default(this.defaultState.phishing),this.initialize(),this.poll()}poll(e){return r(this,void 0,void 0,(function*(){e&&this.configure({interval:e},!1,!1),this.handle&&clearTimeout(this.handle),yield u.safelyExecute((()=>this.updatePhishingLists())),this.handle=setTimeout((()=>{this.poll(this.config.interval)}),this.config.interval)}))}test(e){const t=i.toASCII(e);return-1===this.state.whitelist.indexOf(t)&&this.detector.check(t).result}bypass(e){const t=i.toASCII(e),{whitelist:n}=this.state;-1===n.indexOf(t)&&this.update({whitelist:[...n,t]})}updatePhishingLists(){return r(this,void 0,void 0,(function*(){if(this.disabled)return;const e=yield this.queryConfig(this.configUrl);e&&(this.detector=new o.default(e),this.update({phishing:e}))}))}queryConfig(e){return r(this,void 0,void 0,(function*(){const t=yield fetch(e,{cache:"no-cache"});switch(t.status){case 200:return yield t.json();case 304:case 403:return null;default:throw new Error(`Fetch failed with status '${t.status}' for request '${e}'`)}}))}}n.PhishingController=l,n.default=l}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/third-party/PhishingController.js"}],[1401,{"../BaseController":1341,"../constants":1362,"../util":1404,"@ethereumjs/common":401,"@ethereumjs/tx":405,"async-mutex":1727,"eth-method-registry":1431,"eth-query":2451,"eth-rpc-errors":2455,"ethereumjs-util":2521,events:2082,uuid:6009},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionController=n.SPEED_UP_RATE=n.CANCEL_RATE=n.WalletDevice=n.TransactionStatus=void 0;const i=e("events"),a=e("ethereumjs-util"),o=e("eth-rpc-errors"),c=s(e("eth-method-registry")),u=s(e("eth-query")),l=s(e("@ethereumjs/common")),d=e("@ethereumjs/tx"),h=e("uuid"),f=e("async-mutex"),p=e("../BaseController"),m=e("../util"),g=e("../constants"),y="london";var v;!function(e){e.approved="approved",e.cancelled="cancelled",e.confirmed="confirmed",e.failed="failed",e.rejected="rejected",e.signed="signed",e.submitted="submitted",e.unapproved="unapproved"}(v=n.TransactionStatus||(n.TransactionStatus={})),function(e){e.MM_MOBILE="metamask_mobile",e.MM_EXTENSION="metamask_extension",e.OTHER="other_device"}(n.WalletDevice||(n.WalletDevice={})),n.CANCEL_RATE=1.5,n.SPEED_UP_RATE=1.1;class b extends p.BaseController{constructor({getNetworkState:e,onNetworkStateChange:t,getProvider:n},r,s){super(r,s),this.mutex=new f.Mutex,this.normalizeTokenTx=(e,t,n)=>{const r=1e3*parseInt(e.timeStamp,10),{to:s,from:i,gas:a,gasPrice:o,gasUsed:c,hash:u,contractAddress:l,tokenDecimal:d,tokenSymbol:f,value:p}=e;return{id:h.v1({msecs:r}),isTransfer:!0,networkID:t,chainId:n,status:v.confirmed,time:r,transaction:{chainId:1,from:i,gas:a,gasPrice:o,gasUsed:c,to:s,value:p},transactionHash:u,transferInformation:{contractAddress:l,decimals:Number(d),symbol:f},verifiedOnBlockchain:!1}},this.hub=new i.EventEmitter,this.name="TransactionController",this.defaultConfig={interval:15e3,txHistoryLimit:40},this.defaultState={methodData:{},transactions:[]},this.initialize();const a=n();this.getNetworkState=e,this.ethQuery=new u.default(a),this.registry=new c.default({provider:a}),t((()=>{const e=n();this.ethQuery=new u.default(e),this.registry=new c.default({provider:e})})),this.poll()}failTransaction(e,t){const n=Object.assign(Object.assign({},e),{error:t,status:v.failed});this.updateTransaction(n),this.hub.emit(`${e.id}:finished`,n)}registryLookup(e){return r(this,void 0,void 0,(function*(){const t=yield this.registry.lookup(e);return{registryMethod:t,parsedRegistryMethod:this.registry.parse(t)}}))}normalizeTx(e,t,n){const r=1e3*parseInt(e.timeStamp,10),s={blockNumber:e.blockNumber,id:h.v1({msecs:r}),networkID:t,chainId:n,time:r,transaction:{data:e.input,from:e.from,gas:m.BNToHex(new a.BN(e.gas)),gasPrice:m.BNToHex(new a.BN(e.gasPrice)),gasUsed:m.BNToHex(new a.BN(e.gasUsed)),nonce:m.BNToHex(new a.BN(e.nonce)),to:e.to,value:m.BNToHex(new a.BN(e.value))},transactionHash:e.hash,verifiedOnBlockchain:!1};return"0"===e.isError?Object.assign(Object.assign({},s),{status:v.confirmed}):Object.assign(Object.assign({},s),{error:new Error("Transaction failed"),status:v.failed})}poll(e){return r(this,void 0,void 0,(function*(){e&&this.configure({interval:e},!1,!1),this.handle&&clearTimeout(this.handle),yield m.safelyExecute((()=>this.queryTransactionStatuses())),this.handle=setTimeout((()=>{this.poll(this.config.interval)}),this.config.interval)}))}handleMethodData(e){return r(this,void 0,void 0,(function*(){const t=yield this.mutex.acquire();try{const{methodData:n}=this.state;if(Object.keys(n).find((t=>e===t)))return n[e];const r=yield this.registryLookup(e);return this.update({methodData:Object.assign(Object.assign({},n),{[e]:r})}),r}finally{t()}}))}addTransaction(e,t,n){return r(this,void 0,void 0,(function*(){const{provider:r,network:s}=this.getNetworkState(),{transactions:i}=this.state;e=m.normalizeTransaction(e),m.validateTransaction(e);const a={id:h.v1(),networkID:s,chainId:r.chainId,origin:t,status:v.unapproved,time:Date.now(),transaction:e,deviceConfirmedOn:n,verifiedOnBlockchain:!1};try{const{gas:t}=yield this.estimateGas(e);e.gas=t}catch(e){return this.failTransaction(a,e),Promise.reject(e)}const c=new Promise(((e,t)=>{this.hub.once(`${a.id}:finished`,(n=>{switch(n.status){case v.submitted:return e(n.transactionHash);case v.rejected:return t(o.ethErrors.provider.userRejectedRequest("User rejected the transaction"));case v.cancelled:return t(o.ethErrors.rpc.internal("User cancelled the transaction"));case v.failed:return t(o.ethErrors.rpc.internal(n.error.message));default:return t(o.ethErrors.rpc.internal(`MetaMask Tx Signature: Unknown problem: ${JSON.stringify(n)}`))}}))}));return i.push(a),this.update({transactions:this.trimTransactionsForState(i)}),this.hub.emit("unapprovedTransaction",a),{result:c,transactionMeta:a}}))}prepareUnsignedEthTx(e){return d.TransactionFactory.fromTxData(e,{common:this.getCommonConfiguration(),freeze:!1})}getCommonConfiguration(){const{network:e,provider:{type:t,chainId:n,nickname:r}}=this.getNetworkState();if(t!==g.RPC)return new l.default({chain:t,hardfork:y});const s={name:r,chainId:parseInt(n,undefined),networkId:parseInt(e,undefined)};return l.default.forCustomChain(g.MAINNET,s,y)}approveTransaction(e){return r(this,void 0,void 0,(function*(){const{transactions:t}=this.state,n=yield this.mutex.acquire(),{provider:r}=this.getNetworkState(),{chainId:s}=r,i=t.findIndex((({id:t})=>e===t)),o=t[i],{nonce:c}=o.transaction;try{const{from:e}=o.transaction;if(!this.sign)return n(),void this.failTransaction(o,new Error("No sign method defined."));if(!s)return n(),void this.failTransaction(o,new Error("No chainId defined."));const t=parseInt(s,undefined),{approved:r}=v,i=c||(yield m.query(this.ethQuery,"getTransactionCount",[e,"pending"]));o.status=r,o.transaction.nonce=i,o.transaction.chainId=t;const u=Object.assign(Object.assign({},o.transaction),{gasLimit:o.transaction.gas,chainId:t,nonce:i,status:r}),l=m.isEIP1559Transaction(o.transaction),d=l?Object.assign(Object.assign({},u),{maxFeePerGas:o.transaction.maxFeePerGas,maxPriorityFeePerGas:o.transaction.maxPriorityFeePerGas,estimatedBaseFee:o.transaction.estimatedBaseFee,type:2}):u;l&&delete d.gasPrice;const h=this.prepareUnsignedEthTx(d),f=yield this.sign(h,e);o.status=v.signed,this.updateTransaction(o);const p=a.bufferToHex(f.serialize());o.rawTransaction=p,this.updateTransaction(o);const g=yield m.query(this.ethQuery,"sendRawTransaction",[p]);o.transactionHash=g,o.status=v.submitted,this.updateTransaction(o),this.hub.emit(`${o.id}:finished`,o)}catch(e){this.failTransaction(o,e)}finally{n()}}))}cancelTransaction(e){const t=this.state.transactions.find((({id:t})=>t===e));if(!t)return;t.status=v.rejected,this.hub.emit(`${t.id}:finished`,t);const n=this.state.transactions.filter((({id:t})=>t!==e));this.update({transactions:this.trimTransactionsForState(n)})}stopTransaction(e,t){var s,i;return r(this,void 0,void 0,(function*(){t&&m.validateGasValues(t);const r=this.state.transactions.find((({id:t})=>t===e));if(!r)return;if(!this.sign)throw new Error("No sign method defined.");const o=m.getIncreasedPriceFromExisting(r.transaction.gasPrice,n.CANCEL_RATE),c=m.isGasPriceValue(t)&&t.gasPrice,u=c&&m.validateMinimumIncrease(c,o)||o,l=null===(s=r.transaction)||void 0===s?void 0:s.maxFeePerGas,d=m.getIncreasedPriceFromExisting(l,n.CANCEL_RATE),h=m.isFeeMarketEIP1559Values(t)&&t.maxFeePerGas,f=h&&m.validateMinimumIncrease(h,d)||l&&d,p=null===(i=r.transaction)||void 0===i?void 0:i.maxPriorityFeePerGas,g=m.getIncreasedPriceFromExisting(p,n.CANCEL_RATE),y=m.isFeeMarketEIP1559Values(t)&&t.maxPriorityFeePerGas,b=y&&m.validateMinimumIncrease(y,g)||p&&g,w=f&&b?{from:r.transaction.from,gasLimit:r.transaction.gas,maxFeePerGas:f,maxPriorityFeePerGas:b,type:2,nonce:r.transaction.nonce,to:r.transaction.from,value:"0x0"}:{from:r.transaction.from,gasLimit:r.transaction.gas,gasPrice:u,nonce:r.transaction.nonce,to:r.transaction.from,value:"0x0"},k=this.prepareUnsignedEthTx(w),_=yield this.sign(k,r.transaction.from),E=a.bufferToHex(_.serialize());yield m.query(this.ethQuery,"sendRawTransaction",[E]),r.status=v.cancelled,this.hub.emit(`${r.id}:finished`,r)}))}speedUpTransaction(e,t){var s,i;return r(this,void 0,void 0,(function*(){t&&m.validateGasValues(t);const r=this.state.transactions.find((({id:t})=>t===e));if(!r)return;if(!this.sign)throw new Error("No sign method defined.");const{transactions:o}=this.state,c=m.getIncreasedPriceFromExisting(r.transaction.gasPrice,n.SPEED_UP_RATE),u=m.isGasPriceValue(t)&&t.gasPrice,l=u&&m.validateMinimumIncrease(u,c)||c,d=null===(s=r.transaction)||void 0===s?void 0:s.maxFeePerGas,f=m.getIncreasedPriceFromExisting(d,n.SPEED_UP_RATE),p=m.isFeeMarketEIP1559Values(t)&&t.maxFeePerGas,g=p&&m.validateMinimumIncrease(p,f)||d&&f,y=null===(i=r.transaction)||void 0===i?void 0:i.maxPriorityFeePerGas,v=m.getIncreasedPriceFromExisting(y,n.SPEED_UP_RATE),b=m.isFeeMarketEIP1559Values(t)&&t.maxPriorityFeePerGas,w=b&&m.validateMinimumIncrease(b,v)||y&&v,k=g&&w?Object.assign(Object.assign({},r.transaction),{gasLimit:r.transaction.gas,maxFeePerGas:g,maxPriorityFeePerGas:w,type:2}):Object.assign(Object.assign({},r.transaction),{gasLimit:r.transaction.gas,gasPrice:l}),_=this.prepareUnsignedEthTx(k),E=yield this.sign(_,r.transaction.from),S=a.bufferToHex(E.serialize()),P=yield m.query(this.ethQuery,"sendRawTransaction",[S]),x=Object.assign(Object.assign({},r),{id:h.v1(),time:Date.now(),transactionHash:P}),M=g&&w?Object.assign(Object.assign({},x),{transaction:Object.assign(Object.assign({},r.transaction),{maxFeePerGas:g,maxPriorityFeePerGas:w})}):Object.assign(Object.assign({},x),{transaction:Object.assign(Object.assign({},r.transaction),{gasPrice:l})});o.push(M),this.update({transactions:this.trimTransactionsForState(o)}),this.hub.emit(`${r.id}:speedup`,M)}))}estimateGas(e){return r(this,void 0,void 0,(function*(){const t=Object.assign({},e),{gas:n,gasPrice:r,to:s,value:i,data:o}=t,c=void 0===r?yield m.query(this.ethQuery,"gasPrice"):r,{isCustomNetwork:u}=this.getNetworkState();if(void 0!==n)return{gas:n,gasPrice:c};const{gasLimit:l}=yield m.query(this.ethQuery,"getBlockByNumber",["latest",!1]),d=s?yield m.query(this.ethQuery,"getCode",[s]):undefined;if(!u&&(!s||s&&!o&&(!d||"0x"===d)))return{gas:"0x5208",gasPrice:c};t.data=o?a.addHexPrefix(o):o,t.value=void 0===i?"0x0":i;const h=m.hexToBN(l);t.gas=m.BNToHex(m.fractionBN(h,19,20));const f=yield m.query(this.ethQuery,"estimateGas",[t]),p=m.hexToBN(f),g=h.muln(.9),y=p.muln(1.5);return p.gt(g)||u?{gas:a.addHexPrefix(f),gasPrice:c}:y.lt(g)?{gas:a.addHexPrefix(m.BNToHex(y)),gasPrice:c}:{gas:a.addHexPrefix(m.BNToHex(g)),gasPrice:c}}))}queryTransactionStatuses(){return r(this,void 0,void 0,(function*(){const{transactions:e}=this.state,{provider:t,network:n}=this.getNetworkState(),{chainId:s}=t;let i=!1;yield m.safelyExecute((()=>Promise.all(e.map(((t,a)=>r(this,void 0,void 0,(function*(){const r=t.chainId===s||!t.chainId&&t.networkID===n;if(!t.verifiedOnBlockchain&&r){const[n,r]=yield this.blockchainTransactionStateReconciler(t);r&&(e[a]=n,i=r)}}))))))),i&&this.update({transactions:this.trimTransactionsForState(e)})}))}updateTransaction(e){const{transactions:t}=this.state;e.transaction=m.normalizeTransaction(e.transaction),m.validateTransaction(e.transaction);const n=t.findIndex((({id:t})=>e.id===t));t[n]=e,this.update({transactions:this.trimTransactionsForState(t)})}wipeTransactions(e){if(e)return void this.update({transactions:[]});const{provider:t,network:n}=this.getNetworkState(),{chainId:r}=t,s=this.state.transactions.filter((({networkID:e,chainId:t})=>!(t===r||!t&&e===n)));this.update({transactions:this.trimTransactionsForState(s)})}fetchAll(e,t){return r(this,void 0,void 0,(function*(){const{provider:n,network:s}=this.getNetworkState(),{chainId:i,type:a}=n,{transactions:o}=this.state;if(-1===["1","3","4","42"].indexOf(s))return undefined;const[c,u]=yield m.handleTransactionFetch(a,e,this.config.txHistoryLimit,t),l=c.result.map((e=>this.normalizeTx(e,s,i))),d=u.result.map((e=>this.normalizeTokenTx(e,s,i))),[h,f]=this.etherscanTransactionStateReconciler([...l,...d],o);let p;return f.sort(((e,t)=>e.time<t.time?-1:1)),f.forEach((t=>r(this,void 0,void 0,(function*(){if((t.chainId===i||!t.chainId&&t.networkID===s)&&t.transaction.to&&t.transaction.to.toLowerCase()===e.toLowerCase()&&t.blockNumber&&(!p||parseInt(p,10)<parseInt(t.blockNumber,10))&&(p=t.blockNumber),t.toSmartContract===undefined)if(!t.transaction.to||t.transaction.data&&"0x"===t.transaction.data)t.toSmartContract=!1;else{const e=yield m.query(this.ethQuery,"getCode",[t.transaction.to]);t.toSmartContract=m.isSmartContractCode(e)}})))),h&&this.update({transactions:this.trimTransactionsForState(f)}),p}))}trimTransactionsForState(e){const t=new Set,n=e.reverse().filter((e=>{const{chainId:n,networkID:r,status:s,transaction:i,time:a}=e;if(i){const e=`${i.nonce}-${null!=n?n:r}-${new Date(a).toDateString()}`;if(t.has(e))return!0;if(t.size<this.config.txHistoryLimit||!this.isFinalState(s))return t.add(e),!0}return!1}));return n.reverse(),n}isFinalState(e){return e===v.rejected||e===v.confirmed||e===v.failed||e===v.cancelled}blockchainTransactionStateReconciler(e){return r(this,void 0,void 0,(function*(){const{status:t,transactionHash:n}=e;switch(t){case v.confirmed:const t=yield m.query(this.ethQuery,"getTransactionReceipt",[n]);if(!t)return[e,!1];if(e.verifiedOnBlockchain=!0,e.transaction.gasUsed=t.gasUsed,0===Number(t.status)){const t=new Error("Transaction failed. The transaction was reversed");return this.failTransaction(e,t),[e,!1]}return[e,!0];case v.submitted:const r=yield m.query(this.ethQuery,"getTransactionByHash",[n]);if(!r){if(yield this.checkTxReceiptStatusIsFailed(n)){const t=new Error("Transaction failed. The transaction was dropped or replaced by a new one");this.failTransaction(e,t)}}return(null==r?void 0:r.blockNumber)?(e.status=v.confirmed,this.hub.emit(`${e.id}:confirmed`,e),[e,!0]):[e,!1];default:return[e,!1]}}))}checkTxReceiptStatusIsFailed(e){return r(this,void 0,void 0,(function*(){const t=yield m.query(this.ethQuery,"getTransactionReceipt",[e]);return!!t&&0===Number(t.status)}))}etherscanTransactionStateReconciler(e,t){const n=this.getUpdatedTransactions(e,t),r=this.getNewTransactions(e,t),s=t.map((e=>{const t=n.findIndex((({transactionHash:t})=>t===e.transactionHash));return-1===t?e:n[t]}));return[r.length>0||s.length>0,[...r,...s]]}getNewTransactions(e,t){return e.filter((e=>!t.find((({transactionHash:t})=>t===e.transactionHash))))}getUpdatedTransactions(e,t){return e.filter((e=>t.find((t=>e.transactionHash===t.transactionHash&&this.isTransactionOutdated(e,t)))))}isTransactionOutdated(e,t){const n=this.isStatusOutdated(e.transactionHash,t.transactionHash,e.status,t.status),r=this.isGasDataOutdated(e.transaction.gasUsed,t.transaction.gasUsed);return n||r}isStatusOutdated(e,t,n,r){return e===t&&n!==r}isGasDataOutdated(e,t){return e!==t}}n.TransactionController=b,n.default=b}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/transaction/TransactionController.js"}],[1402,{"../BaseController":1341,"../util":1404},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.AddressBookController=void 0;const r=e("../util"),s=e("../BaseController");class i extends s.BaseController{constructor(e,t){super(e,t),this.name="AddressBookController",this.defaultState={addressBook:{}},this.initialize()}clear(){this.update({addressBook:{}})}delete(e,t){if(t=r.toChecksumHexAddress(t),!r.isValidHexAddress(t)||!this.state.addressBook[e]||!this.state.addressBook[e][t])return!1;const n=Object.assign({},this.state.addressBook);return delete n[e][t],0===Object.keys(n[e]).length&&delete n[e],this.update({addressBook:n}),!0}set(e,t,n="1",s=""){if(e=r.toChecksumHexAddress(e),!r.isValidHexAddress(e))return!1;const i={address:e,chainId:n,isEns:!1,memo:s,name:t},a=r.normalizeEnsName(t);return a&&(i.name=a,i.isEns=!0),this.update({addressBook:Object.assign(Object.assign({},this.state.addressBook),{[n]:Object.assign(Object.assign({},this.state.addressBook[n]),{[e]:i})})}),!0}}n.AddressBookController=i,n.default=i}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/user/AddressBookController.js"}],[1403,{"../BaseController":1341,"../util":1404},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.PreferencesController=void 0;const r=e("../BaseController"),s=e("../util");class i extends r.BaseController{constructor(e,t){super(e,t),this.name="PreferencesController",this.defaultState={featureFlags:{},frequentRpcList:[],identities:{},ipfsGateway:"https://ipfs.io/ipfs/",lostIdentities:{},selectedAddress:"",useStaticTokenList:!1,useCollectibleDetection:!1,openSeaEnabled:!1},this.initialize()}addIdentities(e){const{identities:t}=this.state;e.forEach((e=>{if(e=s.toChecksumHexAddress(e),t[e])return;const n=Object.keys(t).length;t[e]={name:`Account ${n+1}`,address:e,importTime:Date.now()}})),this.update({identities:Object.assign({},t)})}removeIdentity(e){e=s.toChecksumHexAddress(e);const{identities:t}=this.state;t[e]&&(delete t[e],this.update({identities:Object.assign({},t)}),e===this.state.selectedAddress&&this.update({selectedAddress:Object.keys(t)[0]}))}setAccountLabel(e,t){e=s.toChecksumHexAddress(e);const{identities:n}=this.state;n[e]=n[e]||{},n[e].name=t,this.update({identities:Object.assign({},n)})}setFeatureFlag(e,t){const n=this.state.featureFlags,r=Object.assign(Object.assign({},n),{[e]:t});this.update({featureFlags:Object.assign({},r)})}syncIdentities(e){e=e.map((e=>s.toChecksumHexAddress(e)));const{identities:t,lostIdentities:n}=this.state,r={};for(const n in t)-1===e.indexOf(n)&&(r[n]=t[n],delete t[n]);if(Object.keys(r).length>0)for(const e in r)n[e]=r[e];return this.update({identities:Object.assign({},t),lostIdentities:Object.assign({},n)}),this.addIdentities(e),-1===e.indexOf(this.state.selectedAddress)&&this.update({selectedAddress:e[0]}),this.state.selectedAddress}updateIdentities(e){e=e.map((e=>s.toChecksumHexAddress(e)));const t=this.state.identities,n=e.reduce(((e,n,r)=>(e[n]=t[n]||{address:n,name:`Account ${r+1}`,importTime:Date.now()},e)),{});let{selectedAddress:r}=this.state;Object.keys(n).includes(r)||(r=Object.keys(n)[0]),this.update({identities:Object.assign({},n),selectedAddress:r})}addToFrequentRpcList(e,t,n,r,s){const{frequentRpcList:i}=this.state,a=i.findIndex((({rpcUrl:t})=>t===e));-1!==a&&i.splice(a,1);const o={rpcUrl:e,chainId:t,ticker:n,nickname:r,rpcPrefs:s};i.push(o),this.update({frequentRpcList:[...i]})}removeFromFrequentRpcList(e){const{frequentRpcList:t}=this.state,n=t.findIndex((({rpcUrl:t})=>t===e));-1!==n&&t.splice(n,1),this.update({frequentRpcList:[...t]})}setSelectedAddress(e){this.update({selectedAddress:s.toChecksumHexAddress(e)})}setIpfsGateway(e){this.update({ipfsGateway:e})}setUseStaticTokenList(e){this.update({useStaticTokenList:e})}setUseCollectibleDetection(e){if(e&&!this.state.openSeaEnabled)throw new Error("useCollectibleDetection cannot be enabled if openSeaEnabled is false");this.update({useCollectibleDetection:e})}setOpenSeaEnabled(e){this.update({openSeaEnabled:e}),e||this.update({useCollectibleDetection:!1})}}n.PreferencesController=i,n.default=i}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/user/PreferencesController.js"}],[1404,{"./constants":1362,buffer:2081,"eth-ens-namehash":2368,"eth-rpc-errors":2455,"eth-sig-util":2457,"ethereumjs-util":2521,"ethjs-unit":2573,"fast-deep-equal":4293,jsonschema:4740,"multiformats/cid":5228},function(){with(this)return function(){"use strict";return function(e,t,n){(function(t){(function(){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.isValidJson=n.isNonEmptyArray=n.hasProperty=n.isPlainObject=n.getFormattedIpfsUrl=n.addUrlProtocolPrefix=n.getIpfsCIDv1AndPath=n.removeIpfsProtocolPrefix=n.validateMinimumIncrease=n.isGasPriceValue=n.isFeeMarketEIP1559Values=n.validateGasValues=n.getIncreasedPriceFromExisting=n.getIncreasedPriceHex=n.convertPriceToDecimal=n.isEIP1559Transaction=n.query=n.normalizeEnsName=n.timeoutFetch=n.handleFetch=n.successfulFetch=n.isSmartContractCode=n.validateTokenToWatch=n.validateTypedSignMessageDataV3=n.validateTypedSignMessageDataV1=n.validateSignMessageData=n.normalizeMessageData=n.validateTransaction=n.isValidHexAddress=n.toChecksumHexAddress=n.safelyExecuteWithTimeout=n.safelyExecute=n.normalizeTransaction=n.toHex=n.fromHex=n.hexToText=n.hexToBN=n.handleTransactionFetch=n.getEtherscanApiUrl=n.getBuyURL=n.weiHexToGweiDec=n.gweiDecToWEIBN=n.fractionBN=n.BNToHex=void 0;const i=e("ethereumjs-util"),a=e("ethjs-unit"),o=e("eth-rpc-errors"),c=s(e("eth-ens-namehash")),u=e("eth-sig-util"),l=e("jsonschema"),d=e("multiformats/cid"),h=s(e("fast-deep-equal")),f=e("./constants"),p=/^[0-9A-Fa-f]+$/gu,m={data:e=>i.addHexPrefix(e),from:e=>i.addHexPrefix(e).toLowerCase(),gas:e=>i.addHexPrefix(e),gasPrice:e=>i.addHexPrefix(e),nonce:e=>i.addHexPrefix(e),to:e=>i.addHexPrefix(e).toLowerCase(),value:e=>i.addHexPrefix(e),maxFeePerGas:e=>i.addHexPrefix(e),maxPriorityFeePerGas:e=>i.addHexPrefix(e),estimatedBaseFee:e=>i.addHexPrefix(e)};function g(e,t){let n="api";e!==f.MAINNET&&(n=`api-${e}`);let r=`${`https://${n}.etherscan.io`}/api?`;for(const e in t)t[e]&&(r+=`${e}=${t[e]}&`);return r+="tag=latest&page=1",r}function y(e){return new i.BN(i.stripHexPrefix(e),16)}function v(e,{allowNonPrefixed:t=!0}={}){const n=t?i.addHexPrefix(e):e;return!!i.isHexString(n)&&i.isValidAddress(n)}function b(e,t){return r(this,void 0,void 0,(function*(){const n=yield fetch(e,t);if(!n.ok)throw new Error(`Fetch failed with status '${n.status}' for request '${e}'`);return n}))}function w(e,t){return r(this,void 0,void 0,(function*(){const n=yield b(e,t);return yield n.json()}))}n.BNToHex=function(e){return i.addHexPrefix(e.toString(16))},n.fractionBN=function(e,t,n){const r=new i.BN(t),s=new i.BN(n);return e.mul(r).div(s)},n.gweiDecToWEIBN=function(e){if(Number.isNaN(e))return new i.BN(0);const t=e.toString().split("."),n=t[0]||"0";let r=t[1]||"";if(!r)return a.toWei(n,"gwei");if(r.length<=9)return a.toWei(`${n}.${r}`,"gwei");const s=r.slice(9)[0];r=r.slice(0,9);let o=a.toWei(`${n}.${r}`,"gwei");return Number(s)>=5&&(o=o.add(new i.BN(1))),o},n.weiHexToGweiDec=function(e){const t=new i.BN(i.stripHexPrefix(e),16);return a.fromWei(t,"gwei").toString(10)},n.getBuyURL=function(e="1",t,n=5){switch(e){case"1":return`https://buy.coinbase.com/?code=9ec56d01-7e81-5017-930c-513daa27bb6a&amount=${n}&address=${t}&crypto_currency=ETH`;case"3":return"https://faucet.metamask.io/";case"4":return"https://www.rinkeby.io/";case"5":return"https://goerli-faucet.slock.it/";case"42":return"https://github.com/kovan-testnet/faucet";default:return undefined}},n.getEtherscanApiUrl=g,n.handleTransactionFetch=function(e,t,n,s){return r(this,void 0,void 0,(function*(){const r={module:"account",address:t,startBlock:null==s?void 0:s.fromBlock,apikey:null==s?void 0:s.etherscanApiKey,offset:n.toString(),order:"desc"},i=w(g(e,Object.assign(Object.assign({},r),{action:"txlist"}))),a=w(g(e,Object.assign(Object.assign({},r),{action:"tokentx"})));let[o,c]=yield Promise.all([i,a]);return("0"===o.status||o.result.length<=0)&&(o={status:o.status,result:[]}),("0"===c.status||c.result.length<=0)&&(c={status:c.status,result:[]}),[o,c]}))},n.hexToBN=y,n.hexToText=function(e){try{const n=i.stripHexPrefix(e);return t.from(n,"hex").toString("utf8")}catch(t){return e}},n.fromHex=function(e){return i.BN.isBN(e)?e:new i.BN(y(e).toString(10))},n.toHex=function(e){return"string"==typeof e&&i.isHexString(e)?e:`0x${i.BN.isBN(e)?e.toString(16):new i.BN(e.toString(),10).toString(16)}`},n.normalizeTransaction=function(e){const t={from:""};let n;for(n in m)e[n]&&(t[n]=m[n](e[n]));return t},n.safelyExecute=function(e,t=!1,n){return r(this,void 0,void 0,(function*(){try{return yield e()}catch(e){return t&&console.error(e),null==n||n(e),undefined}}))},n.safelyExecuteWithTimeout=function(e,t=!1,n=500){return r(this,void 0,void 0,(function*(){try{return yield Promise.race([e(),new Promise(((e,t)=>setTimeout((()=>{t(new Error("timeout"))}),n)))])}catch(e){return t&&console.error(e),undefined}}))},n.toChecksumHexAddress=function(e){const t=i.addHexPrefix(e);return i.isHexString(t)?i.toChecksumAddress(t):t},n.isValidHexAddress=v,n.validateTransaction=function(e){if(!e.from||"string"!=typeof e.from||!v(e.from))throw new Error(`Invalid "from" address: ${e.from} must be a valid string.`);if("0x"===e.to||e.to===undefined){if(!e.data)throw new Error(`Invalid "to" address: ${e.to} must be a valid string.`);delete e.to}else if(e.to!==undefined&&!v(e.to))throw new Error(`Invalid "to" address: ${e.to} must be a valid string.`);if(e.value!==undefined){const t=e.value.toString();if(t.includes("-"))throw new Error(`Invalid "value": ${t} is not a positive number.`);if(t.includes("."))throw new Error(`Invalid "value": ${t} number must be denominated in wei.`);const n=parseInt(e.value,10);if(!(Number.isFinite(n)&&!Number.isNaN(n)&&!isNaN(Number(t))&&Number.isSafeInteger(n)))throw new Error(`Invalid "value": ${t} number must be a valid number.`)}},n.normalizeMessageData=function(e){try{const t=i.stripHexPrefix(e);if(t.match(p))return i.addHexPrefix(t)}catch(e){}return i.bufferToHex(t.from(e,"utf8"))},n.validateSignMessageData=function(e){const{from:t,data:n}=e;if(!t||"string"!=typeof t||!v(t))throw new Error(`Invalid "from" address: ${t} must be a valid string.`);if(!n||"string"!=typeof n)throw new Error(`Invalid message "data": ${n} must be a valid string.`)},n.validateTypedSignMessageDataV1=function(e){if(!e.from||"string"!=typeof e.from||!v(e.from))throw new Error(`Invalid "from" address: ${e.from} must be a valid string.`);if(!e.data||!Array.isArray(e.data))throw new Error(`Invalid message "data": ${e.data} must be a valid array.`);try{u.typedSignatureHash(e.data)}catch(e){throw new Error("Expected EIP712 typed data.")}},n.validateTypedSignMessageDataV3=function(e){if(!e.from||"string"!=typeof e.from||!v(e.from))throw new Error(`Invalid "from" address: ${e.from} must be a valid string.`);if(!e.data||"string"!=typeof e.data)throw new Error(`Invalid message "data": ${e.data} must be a valid array.`);let t;try{t=JSON.parse(e.data)}catch(e){throw new Error("Data must be passed as a valid JSON string.")}if(l.validate(t,u.TYPED_MESSAGE_SCHEMA).errors.length>0)throw new Error("Data must conform to EIP-712 schema. See https://git.io/fNtcx.")},n.validateTokenToWatch=function(e){const{address:t,symbol:n,decimals:r}=e;if(!t||!n||void 0===r)throw o.ethErrors.rpc.invalidParams("Must specify address, symbol, and decimals.");if("string"!=typeof n)throw o.ethErrors.rpc.invalidParams("Invalid symbol: not a string.");if(n.length>11)throw o.ethErrors.rpc.invalidParams(`Invalid symbol "${n}": longer than 11 characters.`);const s=parseInt(r,10);if(isNaN(s)||s>36||s<0)throw o.ethErrors.rpc.invalidParams(`Invalid decimals "${r}": must be 0 <= 36.`);if(!v(t))throw o.ethErrors.rpc.invalidParams(`Invalid address "${t}".`)},n.isSmartContractCode=function(e){return!!e&&("0x"!==e&&"0x0"!==e)},n.successfulFetch=b,n.handleFetch=w,n.timeoutFetch=function(e,t,n=500){return r(this,void 0,void 0,(function*(){return Promise.race([b(e,t),new Promise(((e,t)=>setTimeout((()=>{t(new Error("timeout"))}),n)))])}))},n.normalizeEnsName=function(e){if(e&&"string"==typeof e)try{const t=c.default.normalize(e.trim());if(t.match(/^(([\w\d-]+)\.)*[\w\d-]{7,}\.(eth|test)$/u))return t}catch(e){}return null},n.query=function(e,t,n=[]){return new Promise(((r,s)=>{const i=(e,t)=>{e?s(e):r(t)};"function"==typeof e[t]?e[t](...n,i):e.sendAsync({method:t,params:n},i)}))};n.isEIP1559Transaction=e=>{const t=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);return t(e,"maxFeePerGas")&&t(e,"maxPriorityFeePerGas")};n.convertPriceToDecimal=e=>parseInt(e===undefined?"0x0":e,16);n.getIncreasedPriceHex=(e,t)=>i.addHexPrefix(`${parseInt(""+e*t,10).toString(16)}`);n.getIncreasedPriceFromExisting=(e,t)=>n.getIncreasedPriceHex(n.convertPriceToDecimal(e),t);n.validateGasValues=e=>{Object.keys(e).forEach((t=>{const n=e[t];if("string"!=typeof n||!i.isHexString(n))throw new TypeError(`expected hex string for ${t} but received: ${n}`)}))};n.isFeeMarketEIP1559Values=e=>{var t,n;return(null===(t=e)||void 0===t?void 0:t.maxFeePerGas)!==undefined||(null===(n=e)||void 0===n?void 0:n.maxPriorityFeePerGas)!==undefined};function k(e){if(e.startsWith("ipfs://ipfs/"))return e.replace("ipfs://ipfs/","");if(e.startsWith("ipfs://"))return e.replace("ipfs://","");throw new Error("this method should not be used with non ipfs urls")}function _(e){const t=k(e),n=t.indexOf("/"),r=-1!==n?t.substring(0,n):t,s=-1!==n?t.substring(n):undefined;return{cid:d.CID.parse(r).toV1().toString(),path:s}}function E(e){return e.match(/(^http:\/\/)|(^https:\/\/)/u)?e:`https://${e}`}n.isGasPriceValue=e=>{var t;return(null===(t=e)||void 0===t?void 0:t.gasPrice)!==undefined},n.validateMinimumIncrease=function(e,t){const r=n.convertPriceToDecimal(e),s=n.convertPriceToDecimal(t);if(r>=s)return e;throw new Error(`The proposed value: ${r} should meet or exceed the minimum value: ${s}`)},n.removeIpfsProtocolPrefix=k,n.getIpfsCIDv1AndPath=_,n.addUrlProtocolPrefix=E,n.getFormattedIpfsUrl=function(e,t,n){const{host:r,protocol:s,origin:i}=new URL(E(e));if(n){const{cid:e,path:n}=_(t);return`${s}//${e}.ipfs.${r}${null!=n?n:""}`}return`${i}/ipfs/${k(t)}`},n.isPlainObject=function(e){return Boolean(e)&&"object"==typeof e&&!Array.isArray(e)};n.hasProperty=(e,t)=>Reflect.hasOwnProperty.call(e,t),n.isNonEmptyArray=function(e){return Array.isArray(e)&&e.length>0},n.isValidJson=function(e){try{return h.default(e,JSON.parse(JSON.stringify(e)))}catch(e){return!1}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/controllers",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/controllers/dist/util.js"}],[1405,{"./ObservableStore":1407},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ComposedStore=void 0;const r=e("./ObservableStore");class s extends r.ObservableStore{constructor(e){super({}),this._children=e||{},Object.keys(this._children).forEach((e=>{const t=this._children[e];this._addChild(e,t)}))}_addChild(e,t){const n=t=>{const n=this.getState();n[e]=t,this.putState(n)};t.subscribe(n),n(t.getState())}}n.ComposedStore=s}}},{package:"@metamask/obs-store",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/obs-store/dist/ComposedStore.js"}],[1406,{"./ObservableStore":1407},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.MergedStore=void 0;const r=e("./ObservableStore");class s extends r.ObservableStore{constructor(e=[]){super({}),this._children=e,e.forEach((e=>this._addChild(e))),this._updateWholeState()}_addChild(e){e.subscribe((()=>this._updateWholeState()))}_updateWholeState(){const e=this._children.map((e=>e.getState())),t=Object.assign({},...e);this.putState(t)}}n.MergedStore=s}}},{package:"@metamask/obs-store",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/obs-store/dist/MergedStore.js"}],[1407,{"@metamask/safe-event-emitter":1315},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.ObservableStore=void 0;const s=r(e("@metamask/safe-event-emitter"));class i extends s.default{constructor(e){super(),this._state=e||{}}getState(){return this._getState()}putState(e){this._putState(e),this.emit("update",e)}updateState(e){if(e&&"object"==typeof e){const t=this.getState();this.putState(Object.assign(Object.assign({},t),e))}else this.putState(e)}subscribe(e){this.on("update",e)}unsubscribe(e){this.removeListener("update",e)}_getState(){return this._state}_putState(e){this._state=e}}n.ObservableStore=i}}},{package:"@metamask/obs-store",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/obs-store/dist/ObservableStore.js"}],[1408,{stream:2084},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.storeAsStream=void 0;const r=e("stream");class s extends r.Duplex{constructor(e){super({objectMode:!0}),this.resume(),this.handler=e=>this.push(e),this.obsStore=e,this.obsStore.subscribe(this.handler)}pipe(e,t){const n=super.pipe(e,t);return e.write(this.obsStore.getState()),n}_write(e,t,n){this.obsStore.putState(e),n()}_read(e){return undefined}_destroy(e,t){this.obsStore.unsubscribe(this.handler),super._destroy(e,t)}}n.storeAsStream=function(e){return new s(e)}}}},{package:"@metamask/obs-store",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/obs-store/dist/asStream.js"}],[1409,{"./ComposedStore":1405,"./MergedStore":1406,"./ObservableStore":1407,"./asStream":1408,"./transform":1410},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),s(e("./asStream"),n),s(e("./ComposedStore"),n),s(e("./MergedStore"),n),s(e("./ObservableStore"),n),s(e("./transform"),n)}}},{package:"@metamask/obs-store",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/obs-store/dist/index.js"}],[141,{lodash:5172},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("lodash");const s="2020-08-31";var i={version:60,async migrate(e){const t=(0,r.cloneDeep)(e);t.meta.version=60;const n=function(e){var t;const n=null==e||null===(t=e.NotificationController)||void 0===t?void 0:t.notifications;var i;(0,r.isPlainObject)(n)&&(null===(i=n[2])||void 0===i?void 0:i.date)===s&&delete e.NotificationController.notifications[2];return e}(t.data);return t.data=n,t}};n.default=i}}},{package:"<root>",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/app/scripts/migrations/060.js"}],[1410,{through2:1455},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.storeTransformStream=void 0;const r=e("through2");n.storeTransformStream=function(e){return r.obj(((t,n,r)=>{try{return r(null,e(t)),undefined}catch(e){return r(e),undefined}}))}}}},{package:"@metamask/obs-store",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/@metamask/obs-store/dist/transform.js"}],[1411,{"fast-deep-equal":4293},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});const r=e("fast-deep-equal");r.code='require("ajv/dist/runtime/equal").default',n.default=r}}},{package:"ajv",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/ajv/dist/runtime/equal.js"}],[1412,{},function(){with(this)return function(){"use strict";return function(e,t,n){function r(e){const t=e.length;let n,r=0,s=0;for(;s<t;)r++,n=e.charCodeAt(s++),n>=55296&&n<=56319&&s<t&&(n=e.charCodeAt(s),56320==(64512&n)&&s++);return r}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r,r.code='require("ajv/dist/runtime/ucs2length").default'}}},{package:"ajv",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/ajv/dist/runtime/ucs2length.js"}],[1413,{},function(){with(this)return function(){"use strict";return function(e,t,n){!function(t,n){function r(e,t){if(!e)throw new Error(t||"Assertion failed")}function s(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}function i(e,t,n){if(i.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(n=t,t=10),this._init(e||0,t||10,n||"be"))}var a;"object"==typeof t?t.exports=i:n.BN=i,i.BN=i,i.wordSize=26;try{a=e("buf"+"fer").Buffer}catch(e){}function o(e,t,n){for(var r=0,s=Math.min(e.length,n),i=t;i<s;i++){var a=e.charCodeAt(i)-48;r<<=4,r|=a>=49&&a<=54?a-49+10:a>=17&&a<=22?a-17+10:15&a}return r}function c(e,t,n,r){for(var s=0,i=Math.min(e.length,n),a=t;a<i;a++){var o=e.charCodeAt(a)-48;s*=r,s+=o>=49?o-49+10:o>=17?o-17+10:o}return s}i.isBN=function(e){return e instanceof i||null!==e&&"object"==typeof e&&e.constructor.wordSize===i.wordSize&&Array.isArray(e.words)},i.max=function(e,t){return e.cmp(t)>0?e:t},i.min=function(e,t){return e.cmp(t)<0?e:t},i.prototype._init=function(e,t,n){if("number"==typeof e)return this._initNumber(e,t,n);if("object"==typeof e)return this._initArray(e,t,n);"hex"===t&&(t=16),r(t===(0|t)&&t>=2&&t<=36);var s=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&s++,16===t?this._parseHex(e,s):this._parseBase(e,t,s),"-"===e[0]&&(this.negative=1),this.strip(),"le"===n&&this._initArray(this.toArray(),t,n)},i.prototype._initNumber=function(e,t,n){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(r(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===n&&this._initArray(this.toArray(),t,n)},i.prototype._initArray=function(e,t,n){if(r("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var s=0;s<this.length;s++)this.words[s]=0;var i,a,o=0;if("be"===n)for(s=e.length-1,i=0;s>=0;s-=3)a=e[s]|e[s-1]<<8|e[s-2]<<16,this.words[i]|=a<<o&67108863,this.words[i+1]=a>>>26-o&67108863,(o+=24)>=26&&(o-=26,i++);else if("le"===n)for(s=0,i=0;s<e.length;s+=3)a=e[s]|e[s+1]<<8|e[s+2]<<16,this.words[i]|=a<<o&67108863,this.words[i+1]=a>>>26-o&67108863,(o+=24)>=26&&(o-=26,i++);return this.strip()},i.prototype._parseHex=function(e,t){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var r,s,i=0;for(n=e.length-6,r=0;n>=t;n-=6)s=o(e,n,n+6),this.words[r]|=s<<i&67108863,this.words[r+1]|=s>>>26-i&4194303,(i+=24)>=26&&(i-=26,r++);n+6!==t&&(s=o(e,t,n+6),this.words[r]|=s<<i&67108863,this.words[r+1]|=s>>>26-i&4194303),this.strip()},i.prototype._parseBase=function(e,t,n){this.words=[0],this.length=1;for(var r=0,s=1;s<=67108863;s*=t)r++;r--,s=s/t|0;for(var i=e.length-n,a=i%r,o=Math.min(i,i-a)+n,u=0,l=n;l<o;l+=r)u=c(e,l,l+r,t),this.imuln(s),this.words[0]+u<67108864?this.words[0]+=u:this._iaddn(u);if(0!==a){var d=1;for(u=c(e,l,e.length,t),l=0;l<a;l++)d*=t;this.imuln(d),this.words[0]+u<67108864?this.words[0]+=u:this._iaddn(u)}},i.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},i.prototype.clone=function(){var e=new i(null);return this.copy(e),e},i.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},i.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},i.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},i.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var u=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],l=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],d=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function h(e,t,n){n.negative=t.negative^e.negative;var r=e.length+t.length|0;n.length=r,r=r-1|0;var s=0|e.words[0],i=0|t.words[0],a=s*i,o=67108863&a,c=a/67108864|0;n.words[0]=o;for(var u=1;u<r;u++){for(var l=c>>>26,d=67108863&c,h=Math.min(u,t.length-1),f=Math.max(0,u-e.length+1);f<=h;f++){var p=u-f|0;l+=(a=(s=0|e.words[p])*(i=0|t.words[f])+d)/67108864|0,d=67108863&a}n.words[u]=0|d,c=0|l}return 0!==c?n.words[u]=0|c:n.length--,n.strip()}i.prototype.toString=function(e,t){var n;if(t=0|t||1,16===(e=e||10)||"hex"===e){n="";for(var s=0,i=0,a=0;a<this.length;a++){var o=this.words[a],c=(16777215&(o<<s|i)).toString(16);n=0!==(i=o>>>24-s&16777215)||a!==this.length-1?u[6-c.length]+c+n:c+n,(s+=2)>=26&&(s-=26,a--)}for(0!==i&&(n=i.toString(16)+n);n.length%t!=0;)n="0"+n;return 0!==this.negative&&(n="-"+n),n}if(e===(0|e)&&e>=2&&e<=36){var h=l[e],f=d[e];n="";var p=this.clone();for(p.negative=0;!p.isZero();){var m=p.modn(f).toString(e);n=(p=p.idivn(f)).isZero()?m+n:u[h-m.length]+m+n}for(this.isZero()&&(n="0"+n);n.length%t!=0;)n="0"+n;return 0!==this.negative&&(n="-"+n),n}r(!1,"Base should be between 2 and 36")},i.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&r(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},i.prototype.toJSON=function(){return this.toString(16)},i.prototype.toBuffer=function(e,t){return r(void 0!==a),this.toArrayLike(a,e,t)},i.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},i.prototype.toArrayLike=function(e,t,n){var s=this.byteLength(),i=n||Math.max(1,s);r(s<=i,"byte array longer than desired length"),r(i>0,"Requested array length <= 0"),this.strip();var a,o,c="le"===t,u=new e(i),l=this.clone();if(c){for(o=0;!l.isZero();o++)a=l.andln(255),l.iushrn(8),u[o]=a;for(;o<i;o++)u[o]=0}else{for(o=0;o<i-s;o++)u[o]=0;for(o=0;!l.isZero();o++)a=l.andln(255),l.iushrn(8),u[i-o-1]=a}return u},Math.clz32?i.prototype._countBits=function(e){return 32-Math.clz32(e)}:i.prototype._countBits=function(e){var t=e,n=0;return t>=4096&&(n+=13,t>>>=13),t>=64&&(n+=7,t>>>=7),t>=8&&(n+=4,t>>>=4),t>=2&&(n+=2,t>>>=2),n+t},i.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,n=0;return 0==(8191&t)&&(n+=13,t>>>=13),0==(127&t)&&(n+=7,t>>>=7),0==(15&t)&&(n+=4,t>>>=4),0==(3&t)&&(n+=2,t>>>=2),0==(1&t)&&n++,n},i.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},i.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var n=this._zeroBits(this.words[t]);if(e+=n,26!==n)break}return e},i.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},i.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},i.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},i.prototype.isNeg=function(){return 0!==this.negative},i.prototype.neg=function(){return this.clone().ineg()},i.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},i.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},i.prototype.ior=function(e){return r(0==(this.negative|e.negative)),this.iuor(e)},i.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},i.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},i.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var n=0;n<t.length;n++)this.words[n]=this.words[n]&e.words[n];return this.length=t.length,this.strip()},i.prototype.iand=function(e){return r(0==(this.negative|e.negative)),this.iuand(e)},i.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},i.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},i.prototype.iuxor=function(e){var t,n;this.length>e.length?(t=this,n=e):(t=e,n=this);for(var r=0;r<n.length;r++)this.words[r]=t.words[r]^n.words[r];if(this!==t)for(;r<t.length;r++)this.words[r]=t.words[r];return this.length=t.length,this.strip()},i.prototype.ixor=function(e){return r(0==(this.negative|e.negative)),this.iuxor(e)},i.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},i.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},i.prototype.inotn=function(e){r("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),n=e%26;this._expand(t),n>0&&t--;for(var s=0;s<t;s++)this.words[s]=67108863&~this.words[s];return n>0&&(this.words[s]=~this.words[s]&67108863>>26-n),this.strip()},i.prototype.notn=function(e){return this.clone().inotn(e)},i.prototype.setn=function(e,t){r("number"==typeof e&&e>=0);var n=e/26|0,s=e%26;return this._expand(n+1),this.words[n]=t?this.words[n]|1<<s:this.words[n]&~(1<<s),this.strip()},i.prototype.iadd=function(e){var t,n,r;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(n=this,r=e):(n=e,r=this);for(var s=0,i=0;i<r.length;i++)t=(0|n.words[i])+(0|r.words[i])+s,this.words[i]=67108863&t,s=t>>>26;for(;0!==s&&i<n.length;i++)t=(0|n.words[i])+s,this.words[i]=67108863&t,s=t>>>26;if(this.length=n.length,0!==s)this.words[this.length]=s,this.length++;else if(n!==this)for(;i<n.length;i++)this.words[i]=n.words[i];return this},i.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},i.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var n,r,s=this.cmp(e);if(0===s)return this.negative=0,this.length=1,this.words[0]=0,this;s>0?(n=this,r=e):(n=e,r=this);for(var i=0,a=0;a<r.length;a++)i=(t=(0|n.words[a])-(0|r.words[a])+i)>>26,this.words[a]=67108863&t;for(;0!==i&&a<n.length;a++)i=(t=(0|n.words[a])+i)>>26,this.words[a]=67108863&t;if(0===i&&a<n.length&&n!==this)for(;a<n.length;a++)this.words[a]=n.words[a];return this.length=Math.max(this.length,a),n!==this&&(this.negative=1),this.strip()},i.prototype.sub=function(e){return this.clone().isub(e)};var f=function(e,t,n){var r,s,i,a=e.words,o=t.words,c=n.words,u=0,l=0|a[0],d=8191&l,h=l>>>13,f=0|a[1],p=8191&f,m=f>>>13,g=0|a[2],y=8191&g,v=g>>>13,b=0|a[3],w=8191&b,k=b>>>13,_=0|a[4],E=8191&_,S=_>>>13,P=0|a[5],x=8191&P,M=P>>>13,j=0|a[6],C=8191&j,T=j>>>13,A=0|a[7],O=8191&A,I=A>>>13,R=0|a[8],N=8191&R,D=R>>>13,B=0|a[9],L=8191&B,U=B>>>13,F=0|o[0],q=8191&F,$=F>>>13,H=0|o[1],G=8191&H,K=H>>>13,V=0|o[2],z=8191&V,W=V>>>13,J=0|o[3],Z=8191&J,Y=J>>>13,Q=0|o[4],X=8191&Q,ee=Q>>>13,te=0|o[5],ne=8191&te,re=te>>>13,se=0|o[6],ie=8191&se,ae=se>>>13,oe=0|o[7],ce=8191&oe,ue=oe>>>13,le=0|o[8],de=8191&le,he=le>>>13,fe=0|o[9],pe=8191&fe,me=fe>>>13;n.negative=e.negative^t.negative,n.length=19;var ge=(u+(r=Math.imul(d,q))|0)+((8191&(s=(s=Math.imul(d,$))+Math.imul(h,q)|0))<<13)|0;u=((i=Math.imul(h,$))+(s>>>13)|0)+(ge>>>26)|0,ge&=67108863,r=Math.imul(p,q),s=(s=Math.imul(p,$))+Math.imul(m,q)|0,i=Math.imul(m,$);var ye=(u+(r=r+Math.imul(d,G)|0)|0)+((8191&(s=(s=s+Math.imul(d,K)|0)+Math.imul(h,G)|0))<<13)|0;u=((i=i+Math.imul(h,K)|0)+(s>>>13)|0)+(ye>>>26)|0,ye&=67108863,r=Math.imul(y,q),s=(s=Math.imul(y,$))+Math.imul(v,q)|0,i=Math.imul(v,$),r=r+Math.imul(p,G)|0,s=(s=s+Math.imul(p,K)|0)+Math.imul(m,G)|0,i=i+Math.imul(m,K)|0;var ve=(u+(r=r+Math.imul(d,z)|0)|0)+((8191&(s=(s=s+Math.imul(d,W)|0)+Math.imul(h,z)|0))<<13)|0;u=((i=i+Math.imul(h,W)|0)+(s>>>13)|0)+(ve>>>26)|0,ve&=67108863,r=Math.imul(w,q),s=(s=Math.imul(w,$))+Math.imul(k,q)|0,i=Math.imul(k,$),r=r+Math.imul(y,G)|0,s=(s=s+Math.imul(y,K)|0)+Math.imul(v,G)|0,i=i+Math.imul(v,K)|0,r=r+Math.imul(p,z)|0,s=(s=s+Math.imul(p,W)|0)+Math.imul(m,z)|0,i=i+Math.imul(m,W)|0;var be=(u+(r=r+Math.imul(d,Z)|0)|0)+((8191&(s=(s=s+Math.imul(d,Y)|0)+Math.imul(h,Z)|0))<<13)|0;u=((i=i+Math.imul(h,Y)|0)+(s>>>13)|0)+(be>>>26)|0,be&=67108863,r=Math.imul(E,q),s=(s=Math.imul(E,$))+Math.imul(S,q)|0,i=Math.imul(S,$),r=r+Math.imul(w,G)|0,s=(s=s+Math.imul(w,K)|0)+Math.imul(k,G)|0,i=i+Math.imul(k,K)|0,r=r+Math.imul(y,z)|0,s=(s=s+Math.imul(y,W)|0)+Math.imul(v,z)|0,i=i+Math.imul(v,W)|0,r=r+Math.imul(p,Z)|0,s=(s=s+Math.imul(p,Y)|0)+Math.imul(m,Z)|0,i=i+Math.imul(m,Y)|0;var we=(u+(r=r+Math.imul(d,X)|0)|0)+((8191&(s=(s=s+Math.imul(d,ee)|0)+Math.imul(h,X)|0))<<13)|0;u=((i=i+Math.imul(h,ee)|0)+(s>>>13)|0)+(we>>>26)|0,we&=67108863,r=Math.imul(x,q),s=(s=Math.imul(x,$))+Math.imul(M,q)|0,i=Math.imul(M,$),r=r+Math.imul(E,G)|0,s=(s=s+Math.imul(E,K)|0)+Math.imul(S,G)|0,i=i+Math.imul(S,K)|0,r=r+Math.imul(w,z)|0,s=(s=s+Math.imul(w,W)|0)+Math.imul(k,z)|0,i=i+Math.imul(k,W)|0,r=r+Math.imul(y,Z)|0,s=(s=s+Math.imul(y,Y)|0)+Math.imul(v,Z)|0,i=i+Math.imul(v,Y)|0,r=r+Math.imul(p,X)|0,s=(s=s+Math.imul(p,ee)|0)+Math.imul(m,X)|0,i=i+Math.imul(m,ee)|0;var ke=(u+(r=r+Math.imul(d,ne)|0)|0)+((8191&(s=(s=s+Math.imul(d,re)|0)+Math.imul(h,ne)|0))<<13)|0;u=((i=i+Math.imul(h,re)|0)+(s>>>13)|0)+(ke>>>26)|0,ke&=67108863,r=Math.imul(C,q),s=(s=Math.imul(C,$))+Math.imul(T,q)|0,i=Math.imul(T,$),r=r+Math.imul(x,G)|0,s=(s=s+Math.imul(x,K)|0)+Math.imul(M,G)|0,i=i+Math.imul(M,K)|0,r=r+Math.imul(E,z)|0,s=(s=s+Math.imul(E,W)|0)+Math.imul(S,z)|0,i=i+Math.imul(S,W)|0,r=r+Math.imul(w,Z)|0,s=(s=s+Math.imul(w,Y)|0)+Math.imul(k,Z)|0,i=i+Math.imul(k,Y)|0,r=r+Math.imul(y,X)|0,s=(s=s+Math.imul(y,ee)|0)+Math.imul(v,X)|0,i=i+Math.imul(v,ee)|0,r=r+Math.imul(p,ne)|0,s=(s=s+Math.imul(p,re)|0)+Math.imul(m,ne)|0,i=i+Math.imul(m,re)|0;var _e=(u+(r=r+Math.imul(d,ie)|0)|0)+((8191&(s=(s=s+Math.imul(d,ae)|0)+Math.imul(h,ie)|0))<<13)|0;u=((i=i+Math.imul(h,ae)|0)+(s>>>13)|0)+(_e>>>26)|0,_e&=67108863,r=Math.imul(O,q),s=(s=Math.imul(O,$))+Math.imul(I,q)|0,i=Math.imul(I,$),r=r+Math.imul(C,G)|0,s=(s=s+Math.imul(C,K)|0)+Math.imul(T,G)|0,i=i+Math.imul(T,K)|0,r=r+Math.imul(x,z)|0,s=(s=s+Math.imul(x,W)|0)+Math.imul(M,z)|0,i=i+Math.imul(M,W)|0,r=r+Math.imul(E,Z)|0,s=(s=s+Math.imul(E,Y)|0)+Math.imul(S,Z)|0,i=i+Math.imul(S,Y)|0,r=r+Math.imul(w,X)|0,s=(s=s+Math.imul(w,ee)|0)+Math.imul(k,X)|0,i=i+Math.imul(k,ee)|0,r=r+Math.imul(y,ne)|0,s=(s=s+Math.imul(y,re)|0)+Math.imul(v,ne)|0,i=i+Math.imul(v,re)|0,r=r+Math.imul(p,ie)|0,s=(s=s+Math.imul(p,ae)|0)+Math.imul(m,ie)|0,i=i+Math.imul(m,ae)|0;var Ee=(u+(r=r+Math.imul(d,ce)|0)|0)+((8191&(s=(s=s+Math.imul(d,ue)|0)+Math.imul(h,ce)|0))<<13)|0;u=((i=i+Math.imul(h,ue)|0)+(s>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,r=Math.imul(N,q),s=(s=Math.imul(N,$))+Math.imul(D,q)|0,i=Math.imul(D,$),r=r+Math.imul(O,G)|0,s=(s=s+Math.imul(O,K)|0)+Math.imul(I,G)|0,i=i+Math.imul(I,K)|0,r=r+Math.imul(C,z)|0,s=(s=s+Math.imul(C,W)|0)+Math.imul(T,z)|0,i=i+Math.imul(T,W)|0,r=r+Math.imul(x,Z)|0,s=(s=s+Math.imul(x,Y)|0)+Math.imul(M,Z)|0,i=i+Math.imul(M,Y)|0,r=r+Math.imul(E,X)|0,s=(s=s+Math.imul(E,ee)|0)+Math.imul(S,X)|0,i=i+Math.imul(S,ee)|0,r=r+Math.imul(w,ne)|0,s=(s=s+Math.imul(w,re)|0)+Math.imul(k,ne)|0,i=i+Math.imul(k,re)|0,r=r+Math.imul(y,ie)|0,s=(s=s+Math.imul(y,ae)|0)+Math.imul(v,ie)|0,i=i+Math.imul(v,ae)|0,r=r+Math.imul(p,ce)|0,s=(s=s+Math.imul(p,ue)|0)+Math.imul(m,ce)|0,i=i+Math.imul(m,ue)|0;var Se=(u+(r=r+Math.imul(d,de)|0)|0)+((8191&(s=(s=s+Math.imul(d,he)|0)+Math.imul(h,de)|0))<<13)|0;u=((i=i+Math.imul(h,he)|0)+(s>>>13)|0)+(Se>>>26)|0,Se&=67108863,r=Math.imul(L,q),s=(s=Math.imul(L,$))+Math.imul(U,q)|0,i=Math.imul(U,$),r=r+Math.imul(N,G)|0,s=(s=s+Math.imul(N,K)|0)+Math.imul(D,G)|0,i=i+Math.imul(D,K)|0,r=r+Math.imul(O,z)|0,s=(s=s+Math.imul(O,W)|0)+Math.imul(I,z)|0,i=i+Math.imul(I,W)|0,r=r+Math.imul(C,Z)|0,s=(s=s+Math.imul(C,Y)|0)+Math.imul(T,Z)|0,i=i+Math.imul(T,Y)|0,r=r+Math.imul(x,X)|0,s=(s=s+Math.imul(x,ee)|0)+Math.imul(M,X)|0,i=i+Math.imul(M,ee)|0,r=r+Math.imul(E,ne)|0,s=(s=s+Math.imul(E,re)|0)+Math.imul(S,ne)|0,i=i+Math.imul(S,re)|0,r=r+Math.imul(w,ie)|0,s=(s=s+Math.imul(w,ae)|0)+Math.imul(k,ie)|0,i=i+Math.imul(k,ae)|0,r=r+Math.imul(y,ce)|0,s=(s=s+Math.imul(y,ue)|0)+Math.imul(v,ce)|0,i=i+Math.imul(v,ue)|0,r=r+Math.imul(p,de)|0,s=(s=s+Math.imul(p,he)|0)+Math.imul(m,de)|0,i=i+Math.imul(m,he)|0;var Pe=(u+(r=r+Math.imul(d,pe)|0)|0)+((8191&(s=(s=s+Math.imul(d,me)|0)+Math.imul(h,pe)|0))<<13)|0;u=((i=i+Math.imul(h,me)|0)+(s>>>13)|0)+(Pe>>>26)|0,Pe&=67108863,r=Math.imul(L,G),s=(s=Math.imul(L,K))+Math.imul(U,G)|0,i=Math.imul(U,K),r=r+Math.imul(N,z)|0,s=(s=s+Math.imul(N,W)|0)+Math.imul(D,z)|0,i=i+Math.imul(D,W)|0,r=r+Math.imul(O,Z)|0,s=(s=s+Math.imul(O,Y)|0)+Math.imul(I,Z)|0,i=i+Math.imul(I,Y)|0,r=r+Math.imul(C,X)|0,s=(s=s+Math.imul(C,ee)|0)+Math.imul(T,X)|0,i=i+Math.imul(T,ee)|0,r=r+Math.imul(x,ne)|0,s=(s=s+Math.imul(x,re)|0)+Math.imul(M,ne)|0,i=i+Math.imul(M,re)|0,r=r+Math.imul(E,ie)|0,s=(s=s+Math.imul(E,ae)|0)+Math.imul(S,ie)|0,i=i+Math.imul(S,ae)|0,r=r+Math.imul(w,ce)|0,s=(s=s+Math.imul(w,ue)|0)+Math.imul(k,ce)|0,i=i+Math.imul(k,ue)|0,r=r+Math.imul(y,de)|0,s=(s=s+Math.imul(y,he)|0)+Math.imul(v,de)|0,i=i+Math.imul(v,he)|0;var xe=(u+(r=r+Math.imul(p,pe)|0)|0)+((8191&(s=(s=s+Math.imul(p,me)|0)+Math.imul(m,pe)|0))<<13)|0;u=((i=i+Math.imul(m,me)|0)+(s>>>13)|0)+(xe>>>26)|0,xe&=67108863,r=Math.imul(L,z),s=(s=Math.imul(L,W))+Math.imul(U,z)|0,i=Math.imul(U,W),r=r+Math.imul(N,Z)|0,s=(s=s+Math.imul(N,Y)|0)+Math.imul(D,Z)|0,i=i+Math.imul(D,Y)|0,r=r+Math.imul(O,X)|0,s=(s=s+Math.imul(O,ee)|0)+Math.imul(I,X)|0,i=i+Math.imul(I,ee)|0,r=r+Math.imul(C,ne)|0,s=(s=s+Math.imul(C,re)|0)+Math.imul(T,ne)|0,i=i+Math.imul(T,re)|0,r=r+Math.imul(x,ie)|0,s=(s=s+Math.imul(x,ae)|0)+Math.imul(M,ie)|0,i=i+Math.imul(M,ae)|0,r=r+Math.imul(E,ce)|0,s=(s=s+Math.imul(E,ue)|0)+Math.imul(S,ce)|0,i=i+Math.imul(S,ue)|0,r=r+Math.imul(w,de)|0,s=(s=s+Math.imul(w,he)|0)+Math.imul(k,de)|0,i=i+Math.imul(k,he)|0;var Me=(u+(r=r+Math.imul(y,pe)|0)|0)+((8191&(s=(s=s+Math.imul(y,me)|0)+Math.imul(v,pe)|0))<<13)|0;u=((i=i+Math.imul(v,me)|0)+(s>>>13)|0)+(Me>>>26)|0,Me&=67108863,r=Math.imul(L,Z),s=(s=Math.imul(L,Y))+Math.imul(U,Z)|0,i=Math.imul(U,Y),r=r+Math.imul(N,X)|0,s=(s=s+Math.imul(N,ee)|0)+Math.imul(D,X)|0,i=i+Math.imul(D,ee)|0,r=r+Math.imul(O,ne)|0,s=(s=s+Math.imul(O,re)|0)+Math.imul(I,ne)|0,i=i+Math.imul(I,re)|0,r=r+Math.imul(C,ie)|0,s=(s=s+Math.imul(C,ae)|0)+Math.imul(T,ie)|0,i=i+Math.imul(T,ae)|0,r=r+Math.imul(x,ce)|0,s=(s=s+Math.imul(x,ue)|0)+Math.imul(M,ce)|0,i=i+Math.imul(M,ue)|0,r=r+Math.imul(E,de)|0,s=(s=s+Math.imul(E,he)|0)+Math.imul(S,de)|0,i=i+Math.imul(S,he)|0;var je=(u+(r=r+Math.imul(w,pe)|0)|0)+((8191&(s=(s=s+Math.imul(w,me)|0)+Math.imul(k,pe)|0))<<13)|0;u=((i=i+Math.imul(k,me)|0)+(s>>>13)|0)+(je>>>26)|0,je&=67108863,r=Math.imul(L,X),s=(s=Math.imul(L,ee))+Math.imul(U,X)|0,i=Math.imul(U,ee),r=r+Math.imul(N,ne)|0,s=(s=s+Math.imul(N,re)|0)+Math.imul(D,ne)|0,i=i+Math.imul(D,re)|0,r=r+Math.imul(O,ie)|0,s=(s=s+Math.imul(O,ae)|0)+Math.imul(I,ie)|0,i=i+Math.imul(I,ae)|0,r=r+Math.imul(C,ce)|0,s=(s=s+Math.imul(C,ue)|0)+Math.imul(T,ce)|0,i=i+Math.imul(T,ue)|0,r=r+Math.imul(x,de)|0,s=(s=s+Math.imul(x,he)|0)+Math.imul(M,de)|0,i=i+Math.imul(M,he)|0;var Ce=(u+(r=r+Math.imul(E,pe)|0)|0)+((8191&(s=(s=s+Math.imul(E,me)|0)+Math.imul(S,pe)|0))<<13)|0;u=((i=i+Math.imul(S,me)|0)+(s>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,r=Math.imul(L,ne),s=(s=Math.imul(L,re))+Math.imul(U,ne)|0,i=Math.imul(U,re),r=r+Math.imul(N,ie)|0,s=(s=s+Math.imul(N,ae)|0)+Math.imul(D,ie)|0,i=i+Math.imul(D,ae)|0,r=r+Math.imul(O,ce)|0,s=(s=s+Math.imul(O,ue)|0)+Math.imul(I,ce)|0,i=i+Math.imul(I,ue)|0,r=r+Math.imul(C,de)|0,s=(s=s+Math.imul(C,he)|0)+Math.imul(T,de)|0,i=i+Math.imul(T,he)|0;var Te=(u+(r=r+Math.imul(x,pe)|0)|0)+((8191&(s=(s=s+Math.imul(x,me)|0)+Math.imul(M,pe)|0))<<13)|0;u=((i=i+Math.imul(M,me)|0)+(s>>>13)|0)+(Te>>>26)|0,Te&=67108863,r=Math.imul(L,ie),s=(s=Math.imul(L,ae))+Math.imul(U,ie)|0,i=Math.imul(U,ae),r=r+Math.imul(N,ce)|0,s=(s=s+Math.imul(N,ue)|0)+Math.imul(D,ce)|0,i=i+Math.imul(D,ue)|0,r=r+Math.imul(O,de)|0,s=(s=s+Math.imul(O,he)|0)+Math.imul(I,de)|0,i=i+Math.imul(I,he)|0;var Ae=(u+(r=r+Math.imul(C,pe)|0)|0)+((8191&(s=(s=s+Math.imul(C,me)|0)+Math.imul(T,pe)|0))<<13)|0;u=((i=i+Math.imul(T,me)|0)+(s>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,r=Math.imul(L,ce),s=(s=Math.imul(L,ue))+Math.imul(U,ce)|0,i=Math.imul(U,ue),r=r+Math.imul(N,de)|0,s=(s=s+Math.imul(N,he)|0)+Math.imul(D,de)|0,i=i+Math.imul(D,he)|0;var Oe=(u+(r=r+Math.imul(O,pe)|0)|0)+((8191&(s=(s=s+Math.imul(O,me)|0)+Math.imul(I,pe)|0))<<13)|0;u=((i=i+Math.imul(I,me)|0)+(s>>>13)|0)+(Oe>>>26)|0,Oe&=67108863,r=Math.imul(L,de),s=(s=Math.imul(L,he))+Math.imul(U,de)|0,i=Math.imul(U,he);var Ie=(u+(r=r+Math.imul(N,pe)|0)|0)+((8191&(s=(s=s+Math.imul(N,me)|0)+Math.imul(D,pe)|0))<<13)|0;u=((i=i+Math.imul(D,me)|0)+(s>>>13)|0)+(Ie>>>26)|0,Ie&=67108863;var Re=(u+(r=Math.imul(L,pe))|0)+((8191&(s=(s=Math.imul(L,me))+Math.imul(U,pe)|0))<<13)|0;return u=((i=Math.imul(U,me))+(s>>>13)|0)+(Re>>>26)|0,Re&=67108863,c[0]=ge,c[1]=ye,c[2]=ve,c[3]=be,c[4]=we,c[5]=ke,c[6]=_e,c[7]=Ee,c[8]=Se,c[9]=Pe,c[10]=xe,c[11]=Me,c[12]=je,c[13]=Ce,c[14]=Te,c[15]=Ae,c[16]=Oe,c[17]=Ie,c[18]=Re,0!==u&&(c[19]=u,n.length++),n};function p(e,t,n){return(new m).mulp(e,t,n)}function m(e,t){this.x=e,this.y=t}Math.imul||(f=h),i.prototype.mulTo=function(e,t){var n,r=this.length+e.length;return n=10===this.length&&10===e.length?f(this,e,t):r<63?h(this,e,t):r<1024?function(e,t,n){n.negative=t.negative^e.negative,n.length=e.length+t.length;for(var r=0,s=0,i=0;i<n.length-1;i++){var a=s;s=0;for(var o=67108863&r,c=Math.min(i,t.length-1),u=Math.max(0,i-e.length+1);u<=c;u++){var l=i-u,d=(0|e.words[l])*(0|t.words[u]),h=67108863&d;o=67108863&(h=h+o|0),s+=(a=(a=a+(d/67108864|0)|0)+(h>>>26)|0)>>>26,a&=67108863}n.words[i]=o,r=a,a=s}return 0!==r?n.words[i]=r:n.length--,n.strip()}(this,e,t):p(this,e,t),n},m.prototype.makeRBT=function(e){for(var t=new Array(e),n=i.prototype._countBits(e)-1,r=0;r<e;r++)t[r]=this.revBin(r,n,e);return t},m.prototype.revBin=function(e,t,n){if(0===e||e===n-1)return e;for(var r=0,s=0;s<t;s++)r|=(1&e)<<t-s-1,e>>=1;return r},m.prototype.permute=function(e,t,n,r,s,i){for(var a=0;a<i;a++)r[a]=t[e[a]],s[a]=n[e[a]]},m.prototype.transform=function(e,t,n,r,s,i){this.permute(i,e,t,n,r,s);for(var a=1;a<s;a<<=1)for(var o=a<<1,c=Math.cos(2*Math.PI/o),u=Math.sin(2*Math.PI/o),l=0;l<s;l+=o)for(var d=c,h=u,f=0;f<a;f++){var p=n[l+f],m=r[l+f],g=n[l+f+a],y=r[l+f+a],v=d*g-h*y;y=d*y+h*g,g=v,n[l+f]=p+g,r[l+f]=m+y,n[l+f+a]=p-g,r[l+f+a]=m-y,f!==o&&(v=c*d-u*h,h=c*h+u*d,d=v)}},m.prototype.guessLen13b=function(e,t){var n=1|Math.max(t,e),r=1&n,s=0;for(n=n/2|0;n;n>>>=1)s++;return 1<<s+1+r},m.prototype.conjugate=function(e,t,n){if(!(n<=1))for(var r=0;r<n/2;r++){var s=e[r];e[r]=e[n-r-1],e[n-r-1]=s,s=t[r],t[r]=-t[n-r-1],t[n-r-1]=-s}},m.prototype.normalize13b=function(e,t){for(var n=0,r=0;r<t/2;r++){var s=8192*Math.round(e[2*r+1]/t)+Math.round(e[2*r]/t)+n;e[r]=67108863&s,n=s<67108864?0:s/67108864|0}return e},m.prototype.convert13b=function(e,t,n,s){for(var i=0,a=0;a<t;a++)i+=0|e[a],n[2*a]=8191&i,i>>>=13,n[2*a+1]=8191&i,i>>>=13;for(a=2*t;a<s;++a)n[a]=0;r(0===i),r(0==(-8192&i))},m.prototype.stub=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=0;return t},m.prototype.mulp=function(e,t,n){var r=2*this.guessLen13b(e.length,t.length),s=this.makeRBT(r),i=this.stub(r),a=new Array(r),o=new Array(r),c=new Array(r),u=new Array(r),l=new Array(r),d=new Array(r),h=n.words;h.length=r,this.convert13b(e.words,e.length,a,r),this.convert13b(t.words,t.length,u,r),this.transform(a,i,o,c,r,s),this.transform(u,i,l,d,r,s);for(var f=0;f<r;f++){var p=o[f]*l[f]-c[f]*d[f];c[f]=o[f]*d[f]+c[f]*l[f],o[f]=p}return this.conjugate(o,c,r),this.transform(o,c,h,i,r,s),this.conjugate(h,i,r),this.normalize13b(h,r),n.negative=e.negative^t.negative,n.length=e.length+t.length,n.strip()},i.prototype.mul=function(e){var t=new i(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},i.prototype.mulf=function(e){var t=new i(null);return t.words=new Array(this.length+e.length),p(this,e,t)},i.prototype.imul=function(e){return this.clone().mulTo(e,this)},i.prototype.imuln=function(e){r("number"==typeof e),r(e<67108864);for(var t=0,n=0;n<this.length;n++){var s=(0|this.words[n])*e,i=(67108863&s)+(67108863&t);t>>=26,t+=s/67108864|0,t+=i>>>26,this.words[n]=67108863&i}return 0!==t&&(this.words[n]=t,this.length++),this},i.prototype.muln=function(e){return this.clone().imuln(e)},i.prototype.sqr=function(){return this.mul(this)},i.prototype.isqr=function(){return this.imul(this.clone())},i.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),n=0;n<t.length;n++){var r=n/26|0,s=n%26;t[n]=(e.words[r]&1<<s)>>>s}return t}(e);if(0===t.length)return new i(1);for(var n=this,r=0;r<t.length&&0===t[r];r++,n=n.sqr());if(++r<t.length)for(var s=n.sqr();r<t.length;r++,s=s.sqr())0!==t[r]&&(n=n.mul(s));return n},i.prototype.iushln=function(e){r("number"==typeof e&&e>=0);var t,n=e%26,s=(e-n)/26,i=67108863>>>26-n<<26-n;if(0!==n){var a=0;for(t=0;t<this.length;t++){var o=this.words[t]&i,c=(0|this.words[t])-o<<n;this.words[t]=c|a,a=o>>>26-n}a&&(this.words[t]=a,this.length++)}if(0!==s){for(t=this.length-1;t>=0;t--)this.words[t+s]=this.words[t];for(t=0;t<s;t++)this.words[t]=0;this.length+=s}return this.strip()},i.prototype.ishln=function(e){return r(0===this.negative),this.iushln(e)},i.prototype.iushrn=function(e,t,n){var s;r("number"==typeof e&&e>=0),s=t?(t-t%26)/26:0;var i=e%26,a=Math.min((e-i)/26,this.length),o=67108863^67108863>>>i<<i,c=n;if(s-=a,s=Math.max(0,s),c){for(var u=0;u<a;u++)c.words[u]=this.words[u];c.length=a}if(0===a);else if(this.length>a)for(this.length-=a,u=0;u<this.length;u++)this.words[u]=this.words[u+a];else this.words[0]=0,this.length=1;var l=0;for(u=this.length-1;u>=0&&(0!==l||u>=s);u--){var d=0|this.words[u];this.words[u]=l<<26-i|d>>>i,l=d&o}return c&&0!==l&&(c.words[c.length++]=l),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},i.prototype.ishrn=function(e,t,n){return r(0===this.negative),this.iushrn(e,t,n)},i.prototype.shln=function(e){return this.clone().ishln(e)},i.prototype.ushln=function(e){return this.clone().iushln(e)},i.prototype.shrn=function(e){return this.clone().ishrn(e)},i.prototype.ushrn=function(e){return this.clone().iushrn(e)},i.prototype.testn=function(e){r("number"==typeof e&&e>=0);var t=e%26,n=(e-t)/26,s=1<<t;return!(this.length<=n)&&!!(this.words[n]&s)},i.prototype.imaskn=function(e){r("number"==typeof e&&e>=0);var t=e%26,n=(e-t)/26;if(r(0===this.negative,"imaskn works only with positive numbers"),this.length<=n)return this;if(0!==t&&n++,this.length=Math.min(n,this.length),0!==t){var s=67108863^67108863>>>t<<t;this.words[this.length-1]&=s}return this.strip()},i.prototype.maskn=function(e){return this.clone().imaskn(e)},i.prototype.iaddn=function(e){return r("number"==typeof e),r(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},i.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},i.prototype.isubn=function(e){if(r("number"==typeof e),r(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.strip()},i.prototype.addn=function(e){return this.clone().iaddn(e)},i.prototype.subn=function(e){return this.clone().isubn(e)},i.prototype.iabs=function(){return this.negative=0,this},i.prototype.abs=function(){return this.clone().iabs()},i.prototype._ishlnsubmul=function(e,t,n){var s,i,a=e.length+n;this._expand(a);var o=0;for(s=0;s<e.length;s++){i=(0|this.words[s+n])+o;var c=(0|e.words[s])*t;o=((i-=67108863&c)>>26)-(c/67108864|0),this.words[s+n]=67108863&i}for(;s<this.length-n;s++)o=(i=(0|this.words[s+n])+o)>>26,this.words[s+n]=67108863&i;if(0===o)return this.strip();for(r(-1===o),o=0,s=0;s<this.length;s++)o=(i=-(0|this.words[s])+o)>>26,this.words[s]=67108863&i;return this.negative=1,this.strip()},i.prototype._wordDiv=function(e,t){var n=(this.length,e.length),r=this.clone(),s=e,a=0|s.words[s.length-1];0!==(n=26-this._countBits(a))&&(s=s.ushln(n),r.iushln(n),a=0|s.words[s.length-1]);var o,c=r.length-s.length;if("mod"!==t){(o=new i(null)).length=c+1,o.words=new Array(o.length);for(var u=0;u<o.length;u++)o.words[u]=0}var l=r.clone()._ishlnsubmul(s,1,c);0===l.negative&&(r=l,o&&(o.words[c]=1));for(var d=c-1;d>=0;d--){var h=67108864*(0|r.words[s.length+d])+(0|r.words[s.length+d-1]);for(h=Math.min(h/a|0,67108863),r._ishlnsubmul(s,h,d);0!==r.negative;)h--,r.negative=0,r._ishlnsubmul(s,1,d),r.isZero()||(r.negative^=1);o&&(o.words[d]=h)}return o&&o.strip(),r.strip(),"div"!==t&&0!==n&&r.iushrn(n),{div:o||null,mod:r}},i.prototype.divmod=function(e,t,n){return r(!e.isZero()),this.isZero()?{div:new i(0),mod:new i(0)}:0!==this.negative&&0===e.negative?(o=this.neg().divmod(e,t),"mod"!==t&&(s=o.div.neg()),"div"!==t&&(a=o.mod.neg(),n&&0!==a.negative&&a.iadd(e)),{div:s,mod:a}):0===this.negative&&0!==e.negative?(o=this.divmod(e.neg(),t),"mod"!==t&&(s=o.div.neg()),{div:s,mod:o.mod}):0!=(this.negative&e.negative)?(o=this.neg().divmod(e.neg(),t),"div"!==t&&(a=o.mod.neg(),n&&0!==a.negative&&a.isub(e)),{div:o.div,mod:a}):e.length>this.length||this.cmp(e)<0?{div:new i(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new i(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new i(this.modn(e.words[0]))}:this._wordDiv(e,t);var s,a,o},i.prototype.div=function(e){return this.divmod(e,"div",!1).div},i.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},i.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},i.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var n=0!==t.div.negative?t.mod.isub(e):t.mod,r=e.ushrn(1),s=e.andln(1),i=n.cmp(r);return i<0||1===s&&0===i?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},i.prototype.modn=function(e){r(e<=67108863);for(var t=(1<<26)%e,n=0,s=this.length-1;s>=0;s--)n=(t*n+(0|this.words[s]))%e;return n},i.prototype.idivn=function(e){r(e<=67108863);for(var t=0,n=this.length-1;n>=0;n--){var s=(0|this.words[n])+67108864*t;this.words[n]=s/e|0,t=s%e}return this.strip()},i.prototype.divn=function(e){return this.clone().idivn(e)},i.prototype.egcd=function(e){r(0===e.negative),r(!e.isZero());var t=this,n=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var s=new i(1),a=new i(0),o=new i(0),c=new i(1),u=0;t.isEven()&&n.isEven();)t.iushrn(1),n.iushrn(1),++u;for(var l=n.clone(),d=t.clone();!t.isZero();){for(var h=0,f=1;0==(t.words[0]&f)&&h<26;++h,f<<=1);if(h>0)for(t.iushrn(h);h-- >0;)(s.isOdd()||a.isOdd())&&(s.iadd(l),a.isub(d)),s.iushrn(1),a.iushrn(1);for(var p=0,m=1;0==(n.words[0]&m)&&p<26;++p,m<<=1);if(p>0)for(n.iushrn(p);p-- >0;)(o.isOdd()||c.isOdd())&&(o.iadd(l),c.isub(d)),o.iushrn(1),c.iushrn(1);t.cmp(n)>=0?(t.isub(n),s.isub(o),a.isub(c)):(n.isub(t),o.isub(s),c.isub(a))}return{a:o,b:c,gcd:n.iushln(u)}},i.prototype._invmp=function(e){r(0===e.negative),r(!e.isZero());var t=this,n=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var s,a=new i(1),o=new i(0),c=n.clone();t.cmpn(1)>0&&n.cmpn(1)>0;){for(var u=0,l=1;0==(t.words[0]&l)&&u<26;++u,l<<=1);if(u>0)for(t.iushrn(u);u-- >0;)a.isOdd()&&a.iadd(c),a.iushrn(1);for(var d=0,h=1;0==(n.words[0]&h)&&d<26;++d,h<<=1);if(d>0)for(n.iushrn(d);d-- >0;)o.isOdd()&&o.iadd(c),o.iushrn(1);t.cmp(n)>=0?(t.isub(n),a.isub(o)):(n.isub(t),o.isub(a))}return(s=0===t.cmpn(1)?a:o).cmpn(0)<0&&s.iadd(e),s},i.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),n=e.clone();t.negative=0,n.negative=0;for(var r=0;t.isEven()&&n.isEven();r++)t.iushrn(1),n.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;n.isEven();)n.iushrn(1);var s=t.cmp(n);if(s<0){var i=t;t=n,n=i}else if(0===s||0===n.cmpn(1))break;t.isub(n)}return n.iushln(r)},i.prototype.invm=function(e){return this.egcd(e).a.umod(e)},i.prototype.isEven=function(){return 0==(1&this.words[0])},i.prototype.isOdd=function(){return 1==(1&this.words[0])},i.prototype.andln=function(e){return this.words[0]&e},i.prototype.bincn=function(e){r("number"==typeof e);var t=e%26,n=(e-t)/26,s=1<<t;if(this.length<=n)return this._expand(n+1),this.words[n]|=s,this;for(var i=s,a=n;0!==i&&a<this.length;a++){var o=0|this.words[a];i=(o+=i)>>>26,o&=67108863,this.words[a]=o}return 0!==i&&(this.words[a]=i,this.length++),this},i.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},i.prototype.cmpn=function(e){var t,n=e<0;if(0!==this.negative&&!n)return-1;if(0===this.negative&&n)return 1;if(this.strip(),this.length>1)t=1;else{n&&(e=-e),r(e<=67108863,"Number is too big");var s=0|this.words[0];t=s===e?0:s<e?-1:1}return 0!==this.negative?0|-t:t},i.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},i.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,n=this.length-1;n>=0;n--){var r=0|this.words[n],s=0|e.words[n];if(r!==s){r<s?t=-1:r>s&&(t=1);break}}return t},i.prototype.gtn=function(e){return 1===this.cmpn(e)},i.prototype.gt=function(e){return 1===this.cmp(e)},i.prototype.gten=function(e){return this.cmpn(e)>=0},i.prototype.gte=function(e){return this.cmp(e)>=0},i.prototype.ltn=function(e){return-1===this.cmpn(e)},i.prototype.lt=function(e){return-1===this.cmp(e)},i.prototype.lten=function(e){return this.cmpn(e)<=0},i.prototype.lte=function(e){return this.cmp(e)<=0},i.prototype.eqn=function(e){return 0===this.cmpn(e)},i.prototype.eq=function(e){return 0===this.cmp(e)},i.red=function(e){return new _(e)},i.prototype.toRed=function(e){return r(!this.red,"Already a number in reduction context"),r(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},i.prototype.fromRed=function(){return r(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},i.prototype._forceRed=function(e){return this.red=e,this},i.prototype.forceRed=function(e){return r(!this.red,"Already a number in reduction context"),this._forceRed(e)},i.prototype.redAdd=function(e){return r(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},i.prototype.redIAdd=function(e){return r(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},i.prototype.redSub=function(e){return r(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},i.prototype.redISub=function(e){return r(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},i.prototype.redShl=function(e){return r(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},i.prototype.redMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},i.prototype.redIMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},i.prototype.redSqr=function(){return r(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},i.prototype.redISqr=function(){return r(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},i.prototype.redSqrt=function(){return r(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},i.prototype.redInvm=function(){return r(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},i.prototype.redNeg=function(){return r(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},i.prototype.redPow=function(e){return r(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var g={k256:null,p224:null,p192:null,p25519:null};function y(e,t){this.name=e,this.p=new i(t,16),this.n=this.p.bitLength(),this.k=new i(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function v(){y.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function b(){y.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function w(){y.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function k(){y.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function _(e){if("string"==typeof e){var t=i._prime(e);this.m=t.p,this.prime=t}else r(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function E(e){_.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new i(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}y.prototype._tmp=function(){var e=new i(null);return e.words=new Array(Math.ceil(this.n/13)),e},y.prototype.ireduce=function(e){var t,n=e;do{this.split(n,this.tmp),t=(n=(n=this.imulK(n)).iadd(this.tmp)).bitLength()}while(t>this.n);var r=t<this.n?-1:n.ucmp(this.p);return 0===r?(n.words[0]=0,n.length=1):r>0?n.isub(this.p):n.strip(),n},y.prototype.split=function(e,t){e.iushrn(this.n,0,t)},y.prototype.imulK=function(e){return e.imul(this.k)},s(v,y),v.prototype.split=function(e,t){for(var n=4194303,r=Math.min(e.length,9),s=0;s<r;s++)t.words[s]=e.words[s];if(t.length=r,e.length<=9)return e.words[0]=0,void(e.length=1);var i=e.words[9];for(t.words[t.length++]=i&n,s=10;s<e.length;s++){var a=0|e.words[s];e.words[s-10]=(a&n)<<4|i>>>22,i=a}i>>>=22,e.words[s-10]=i,0===i&&e.length>10?e.length-=10:e.length-=9},v.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,n=0;n<e.length;n++){var r=0|e.words[n];t+=977*r,e.words[n]=67108863&t,t=64*r+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},s(b,y),s(w,y),s(k,y),k.prototype.imulK=function(e){for(var t=0,n=0;n<e.length;n++){var r=19*(0|e.words[n])+t,s=67108863&r;r>>>=26,e.words[n]=s,t=r}return 0!==t&&(e.words[e.length++]=t),e},i._prime=function(e){if(g[e])return g[e];var t;if("k256"===e)t=new v;else if("p224"===e)t=new b;else if("p192"===e)t=new w;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new k}return g[e]=t,t},_.prototype._verify1=function(e){r(0===e.negative,"red works only with positives"),r(e.red,"red works only with red numbers")},_.prototype._verify2=function(e,t){r(0==(e.negative|t.negative),"red works only with positives"),r(e.red&&e.red===t.red,"red works only with red numbers")},_.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},_.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},_.prototype.add=function(e,t){this._verify2(e,t);var n=e.add(t);return n.cmp(this.m)>=0&&n.isub(this.m),n._forceRed(this)},_.prototype.iadd=function(e,t){this._verify2(e,t);var n=e.iadd(t);return n.cmp(this.m)>=0&&n.isub(this.m),n},_.prototype.sub=function(e,t){this._verify2(e,t);var n=e.sub(t);return n.cmpn(0)<0&&n.iadd(this.m),n._forceRed(this)},_.prototype.isub=function(e,t){this._verify2(e,t);var n=e.isub(t);return n.cmpn(0)<0&&n.iadd(this.m),n},_.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},_.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},_.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},_.prototype.isqr=function(e){return this.imul(e,e.clone())},_.prototype.sqr=function(e){return this.mul(e,e)},_.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(r(t%2==1),3===t){var n=this.m.add(new i(1)).iushrn(2);return this.pow(e,n)}for(var s=this.m.subn(1),a=0;!s.isZero()&&0===s.andln(1);)a++,s.iushrn(1);r(!s.isZero());var o=new i(1).toRed(this),c=o.redNeg(),u=this.m.subn(1).iushrn(1),l=this.m.bitLength();for(l=new i(2*l*l).toRed(this);0!==this.pow(l,u).cmp(c);)l.redIAdd(c);for(var d=this.pow(l,s),h=this.pow(e,s.addn(1).iushrn(1)),f=this.pow(e,s),p=a;0!==f.cmp(o);){for(var m=f,g=0;0!==m.cmp(o);g++)m=m.redSqr();r(g<p);var y=this.pow(d,new i(1).iushln(p-g-1));h=h.redMul(y),d=y.redSqr(),f=f.redMul(d),p=g}return h},_.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},_.prototype.pow=function(e,t){if(t.isZero())return new i(1);if(0===t.cmpn(1))return e.clone();var n=new Array(16);n[0]=new i(1).toRed(this),n[1]=e;for(var r=2;r<n.length;r++)n[r]=this.mul(n[r-1],e);var s=n[0],a=0,o=0,c=t.bitLength()%26;for(0===c&&(c=26),r=t.length-1;r>=0;r--){for(var u=t.words[r],l=c-1;l>=0;l--){var d=u>>l&1;s!==n[0]&&(s=this.sqr(s)),0!==d||0!==a?(a<<=1,a|=d,(4===++o||0===r&&0===l)&&(s=this.mul(s,n[a]),o=0,a=0)):o=0}c=26}return s},_.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},_.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},i.mont=function(e){return new E(e)},s(E,_),E.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},E.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},E.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var n=e.imul(t),r=n.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),s=n.isub(r).iushrn(this.shift),i=s;return s.cmp(this.m)>=0?i=s.isub(this.m):s.cmpn(0)<0&&(i=s.iadd(this.m)),i._forceRed(this)},E.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new i(0)._forceRed(this);var n=e.mul(t),r=n.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),s=n.isub(r).iushrn(this.shift),a=s;return s.cmp(this.m)>=0?a=s.isub(this.m):s.cmpn(0)<0&&(a=s.iadd(this.m)),a._forceRed(this)},E.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(void 0===t||t,this)}}},{package:"bn.js",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/bn.js/lib/bn.js"}],[1414,{buffer:2081,inherits:4404,"readable-stream":1429},function(){with(this)return function(){"use strict";return function(e,t,n){(function(n){(function(){var r=e("readable-stream").Writable,s=e("inherits"),i=Uint8Array;function a(e,t){if(!(this instanceof a))return new a(e,t);"function"==typeof e&&(t=e,e={}),e||(e={});var n=e.encoding,s=!1;n?"u8"!==(n=String(n).toLowerCase())&&"uint8"!==n||(n="uint8array"):s=!0,r.call(this,{objectMode:!0}),this.encoding=n,this.shouldInferEncoding=s,t&&this.on("finish",(function(){t(this.getBody())})),this.body=[]}function o(e){return"string"==typeof e||(t=e,/Array\]$/.test(Object.prototype.toString.call(t)))||e&&"function"==typeof e.subarray;var t}t.exports=a,s(a,r),a.prototype._write=function(e,t,n){this.body.push(e),n()},a.prototype.inferEncoding=function(e){var t=e===undefined?this.body[0]:e;return n.isBuffer(t)?"buffer":"undefined"!=typeof Uint8Array&&t instanceof Uint8Array?"uint8array":Array.isArray(t)?"array":"string"==typeof t?"string":"[object Object]"===Object.prototype.toString.call(t)?"object":"buffer"},a.prototype.getBody=function(){return this.encoding||0!==this.body.length?(this.shouldInferEncoding&&(this.encoding=this.inferEncoding()),"array"===this.encoding?function(e){for(var t=[],n=0;n<e.length;n++)t.push.apply(t,e[n]);return t}(this.body):"string"===this.encoding?function(e){for(var t=[],r=0;r<e.length;r++){var s=e[r];"string"==typeof s||n.isBuffer(s)?t.push(s):o(s)?t.push(n.from(s)):t.push(n.from(String(s)))}t=n.isBuffer(e[0])?(t=n.concat(t)).toString("utf8"):t.join("");return t}(this.body):"buffer"===this.encoding?function(e){for(var t=[],r=0;r<e.length;r++){var s=e[r];n.isBuffer(s)?t.push(s):o(s)?t.push(n.from(s)):t.push(n.from(String(s)))}return n.concat(t)}(this.body):"uint8array"===this.encoding?function(e){for(var t=0,r=0;r<e.length;r++)"string"==typeof e[r]&&(e[r]=n.from(e[r])),t+=e[r].length;for(var s=new i(t),a=(r=0,0);r<e.length;r++)for(var o=e[r],c=0;c<o.length;c++)s[a++]=o[c];return s}(this.body):this.body):[]}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"concat-stream",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/concat-stream/index.js"}],[1415,{},function(){with(this)return function(){"use strict";return function(e,t,n){var r={};function s(e,t,n){n||(n=Error);var s=function(e){var n,r;function s(n,r,s){return e.call(this,function(e,n,r){return"string"==typeof t?t:t(e,n,r)}(n,r,s))||this}return r=e,(n=s).prototype=Object.create(r.prototype),n.prototype.constructor=n,n.__proto__=r,s}(n);s.prototype.name=n.name,s.prototype.code=e,r[e]=s}function i(e,t){if(Array.isArray(e)){var n=e.length;return e=e.map((function(e){return String(e)})),n>2?"one of ".concat(t," ").concat(e.slice(0,n-1).join(", "),", or ")+e[n-1]:2===n?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}s("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),s("ERR_INVALID_ARG_TYPE",(function(e,t,n){var r,s,a,o;if("string"==typeof t&&(s="not ",t.substr(!a||a<0?0:+a,s.length)===s)?(r="must not be",t=t.replace(/^not /,"")):r="must be",function(e,t,n){return(n===undefined||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t}(e," argument"))o="The ".concat(e," ").concat(r," ").concat(i(t,"type"));else{var c=function(e,t,n){return"number"!=typeof n&&(n=0),!(n+t.length>e.length)&&-1!==e.indexOf(t,n)}(e,".")?"property":"argument";o='The "'.concat(e,'" ').concat(c," ").concat(r," ").concat(i(t,"type"))}return o+=". Received type ".concat(typeof n)}),TypeError),s("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),s("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),s("ERR_STREAM_PREMATURE_CLOSE","Premature close"),s("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),s("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),s("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),s("ERR_STREAM_WRITE_AFTER_END","write after end"),s("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),s("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),s("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),t.exports.codes=r}}},{package:"readable-stream",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/concat-stream/node_modules/readable-stream/errors-browser.js"}],[1416,{"./_stream_readable":1418,"./_stream_writable":1420,_process:5420,inherits:4404},function(){with(this)return function(){"use strict";return function(e,t,n){(function(n){(function(){var r=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};t.exports=u;var s=e("./_stream_readable"),i=e("./_stream_writable");e("inherits")(u,s);for(var a=r(i.prototype),o=0;o<a.length;o++){var c=a[o];u.prototype[c]||(u.prototype[c]=i.prototype[c])}function u(e){if(!(this instanceof u))return new u(e);s.call(this,e),i.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",l)))}function l(){this._writableState.ended||n.nextTick(d,this)}function d(e){e.end()}Object.defineProperty(u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(u.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(u.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(u.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==undefined&&this._writableState!==undefined&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){this._readableState!==undefined&&this._writableState!==undefined&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})}).call(this)}).call(this,e("_process"))}}},{package:"readable-stream",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/concat-stream/node_modules/readable-stream/lib/_stream_duplex.js"}],[1417,{"./_stream_transform":1419,inherits:4404},function(){with(this)return function(){"use strict";return function(e,t,n){t.exports=s;var r=e("./_stream_transform");function s(e){if(!(this instanceof s))return new s(e);r.call(this,e)}e("inherits")(s,r),s.prototype._transform=function(e,t,n){n(null,e)}}}},{package:"readable-stream",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/concat-stream/node_modules/readable-stream/lib/_stream_passthrough.js"}],[1418,{"../errors":1415,"./_stream_duplex":1416,"./internal/streams/async_iterator":1421,"./internal/streams/buffer_list":1422,"./internal/streams/destroy":1423,"./internal/streams/from":1425,"./internal/streams/state":1427,"./internal/streams/stream":1428,_process:5420,buffer:2081,events:2082,inherits:4404,"string_decoder/":5897,util:2080},function(){with(this)return function(){"use strict";return function(e,t,n){(function(n){(function(){var r;t.exports=S,S.ReadableState=E;e("events").EventEmitter;var s=function(e,t){return e.listeners(t).length},i=e("./internal/streams/stream"),a=e("buffer").Buffer,o=global.Uint8Array||function(){};var c,u=e("util");c=u&&u.debuglog?u.debuglog("stream"):function(){};var l,d,h,f=e("./internal/streams/buffer_list"),p=e("./internal/streams/destroy"),m=e("./internal/streams/state").getHighWaterMark,g=e("../errors").codes,y=g.ERR_INVALID_ARG_TYPE,v=g.ERR_STREAM_PUSH_AFTER_EOF,b=g.ERR_METHOD_NOT_IMPLEMENTED,w=g.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;e("inherits")(S,i);var k=p.errorOrDestroy,_=["error","close","destroy","pause","resume"];function E(t,n,s){r=r||e("./_stream_duplex"),t=t||{},"boolean"!=typeof s&&(s=n instanceof r),this.objectMode=!!t.objectMode,s&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=m(this,t,"readableHighWaterMark",s),this.buffer=new f,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(l||(l=e("string_decoder/").StringDecoder),this.decoder=new l(t.encoding),this.encoding=t.encoding)}function S(t){if(r=r||e("./_stream_duplex"),!(this instanceof S))return new S(t);var n=this instanceof r;this._readableState=new E(t,this,n),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),i.call(this)}function P(e,t,n,r,s){c("readableAddChunk",t);var i,u=e._readableState;if(null===t)u.reading=!1,function(e,t){if(c("onEofChunk"),t.ended)return;if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,t.sync?C(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,T(e)))}(e,u);else if(s||(i=function(e,t){var n;r=t,a.isBuffer(r)||r instanceof o||"string"==typeof t||t===undefined||e.objectMode||(n=new y("chunk",["string","Buffer","Uint8Array"],t));var r;return n}(u,t)),i)k(e,i);else if(u.objectMode||t&&t.length>0)if("string"==typeof t||u.objectMode||Object.getPrototypeOf(t)===a.prototype||(t=function(e){return a.from(e)}(t)),r)u.endEmitted?k(e,new w):x(e,u,t,!0);else if(u.ended)k(e,new v);else{if(u.destroyed)return!1;u.reading=!1,u.decoder&&!n?(t=u.decoder.write(t),u.objectMode||0!==t.length?x(e,u,t,!1):A(e,u)):x(e,u,t,!1)}else r||(u.reading=!1,A(e,u));return!u.ended&&(u.length<u.highWaterMark||0===u.length)}function x(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",n)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&C(e)),A(e,t)}Object.defineProperty(S.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==undefined&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),S.prototype.destroy=p.destroy,S.prototype._undestroy=p.undestroy,S.prototype._destroy=function(e,t){t(e)},S.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=a.from(e,t),t=""),n=!0),P(this,e,t,!1,n)},S.prototype.unshift=function(e){return P(this,e,null,!0,!1)},S.prototype.isPaused=function(){return!1===this._readableState.flowing},S.prototype.setEncoding=function(t){l||(l=e("string_decoder/").StringDecoder);var n=new l(t);this._readableState.decoder=n,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,s="";null!==r;)s+=n.write(r.data),r=r.next;return this._readableState.buffer.clear(),""!==s&&this._readableState.buffer.push(s),this._readableState.length=s.length,this};var M=1073741824;function j(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=M?e=M:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function C(e){var t=e._readableState;c("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(c("emitReadable",t.flowing),t.emittedReadable=!0,n.nextTick(T,e))}function T(e){var t=e._readableState;c("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,D(e)}function A(e,t){t.readingMore||(t.readingMore=!0,n.nextTick(O,e,t))}function O(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var n=t.length;if(c("maybeReadMore read 0"),e.read(0),n===t.length)break}t.readingMore=!1}function I(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function R(e){c("readable nexttick read 0"),e.read(0)}function N(e,t){c("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),D(e),t.flowing&&!t.reading&&e.read(0)}function D(e){var t=e._readableState;for(c("flow",t.flowing);t.flowing&&null!==e.read(););}function B(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):n=t.buffer.consume(e,t.decoder),n);var n}function L(e){var t=e._readableState;c("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,n.nextTick(U,t,e))}function U(e,t){if(c("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var n=t._writableState;(!n||n.autoDestroy&&n.finished)&&t.destroy()}}function F(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}S.prototype.read=function(e){c("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return c("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?L(this):C(this),null;if(0===(e=j(e,t))&&t.ended)return 0===t.length&&L(this),null;var r,s=t.needReadable;return c("need readable",s),(0===t.length||t.length-e<t.highWaterMark)&&c("length less than watermark",s=!0),t.ended||t.reading?c("reading or ended",s=!1):s&&(c("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=j(n,t))),null===(r=e>0?B(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&L(this)),null!==r&&this.emit("data",r),r},S.prototype._read=function(e){k(this,new b("_read()"))},S.prototype.pipe=function(e,t){var r=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e)}i.pipesCount+=1,c("pipe count=%d opts=%j",i.pipesCount,t);var a=(!t||!1!==t.end)&&e!==n.stdout&&e!==n.stderr?u:g;function o(t,n){c("onunpipe"),t===r&&n&&!1===n.hasUnpiped&&(n.hasUnpiped=!0,c("cleanup"),e.removeListener("close",p),e.removeListener("finish",m),e.removeListener("drain",l),e.removeListener("error",f),e.removeListener("unpipe",o),r.removeListener("end",u),r.removeListener("end",g),r.removeListener("data",h),d=!0,!i.awaitDrain||e._writableState&&!e._writableState.needDrain||l())}function u(){c("onend"),e.end()}i.endEmitted?n.nextTick(a):r.once("end",a),e.on("unpipe",o);var l=function(e){return function(){var t=e._readableState;c("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&s(e,"data")&&(t.flowing=!0,D(e))}}(r);e.on("drain",l);var d=!1;function h(t){c("ondata");var n=e.write(t);c("dest.write",n),!1===n&&((1===i.pipesCount&&i.pipes===e||i.pipesCount>1&&-1!==F(i.pipes,e))&&!d&&(c("false write response, pause",i.awaitDrain),i.awaitDrain++),r.pause())}function f(t){c("onerror",t),g(),e.removeListener("error",f),0===s(e,"error")&&k(e,t)}function p(){e.removeListener("finish",m),g()}function m(){c("onfinish"),e.removeListener("close",p),g()}function g(){c("unpipe"),r.unpipe(e)}return r.on("data",h),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",f),e.once("close",p),e.once("finish",m),e.emit("pipe",r),i.flowing||(c("pipe resume"),r.resume()),e},S.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var r=t.pipes,s=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<s;i++)r[i].emit("unpipe",this,{hasUnpiped:!1});return this}var a=F(t.pipes,e);return-1===a||(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},S.prototype.on=function(e,t){var r=i.prototype.on.call(this,e,t),s=this._readableState;return"data"===e?(s.readableListening=this.listenerCount("readable")>0,!1!==s.flowing&&this.resume()):"readable"===e&&(s.endEmitted||s.readableListening||(s.readableListening=s.needReadable=!0,s.flowing=!1,s.emittedReadable=!1,c("on readable",s.length,s.reading),s.length?C(this):s.reading||n.nextTick(R,this))),r},S.prototype.addListener=S.prototype.on,S.prototype.removeListener=function(e,t){var r=i.prototype.removeListener.call(this,e,t);return"readable"===e&&n.nextTick(I,this),r},S.prototype.removeAllListeners=function(e){var t=i.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&e!==undefined||n.nextTick(I,this),t},S.prototype.resume=function(){var e=this._readableState;return e.flowing||(c("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,n.nextTick(N,e,t))}(this,e)),e.paused=!1,this},S.prototype.pause=function(){return c("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(c("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},S.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var s in e.on("end",(function(){if(c("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(s){(c("wrapped data"),n.decoder&&(s=n.decoder.write(s)),!n.objectMode||null!==s&&s!==undefined)&&((n.objectMode||s&&s.length)&&(t.push(s)||(r=!0,e.pause())))})),e)this[s]===undefined&&"function"==typeof e[s]&&(this[s]=function(t){return function(){return e[t].apply(e,arguments)}}(s));for(var i=0;i<_.length;i++)e.on(_[i],this.emit.bind(this,_[i]));return this._read=function(t){c("wrapped _read",t),r&&(r=!1,e.resume())},this},"function"==typeof Symbol&&(S.prototype[Symbol.asyncIterator]=function(){return d===undefined&&(d=e("./internal/streams/async_iterator")),d(this)}),Object.defineProperty(S.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(S.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(S.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),S._fromList=B,Object.defineProperty(S.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(S.from=function(t,n){return h===undefined&&(h=e("./internal/streams/from")),h(S,t,n)})}).call(this)}).call(this,e("_process"))}}},{package:"readable-stream",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/concat-stream/node_modules/readable-stream/lib/_stream_readable.js"}],[1419,{"../errors":1415,"./_stream_duplex":1416,inherits:4404},function(){with(this)return function(){"use strict";return function(e,t,n){t.exports=l;var r=e("../errors").codes,s=r.ERR_METHOD_NOT_IMPLEMENTED,i=r.ERR_MULTIPLE_CALLBACK,a=r.ERR_TRANSFORM_ALREADY_TRANSFORMING,o=r.ERR_TRANSFORM_WITH_LENGTH_0,c=e("./_stream_duplex");function u(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(null===r)return this.emit("error",new i);n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var s=this._readableState;s.reading=!1,(s.needReadable||s.length<s.highWaterMark)&&this._read(s.highWaterMark)}function l(e){if(!(this instanceof l))return new l(e);c.call(this,e),this._transformState={afterTransform:u.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",d)}function d(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?h(this,null,null):this._flush((function(t,n){h(e,t,n)}))}function h(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new o;if(e._transformState.transforming)throw new a;return e.push(null)}e("inherits")(l,c),l.prototype.push=function(e,t){return this._transformState.needTransform=!1,c.prototype.push.call(this,e,t)},l.prototype._transform=function(e,t,n){n(new s("_transform()"))},l.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var s=this._readableState;(r.needTransform||s.needReadable||s.length<s.highWaterMark)&&this._read(s.highWaterMark)}},l.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},l.prototype._destroy=function(e,t){c.prototype._destroy.call(this,e,(function(e){t(e)}))}}}},{package:"readable-stream",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/concat-stream/node_modules/readable-stream/lib/_stream_transform.js"}],[142,{lodash:5172},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("lodash");var s={version:61,async migrate(e){const t=(0,r.cloneDeep)(e);t.meta.version=61;const n=function(e){const t=(new Date).getTime();e.AppStateController?(e.AppStateController.recoveryPhraseReminderHasBeenShown=!1,e.AppStateController.recoveryPhraseReminderLastShown=t):e.AppStateController={recoveryPhraseReminderHasBeenShown:!1,recoveryPhraseReminderLastShown:t};return e}(t.data);return t.data=n,t}};n.default=s}}},{package:"<root>",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/app/scripts/migrations/061.js"}],[1420,{"../errors":1415,"./_stream_duplex":1416,"./internal/streams/destroy":1423,"./internal/streams/state":1427,"./internal/streams/stream":1428,_process:5420,buffer:2081,inherits:4404,"util-deprecate":6008},function(){with(this)return function(){"use strict";return function(e,t,n){(function(n){(function(){function r(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;e.entry=null;for(;r;){var s=r.callback;t.pendingcb--,s(n),r=r.next}t.corkedRequestsFree.next=e}(t,e)}}var s;t.exports=S,S.WritableState=E;var i={deprecate:e("util-deprecate")},a=e("./internal/streams/stream"),o=e("buffer").Buffer,c=global.Uint8Array||function(){};var u,l=e("./internal/streams/destroy"),d=e("./internal/streams/state").getHighWaterMark,h=e("../errors").codes,f=h.ERR_INVALID_ARG_TYPE,p=h.ERR_METHOD_NOT_IMPLEMENTED,m=h.ERR_MULTIPLE_CALLBACK,g=h.ERR_STREAM_CANNOT_PIPE,y=h.ERR_STREAM_DESTROYED,v=h.ERR_STREAM_NULL_VALUES,b=h.ERR_STREAM_WRITE_AFTER_END,w=h.ERR_UNKNOWN_ENCODING,k=l.errorOrDestroy;function _(){}function E(t,i,a){s=s||e("./_stream_duplex"),t=t||{},"boolean"!=typeof a&&(a=i instanceof s),this.objectMode=!!t.objectMode,a&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=d(this,t,"writableHighWaterMark",a),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var o=!1===t.decodeStrings;this.decodeStrings=!o,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,s=r.sync,i=r.writecb;if("function"!=typeof i)throw new m;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,s,i){--t.pendingcb,r?(n.nextTick(i,s),n.nextTick(T,e,t),e._writableState.errorEmitted=!0,k(e,s)):(i(s),e._writableState.errorEmitted=!0,k(e,s),T(e,t))}(e,r,s,t,i);else{var a=j(r)||e.destroyed;a||r.corked||r.bufferProcessing||!r.bufferedRequest||M(e,r),s?n.nextTick(x,e,r,a,i):x(e,r,a,i)}}(i,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new r(this)}function S(t){var n=this instanceof(s=s||e("./_stream_duplex"));if(!n&&!u.call(S,this))return new S(t);this._writableState=new E(t,this,n),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),a.call(this)}function P(e,t,n,r,s,i,a){t.writelen=r,t.writecb=a,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new y("write")):n?e._writev(s,t.onwrite):e._write(s,i,t.onwrite),t.sync=!1}function x(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),T(e,t)}function M(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var s=t.bufferedRequestCount,i=new Array(s),a=t.corkedRequestsFree;a.entry=n;for(var o=0,c=!0;n;)i[o]=n,n.isBuf||(c=!1),n=n.next,o+=1;i.allBuffers=c,P(e,t,!0,t.length,i,"",a.finish),t.pendingcb++,t.lastBufferedRequest=null,a.next?(t.corkedRequestsFree=a.next,a.next=null):t.corkedRequestsFree=new r(t),t.bufferedRequestCount=0}else{for(;n;){var u=n.chunk,l=n.encoding,d=n.callback;if(P(e,t,!1,t.objectMode?1:u.length,u,l,d),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function j(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function C(e,t){e._final((function(n){t.pendingcb--,n&&k(e,n),t.prefinished=!0,e.emit("prefinish"),T(e,t)}))}function T(e,t){var r=j(t);if(r&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,n.nextTick(C,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var s=e._readableState;(!s||s.autoDestroy&&s.endEmitted)&&e.destroy()}return r}e("inherits")(S,a),E.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(E.prototype,"buffer",{get:i.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer "+"instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(u=Function.prototype[Symbol.hasInstance],Object.defineProperty(S,Symbol.hasInstance,{value:function(e){return!!u.call(this,e)||this===S&&(e&&e._writableState instanceof E)}})):u=function(e){return e instanceof this},S.prototype.pipe=function(){k(this,new g)},S.prototype.write=function(e,t,r){var s,i=this._writableState,a=!1,u=!i.objectMode&&(s=e,o.isBuffer(s)||s instanceof c);return u&&!o.isBuffer(e)&&(e=function(e){return o.from(e)}(e)),"function"==typeof t&&(r=t,t=null),u?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof r&&(r=_),i.ending?function(e,t){var r=new b;k(e,r),n.nextTick(t,r)}(this,r):(u||function(e,t,r,s){var i;return null===r?i=new v:"string"==typeof r||t.objectMode||(i=new f("chunk",["string","Buffer"],r)),!i||(k(e,i),n.nextTick(s,i),!1)}(this,i,e,r))&&(i.pendingcb++,a=function(e,t,n,r,s,i){if(!n){var a=function(e,t,n){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=o.from(t,n));return t}(t,r,s);r!==a&&(n=!0,s="buffer",r=a)}var c=t.objectMode?1:r.length;t.length+=c;var u=t.length<t.highWaterMark;u||(t.needDrain=!0);if(t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:s,isBuf:n,callback:i,next:null},l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else P(e,t,!1,c,r,s,i);return u}(this,i,u,e,t,r)),a},S.prototype.cork=function(){this._writableState.corked++},S.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||M(this,e))},S.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new w(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(S.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(S.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),S.prototype._write=function(e,t,n){n(new p("_write()"))},S.prototype._writev=null,S.prototype.end=function(e,t,r){var s=this._writableState;return"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!==e&&e!==undefined&&this.write(e,t),s.corked&&(s.corked=1,this.uncork()),s.ending||function(e,t,r){t.ending=!0,T(e,t),r&&(t.finished?n.nextTick(r):e.once("finish",r));t.ended=!0,e.writable=!1}(this,s,r),this},Object.defineProperty(S.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(S.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==undefined&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),S.prototype.destroy=l.destroy,S.prototype._undestroy=l.undestroy,S.prototype._destroy=function(e,t){t(e)}}).call(this)}).call(this,e("_process"))}}},{package:"readable-stream",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/concat-stream/node_modules/readable-stream/lib/_stream_writable.js"}],[1421,{"./end-of-stream":1424,_process:5420},function(){with(this)return function(){"use strict";return function(e,t,n){(function(n){(function(){var r;function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i=e("./end-of-stream"),a=Symbol("lastResolve"),o=Symbol("lastReject"),c=Symbol("error"),u=Symbol("ended"),l=Symbol("lastPromise"),d=Symbol("handlePromise"),h=Symbol("stream");function f(e,t){return{value:e,done:t}}function p(e){var t=e[a];if(null!==t){var n=e[h].read();null!==n&&(e[l]=null,e[a]=null,e[o]=null,t(f(n,!1)))}}function m(e){n.nextTick(p,e)}var g=Object.getPrototypeOf((function(){})),y=Object.setPrototypeOf((s(r={get stream(){return this[h]},next:function(){var e=this,t=this[c];if(null!==t)return Promise.reject(t);if(this[u])return Promise.resolve(f(undefined,!0));if(this[h].destroyed)return new Promise((function(t,r){n.nextTick((function(){e[c]?r(e[c]):t(f(undefined,!0))}))}));var r,s=this[l];if(s)r=new Promise(function(e,t){return function(n,r){e.then((function(){t[u]?n(f(undefined,!0)):t[d](n,r)}),r)}}(s,this));else{var i=this[h].read();if(null!==i)return Promise.resolve(f(i,!1));r=new Promise(this[d])}return this[l]=r,r}},Symbol.asyncIterator,(function(){return this})),s(r,"return",(function(){var e=this;return new Promise((function(t,n){e[h].destroy(null,(function(e){e?n(e):t(f(undefined,!0))}))}))})),r),g);t.exports=function(e){var t,n=Object.create(y,(s(t={},h,{value:e,writable:!0}),s(t,a,{value:null,writable:!0}),s(t,o,{value:null,writable:!0}),s(t,c,{value:null,writable:!0}),s(t,u,{value:e._readableState.endEmitted,writable:!0}),s(t,d,{value:function(e,t){var r=n[h].read();r?(n[l]=null,n[a]=null,n[o]=null,e(f(r,!1))):(n[a]=e,n[o]=t)},writable:!0}),t));return n[l]=null,i(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=n[o];return null!==t&&(n[l]=null,n[a]=null,n[o]=null,t(e)),void(n[c]=e)}var r=n[a];null!==r&&(n[l]=null,n[a]=null,n[o]=null,r(f(undefined,!0))),n[u]=!0})),e.on("readable",m.bind(null,n)),n}}).call(this)}).call(this,e("_process"))}}},{package:"readable-stream",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/concat-stream/node_modules/readable-stream/lib/internal/streams/async_iterator.js"}],[1422,{buffer:2081,util:2080},function(){with(this)return function(){"use strict";return function(e,t,n){function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=e("buffer").Buffer,o=e("util").inspect,c=o&&o.custom||"inspect";t.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t,n,u;return t=e,n=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n}},{key:"concat",value:function(e){if(0===this.length)return a.alloc(0);for(var t,n,r,s=a.allocUnsafe(e>>>0),i=this.head,o=0;i;)t=i.data,n=s,r=o,a.prototype.copy.call(t,n,r),o+=i.data.length,i=i.next;return s}},{key:"consume",value:function(e,t){var n;return e<this.head.data.length?(n=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):n=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),n}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,n=1,r=t.data;for(e-=r.length;t=t.next;){var s=t.data,i=e>s.length?s.length:e;if(i===s.length?r+=s:r+=s.slice(0,e),0==(e-=i)){i===s.length?(++n,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=s.slice(i));break}++n}return this.length-=n,r}},{key:"_getBuffer",value:function(e){var t=a.allocUnsafe(e),n=this.head,r=1;for(n.data.copy(t),e-=n.data.length;n=n.next;){var s=n.data,i=e>s.length?s.length:e;if(s.copy(t,t.length-e,0,i),0==(e-=i)){i===s.length?(++r,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=s.slice(i));break}++r}return this.length-=r,t}},{key:c,value:function(e,t){return o(this,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{depth:0,customInspect:!1}))}}],n&&i(t.prototype,n),u&&i(t,u),e}()}}},{package:"readable-stream",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/concat-stream/node_modules/readable-stream/lib/internal/streams/buffer_list.js"}],[1423,{_process:5420},function(){with(this)return function(){"use strict";return function(e,t,n){(function(e){(function(){function n(e,t){s(e,t),r(e)}function r(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function s(e,t){e.emit("error",t)}t.exports={destroy:function(t,i){var a=this,o=this._readableState&&this._readableState.destroyed,c=this._writableState&&this._writableState.destroyed;return o||c?(i?i(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,e.nextTick(s,this,t)):e.nextTick(s,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,(function(t){!i&&t?a._writableState?a._writableState.errorEmitted?e.nextTick(r,a):(a._writableState.errorEmitted=!0,e.nextTick(n,a,t)):e.nextTick(n,a,t):i?(e.nextTick(r,a),i(t)):e.nextTick(r,a)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var n=e._readableState,r=e._writableState;n&&n.autoDestroy||r&&r.autoDestroy?e.destroy(t):e.emit("error",t)}}}).call(this)}).call(this,e("_process"))}}},{package:"readable-stream",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/concat-stream/node_modules/readable-stream/lib/internal/streams/destroy.js"}],[1424,{"../../../errors":1415},function(){with(this)return function(){"use strict";return function(e,t,n){var r=e("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function s(){}t.exports=function e(t,n,i){if("function"==typeof n)return e(t,null,n);n||(n={}),i=function(e){var t=!1;return function(){if(!t){t=!0;for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];e.apply(this,r)}}}(i||s);var a=n.readable||!1!==n.readable&&t.readable,o=n.writable||!1!==n.writable&&t.writable,c=function(){t.writable||l()},u=t._writableState&&t._writableState.finished,l=function(){o=!1,u=!0,a||i.call(t)},d=t._readableState&&t._readableState.endEmitted,h=function(){a=!1,d=!0,o||i.call(t)},f=function(e){i.call(t,e)},p=function(){var e;return a&&!d?(t._readableState&&t._readableState.ended||(e=new r),i.call(t,e)):o&&!u?(t._writableState&&t._writableState.ended||(e=new r),i.call(t,e)):void 0},m=function(){t.req.on("finish",l)};return!function(e){return e.setHeader&&"function"==typeof e.abort}(t)?o&&!t._writableState&&(t.on("end",c),t.on("close",c)):(t.on("complete",l),t.on("abort",p),t.req?m():t.on("request",m)),t.on("end",h),t.on("finish",l),!1!==n.error&&t.on("error",f),t.on("close",p),function(){t.removeListener("complete",l),t.removeListener("abort",p),t.removeListener("request",m),t.req&&t.req.removeListener("finish",l),t.removeListener("end",c),t.removeListener("close",c),t.removeListener("finish",l),t.removeListener("end",h),t.removeListener("error",f),t.removeListener("close",p)}}}}},{package:"readable-stream",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/concat-stream/node_modules/readable-stream/lib/internal/streams/end-of-stream.js"}],[1425,{},function(){with(this)return function(){"use strict";return function(e,t,n){t.exports=function(){throw new Error("Readable.from is not available in the browser")}}}},{package:"readable-stream",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/concat-stream/node_modules/readable-stream/lib/internal/streams/from-browser.js"}],[1426,{"../../../errors":1415,"./end-of-stream":1424},function(){with(this)return function(){"use strict";return function(e,t,n){var r;var s=e("../../../errors").codes,i=s.ERR_MISSING_ARGS,a=s.ERR_STREAM_DESTROYED;function o(e){if(e)throw e}function c(t,n,s,i){i=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(i);var o=!1;t.on("close",(function(){o=!0})),r===undefined&&(r=e("./end-of-stream")),r(t,{readable:n,writable:s},(function(e){if(e)return i(e);o=!0,i()}));var c=!1;return function(e){if(!o&&!c)return c=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(t)?t.abort():"function"==typeof t.destroy?t.destroy():void i(e||new a("pipe"))}}function u(e){e()}function l(e,t){return e.pipe(t)}function d(e){return e.length?"function"!=typeof e[e.length-1]?o:e.pop():o}t.exports=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r,s=d(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new i("streams");var a=t.map((function(e,n){var i=n<t.length-1;return c(e,i,n>0,(function(e){r||(r=e),e&&a.forEach(u),i||(a.forEach(u),s(r))}))}));return t.reduce(l)}}}},{package:"readable-stream",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/concat-stream/node_modules/readable-stream/lib/internal/streams/pipeline.js"}],[1427,{"../../../errors":1415},function(){with(this)return function(){"use strict";return function(e,t,n){var r=e("../../../errors").codes.ERR_INVALID_OPT_VALUE;t.exports={getHighWaterMark:function(e,t,n,s){var i=function(e,t,n){return null!=e.highWaterMark?e.highWaterMark:t?e[n]:null}(t,s,n);if(null!=i){if(!isFinite(i)||Math.floor(i)!==i||i<0)throw new r(s?n:"highWaterMark",i);return Math.floor(i)}return e.objectMode?16:16384}}}}},{package:"readable-stream",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/concat-stream/node_modules/readable-stream/lib/internal/streams/state.js"}],[1428,{events:2082},function(){with(this)return function(){"use strict";return function(e,t,n){t.exports=e("events").EventEmitter}}},{package:"readable-stream",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/concat-stream/node_modules/readable-stream/lib/internal/streams/stream-browser.js"}],[1429,{"./lib/_stream_duplex.js":1416,"./lib/_stream_passthrough.js":1417,"./lib/_stream_readable.js":1418,"./lib/_stream_transform.js":1419,"./lib/_stream_writable.js":1420,"./lib/internal/streams/end-of-stream.js":1424,"./lib/internal/streams/pipeline.js":1426},function(){with(this)return function(){"use strict";return function(e,t,n){(n=t.exports=e("./lib/_stream_readable.js")).Stream=n,n.Readable=n,n.Writable=e("./lib/_stream_writable.js"),n.Duplex=e("./lib/_stream_duplex.js"),n.Transform=e("./lib/_stream_transform.js"),n.PassThrough=e("./lib/_stream_passthrough.js"),n.finished=e("./lib/internal/streams/end-of-stream.js"),n.pipeline=e("./lib/internal/streams/pipeline.js")}}},{package:"readable-stream",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/concat-stream/node_modules/readable-stream/readable-browser.js"}],[143,{lodash:5172},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("lodash");var s={version:62,async migrate(e){const t=(0,r.cloneDeep)(e);t.meta.version=62;const n=function(e){if(e.MetaMetricsController){const{metaMetricsSendCount:t}=e.MetaMetricsController;t!==undefined&&delete e.MetaMetricsController.metaMetricsSendCount}return e}(t.data);return t.data=n,t}};n.default=s}}},{package:"<root>",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/app/scripts/migrations/062.js"}],[1430,{},function(){with(this)return function(){"use strict";return function(e,t,n){t.exports=[{constant:!1,inputs:[{name:"_new",type:"address"}],name:"setOwner",outputs:[],payable:!1,type:"function"},{constant:!0,inputs:[],name:"totalSignatures",outputs:[{name:"",type:"uint256"}],payable:!1,type:"function"},{constant:!0,inputs:[],name:"owner",outputs:[{name:"",type:"address"}],payable:!1,type:"function"},{constant:!1,inputs:[],name:"drain",outputs:[],payable:!1,type:"function"},{constant:!0,inputs:[{name:"",type:"bytes4"}],name:"entries",outputs:[{name:"",type:"string"}],payable:!1,type:"function"},{constant:!1,inputs:[{name:"_method",type:"string"}],name:"register",outputs:[{name:"",type:"bool"}],payable:!1,type:"function"},{inputs:[],type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"creator",type:"address"},{indexed:!0,name:"signature",type:"bytes4"},{indexed:!1,name:"method",type:"string"}],name:"Registered",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"old",type:"address"},{indexed:!0,name:"current",type:"address"}],name:"NewOwner",type:"event"}]}}},{package:"eth-method-registry",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/eth-method-registry/abi.json"}],[1431,{"./abi":1430,"./registry-map.json":1432,ethjs:1447},function(){with(this)return function(){"use strict";return function(e,t,n){const r=e("ethjs"),s=e("./registry-map.json"),i=e("./abi");t.exports=class{constructor(e={}){this.provider=e.provider||new r.HttpProvider("https://mainnet.infura.io/eth-contract-registry"),this.eth=new r(this.provider);const t=s[e.network||"1"];if(!t)throw new Error("No method registry found on the requested network.");this.registry=this.eth.contract(i).at(t)}async lookup(e){return(await this.registry.entries(e))[0]}parse(e){let t=e.match(/^.+(?=\()/);t=t?t[0].charAt(0).toUpperCase()+t[0].slice(1).split(/(?=[A-Z])/).join(" "):"";const n=e.match(/\(.+\)/);let r=[];return n&&(r=n[0].slice(1,-1).split(",").map((e=>({type:e})))),{name:t,args:r}}}}}},{package:"eth-method-registry",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/eth-method-registry/index.js"}],[1432,{},function(){with(this)return function(){"use strict";return function(e,t,n){t.exports={1:"0x44691B39d1a75dC4E0A0346CBB15E310e6ED1E86"}}}},{package:"eth-method-registry",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/eth-method-registry/registry-map.json"}],[1433,{"./index":1434,"ethereum-cryptography/hdkey":2491},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r=e("./index"),s=e("ethereum-cryptography/hdkey"),i=function(){function e(e){this._hdkey=e}return e.fromMasterSeed=function(t){return new e(s.HDKey.fromMasterSeed(t))},e.fromExtendedKey=function(t){return new e(s.HDKey.fromExtendedKey(t))},e.prototype.privateExtendedKey=function(){if(!this._hdkey.privateExtendedKey)throw new Error("This is a public key only wallet");return this._hdkey.privateExtendedKey},e.prototype.publicExtendedKey=function(){return this._hdkey.publicExtendedKey},e.prototype.derivePath=function(t){return new e(this._hdkey.derive(t))},e.prototype.deriveChild=function(t){return new e(this._hdkey.deriveChild(t))},e.prototype.getWallet=function(){return this._hdkey._privateKey?r.default.fromPrivateKey(this._hdkey._privateKey):r.default.fromPublicKey(this._hdkey._publicKey,!0)},e}();n.default=i}}},{package:"ethereumjs-wallet",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/ethereumjs-wallet/dist/hdkey.js"}],[1434,{"./hdkey":1433,"./thirdparty":1435,bs58check:2090,buffer:2081,crypto:2191,"ethereumjs-util":2521,randombytes:5554,"scrypt-js":5748,"uuid/v4":1438},function(){with(this)return function(){"use strict";return function(e,t,n){(function(t){(function(){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},r.apply(this,arguments)},s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,s,i,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(s=a.trys,(s=s.length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){a.label=i[1];break}if(6===i[0]&&a.label<s[1]){a.label=s[1],s=i;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(i);break}s[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}};Object.defineProperty(n,"__esModule",{value:!0});var a=e("crypto"),o=e("ethereumjs-util"),c=e("scrypt-js"),u=e("./hdkey");Object.defineProperty(n,"hdkey",{enumerable:!0,get:function(){return u.default}});var l=e("./thirdparty");Object.defineProperty(n,"thirdparty",{enumerable:!0,get:function(){return l.default}});var d=e("bs58check"),h=e("randombytes"),f=e("uuid/v4");function p(e,t,n){if(t.toLowerCase().startsWith("0x")&&(t=t.slice(2)),!t&&!n)return t;if(n%2)throw new Error("Invalid length argument, must be an even number");if("number"==typeof n&&t.length!==n)throw new Error("Invalid "+e+", string must be "+n+" hex characters");if(!/^([0-9a-f]{2})+$/i.test(t))throw new Error("Invalid "+e+", string must be "+("number"==typeof n?n:"empty or a non-zero even number of")+" hex characters");return t}function m(e,n,r){if(!t.isBuffer(n))throw new Error("Invalid "+e+", must be a string ("+("number"==typeof r?""+2*r:"empty or a non-zero even number of")+" hex characters) or buffer"+("number"==typeof r?" ("+r+" bytes)":""));if("number"==typeof r&&n.length!==r)throw new Error("Invalid "+e+", buffer must be "+r+" bytes");return n}var g=function(){function e(e,t){if(void 0===t&&(t=undefined),this.privateKey=e,this.publicKey=t,e&&t)throw new Error("Cannot supply both a private and a public key to the constructor");if(e&&!o.isValidPrivate(e))throw new Error("Private key does not satisfy the curve requirements (ie. it is invalid)");if(t&&!o.isValidPublic(t))throw new Error("Invalid public key")}return e.generate=function(t){if(void 0===t&&(t=!1),!t)return new e(h(32));for(var n=new o.BN("088f924eeceeda7fe92e1f5b0fffffffffffffff",16);;){var r=h(32);if(new o.BN(o.privateToAddress(r)).lte(n))return new e(r)}},e.generateVanityAddress=function(t){for(t instanceof RegExp||(t=new RegExp(t));;){var n=h(32),r=o.privateToAddress(n);if(t.test(r.toString("hex")))return new e(n)}},e.fromPublicKey=function(t,n){return void 0===n&&(n=!1),n&&(t=o.importPublic(t)),new e(undefined,t)},e.fromExtendedPublicKey=function(t){if("xpub"!==t.slice(0,4))throw new Error("Not an extended public key");var n=d.decode(t).slice(45);return e.fromPublicKey(n,!0)},e.fromPrivateKey=function(t){return new e(t)},e.fromExtendedPrivateKey=function(t){if("xprv"!==t.slice(0,4))throw new Error("Not an extended private key");var n=d.decode(t);if(0!==n[45])throw new Error("Invalid extended private key");return e.fromPrivateKey(n.slice(46))},e.fromV1=function(n,r){return s(this,void 0,void 0,(function(){var s,u,l,d,h;return i(this,(function(i){switch(i.label){case 0:if("1"!==(s="object"==typeof n?n:JSON.parse(n)).Version)throw new Error("Not a V1 Wallet");if("scrypt"!==s.Crypto.KeyHeader.Kdf)throw new Error("Unsupported key derivation scheme");return u=s.Crypto.KeyHeader.KdfParams,[4,c.scrypt(t.from(r),t.from(s.Crypto.Salt,"hex"),u.N,u.R,u.P,u.DkLen)];case 1:if(l=i.sent(),d=t.from(s.Crypto.CipherText,"hex"),o.keccak256(t.concat([l.slice(16,32),d])).toString("hex")!==s.Crypto.MAC)throw new Error("Key derivation failed - possibly wrong passphrase");return h=a.createDecipheriv("aes-128-cbc",o.keccak256(l.slice(0,16)).slice(0,16),t.from(s.Crypto.IV,"hex")),[2,new e(y(h,d))]}}))}))},e.fromV3=function(n,r,u){return void 0===u&&(u=!1),s(this,void 0,void 0,(function(){var s,l,d,h,f;return i(this,(function(i){switch(i.label){case 0:if(3!==(s="object"==typeof n?n:JSON.parse(u?n.toLowerCase():n)).version)throw new Error("Not a V3 wallet");return"scrypt"!==s.crypto.kdf?[3,2]:(d=s.crypto.kdfparams,[4,c.scrypt(t.from(r),t.from(d.salt,"hex"),d.n,d.r,d.p,d.dklen)]);case 1:return l=i.sent(),[3,3];case 2:if("pbkdf2"!==s.crypto.kdf)throw new Error("Unsupported key derivation scheme");if("hmac-sha256"!==(d=s.crypto.kdfparams).prf)throw new Error("Unsupported parameters to PBKDF2");l=a.pbkdf2Sync(t.from(r),t.from(d.salt,"hex"),d.c,d.dklen,"sha256"),i.label=3;case 3:if(h=t.from(s.crypto.ciphertext,"hex"),o.keccak256(t.concat([t.from(l.slice(16,32)),h])).toString("hex")!==s.crypto.mac)throw new Error("Key derivation failed - possibly wrong passphrase");return f=a.createDecipheriv(s.crypto.cipher,l.slice(0,16),t.from(s.crypto.cipherparams.iv,"hex")),[2,new e(y(f,h))]}}))}))},e.fromEthSale=function(n,r){var s="object"==typeof n?n:JSON.parse(n),i=t.from(s.encseed,"hex"),c=a.pbkdf2Sync(r,r,2e3,32,"sha256").slice(0,16),u=y(a.createDecipheriv("aes-128-cbc",c,i.slice(0,16)),i.slice(16)),l=new e(o.keccak256(u));if(l.getAddress().toString("hex")!==s.ethaddr)throw new Error("Decoded key mismatch - possibly wrong passphrase");return l},Object.defineProperty(e.prototype,"pubKey",{get:function(){return v(this.publicKey)||(this.publicKey=o.privateToPublic(this.privateKey)),this.publicKey},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"privKey",{get:function(){if(!v(this.privateKey))throw new Error("This is a public key only wallet");return this.privateKey},enumerable:!1,configurable:!0}),e.prototype.getPrivateKey=function(){return this.privKey},e.prototype.getPrivateKeyString=function(){return o.bufferToHex(this.privKey)},e.prototype.getPublicKey=function(){return this.pubKey},e.prototype.getPublicKeyString=function(){return o.bufferToHex(this.getPublicKey())},e.prototype.getAddress=function(){return o.publicToAddress(this.pubKey)},e.prototype.getAddressString=function(){return o.bufferToHex(this.getAddress())},e.prototype.getChecksumAddressString=function(){return o.toChecksumAddress(this.getAddressString())},e.prototype.toV3=function(e,n){return s(this,void 0,void 0,(function(){var s,u,l,d,g,b;return i(this,(function(i){switch(i.label){case 0:if(!v(this.privateKey))throw new Error("This is a public key only wallet");switch(w=n,k={cipher:"aes-128-ctr",kdf:"scrypt",salt:h(32),iv:h(16),uuid:h(16),dklen:32,c:262144,n:262144,r:8,p:1},s=w?("string"==typeof w.salt&&(w.salt=t.from(p("salt",w.salt),"hex")),"string"==typeof w.iv&&(w.iv=t.from(p("iv",w.iv,32),"hex")),"string"==typeof w.uuid&&(w.uuid=t.from(p("uuid",w.uuid,32),"hex")),w.salt&&m("salt",w.salt),w.iv&&m("iv",w.iv,16),w.uuid&&m("uuid",w.uuid,16),r(r({},k),w)):k,s.kdf){case"pbkdf2":return[3,1];case"scrypt":return[3,2]}return[3,4];case 1:return u=function(e){return{dklen:e.dklen,salt:e.salt,c:e.c,prf:"hmac-sha256"}}(s),l=a.pbkdf2Sync(t.from(e),u.salt,u.c,u.dklen,"sha256"),[3,5];case 2:return u=function(e){return{dklen:e.dklen,salt:e.salt,n:e.n,r:e.r,p:e.p}}(s),[4,c.scrypt(t.from(e),u.salt,u.n,u.r,u.p,u.dklen)];case 3:return l=i.sent(),[3,5];case 4:throw new Error("Unsupported kdf");case 5:if(!(d=a.createCipheriv(s.cipher,l.slice(0,16),s.iv)))throw new Error("Unsupported cipher");return g=y(d,this.privKey),b=o.keccak256(t.concat([t.from(l.slice(16,32)),t.from(g)])),[2,{version:3,id:f({random:s.uuid}),address:this.getAddress().toString("hex"),crypto:{ciphertext:g.toString("hex"),cipherparams:{iv:s.iv.toString("hex")},cipher:s.cipher,kdf:s.kdf,kdfparams:r(r({},u),{salt:u.salt.toString("hex")}),mac:b.toString("hex")}}]}var w,k}))}))},e.prototype.getV3Filename=function(e){return["UTC--",(e?new Date(e):new Date).toJSON().replace(/:/g,"-"),"--",this.getAddress().toString("hex")].join("")},e.prototype.toV3String=function(e,t){return s(this,void 0,void 0,(function(){var n,r;return i(this,(function(s){switch(s.label){case 0:return r=(n=JSON).stringify,[4,this.toV3(e,t)];case 1:return[2,r.apply(n,[s.sent()])]}}))}))},e}();function y(e,n){return t.concat([e.update(n),e.final()])}function v(e){return e!==undefined&&null!==e}n.default=g}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"ethereumjs-wallet",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/ethereumjs-wallet/dist/index.js"}],[1435,{"./index":1434,"aes-js":1675,buffer:2081,crypto:2191,"ethereumjs-util":2521,"scrypt-js":5748,utf8:6007},function(){with(this)return function(){"use strict";return function(e,t,n){(function(t){(function(){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function o(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,s,i,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(s=a.trys,(s=s.length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){a.label=i[1];break}if(6===i[0]&&a.label<s[1]){a.label=s[1],s=i;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(i);break}s[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.fromQuorumWallet=n.fromKryptoKit=n.fromEtherCamp=n.fromEtherWallet=void 0;var i=e("crypto"),a=e("ethereumjs-util"),o=e("scrypt-js"),c=e("./index"),u=e("utf8"),l=e("aes-js");var d={count:1,keysize:16,ivsize:16,digest:"md5"};function h(e,n,r){var s=function(e){return e?{count:e.count||d.count,keysize:e.keysize||d.keysize,ivsize:e.ivsize||d.ivsize,digest:e.digest||d.digest}:d}(r);function a(t){var r=i.createHash(s.digest);r.update(t),r.update(e),r.update(n),t=r.digest();for(var a=1,o=s.count;a<o;a++)(r=i.createHash(s.digest)).update(t),t=r.digest();return t}for(var o=[],c=0;t.concat(o).length<s.keysize+s.ivsize;)o[c]=a(0===c?t.alloc(0):o[c-1]),c++;var u=t.concat(o);return{key:u.slice(0,s.keysize),iv:u.slice(s.keysize,s.keysize+s.ivsize)}}function f(e,n){var r,s="object"==typeof e?e:JSON.parse(e);if(s.locked){if("string"!=typeof n)throw new Error("Password required");if(n.length<7)throw new Error("Password must be at least 7 characters");var a=function(e){var n=t.from(e,"base64");return"Salted__"===n.slice(0,8).toString()?{salt:n.slice(8,16),ciphertext:n.slice(16)}:{ciphertext:n}}(s.encrypted?s.private.slice(0,128):s.private);if(!a.salt)throw new Error("Unsupported EtherWallet key format");var o=h(t.from(n),a.salt,{keysize:32,ivsize:16});r=function(e,n){return t.concat([e.update(n),e.final()])}(i.createDecipheriv("aes-256-cbc",o.key,o.iv),t.from(a.ciphertext)),r=t.from(u.decode(r.toString()),"hex")}else{if(64!==s.private.length)throw new Error("Invalid private key length");r=t.from(s.private,"hex")}var l=new c.default(r);if(l.getAddressString()!==s.address)throw new Error("Invalid private key or address");return l}function p(e){return new c.default(a.keccak256(t.from(e)))}function m(e,n){return r(this,void 0,void 0,(function(){var r,i,u,d,h,f,p;return s(this,(function(s){switch(s.label){case 0:return"#"===e[0]&&(e=e.slice(1)),r=e[0],e=e.slice(1),"d"!==r?[3,1]:(i=a.sha256(a.toBuffer(e)),[3,4]);case 1:if("q"!==r)return[3,3];if("string"!=typeof n)throw new Error("Password required");return u=a.sha256(t.from(e.slice(0,30))),d=e.slice(30,46),h=function(e){function n(e){try{return decodeURIComponent(e)}catch(e){return String.fromCharCode(65533)}}for(var r="",s="",i=0;i<e.length;i++)e[i]<=127?(r+=n(s)+String.fromCharCode(e[i]),s=""):s+="%"+e[i].toString(16);return t.from(r+n(s))}(u),[4,o.scrypt(t.from(n,"utf8"),h,16384,8,1,32)];case 2:if(f=s.sent(),p=new l.ModeOfOperation.ecb(f),i=t.concat([t.from(p.decrypt(u.slice(0,16))),t.from(p.decrypt(u.slice(16,32)))]),d.length>0&&d!==a.sha256(a.sha256(i)).slice(0,8).toString("hex"))throw new Error("Failed to decrypt input - possibly invalid passphrase");return[3,4];case 3:throw new Error("Unsupported or invalid entropy type");case 4:return[2,new c.default(i)]}}))}))}function g(e,t){if(e.length<10)throw new Error("Passphrase must be at least 10 characters");if(t.length<10)throw new Error("User id must be at least 10 characters");var n=e+t,r=i.pbkdf2Sync(n,n,2e3,32,"sha256");return new c.default(r)}n.fromEtherWallet=f,n.fromEtherCamp=p,n.fromKryptoKit=m,n.fromQuorumWallet=g;var y={fromEtherWallet:f,fromEtherCamp:p,fromKryptoKit:m,fromQuorumWallet:g};n.default=y}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"ethereumjs-wallet",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/ethereumjs-wallet/dist/thirdparty.js"}],[1436,{},function(){with(this)return function(){"use strict";return function(e,t,n){for(var r=[],s=0;s<256;++s)r[s]=(s+256).toString(16).substr(1);t.exports=function(e,t){var n=t||0,s=r;return[s[e[n++]],s[e[n++]],s[e[n++]],s[e[n++]],"-",s[e[n++]],s[e[n++]],"-",s[e[n++]],s[e[n++]],"-",s[e[n++]],s[e[n++]],"-",s[e[n++]],s[e[n++]],s[e[n++]],s[e[n++]],s[e[n++]],s[e[n++]]].join("")}}}},{package:"uuid",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/ethereumjs-wallet/node_modules/uuid/lib/bytesToUuid.js"}],[1437,{},function(){with(this)return function(){"use strict";return function(e,t,n){var r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(r){var s=new Uint8Array(16);t.exports=function(){return r(s),s}}else{var i=new Array(16);t.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}}}},{package:"uuid",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/ethereumjs-wallet/node_modules/uuid/lib/rng-browser.js"}],[1438,{"./lib/bytesToUuid":1436,"./lib/rng":1437},function(){with(this)return function(){"use strict";return function(e,t,n){var r=e("./lib/rng"),s=e("./lib/bytesToUuid");t.exports=function(e,t,n){var i=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var o=0;o<16;++o)t[i+o]=a[o];return t||s(a)}}}},{package:"uuid",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/ethereumjs-wallet/node_modules/uuid/v4.js"}],[1439,{"./utils/index.js":1440,buffer:2081},function(){with(this)return function(){"use strict";return function(e,t,n){(function(n){(function(){var r=e("./utils/index.js"),s=r.uint256Coder,i=(r.coderBoolean,r.coderFixedBytes,r.coderAddress,r.coderDynamicBytes,r.coderString,r.coderArray,r.paramTypePart,r.getParamCoder);function a(){}function o(e,t){if(e.length!==t.length)throw new Error("[ethjs-abi] while encoding params, types/values mismatch, Your contract requires "+e.length+" types (arguments), and you passed in "+t.length);var r=[];function a(e){return parseInt(32*Math.ceil(e/32))}e.forEach((function(e,n){var s=i(e);r.push({dynamic:s.dynamic,value:s.encode(t[n])})}));var o=0,c=0;r.forEach((function(e){e.dynamic?(o+=32,c+=a(e.value.length)):o+=a(e.value.length)}));var u=0,l=o,d=new n(o+c);return r.forEach((function(e,t){e.dynamic?(s.encode(l).copy(d,u),u+=32,e.value.copy(d,l),l+=a(e.value.length)):(e.value.copy(d,u),u+=a(e.value.length))})),"0x"+d.toString("hex")}function c(e,t,n){var o=!(arguments.length>3&&arguments[3]!==undefined)||arguments[3];arguments.length<3&&(n=t,t=e,e=[]),n=r.hexOrBuffer(n);var c=new a,u=0;return t.forEach((function(t,r){var a=i(t);if(a.dynamic){var l=s.decode(n,u),d=a.decode(n,l.value.toNumber());u+=l.consumed}else{d=a.decode(n,u);u+=d.consumed}o&&(c[r]=d.value),e[r]&&(c[e[r]]=d.value)})),c}function u(e){var t=e.name+"("+r.getKeys(e.inputs,"type").join(",")+")";return"0x"+new n(r.keccak256(t),"hex").slice(0,4).toString("hex")}function l(e,t){var n=o(r.getKeys(e.inputs,"type"),t).substring(2);return""+u(e)+n}function d(e){var t=e.name+"("+r.getKeys(e.inputs,"type").join(",")+")";return"0x"+r.keccak256(t)}function h(e,t,s){var a=!(arguments.length>3&&arguments[3]!==undefined)||arguments[3],o=e.inputs.filter((function(e){return!e.indexed})),u=r.getKeys(o,"name",!0),l=r.getKeys(o,"type"),d=c(u,l,r.hexOrBuffer(t),a),h=e.anonymous?0:1;return e.inputs.filter((function(e){return e.indexed})).map((function(e,t){var r=new n(s[t+h].slice(2),"hex"),a=i(e.type);d[e.name]=a.decode(r,0).value})),d._eventName=e.name,d}function f(e,t){var n=!(arguments.length>2&&arguments[2]!==undefined)||arguments[2];if(e&&t.topics[0]===d(e))return h(e,t.data,t.topics,n)}t.exports={encodeParams:o,decodeParams:c,encodeMethod:l,decodeMethod:function(e,t){return c(r.getKeys(e.outputs,"name",!0),r.getKeys(e.outputs,"type"),r.hexOrBuffer(t))},encodeEvent:function(e,t){return l(e,t)},decodeEvent:h,decodeLogItem:f,logDecoder:function(e){var t=!(arguments.length>1&&arguments[1]!==undefined)||arguments[1],n={};return e.filter((function(e){return"event"===e.type})).map((function(e){n[d(e)]=e})),function(e){return e.map((function(e){return f(n[e.topics[0]],e,t)})).filter((function(e){return e}))}},eventSignature:d,encodeSignature:u}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"ethjs-abi",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/ethjs-abi/lib/index.js"}],[144,{"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,lodash:5172},function(){with(this)return function(){"use strict";return function(e,t,n){var r=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=r(e("@babel/runtime/helpers/defineProperty")),i=e("lodash");function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){(0,s.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var c={version:63,async migrate(e){const t=(0,i.cloneDeep)(e);t.meta.version=63;const n=function(e){var t,n,r,s,i,a,c,u;const l=null==e||null===(t=e.PreferencesController)||void 0===t?void 0:t.accountTokens,d=null==e||null===(n=e.PreferencesController)||void 0===n?void 0:n.accountHiddenTokens,h={};l&&Object.keys(l).forEach((e=>{Object.keys(l[e]).forEach((t=>{const n=l[e][t];h[t]===undefined?h[t]={[e]:n}:h[t]=o(o({},h[t]),{},{[e]:n})}))}));const f={};d&&Object.keys(d).forEach((e=>{Object.keys(d[e]).forEach((t=>{const n=d[e][t];f[t]===undefined?f[t]={[e]:n}:f[t]=o(o({},f[t]),{},{[e]:n})}))}));e.TokensController?(e.TokensController.allTokens=h,e.TokensController.allIgnoredTokens=f):e.TokensController={allTokens:h,allIgnoredTokens:f};return null==e||(null===(r=e.PreferencesController)||void 0===r||delete r.accountHiddenTokens),null==e||null===(s=e.PreferencesController)||void 0===s||delete s.accountTokens,null==e||null===(i=e.PreferencesController)||void 0===i||delete i.assetImages,null==e||null===(a=e.PreferencesController)||void 0===a||delete a.hiddenTokens,null==e||null===(c=e.PreferencesController)||void 0===c||delete c.tokens,null==e||null===(u=e.PreferencesController)||void 0===u||delete u.suggestedTokens,e}(t.data);return t.data=n,t}};n.default=c}}},{package:"<root>",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/app/scripts/migrations/063.js"}],[1440,{"bn.js":1413,buffer:2081,"js-sha3":1449,"number-to-bn":5298},function(){with(this)return function(){"use strict";return function(e,t,n){(function(n){(function(){var r=e("bn.js"),s=e("number-to-bn"),i=e("js-sha3").keccak_256;function a(e){for(var t=e,n=t[0];t.length>0&&"0"===n.toString();)n=(t=t.slice(1))[0];return t}function o(e){var t=e.toString(16);return t.length%2&&(t="0"+t),a(new n(t,"hex"))}function c(e,t){return!("string"!=typeof e||!e.match(/^0x[0-9A-Fa-f]*$/))&&(!t||e.length===2+2*t)}function u(e,t){var r=e;if(!n.isBuffer(r)){if(!c(r)){var s=new Error(t?"[ethjs-abi] invalid "+t:"[ethjs-abi] invalid hex or buffer, must be a prefixed alphanumeric even length hex string");throw s.reason="[ethjs-abi] invalid hex string, hex must be prefixed and alphanumeric (e.g. 0x023..)",s.value=r,s}(r=r.substring(2)).length%2&&(r="0"+r),r=new n(r,"hex")}return r}function l(e,t){return{encode:function(r){var i=r;return"object"==typeof i&&i.toString&&(i.toTwos||i.dividedToIntegerBy)&&(i=i.toString(10).split(".")[0]),"string"!=typeof i&&"number"!=typeof i||(i=String(i).split(".")[0]),i=(i=s(i)).toTwos(8*e).maskn(8*e),t&&(i=i.fromTwos(8*e).toTwos(256)),i.toArrayLike(n,"be",32)},decode:function(n,s){var i=32-e,a=new r(n.slice(s+i,s+32));return a=t?a.fromTwos(8*e):a.maskn(8*e),{consumed:32,value:new r(a.toString(10))}}}}var d=l(32,!1),h={encode:function(e){return d.encode(e?1:0)},decode:function(e,t){var n=d.decode(e,t);return{consumed:n.consumed,value:!n.value.isZero()}}};function f(e){return{encode:function(e){var t=e;if(32===(t=u(t)).length)return t;var r=new n(32);return r.fill(0),t.copy(r),r},decode:function(t,n){if(0!==t.length&&t.length<n+32)throw new Error("[ethjs-abi] while decoding fixed bytes, invalid bytes data length: "+e);return{consumed:32,value:"0x"+t.slice(n,n+e).toString("hex")}}}}var p={encode:function(e){var t=e,r=new n(32);if(!c(t,20))throw new Error("[ethjs-abi] while encoding address, invalid address value, not alphanumeric 20 byte hex string");return t=u(t),r.fill(0),t.copy(r,12),r},decode:function(e,t){if(0===e.length)return{consumed:32,value:"0x"};if(0!==e.length&&e.length<t+32)throw new Error("[ethjs-abi] while decoding address data, invalid address data, invalid byte length "+e.length);return{consumed:32,value:"0x"+e.slice(t+12,t+32).toString("hex")}}};function m(e){var t=parseInt(32*Math.ceil(e.length/32)),r=new n(t-e.length);return r.fill(0),n.concat([d.encode(e.length),e,r])}function g(e,t){if(0!==e.length&&e.length<t+32)throw new Error("[ethjs-abi] while decoding dynamic bytes data, invalid bytes length: "+e.length+" should be less than "+(t+32));var n=d.decode(e,t).value;if(n=n.toNumber(),0!==e.length&&e.length<t+32+n)throw new Error("[ethjs-abi] while decoding dynamic bytes data, invalid bytes length: "+e.length+" should be less than "+(t+32+n));return{consumed:parseInt(32+32*Math.ceil(n/32),10),value:e.slice(t+32,t+32+n)}}var y={encode:function(e){return m(u(e))},decode:function(e,t){var n=g(e,t);return n.value="0x"+n.value.toString("hex"),n},dynamic:!0},v={encode:function(e){return m(new n(e,"utf8"))},decode:function(e,t){var n=g(e,t);return n.value=n.value.toString("utf8"),n},dynamic:!0};function b(e,t){return{encode:function(r){var s=new n(0),i=t;if(!Array.isArray(r))throw new Error("[ethjs-abi] while encoding array, invalid array data, not type Object (Array)");if(-1===i&&(i=r.length,s=d.encode(i)),i!==r.length)throw new Error("[ethjs-abi] while encoding array, size mismatch array length "+i+" does not equal "+r.length);return r.forEach((function(t){s=n.concat([s,e.encode(t)])})),s},decode:function(n,r){var s,i=t,a=r,o=0;-1===i&&(i=(s=d.decode(n,a)).value.toNumber(),o+=s.consumed,a+=s.consumed);for(var c=[],u=0;u<i;u++){var l=e.decode(n,a);o+=l.consumed,a+=l.consumed,c.push(l.value)}return{consumed:o,value:c}},dynamic:-1===t}}var w=new RegExp(/^((u?int|bytes)([0-9]*)|(address|bool|string)|(\[([0-9]*)\]))/);t.exports={BN:r,bnToBuffer:o,isHexString:c,hexOrBuffer:u,hexlify:function(e){return"number"==typeof e?"0x"+o(new r(e)).toString("hex"):e.mod||e.modulo?"0x"+o(e).toString("hex"):"0x"+u(e).toString("hex")},stripZeros:a,keccak256:i,getKeys:function(e,t,n){var r=[];if(!Array.isArray(e))throw new Error("[ethjs-abi] while getting keys, invalid params value "+JSON.stringify(e));for(var s=0;s<e.length;s++){var i=e[s][t];if(n&&!i)i="";else if("string"!=typeof i)throw new Error("[ethjs-abi] while getKeys found invalid ABI data structure, type value not string");r.push(i)}return r},numberToBN:s,coderNumber:l,uint256Coder:d,coderBoolean:h,coderFixedBytes:f,coderAddress:p,coderDynamicBytes:y,coderString:v,coderArray:b,paramTypePart:w,getParamCoder:function(e){for(var t=e,n=null,r="[ethjs-abi] while getting param coder (getParamCoder) type value "+JSON.stringify(t)+" is either invalid or unsupported by ethjs-abi.";t;){var s=t.match(w);if(!s)throw new Error(r);t=t.substring(s[0].length);var i=s[2]||s[4]||s[5];switch(i){case"int":case"uint":if(n)throw new Error(r);var a=parseInt(s[3]||256);if(0===a||a>256||a%8!=0)throw new Error("[ethjs-abi] while getting param coder for type "+t+", invalid "+i+"<N> width: "+t);n=l(a/8,"int"===i);break;case"bool":if(n)throw new Error(r);n=h;break;case"string":if(n)throw new Error(r);n=v;break;case"bytes":if(n)throw new Error(r);if(s[3]){var o=parseInt(s[3]);if(0===o||o>32)throw new Error("[ethjs-abi] while getting param coder for prefix bytes, invalid type "+t+", size "+o+" should be 0 or greater than 32");n=f(o)}else n=y;break;case"address":if(n)throw new Error(r);n=p;break;case"[]":if(!n||n.dynamic)throw new Error(r);n=b(n,-1);break;default:if(!n||n.dynamic)throw new Error(r);n=b(n,parseInt(s[6]))}}if(!n)throw new Error(r);return n}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"ethjs-abi",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/ethjs-abi/lib/utils/index.js"}],[1441,{"./has-tx-object":1442,"babel-runtime/core-js/json/stringify":1816,"babel-runtime/core-js/object/assign":1817,"babel-runtime/helpers/asyncToGenerator":1825,"babel-runtime/regenerator":1942,"ethjs-abi":1444,"ethjs-filter":2567,"ethjs-util":2575,"js-sha3":1449,"promise-to-callback":5422},function(){with(this)return function(){"use strict";return function(e,t,n){var r=o(e("babel-runtime/regenerator")),s=o(e("babel-runtime/core-js/json/stringify")),i=o(e("babel-runtime/helpers/asyncToGenerator")),a=o(e("babel-runtime/core-js/object/assign"));function o(e){return e&&e.__esModule?e:{default:e}}var c=e("ethjs-abi"),u=e("ethjs-filter"),l=e("ethjs-util").getKeys,d=e("js-sha3").keccak_256,h=e("./has-tx-object"),f=e("promise-to-callback");function p(e){return e.filter((function(e){return("function"===e.type||"event"===e.type)&&e.name.length>0}))}t.exports=function(){var e=(o=(0,i.default)(r.default.mark((function e(t){var i,o,u,l,d,f=t.methodObject,p=t.methodArgs;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="call",o={},h(p)&&(o=p.pop()),(u=(0,a.default)({},n.defaultTxObject,o,{to:n.address})).data=c.encodeMethod(f,p),!1===f.constant&&(i="sendTransaction"),e.next=8,n.query[i](u);case 8:if(l=e.sent,"call"!==i){e.next=19;break}return e.prev=10,d=c.decodeMethod(f,l),e.abrupt("return",d);case 15:throw e.prev=15,e.t0=e.catch(10),new Error("[ethjs-contract] while formatting incoming raw call data "+(0,s.default)(l)+" "+e.t0);case 19:return e.abrupt("return",l);case 20:case"end":return e.stop()}}),e,this,[[10,15]])}))),function(e){return o.apply(this,arguments)}),t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},n=this;var o;function m(e){return function(){var t=[].slice.call(arguments),r=l(e.inputs,"type",!1),s="0x"+d(e.name+"("+r.join(",")+")"),i=[s],o=(0,a.default)({},t[0])||{},u=(0,a.default)({},t[0]||{},{to:n.address,topics:i}),h=(0,a.default)({},o,{decoder:function(t){return c.decodeEvent(e,t,i)},defaultFilterObject:u});return new n.filters.Filter(h)}}function g(t){return function(){var n=void 0,r=[].slice.call(arguments);"function"==typeof r[r.length-1]&&(n=r.pop());var s=e({methodObject:t,methodArgs:r});return n?f(s)(n):s}}n.abi=t.contractABI||[],n.query=t.query,n.address=t.address||"0x",n.bytecode=t.contractBytecode||"0x",n.defaultTxObject=t.contractDefaultTxObject||{},n.filters=new u(n.query),p(n.abi).forEach((function(e){"function"===e.type?n[e.name]=g(e):"event"===e.type&&(n[e.name]=m(e))}))}}}},{package:"ethjs-contract",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/ethjs-contract/lib/contract.js"}],[1442,{"babel-runtime/core-js/object/keys":1820},function(){with(this)return function(){"use strict";return function(e,t,n){var r,s=e("babel-runtime/core-js/object/keys"),i=(r=s)&&r.__esModule?r:{default:r};var a=["from","to","data","value","gasPrice","gas"];t.exports=function(e){if(!Array.isArray(e)||0===e.length)return!1;var t=e[e.length-1];if(!t)return!1;if("object"!=typeof t)return!1;if(0===(0,i.default)(t).length)return!0;var n=(0,i.default)(t);if(a.some((function(e){return n.includes(e)})))return!0;return!1}}}},{package:"ethjs-contract",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/ethjs-contract/lib/has-tx-object.js"}],[1443,{"./contract":1441,"./has-tx-object":1442,"babel-runtime/core-js/object/assign":1817,"ethjs-abi":1444,"ethjs-filter":2567,"ethjs-util":2575,"js-sha3":1449},function(){with(this)return function(){"use strict";return function(e,t,n){var r,s=e("babel-runtime/core-js/object/assign"),i=(r=s)&&r.__esModule?r:{default:r};var a=e("ethjs-abi"),o=(e("js-sha3").keccak_256,e("ethjs-filter"),e("ethjs-util").getKeys),c=e("./contract"),u=e("./has-tx-object");function l(e){return e.filter((function(e){return"constructor"===e.type}))[0]}t.exports=function(e){return function(t,n,r){if(!Array.isArray(t))throw new Error("[ethjs-contract] Contract ABI must be type Array, got type "+typeof t);if(void 0!==n&&"string"!=typeof n)throw new Error("[ethjs-contract] Contract bytecode must be type String, got type "+typeof n);if(void 0!==r&&"object"!=typeof r)throw new Error("[ethjs-contract] Contract default tx object must be type Object, got type "+typeof t);var s={at:function(s){return new c({address:s,query:e,contractBytecode:n,contractDefaultTxObject:r,contractABI:t})},new:function(){var s={},c=null,d=[].slice.call(arguments);"function"==typeof d[d.length-1]&&(c=d.pop()),u(d)&&(s=d.pop());var h=l(t),f=(0,i.default)({},r,s);if(n&&(f.data=n),h){var p=a.encodeParams(o(h.inputs,"type"),d).substring(2);f.data=""+f.data+p}return c?e.sendTransaction(f,c):e.sendTransaction(f)}};return s}}}}},{package:"ethjs-contract",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/ethjs-contract/lib/index.js"}],[1444,{"./utils/index.js":1445,buffer:2081},function(){with(this)return function(){"use strict";return function(e,t,n){(function(n){(function(){var r=e("./utils/index.js"),s=r.uint256Coder,i=(r.coderBoolean,r.coderFixedBytes,r.coderAddress,r.coderDynamicBytes,r.coderString,r.coderArray,r.paramTypePart,r.getParamCoder);function a(){}function o(e,t){if(e.length!==t.length)throw new Error("[ethjs-abi] while encoding params, types/values mismatch, Your contract requires "+e.length+" types (arguments), and you passed in "+t.length);var r=[];function a(e){return parseInt(32*Math.ceil(e/32))}e.forEach((function(e,n){var s=i(e);r.push({dynamic:s.dynamic,value:s.encode(t[n])})}));var o=0,c=0;r.forEach((function(e){e.dynamic?(o+=32,c+=a(e.value.length)):o+=a(e.value.length)}));var u=0,l=o,d=new n(o+c);return r.forEach((function(e,t){e.dynamic?(s.encode(l).copy(d,u),u+=32,e.value.copy(d,l),l+=a(e.value.length)):(e.value.copy(d,u),u+=a(e.value.length))})),"0x"+d.toString("hex")}function c(e,t,n){var o=!(arguments.length>3&&arguments[3]!==undefined)||arguments[3];arguments.length<3&&(n=t,t=e,e=[]),n=r.hexOrBuffer(n);var c=new a,u=0;return t.forEach((function(t,r){var a=i(t);if(a.dynamic){var l=s.decode(n,u),d=a.decode(n,l.value.toNumber());u+=l.consumed}else{d=a.decode(n,u);u+=d.consumed}o&&(c[r]=d.value),e[r]&&(c[e[r]]=d.value)})),c}function u(e,t){var s=e.name+"("+r.getKeys(e.inputs,"type").join(",")+")";return""+("0x"+new n(r.keccak256(s),"hex").slice(0,4).toString("hex"))+o(r.getKeys(e.inputs,"type"),t).substring(2)}function l(e){var t=e.name+"("+r.getKeys(e.inputs,"type").join(",")+")";return"0x"+r.keccak256(t)}function d(e,t,s){var a=!(arguments.length>3&&arguments[3]!==undefined)||arguments[3],o=e.inputs.filter((function(e){return!e.indexed})),u=r.getKeys(o,"name",!0),l=r.getKeys(o,"type"),d=c(u,l,r.hexOrBuffer(t),a),h=e.anonymous?0:1;return e.inputs.filter((function(e){return e.indexed})).map((function(e,t){var r=new n(s[t+h].slice(2),"hex"),a=i(e.type);d[e.name]=a.decode(r,0).value})),d._eventName=e.name,d}function h(e,t){var n=!(arguments.length>2&&arguments[2]!==undefined)||arguments[2];if(e&&t.topics[0]===l(e))return d(e,t.data,t.topics,n)}t.exports={encodeParams:o,decodeParams:c,encodeMethod:u,decodeMethod:function(e,t){return c(r.getKeys(e.outputs,"name",!0),r.getKeys(e.outputs,"type"),r.hexOrBuffer(t))},encodeEvent:function(e,t){return u(e,t)},decodeEvent:d,decodeLogItem:h,logDecoder:function(e){var t=!(arguments.length>1&&arguments[1]!==undefined)||arguments[1],n={};return e.filter((function(e){return"event"===e.type})).map((function(e){n[l(e)]=e})),function(e){return e.map((function(e){return h(n[e.topics[0]],e,t)})).filter((function(e){return e}))}},eventSignature:l}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"ethjs-abi",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/ethjs-contract/node_modules/ethjs-abi/lib/index.js"}],[1445,{"bn.js":1413,buffer:2081,"js-sha3":1449,"number-to-bn":5298},function(){with(this)return function(){"use strict";return function(e,t,n){(function(n){(function(){var r=e("bn.js"),s=e("number-to-bn"),i=e("js-sha3").keccak_256;function a(e){for(var t=e,n=t[0];t.length>0&&"0"===n.toString();)n=(t=t.slice(1))[0];return t}function o(e){var t=e.toString(16);return t.length%2&&(t="0"+t),a(new n(t,"hex"))}function c(e,t){return!("string"!=typeof e||!e.match(/^0x[0-9A-Fa-f]*$/))&&(!t||e.length===2+2*t)}function u(e,t){var r=e;if(!n.isBuffer(r)){if(!c(r)){var s=new Error(t?"[ethjs-abi] invalid "+t:"[ethjs-abi] invalid hex or buffer, must be a prefixed alphanumeric even length hex string");throw s.reason="[ethjs-abi] invalid hex string, hex must be prefixed and alphanumeric (e.g. 0x023..)",s.value=r,s}(r=r.substring(2)).length%2&&(r="0"+r),r=new n(r,"hex")}return r}function l(e,t){return{encode:function(r){var i=r;return"object"==typeof i&&i.toString&&(i.toTwos||i.dividedToIntegerBy)&&(i=i.toString(10).split(".")[0]),"string"!=typeof i&&"number"!=typeof i||(i=String(i).split(".")[0]),i=(i=s(i)).toTwos(8*e).maskn(8*e),t&&(i=i.fromTwos(8*e).toTwos(256)),i.toArrayLike(n,"be",32)},decode:function(n,s){var i=32-e,a=new r(n.slice(s+i,s+32));return a=t?a.fromTwos(8*e):a.maskn(8*e),{consumed:32,value:new r(a.toString(10))}}}}var d=l(32,!1),h={encode:function(e){return d.encode(e?1:0)},decode:function(e,t){var n=d.decode(e,t);return{consumed:n.consumed,value:!n.value.isZero()}}};function f(e){return{encode:function(e){var t=e;if(32===(t=u(t)).length)return t;var r=new n(32);return r.fill(0),t.copy(r),r},decode:function(t,n){if(0!==t.length&&t.length<n+32)throw new Error("[ethjs-abi] while decoding fixed bytes, invalid bytes data length: "+e);return{consumed:32,value:"0x"+t.slice(n,n+e).toString("hex")}}}}var p={encode:function(e){var t=e,r=new n(32);if(!c(t,20))throw new Error("[ethjs-abi] while encoding address, invalid address value, not alphanumeric 20 byte hex string");return t=u(t),r.fill(0),t.copy(r,12),r},decode:function(e,t){if(0===e.length)return{consumed:32,value:"0x"};if(0!==e.length&&e.length<t+32)throw new Error("[ethjs-abi] while decoding address data, invalid address data, invalid byte length "+e.length);return{consumed:32,value:"0x"+e.slice(t+12,t+32).toString("hex")}}};function m(e){var t=parseInt(32*Math.ceil(e.length/32)),r=new n(t-e.length);return r.fill(0),n.concat([d.encode(e.length),e,r])}function g(e,t){if(0!==e.length&&e.length<t+32)throw new Error("[ethjs-abi] while decoding dynamic bytes data, invalid bytes length: "+e.length+" should be less than "+(t+32));var n=d.decode(e,t).value;if(n=n.toNumber(),0!==e.length&&e.length<t+32+n)throw new Error("[ethjs-abi] while decoding dynamic bytes data, invalid bytes length: "+e.length+" should be less than "+(t+32+n));return{consumed:parseInt(32+32*Math.ceil(n/32),10),value:e.slice(t+32,t+32+n)}}var y={encode:function(e){return m(u(e))},decode:function(e,t){var n=g(e,t);return n.value="0x"+n.value.toString("hex"),n},dynamic:!0},v={encode:function(e){return m(new n(e,"utf8"))},decode:function(e,t){var n=g(e,t);return n.value=n.value.toString("utf8"),n},dynamic:!0};function b(e,t){return{encode:function(r){var s=new n(0),i=t;if(!Array.isArray(r))throw new Error("[ethjs-abi] while encoding array, invalid array data, not type Object (Array)");if(-1===i&&(i=r.length,s=d.encode(i)),i!==r.length)throw new Error("[ethjs-abi] while encoding array, size mismatch array length "+i+" does not equal "+r.length);return r.forEach((function(t){s=n.concat([s,e.encode(t)])})),s},decode:function(n,r){var s,i=t,a=r,o=0;-1===i&&(i=(s=d.decode(n,a)).value.toNumber(),o+=s.consumed,a+=s.consumed);for(var c=[],u=0;u<i;u++){var l=e.decode(n,a);o+=l.consumed,a+=l.consumed,c.push(l.value)}return{consumed:o,value:c}},dynamic:-1===t}}var w=new RegExp(/^((u?int|bytes)([0-9]*)|(address|bool|string)|(\[([0-9]*)\]))/);t.exports={BN:r,bnToBuffer:o,isHexString:c,hexOrBuffer:u,hexlify:function(e){return"number"==typeof e?"0x"+o(new r(e)).toString("hex"):e.mod||e.modulo?"0x"+o(e).toString("hex"):"0x"+u(e).toString("hex")},stripZeros:a,keccak256:i,getKeys:function(e,t,n){var r=[];if(!Array.isArray(e))throw new Error("[ethjs-abi] while getting keys, invalid params value "+JSON.stringify(e));for(var s=0;s<e.length;s++){var i=e[s][t];if(n&&!i)i="";else if("string"!=typeof i)throw new Error("[ethjs-abi] while getKeys found invalid ABI data structure, type value not string");r.push(i)}return r},numberToBN:s,coderNumber:l,uint256Coder:d,coderBoolean:h,coderFixedBytes:f,coderAddress:p,coderDynamicBytes:y,coderString:v,coderArray:b,paramTypePart:w,getParamCoder:function(e){for(var t=e,n=null,r="[ethjs-abi] while getting param coder (getParamCoder) type value "+JSON.stringify(t)+" is either invalid or unsupported by ethjs-abi.";t;){var s=t.match(w);if(!s)throw new Error(r);t=t.substring(s[0].length);var i=s[2]||s[4]||s[5];switch(i){case"int":case"uint":if(n)throw new Error(r);var a=parseInt(s[3]||256);if(0===a||a>256||a%8!=0)throw new Error("[ethjs-abi] while getting param coder for type "+t+", invalid "+i+"<N> width: "+t);n=l(a/8,"int"===i);break;case"bool":if(n)throw new Error(r);n=h;break;case"string":if(n)throw new Error(r);n=v;break;case"bytes":if(n)throw new Error(r);if(s[3]){var o=parseInt(s[3]);if(0===o||o>32)throw new Error("[ethjs-abi] while getting param coder for prefix bytes, invalid type "+t+", size "+o+" should be 0 or greater than 32");n=f(o)}else n=y;break;case"address":if(n)throw new Error(r);n=p;break;case"[]":if(!n||n.dynamic)throw new Error(r);n=b(n,-1);break;default:if(!n||n.dynamic)throw new Error(r);n=b(n,parseInt(s[6]))}}if(!n)throw new Error(r);return n}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"ethjs-abi",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/ethjs-contract/node_modules/ethjs-abi/lib/utils/index.js"}],[1446,{"babel-runtime/core-js/json/stringify":1816,"babel-runtime/core-js/object/assign":1817,"babel-runtime/core-js/object/define-property":1819,"babel-runtime/core-js/object/keys":1820,"babel-runtime/helpers/asyncToGenerator":1825,"babel-runtime/regenerator":1942,"ethjs-format":2568,"ethjs-rpc":2571,"promise-to-callback":5422},function(){with(this)return function(){"use strict";return function(e,t,n){var r=u(e("babel-runtime/regenerator")),s=u(e("babel-runtime/core-js/json/stringify")),i=u(e("babel-runtime/helpers/asyncToGenerator")),a=u(e("babel-runtime/core-js/object/define-property")),o=u(e("babel-runtime/core-js/object/keys")),c=u(e("babel-runtime/core-js/object/assign"));function u(e){return e&&e.__esModule?e:{default:e}}var l=e("ethjs-format"),d=e("ethjs-rpc"),h=e("promise-to-callback");function f(e,t){var n=this,r=t||{};if(!(this instanceof f))throw new Error('[ethjs-query] the Eth object requires the "new" flag in order to function normally (i.e. `const eth = new Eth(provider);`).');if("object"!=typeof e)throw new Error("[ethjs-query] the Eth object requires that the first input 'provider' must be an object, got '"+typeof e+"' (i.e. 'const eth = new Eth(provider);')");n.options=(0,c.default)({debug:r.debug||!1,logger:r.logger||console,jsonSpace:r.jsonSpace||0}),n.rpc=new d(e),n.setProvider=n.rpc.setProvider}function p(e,t){return function(){var n,a=(n=(0,i.default)(r.default.mark((function n(){var i,a;return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(d.length<t[2])){n.next=2;break}throw new Error("[ethjs-query] method '"+f+"' requires at least "+t[2]+" input (format type "+t[0][0]+"), "+d.length+" provided. For more information visit: https://github.com/ethereum/wiki/wiki/JSON-RPC#"+e.toLowerCase());case 2:if(!(d.length>t[0].length)){n.next=4;break}throw new Error("[ethjs-query] method '"+f+"' requires at most "+t[0].length+" params, "+d.length+" provided '"+(0,s.default)(d,null,u.options.jsonSpace)+"'. For more information visit: https://github.com/ethereum/wiki/wiki/JSON-RPC#"+e.toLowerCase());case 4:t[3]&&d.length<t[3]&&d.push("latest"),this.log("attempting method formatting for '"+f+"' with inputs "+(0,s.default)(d,null,this.options.jsonSpace)),n.prev=6,c=l.formatInputs(e,d),this.log("method formatting success for '"+f+"' with formatted result: "+(0,s.default)(c,null,this.options.jsonSpace)),n.next=14;break;case 11:throw n.prev=11,n.t0=n.catch(6),new Error("[ethjs-query] while formatting inputs '"+(0,s.default)(d,null,this.options.jsonSpace)+"' for method '"+f+"' error: "+n.t0);case 14:return n.next=16,this.rpc.sendAsync({method:e,params:c});case 16:return i=n.sent,n.prev=17,this.log("attempting method formatting for '"+f+"' with raw outputs: "+(0,s.default)(i,null,this.options.jsonSpace)),a=l.formatOutputs(e,i),this.log("method formatting success for '"+f+"' formatted result: "+(0,s.default)(a,null,this.options.jsonSpace)),n.abrupt("return",a);case 24:throw n.prev=24,n.t1=n.catch(17),new Error("[ethjs-query] while formatting outputs from RPC '"+(0,s.default)(i,null,this.options.jsonSpace)+"' for method '"+f+"' "+n.t1);case 28:case"end":return n.stop()}}),n,this,[[6,11],[17,24]])}))),function(){return n.apply(this,arguments)}),o=null,c=null,u=this,d=[].slice.call(arguments),f=e.replace("eth_","");d.length>0&&"function"==typeof d[d.length-1]&&(o=d.pop());var p=a.call(this);return o?h(p)(o):p}}t.exports=f,f.prototype.log=function(e){this.options.debug&&this.options.logger.log("[ethjs-query log] "+e)},(0,o.default)(l.schema.methods).forEach((function(e){(0,a.default)(f.prototype,e.replace("eth_",""),{enumerable:!0,value:p(e,l.schema.methods[e])})}))}}},{package:"ethjs-query",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/ethjs-query/lib/index.js"}],[1447,{"./lib/getTransactionSuccess.js":1448,"bn.js":1413,buffer:2081,"ethjs-abi":1439,"ethjs-contract":1443,"ethjs-filter":2567,"ethjs-provider-http":2569,"ethjs-query":1446,"ethjs-unit":2573,"ethjs-util":2575,"js-sha3":1449,"number-to-bn":5298},function(){with(this)return function(){"use strict";return function(e,t,n){(function(n){(function(){var r=e("ethjs-query"),s=e("ethjs-filter"),i=e("ethjs-contract"),a=e("ethjs-provider-http"),o=e("ethjs-abi"),c=e("ethjs-unit"),u=e("js-sha3").keccak_256,l=e("number-to-bn"),d=e("bn.js"),h=e("ethjs-util"),f=e("./lib/getTransactionSuccess.js");function p(e,t){if(!(this instanceof p))throw new Error('[ethjs] the Eth object requires you construct it with the "new" flag (i.e. `const eth = new Eth(...);`).');var n=this;n.options=t||{};var a=new r(e,n.options.query);Object.keys(Object.getPrototypeOf(a)).forEach((function(e){n[e]=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return a[e].apply(a,n)}})),n.filter=new s(a,n.options.query),n.contract=new i(a,n.options.query),n.currentProvider=a.rpc.currentProvider,n.setProvider=a.setProvider,n.getTransactionSuccess=f(n)}t.exports=p,p.BN=d,p.isAddress=function(e){return h.isHexString(e,20)},p.keccak256=function(e){return"0x"+u(e)},p.Buffer=n,p.isHexString=h.isHexString,p.fromWei=c.fromWei,p.toWei=c.toWei,p.toBN=l,p.abi=o,p.fromAscii=h.fromAscii,p.toAscii=h.toAscii,p.fromUtf8=h.fromUtf8,p.toUtf8=h.toUtf8,p.HttpProvider=a}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"ethjs",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/ethjs/lib/index.js"}],[1448,{},function(){with(this)return function(){"use strict";return function(e,t,n){t.exports=function(e){return function(t,n){var r=0,s=e.options.timeout||8e5,i=e.options.interval||7e3,a=new Promise((function(n,a){var o=setInterval((function(){(e.getTransactionReceipt(t,(function(e,t){e&&(clearInterval(o),a(e)),!e&&t&&(clearInterval(o),n(t))})),r>=s)&&(clearInterval(o),a("Receipt timeout waiting for tx hash: "+t));r+=i}),i)}));return n&&a.then((function(e){return n(null,e)})).catch((function(e){return n(e,null)})),n?null:a}}}}},{package:"ethjs",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/ethjs/lib/lib/getTransactionSuccess.js"}],[1449,{_process:5420},function(){with(this)return function(){"use strict";return function(e,t,n){(function(e){(function(){
/**
 * [js-sha3]{@link https://github.com/emn178/js-sha3}
 *
 * @version 0.5.5
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2015-2016
 * @license MIT
 */
!function(n){"object"==typeof e&&e.versions&&e.versions.node&&(n=global);for(var r=!n.JS_SHA3_TEST&&"object"==typeof t&&t.exports,s="0123456789abcdef".split(""),i=[0,8,16,24],a=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648],o=[224,256,384,512],c=["hex","buffer","arrayBuffer","array"],u=function(e,t,n){return function(r){return new v(e,t,e).update(r)[n]()}},l=function(e,t,n){return function(r,s){return new v(e,t,s).update(r)[n]()}},d=function(e,t){var n=u(e,t,"hex");n.create=function(){return new v(e,t,e)},n.update=function(e){return n.create().update(e)};for(var r=0;r<c.length;++r){var s=c[r];n[s]=u(e,t,s)}return n},h=[{name:"keccak",padding:[1,256,65536,16777216],bits:o,createMethod:d},{name:"sha3",padding:[6,1536,393216,100663296],bits:o,createMethod:d},{name:"shake",padding:[31,7936,2031616,520093696],bits:[128,256],createMethod:function(e,t){var n=l(e,t,"hex");n.create=function(n){return new v(e,t,n)},n.update=function(e,t){return n.create(t).update(e)};for(var r=0;r<c.length;++r){var s=c[r];n[s]=l(e,t,s)}return n}}],f={},p=0;p<h.length;++p)for(var m=h[p],g=m.bits,y=0;y<g.length;++y)f[m.name+"_"+g[y]]=m.createMethod(g[y],m.padding);function v(e,t,n){this.blocks=[],this.s=[],this.padding=t,this.outputBits=n,this.reset=!0,this.block=0,this.start=0,this.blockCount=1600-(e<<1)>>5,this.byteCount=this.blockCount<<2,this.outputBlocks=n>>5,this.extraBytes=(31&n)>>3;for(var r=0;r<50;++r)this.s[r]=0}v.prototype.update=function(e){var t="string"!=typeof e;t&&e.constructor==n.ArrayBuffer&&(e=new Uint8Array(e));for(var r,s,a=e.length,o=this.blocks,c=this.byteCount,u=this.blockCount,l=0,d=this.s;l<a;){if(this.reset)for(this.reset=!1,o[0]=this.block,r=1;r<u+1;++r)o[r]=0;if(t)for(r=this.start;l<a&&r<c;++l)o[r>>2]|=e[l]<<i[3&r++];else for(r=this.start;l<a&&r<c;++l)(s=e.charCodeAt(l))<128?o[r>>2]|=s<<i[3&r++]:s<2048?(o[r>>2]|=(192|s>>6)<<i[3&r++],o[r>>2]|=(128|63&s)<<i[3&r++]):s<55296||s>=57344?(o[r>>2]|=(224|s>>12)<<i[3&r++],o[r>>2]|=(128|s>>6&63)<<i[3&r++],o[r>>2]|=(128|63&s)<<i[3&r++]):(s=65536+((1023&s)<<10|1023&e.charCodeAt(++l)),o[r>>2]|=(240|s>>18)<<i[3&r++],o[r>>2]|=(128|s>>12&63)<<i[3&r++],o[r>>2]|=(128|s>>6&63)<<i[3&r++],o[r>>2]|=(128|63&s)<<i[3&r++]);if(this.lastByteIndex=r,r>=c){for(this.start=r-c,this.block=o[u],r=0;r<u;++r)d[r]^=o[r];b(d),this.reset=!0}else this.start=r}return this},v.prototype.finalize=function(){var e=this.blocks,t=this.lastByteIndex,n=this.blockCount,r=this.s;if(e[t>>2]|=this.padding[3&t],this.lastByteIndex==this.byteCount)for(e[0]=e[n],t=1;t<n+1;++t)e[t]=0;for(e[n-1]|=2147483648,t=0;t<n;++t)r[t]^=e[t];b(r)},v.prototype.toString=v.prototype.hex=function(){this.finalize();for(var e,t=this.blockCount,n=this.s,r=this.outputBlocks,i=this.extraBytes,a=0,o=0,c="";o<r;){for(a=0;a<t&&o<r;++a,++o)e=n[a],c+=s[e>>4&15]+s[15&e]+s[e>>12&15]+s[e>>8&15]+s[e>>20&15]+s[e>>16&15]+s[e>>28&15]+s[e>>24&15];o%t==0&&(b(n),a=0)}return i&&(e=n[a],i>0&&(c+=s[e>>4&15]+s[15&e]),i>1&&(c+=s[e>>12&15]+s[e>>8&15]),i>2&&(c+=s[e>>20&15]+s[e>>16&15])),c},v.prototype.arrayBuffer=function(){this.finalize();var e,t=this.blockCount,n=this.s,r=this.outputBlocks,s=this.extraBytes,i=0,a=0,o=this.outputBits>>3;e=s?new ArrayBuffer(r+1<<2):new ArrayBuffer(o);for(var c=new Uint32Array(e);a<r;){for(i=0;i<t&&a<r;++i,++a)c[a]=n[i];a%t==0&&b(n)}return s&&(c[i]=n[i],e=e.slice(0,o)),e},v.prototype.buffer=v.prototype.arrayBuffer,v.prototype.digest=v.prototype.array=function(){this.finalize();for(var e,t,n=this.blockCount,r=this.s,s=this.outputBlocks,i=this.extraBytes,a=0,o=0,c=[];o<s;){for(a=0;a<n&&o<s;++a,++o)e=o<<2,t=r[a],c[e]=255&t,c[e+1]=t>>8&255,c[e+2]=t>>16&255,c[e+3]=t>>24&255;o%n==0&&b(r)}return i&&(e=o<<2,t=r[a],i>0&&(c[e]=255&t),i>1&&(c[e+1]=t>>8&255),i>2&&(c[e+2]=t>>16&255)),c};var b=function(e){var t,n,r,s,i,o,c,u,l,d,h,f,p,m,g,y,v,b,w,k,_,E,S,P,x,M,j,C,T,A,O,I,R,N,D,B,L,U,F,q,$,H,G,K,V,z,W,J,Z,Y,Q,X,ee,te,ne,re,se,ie,ae,oe,ce,ue,le;for(r=0;r<48;r+=2)s=e[0]^e[10]^e[20]^e[30]^e[40],i=e[1]^e[11]^e[21]^e[31]^e[41],o=e[2]^e[12]^e[22]^e[32]^e[42],c=e[3]^e[13]^e[23]^e[33]^e[43],u=e[4]^e[14]^e[24]^e[34]^e[44],l=e[5]^e[15]^e[25]^e[35]^e[45],d=e[6]^e[16]^e[26]^e[36]^e[46],h=e[7]^e[17]^e[27]^e[37]^e[47],t=(f=e[8]^e[18]^e[28]^e[38]^e[48])^(o<<1|c>>>31),n=(p=e[9]^e[19]^e[29]^e[39]^e[49])^(c<<1|o>>>31),e[0]^=t,e[1]^=n,e[10]^=t,e[11]^=n,e[20]^=t,e[21]^=n,e[30]^=t,e[31]^=n,e[40]^=t,e[41]^=n,t=s^(u<<1|l>>>31),n=i^(l<<1|u>>>31),e[2]^=t,e[3]^=n,e[12]^=t,e[13]^=n,e[22]^=t,e[23]^=n,e[32]^=t,e[33]^=n,e[42]^=t,e[43]^=n,t=o^(d<<1|h>>>31),n=c^(h<<1|d>>>31),e[4]^=t,e[5]^=n,e[14]^=t,e[15]^=n,e[24]^=t,e[25]^=n,e[34]^=t,e[35]^=n,e[44]^=t,e[45]^=n,t=u^(f<<1|p>>>31),n=l^(p<<1|f>>>31),e[6]^=t,e[7]^=n,e[16]^=t,e[17]^=n,e[26]^=t,e[27]^=n,e[36]^=t,e[37]^=n,e[46]^=t,e[47]^=n,t=d^(s<<1|i>>>31),n=h^(i<<1|s>>>31),e[8]^=t,e[9]^=n,e[18]^=t,e[19]^=n,e[28]^=t,e[29]^=n,e[38]^=t,e[39]^=n,e[48]^=t,e[49]^=n,m=e[0],g=e[1],z=e[11]<<4|e[10]>>>28,W=e[10]<<4|e[11]>>>28,C=e[20]<<3|e[21]>>>29,T=e[21]<<3|e[20]>>>29,oe=e[31]<<9|e[30]>>>23,ce=e[30]<<9|e[31]>>>23,H=e[40]<<18|e[41]>>>14,G=e[41]<<18|e[40]>>>14,N=e[2]<<1|e[3]>>>31,D=e[3]<<1|e[2]>>>31,y=e[13]<<12|e[12]>>>20,v=e[12]<<12|e[13]>>>20,J=e[22]<<10|e[23]>>>22,Z=e[23]<<10|e[22]>>>22,A=e[33]<<13|e[32]>>>19,O=e[32]<<13|e[33]>>>19,ue=e[42]<<2|e[43]>>>30,le=e[43]<<2|e[42]>>>30,te=e[5]<<30|e[4]>>>2,ne=e[4]<<30|e[5]>>>2,B=e[14]<<6|e[15]>>>26,L=e[15]<<6|e[14]>>>26,b=e[25]<<11|e[24]>>>21,w=e[24]<<11|e[25]>>>21,Y=e[34]<<15|e[35]>>>17,Q=e[35]<<15|e[34]>>>17,I=e[45]<<29|e[44]>>>3,R=e[44]<<29|e[45]>>>3,P=e[6]<<28|e[7]>>>4,x=e[7]<<28|e[6]>>>4,re=e[17]<<23|e[16]>>>9,se=e[16]<<23|e[17]>>>9,U=e[26]<<25|e[27]>>>7,F=e[27]<<25|e[26]>>>7,k=e[36]<<21|e[37]>>>11,_=e[37]<<21|e[36]>>>11,X=e[47]<<24|e[46]>>>8,ee=e[46]<<24|e[47]>>>8,K=e[8]<<27|e[9]>>>5,V=e[9]<<27|e[8]>>>5,M=e[18]<<20|e[19]>>>12,j=e[19]<<20|e[18]>>>12,ie=e[29]<<7|e[28]>>>25,ae=e[28]<<7|e[29]>>>25,q=e[38]<<8|e[39]>>>24,$=e[39]<<8|e[38]>>>24,E=e[48]<<14|e[49]>>>18,S=e[49]<<14|e[48]>>>18,e[0]=m^~y&b,e[1]=g^~v&w,e[10]=P^~M&C,e[11]=x^~j&T,e[20]=N^~B&U,e[21]=D^~L&F,e[30]=K^~z&J,e[31]=V^~W&Z,e[40]=te^~re&ie,e[41]=ne^~se&ae,e[2]=y^~b&k,e[3]=v^~w&_,e[12]=M^~C&A,e[13]=j^~T&O,e[22]=B^~U&q,e[23]=L^~F&$,e[32]=z^~J&Y,e[33]=W^~Z&Q,e[42]=re^~ie&oe,e[43]=se^~ae&ce,e[4]=b^~k&E,e[5]=w^~_&S,e[14]=C^~A&I,e[15]=T^~O&R,e[24]=U^~q&H,e[25]=F^~$&G,e[34]=J^~Y&X,e[35]=Z^~Q&ee,e[44]=ie^~oe&ue,e[45]=ae^~ce&le,e[6]=k^~E&m,e[7]=_^~S&g,e[16]=A^~I&P,e[17]=O^~R&x,e[26]=q^~H&N,e[27]=$^~G&D,e[36]=Y^~X&K,e[37]=Q^~ee&V,e[46]=oe^~ue&te,e[47]=ce^~le&ne,e[8]=E^~m&y,e[9]=S^~g&v,e[18]=I^~P&M,e[19]=R^~x&j,e[28]=H^~N&B,e[29]=G^~D&L,e[38]=X^~K&z,e[39]=ee^~V&W,e[48]=ue^~te&re,e[49]=le^~ne&se,e[0]^=a[r],e[1]^=a[r+1]};if(r)t.exports=f;else if(n)for(var w in f)n[w]=f[w]}(this)}).call(this)}).call(this,e("_process"))}}},{package:"js-sha3",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/js-sha3/src/sha3.js"}],[145,{"../../../shared/constants/transaction":6193,lodash:5172},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("lodash"),s=e("../../../shared/constants/transaction");const i="sentEther";var a={version:64,async migrate(e){const t=(0,r.cloneDeep)(e);t.meta.version=64;const n=function(e){var t;const n=null==e||null===(t=e.TransactionController)||void 0===t?void 0:t.transactions;if((0,r.isPlainObject)(n))for(const e of Object.values(n))e.type===i&&(e.type=s.TRANSACTION_TYPES.SIMPLE_SEND),e.history&&e.history.map((e=>(e.type&&e.type===i&&(e.type=s.TRANSACTION_TYPES.SIMPLE_SEND),e)));return e}(t.data);return t.data=n,t}};n.default=a}}},{package:"<root>",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/app/scripts/migrations/064.js"}],[1450,{"readable-stream":5700},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});const r=e("readable-stream");n.default=function(e){if(!e||!e.engine)throw new Error("Missing engine parameter!");const{engine:t}=e,n=new r.Duplex({objectMode:!0,read:function(){return undefined},write:function(e,r,s){t.handle(e,((e,t)=>{n.push(t)})),s()}});return t.on&&t.on("notification",(e=>{n.push(e)})),n}}}},{package:"json-rpc-middleware-stream",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/json-rpc-middleware-stream/dist/createEngineStream.js"}],[1451,{"@metamask/safe-event-emitter":1315,"readable-stream":5700},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const s=r(e("@metamask/safe-event-emitter")),i=e("readable-stream");n.default=function(){const e={},t=new i.Duplex({objectMode:!0,read:function(){return!1},write:function(t,r,s){let i;try{!t.id?function(e){n.emit("notification",e)}(t):function(t){const n=e[t.id];if(!n)throw new Error(`StreamMiddleware - Unknown response id "${t.id}"`);delete e[t.id],Object.assign(n.res,t),setTimeout(n.end)}(t)}catch(e){i=e}s(i)}}),n=new s.default;return{events:n,middleware:(n,r,s,i)=>{t.push(n),e[n.id]={req:n,res:r,next:s,end:i}},stream:t}}}}},{package:"json-rpc-middleware-stream",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/json-rpc-middleware-stream/dist/createStreamMiddleware.js"}],[1452,{"./createEngineStream":1450,"./createStreamMiddleware":1451},function(){with(this)return function(){"use strict";return function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.createStreamMiddleware=n.createEngineStream=void 0;const s=r(e("./createEngineStream"));n.createEngineStream=s.default;const i=r(e("./createStreamMiddleware"));n.createStreamMiddleware=i.default}}},{package:"json-rpc-middleware-stream",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/json-rpc-middleware-stream/dist/index.js"}],[1453,{"./url-alphabet/index.cjs":1454},function(){with(this)return function(){"use strict";return function(e,t,n){let{urlAlphabet:r}=e("./url-alphabet/index.cjs");let s=e=>crypto.getRandomValues(new Uint8Array(e)),i=(e,t,n)=>{let r=(2<<Math.log(e.length-1)/Math.LN2)-1,s=-~(1.6*r*t/e.length);return()=>{let i="";for(;;){let a=n(s),o=s;for(;o--;)if(i+=e[a[o]&r]||"",i.length===t)return i}}};t.exports={nanoid:(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;){let r=63&n[e];t+=r<36?r.toString(36):r<62?(r-26).toString(36).toUpperCase():r<63?"_":"-"}return t},customAlphabet:(e,t)=>i(e,t,s),customRandom:i,urlAlphabet:r,random:s}}}},{package:"nanoid",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/nanoid/index.browser.cjs"}],[1454,{},function(){with(this)return function(){"use strict";return function(e,t,n){t.exports={urlAlphabet:"useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"}}}},{package:"nanoid",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/nanoid/url-alphabet/index.cjs"}],[1455,{_process:5420,"readable-stream":5700,util:2087,xtend:6171},function(){with(this)return function(){"use strict";return function(e,t,n){(function(n){(function(){var r=e("readable-stream").Transform,s=e("util").inherits,i=e("xtend");function a(e){r.call(this,e),this._destroyed=!1}function o(e,t,n){n(null,e)}function c(e){return function(t,n,r){return"function"==typeof t&&(r=n,n=t,t={}),"function"!=typeof n&&(n=o),"function"!=typeof r&&(r=null),e(t,n,r)}}s(a,r),a.prototype.destroy=function(e){if(!this._destroyed){this._destroyed=!0;var t=this;n.nextTick((function(){e&&t.emit("error",e),t.emit("close")}))}},t.exports=c((function(e,t,n){var r=new a(e);return r._transform=t,n&&(r._flush=n),r})),t.exports.ctor=c((function(e,t,n){function r(t){if(!(this instanceof r))return new r(t);this.options=i(e,t),a.call(this,this.options)}return s(r,a),r.prototype._transform=t,n&&(r.prototype._flush=n),r})),t.exports.obj=c((function(e,t,n){var r=new a(i({objectMode:!0,highWaterMark:16},e));return r._transform=t,n&&(r._flush=n),r}))}).call(this)}).call(this,e("_process"))}}},{package:"through2",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@metamask/snap-controllers/node_modules/through2/through2.js"}],[1456,{},function(){with(this)return function(){"use strict";return function(e,t,n){t.exports=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var r=0;r<e.length;r++){var s=e.charAt(r),i=s.charCodeAt(0);if(255!==t[i])throw new TypeError(s+" is ambiguous");t[i]=r}var a=e.length,o=e.charAt(0),c=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var n=0;if(" "!==e[n]){for(var r=0,s=0;e[n]===o;)r++,n++;for(var i=(e.length-n)*c+1>>>0,u=new Uint8Array(i);e[n];){var l=t[e.charCodeAt(n)];if(255===l)return;for(var d=0,h=i-1;(0!==l||d<s)&&-1!==h;h--,d++)l+=a*u[h]>>>0,u[h]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");s=d,n++}if(" "!==e[n]){for(var f=i-s;f!==i&&0===u[f];)f++;for(var p=new Uint8Array(r+(i-f)),m=r;f!==i;)p[m++]=u[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var n=0,r=0,s=0,i=t.length;s!==i&&0===t[s];)s++,n++;for(var c=(i-s)*u+1>>>0,l=new Uint8Array(c);s!==i;){for(var d=t[s],h=0,f=c-1;(0!==d||h<r)&&-1!==f;f--,h++)d+=256*l[f]>>>0,l[f]=d%a>>>0,d=d/a>>>0;if(0!==d)throw new Error("Non-zero carry");r=h,s++}for(var p=c-r;p!==c&&0===l[p];)p++;for(var m=o.repeat(n);p<c;++p)m+=e.charAt(l[p]);return m},decodeUnsafe:l,decode:function(e){var t=l(e);if(t)return t;throw new Error("Non-base"+a+" character")}}}}}},{package:"@multiformats/base-x",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@multiformats/base-x/src/index.js"}],[146,{lodash:5172},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("lodash");var s={version:65,async migrate(e){const t=(0,r.cloneDeep)(e);t.meta.version=65;const n=function(e){if(e.PreferencesController){var t;const{completedOnboarding:n,firstTimeFlowType:r}=e.PreferencesController;e.OnboardingController=null!==(t=e.OnboardingController)&&void 0!==t?t:{},n!==undefined&&(e.OnboardingController.completedOnboarding=n,delete e.PreferencesController.completedOnboarding),r!==undefined&&(e.OnboardingController.firstTimeFlowType=r,delete e.PreferencesController.firstTimeFlowType)}return e}(t.data);return t.data=n,t}};n.default=s}}},{package:"<root>",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/app/scripts/migrations/065.js"}],[147,{"../../../shared/constants/hardware-wallets":6186,"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,lodash:5172},function(){with(this)return function(){"use strict";return function(e,t,n){var r=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=r(e("@babel/runtime/helpers/defineProperty")),i=e("lodash"),a=e("../../../shared/constants/hardware-wallets");function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){(0,s.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var u={version:66,async migrate(e){const t=(0,i.cloneDeep)(e);t.meta.version=66;const n=function(e){var t;const n=window.navigator.hid?a.LEDGER_TRANSPORT_TYPES.WEBHID:a.LEDGER_TRANSPORT_TYPES.U2F,r=Boolean(null===(t=e.PreferencesController)||void 0===t?void 0:t.useLedgerLive),s=c(c({},e),{},{PreferencesController:c(c({},null==e?void 0:e.PreferencesController),{},{ledgerTransportType:r?a.LEDGER_TRANSPORT_TYPES.LIVE:n})});return delete s.PreferencesController.useLedgerLive,s}(t.data);return t.data=n,t}};n.default=u}}},{package:"<root>",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/app/scripts/migrations/066.js"}],[1474,{assert:1700,buffer:2081,"component-type":2150,"join-component":4716},function(){with(this)return function(){"use strict";return function(e,t,n){(function(n){(function(){var r=e("component-type"),s=e("join-component"),i=e("assert");t.exports=function(e,t){switch(o(e),t=t||e.type,i(t,"You must pass an event type."),t){case"track":return function(e){i(e.anonymousId||e.userId,'You must pass either an "anonymousId" or a "userId".'),i(e.event,'You must pass an "event".')}(e);case"group":return function(e){i(e.anonymousId||e.userId,'You must pass either an "anonymousId" or a "userId".'),i(e.groupId,'You must pass a "groupId".')}(e);case"identify":case"page":case"screen":return function(e){i(e.anonymousId||e.userId,'You must pass either an "anonymousId" or a "userId".')}(e);case"alias":return function(e){i(e.userId,'You must pass a "userId".'),i(e.previousId,'You must pass a "previousId".')}(e);default:i(0,'Invalid event type: "'+t+'"')}};var a={anonymousId:["string","number"],category:"string",context:"object",event:"string",groupId:["string","number"],integrations:"object",name:"string",previousId:["string","number"],timestamp:"date",userId:["string","number"],type:"string"};function o(e){i("object"===r(e),"You must pass a message object.");var t=JSON.stringify(e);for(var o in i(n.byteLength(t,"utf8")<32768,"Your message must be < 32kb."),a){var c=e[o];if(c){var u=a[o];"array"!==r(u)&&(u=[u]);var l="object"===u[0]?"an":"a";i(u.some((function(e){return r(c)===e})),'"'+o+'" must be '+l+" "+s(u,"or")+".")}}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@segment/loosely-validate-event",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@segment/loosely-validate-event/index.js"}],[148,{"../../../shared/constants/network":6189,"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,"bignumber.js":1960,lodash:5172},function(){with(this)return function(){"use strict";return function(e,t,n){var r=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=r(e("@babel/runtime/helpers/defineProperty")),i=e("lodash"),a=r(e("bignumber.js")),o=e("../../../shared/constants/network");function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){(0,s.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const l=e=>new a.default(e||"0x0",16).gt(0);var d={version:67,async migrate(e){const t=(0,i.cloneDeep)(e);t.meta.version=67;const n=function(e){var t,n,r;const s=(null==e?void 0:e.PreferencesController)||{},i=s.preferences||{};if(i.showTestNetworks)return e;const a=(null==e||null===(t=e.TransactionController)||void 0===t?void 0:t.transactions)||{},c=(null===(n=e.NetworkController)||void 0===n?void 0:n.provider)||{},d=(null===(r=e.CachedBalancesController)||void 0===r?void 0:r.cachedBalances)||{},h=o.TEST_CHAINS.includes(null==c?void 0:c.chainId),f=Object.values(a).some((({chainId:e})=>o.TEST_CHAINS.includes(e))),p=o.TEST_CHAINS.some((e=>Object.values(d[e]||{}).some(l))),m=h||f||p;return u(u({},e),{},{PreferencesController:u(u({},s),{},{preferences:u(u({},i),{},{showTestNetworks:m})})})}(t.data);return t.data=n,t}};n.default=d}}},{package:"<root>",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/app/scripts/migrations/067.js"}],[149,{"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,"@babel/runtime/helpers/objectWithoutProperties":204,lodash:5172},function(){with(this)return function(){"use strict";return function(e,t,n){var r=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=r(e("@babel/runtime/helpers/defineProperty")),i=r(e("@babel/runtime/helpers/objectWithoutProperties")),a=e("lodash");const o=["PermissionsController","PermissionsMetadata"],c=["name","icon","extensionId"];function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){(0,s.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d={version:68,async migrate(e){const t=(0,a.cloneDeep)(e);t.meta.version=68;const n=function(e){const{PermissionsController:t={},PermissionsMetadata:n={}}=e,r=(0,i.default)(e,o),{domainMetadata:s={},permissionsHistory:a={},permissionsLog:c=[]}=n;return l(l({},r),{},{PermissionController:h(t),PermissionLogController:{permissionActivityLog:c,permissionHistory:a},SubjectMetadataController:f(s)})}(t.data);return t.data=n,t}};function h(e){const{domains:t={}}=e;return{subjects:Object.entries(t).reduce(((e,[t,n])=>{const{permissions:[r]}=n,s=r.caveats.find((e=>"exposedAccounts"===e.name)),i=l(l({},r),{},{caveats:[{type:"restrictReturnedAccounts",value:s.value}]});return delete i["@context"],e[t]={origin:t,permissions:{eth_accounts:i}},e}),{})}}function f(e){return{subjectMetadata:Object.entries(e).reduce(((e,[t,n])=>{const{name:r=null,icon:s=null,extensionId:a=null}=n,o=(0,i.default)(n,c);return delete o.lastUpdated,delete o.host,t&&(e[t]=l(l({name:r,iconUrl:s,extensionId:a},o),{},{origin:t})),e}),{})}}n.default=d}}},{package:"<root>",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/app/scripts/migrations/068.js"}],[15,{"../../../../shared/constants/time":6192,"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,_process:5420,"eth-block-tracker":2361,"eth-json-rpc-middleware":2406,"json-rpc-engine":4727},function(){with(this)return function(){"use strict";return function(e,t,n){(function(t){(function(){var r=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({rpcUrl:e,chainId:t}){const n=(0,a.createFetchMiddleware)({rpcUrl:e}),r=(0,a.providerFromMiddleware)(n),s=new o.PollingBlockTracker(l(l({},h),{},{provider:r}));return{networkMiddleware:(0,i.mergeMiddleware)([...d?[(0,i.createAsyncMiddleware)((async(e,t,n)=>("eth_estimateGas"===e.method&&await new Promise((e=>setTimeout(e,2*c.SECOND))),n())))]:[],f(t),(0,a.createBlockRefRewriteMiddleware)({blockTracker:s}),(0,a.createBlockCacheMiddleware)({blockTracker:s}),(0,a.createInflightCacheMiddleware)(),(0,a.createBlockTrackerInspectorMiddleware)({blockTracker:s}),n]),blockTracker:s}};var s=r(e("@babel/runtime/helpers/defineProperty")),i=e("json-rpc-engine"),a=e("eth-json-rpc-middleware"),o=e("eth-block-tracker"),c=e("../../../../shared/constants/time");function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){(0,s.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const d=t.env.IN_TEST,h=d?{pollingInterval:c.SECOND}:{};function f(e){return(t,n,r,s)=>"eth_chainId"===t.method?(n.result=e,s()):r()}}).call(this)}).call(this,e("_process"))}}},{package:"<root>",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/app/scripts/controllers/network/createJsonRpcClient.js"}],[150,{"../../../shared/constants/app":6184,lodash:5172},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=e("lodash"),s=e("../../../shared/constants/app");var i={version:69,async migrate(e){const t=(0,r.cloneDeep)(e);t.meta.version=69;const n=function(e){var t;if("object"==typeof(null==e||null===(t=e.SubjectMetadataController)||void 0===t?void 0:t.subjectMetadata)){const{SubjectMetadataController:{subjectMetadata:t}}=e;Object.values(t).forEach((e=>{e&&"object"==typeof e&&!Array.isArray(e)&&(e.subjectType=e.extensionId?s.SUBJECT_TYPES.EXTENSION:s.SUBJECT_TYPES.WEBSITE)}))}return e}(t.data);return t.data=n,t}};n.default=i}}},{package:"<root>",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/app/scripts/migrations/069.js"}],[151,{"../../../shared/constants/transaction":6193,lodash:5172},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t,n){return function(i){const a=(0,r.cloneDeep)(i);a.meta.version=e;try{const e=function(e,t,n){const r=e,{TransactionController:i}=r;if(i&&i.transactions){const{transactions:e}=i;r.TransactionController.transactions=e.map((e=>t(e)?(e.status=s.TRANSACTION_STATUSES.FAILED,e.err={message:n,note:`Tx automatically failed by migration because ${n}`},e):e))}return r}(a.data,n,t);a.data=e}catch(t){console.warn(`MetaMask Migration #${e}${t.stack}`)}return Promise.resolve(a)}};var r=e("lodash"),s=e("../../../shared/constants/transaction")}}},{package:"<root>",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/app/scripts/migrations/fail-tx.js"}],[152,{"./002":83,"./003":84,"./004":85,"./005":86,"./006":87,"./007":88,"./008":89,"./009":90,"./010":91,"./011":92,"./012":93,"./013":94,"./014":95,"./015":96,"./016":97,"./017":98,"./018":99,"./019":100,"./020":101,"./021":102,"./022":103,"./023":104,"./024":105,"./025":106,"./026":107,"./027":108,"./028":109,"./029":110,"./030":111,"./031":112,"./032":113,"./033":114,"./034":115,"./035":116,"./036":117,"./037":118,"./038":119,"./039":120,"./040":121,"./041":122,"./042":123,"./043":124,"./044":125,"./045":126,"./046":127,"./047":128,"./048":129,"./049":130,"./050":131,"./051":132,"./052":133,"./053":134,"./054":135,"./055":136,"./056":137,"./057":138,"./058":139,"./059":140,"./060":141,"./061":142,"./062":143,"./063":144,"./064":145,"./065":146,"./066":147,"./067":148,"./068":149,"./069":150,"@babel/runtime/helpers/interopRequireDefault":195},function(){with(this)return function(){"use strict";return function(e,t,n){var r=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=r(e("./002")),i=r(e("./003")),a=r(e("./004")),o=r(e("./005")),c=r(e("./006")),u=r(e("./007")),l=r(e("./008")),d=r(e("./009")),h=r(e("./010")),f=r(e("./011")),p=r(e("./012")),m=r(e("./013")),g=r(e("./014")),y=r(e("./015")),v=r(e("./016")),b=r(e("./017")),w=r(e("./018")),k=r(e("./019")),_=r(e("./020")),E=r(e("./021")),S=r(e("./022")),P=r(e("./023")),x=r(e("./024")),M=r(e("./025")),j=r(e("./026")),C=r(e("./027")),T=r(e("./028")),A=r(e("./029")),O=r(e("./030")),I=r(e("./031")),R=r(e("./032")),N=r(e("./033")),D=r(e("./034")),B=r(e("./035")),L=r(e("./036")),U=r(e("./037")),F=r(e("./038")),q=r(e("./039")),$=r(e("./040")),H=r(e("./041")),G=r(e("./042")),K=r(e("./043")),V=r(e("./044")),z=r(e("./045")),W=r(e("./046")),J=r(e("./047")),Z=r(e("./048")),Y=r(e("./049")),Q=r(e("./050")),X=r(e("./051")),ee=r(e("./052")),te=r(e("./053")),ne=r(e("./054")),re=r(e("./055")),se=r(e("./056")),ie=r(e("./057")),ae=r(e("./058")),oe=r(e("./059")),ce=r(e("./060")),ue=r(e("./061")),le=r(e("./062")),de=r(e("./063")),he=r(e("./064")),fe=r(e("./065")),pe=r(e("./066")),me=r(e("./067")),ge=r(e("./068")),ye=r(e("./069"));var ve=[s.default,i.default,a.default,o.default,c.default,u.default,l.default,d.default,h.default,f.default,p.default,m.default,g.default,y.default,v.default,b.default,w.default,k.default,_.default,E.default,S.default,P.default,x.default,M.default,j.default,C.default,T.default,A.default,O.default,I.default,R.default,N.default,D.default,B.default,L.default,U.default,F.default,q.default,$.default,H.default,G.default,K.default,V.default,z.default,W.default,J.default,Z.default,Y.default,Q.default,X.default,ee.default,te.default,ne.default,re.default,se.default,ie.default,ae.default,oe.default,ce.default,ue.default,le.default,de.default,he.default,fe.default,pe.default,me.default,ge.default,ye.default];n.default=ve}}},{package:"<root>",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/app/scripts/migrations/index.js"}],[1555,{},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r="utf8: invalid string",s="utf8: invalid source encoding";function i(e){for(var t=0,n=0;n<e.length;n++){var s=e.charCodeAt(n);if(s<128)t+=1;else if(s<2048)t+=2;else if(s<55296)t+=3;else{if(!(s<=57343))throw new Error(r);if(n>=e.length-1)throw new Error(r);n++,t+=4}}return t}n.encode=function(e){for(var t=new Uint8Array(i(e)),n=0,r=0;r<e.length;r++){var s=e.charCodeAt(r);s<128?t[n++]=s:s<2048?(t[n++]=192|s>>6,t[n++]=128|63&s):s<55296?(t[n++]=224|s>>12,t[n++]=128|s>>6&63,t[n++]=128|63&s):(r++,s=(1023&s)<<10,s|=1023&e.charCodeAt(r),s+=65536,t[n++]=240|s>>18,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|63&s)}return t},n.encodedLength=i,n.decode=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];if(128&r){var i=void 0;if(r<224){if(n>=e.length)throw new Error(s);if(128!=(192&(a=e[++n])))throw new Error(s);r=(31&r)<<6|63&a,i=128}else if(r<240){if(n>=e.length-1)throw new Error(s);var a=e[++n],o=e[++n];if(128!=(192&a)||128!=(192&o))throw new Error(s);r=(15&r)<<12|(63&a)<<6|63&o,i=2048}else{if(!(r<248))throw new Error(s);if(n>=e.length-2)throw new Error(s);a=e[++n],o=e[++n];var c=e[++n];if(128!=(192&a)||128!=(192&o)||128!=(192&c))throw new Error(s);r=(15&r)<<18|(63&a)<<12|(63&o)<<6|63&c,i=65536}if(r<i||r>=55296&&r<=57343)throw new Error(s);if(r>=65536){if(r>1114111)throw new Error(s);r-=65536,t.push(String.fromCharCode(55296|r>>10)),r=56320|1023&r}}t.push(String.fromCharCode(r))}return t.join("")}}}},{package:"@stablelib/utf8",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/@stablelib/utf8/lib/utf8.js"}],[156,{},function(){with(this)return function(){"use strict";return function(e,t,n){function r(e){return new Promise((t=>setTimeout(t,e)))}async function s(e){const t=await window.fetch(`http://localhost:8889?key=${e}`),n=await t.text();return n.length?JSON.parse(n):null}t.exports=class{static openBox(e){return this.address=e,Promise.resolve({onSyncDone:e=>{setTimeout(e,200)},openSpace:async(e,t)=>{const{onSyncDone:n}=t;return this.spaceName=e,setTimeout(n,150),await r(50),{private:{get:async e=>{await r(50);return await s(`${this.address}-${this.spaceName}-${e}`)},set:async(e,t)=>(await async function(e,t){return(await window.fetch("http://localhost:8889",{method:"POST",body:JSON.stringify({key:e,data:t})})).text()}(`${this.address}-${this.spaceName}-${e}`,t),await r(50),null)}}},logout:()=>undefined})}static async getConfig(e){return await s(`${e}-metamask-metamaskBackup`)?{spaces:{metamask:{}}}:{}}}}}},{package:"<root>",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/development/mock-3box.js"}],[157,{"./legacyIpfs3boxAccessController":158,"./moderatorAccessController":159,"./odbIdentityProvider":160,"./threadAccessController":161},function(){with(this)return function(){"use strict";return function(e,t,n){const r=e("./odbIdentityProvider"),s=e("./moderatorAccessController"),i=e("./threadAccessController"),a=e("./legacyIpfs3boxAccessController");t.exports={OdbIdentityProvider:r,ModeratorAccessController:s,ThreadAccessController:i,LegacyIPFS3BoxAccessController:a}}}},{package:"3box-orbitdb-plugins",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/3box-orbitdb-plugins/src/index.js"}],[158,{"did-resolver":2274,"orbit-db-io":5336,"safe-buffer":5739},function(){with(this)return function(){"use strict";return function(e,t,n){const r=e("orbit-db-io"),s=e("safe-buffer").Buffer,i=e("did-resolver").default;class a{constructor(e,t){this._ipfs=e,this._write=Array.from(t.write||[])}static get type(){return"legacy-ipfs-3box"}get write(){return this._write}async canAppend(e,t){const n=0===e.v?e.key:await(async e=>{const t=await i(e);return t.publicKey.find((e=>{const n=e.id.split("#");return n[0]===t.id&&("subSigningKey"===n[1]||"signingKey"===n[1])})).publicKeyHex})(e.identity.id);return!(!this.write.includes(n)&&!this.write.includes("*"))&&(0===e.v||await t.verifyIdentity(e.identity))}async load(e){0===e.indexOf("/ipfs")&&(e=e.split("/")[2]);try{const t=await r.read(this._ipfs,e);this._write=t.write}catch(e){console.log("LegacyIPFS3BoxAccessController.load ERROR:",e)}}async save(e){let t;const n={admin:[],write:this.write,read:[]};try{t=await r.write(this._ipfs,"raw",s.from(JSON.stringify(n,null,2)),{format:"dag-pb"})}catch(e){console.log("LegacyIPFS3BoxAccessController.save ERROR:",e)}return{address:t,skipManifest:!0}}static async create(e,t={}){return t={...t,write:t.write||[e.identity.publicKey]},new a(e._ipfs,t)}}t.exports=a}}},{package:"3box-orbitdb-plugins",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/3box-orbitdb-plugins/src/legacyIpfs3boxAccessController.js"}],[159,{},function(){with(this)return function(){"use strict";return function(e,t,n){const r="moderator-access",s="MODERATOR";class i{constructor(e,t){this._capabilityTypes=[s],this._write=[],this._firstModerator=e,this._write.push(this._firstModerator),this._members=Boolean(t.members),this._members&&this._capabilityTypes.push("MEMBER")}static get type(){return r}isMod(e){return this._write.includes(e)}isValidCapability(e){return this._capabilityTypes.includes(e)}get firstModerator(){return this._firstModerator}async canAppend(e,t){const n=e.identity.id,r=e.payload.value.capability,i=e.payload.value.id,a=this.isMod(n),o=this.isValidCapability(r);return!!(a&&o&&await(async()=>t.verifyIdentity(e.identity))())&&(r===s&&this._write.push(i),!0)}async load(e){const t=e.split("/"),n=t.pop();this._members="members"===n;const r=n.includes("mod")?n:t.pop();this._firstModerator=r.split("_")[1]}async save(){let e=`${r}/mod_${this._firstModerator}`;return e+=this._members?"/members":"",{address:e}}static async create(e,t={}){if(!t.firstModerator)throw new Error("Moderator AC: firstModerator required");return new i(t.firstModerator,t)}}t.exports=i}}},{package:"3box-orbitdb-plugins",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/3box-orbitdb-plugins/src/moderatorAccessController.js"}],[16,{"./middleware/pending":18,"eth-json-rpc-middleware":2406,"json-rpc-engine":4727},function(){with(this)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({version:e,getAccounts:t,processTransaction:n,processEthSignMessage:a,processTypedMessage:o,processTypedMessageV3:c,processTypedMessageV4:u,processPersonalMessage:l,processDecryptMessage:d,processEncryptionPublicKey:h,getPendingNonce:f,getPendingTransactionByHash:p}){return(0,r.mergeMiddleware)([(0,r.createScaffoldMiddleware)({eth_syncing:!1,web3_clientVersion:`MetaMask/v${e}`}),(0,s.createWalletMiddleware)({getAccounts:t,processTransaction:n,processEthSignMessage:a,processTypedMessage:o,processTypedMessageV3:c,processTypedMessageV4:u,processPersonalMessage:l,processDecryptMessage:d,processEncryptionPublicKey:h}),(0,i.createPendingNonceMiddleware)({getPendingNonce:f}),(0,i.createPendingTxMiddleware)({getPendingTransactionByHash:p})])};var r=e("json-rpc-engine"),s=e("eth-json-rpc-middleware"),i=e("./middleware/pending")}}},{package:"<root>",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/app/scripts/controllers/network/createMetamaskMiddleware.js"}],[160,{base64url:1957,"did-jwt":2273},function(){with(this)return function(){"use strict";return function(e,t,n){const r=e("base64url"),{verifyJWT:s}=e("did-jwt"),i=e=>r.encode(JSON.stringify(e)),a=i({typ:"JWT",alg:"ES256K"});t.exports=class{constructor({threeId:e}){this.threeId=e}static get type(){return"3ID"}async getId({space:e}){return e?this.threeId.getSubDID(e):this.threeId.DID}async signIdentity(e,{space:t}){const n={data:e,iat:null},r=t?{space:t}:{use3ID:!0};return(await this.threeId.signJWT(n,r)).split(".")[2]}static async verifyIdentity(e){const t=i({iat:null,data:e.publicKey+e.signatures.id,iss:e.id}),n=`${a}.${t}.${e.signatures.publicKey}`;try{await s(n,{auth:!0})}catch(e){return!1}return!0}}}}},{package:"3box-orbitdb-plugins",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/3box-orbitdb-plugins/src/odbIdentityProvider.js"}],[161,{events:2082,"ipfs-log/src/entry":4447,"is-ipfs":4697,"orbit-db-access-controllers/src/utils/ensure-ac-address":5315},function(){with(this)return function(){"use strict";return function(e,t,n){const r=e("orbit-db-access-controllers/src/utils/ensure-ac-address"),s=e("events").EventEmitter,i=e("ipfs-log/src/entry"),a=(e("is-ipfs"),"MODERATOR"),o="MEMBER";class c extends s{constructor(e,t,n,r,s){super(),this._orbitdb=e,this._db=null,this._options=s||{},this._ipfs=t,this._members=Boolean(s.members),this._firstModerator=r,this._threadName=s.threadName,this._identity=n}static get type(){return"thread-access"}get address(){return this._db.address}async canAppend(e,t){const n=async()=>await t.verifyIdentity(e.identity),r=e.payload.op,s=this.capabilities.moderators,a=this.capabilities.members,o=s.includes(e.identity.id),c=a.includes(e.identity.id);if("ADD"===r){if(!this._members)return await n();if(c||o)return await n()}if("DEL"===r){const t=e.payload.value;if((await i.fromMultihash(this._ipfs,t)).identity.id===e.identity.id)return await n();if(o)return await n()}return!1}get capabilities(){return this._capabilities||this._updateCapabilites(),this._capabilities}_updateCapabilites(){let e=[],t=[];return this._db&&(e.push(this._db.access._firstModerator),Object.entries(this._db.index).forEach((n=>{const r=n[1].payload.value.capability,s=n[1].payload.value.id;r===a&&e.push(s),r===o&&t.push(s)}))),this._capabilities={moderators:e,members:t},this._capabilities}get(e){return this.capabilities[e]||[]}async close(){await this._db.close()}async load(e){this._db&&await this._db.close(),this._db=await this._orbitdb.feed(r(e),{identity:this._identity,accessController:{type:"moderator-access",firstModerator:this._firstModerator,members:this._members},sync:!0}),this._db.events.on("ready",this._onUpdate.bind(this)),this._db.events.on("write",this._onUpdate.bind(this)),this._db.events.on("replicated",this._onUpdate.bind(this)),await this._db.load()}async save(){return{address:this._db.address.toString(),firstModerator:this._firstModerator,members:this._members}}async grant(e,t){if(!this._db.access.isValidCapability(e))throw new Error("grant: Invalid capability to grant");if(e===o&&this.capabilities.members.includes(t))throw new Error(`grant: capability ${e} has already been granted to ${t}`);if(e===a&&this.capabilities.moderators.includes(t))throw new Error(`grant: capability ${e} has already been granted to ${t}`);try{await this._db.add({capability:e,id:t})}catch(n){if(n.toString().includes("not append entry"))throw new Error(`grant: Capability ${e} can not be granted to ${t}`);throw n}}_onUpdate(){this._updateCapabilites(),this.emit("updated")}static async create(e,t={}){if(!t.firstModerator)throw new Error("Thread AC: firstModerator required");const n=new c(e,e._ipfs,t.identity,t.firstModerator,t);return await n.load(t.address||t.threadName),n}}t.exports=c}}},{package:"3box-orbitdb-plugins",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/3box-orbitdb-plugins/src/threadAccessController.js"}],[162,{"./3id":163,"./api":165,"./config.js":166,"./privateStore":168,"./publicStore":169,"./space":170,"./utils/id":172,"./utils/index":173,"./verified":175,"3box-orbitdb-plugins":157,"@babel/runtime/helpers/asyncToGenerator":185,"@babel/runtime/helpers/classCallCheck":186,"@babel/runtime/helpers/createClass":188,"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,"@babel/runtime/helpers/slicedToArray":208,"@babel/runtime/regenerator":215,ipfs:4638,"orbit-db":5357,"orbit-db-access-controllers":5308,"orbit-db-pubsub":5350,store:5864},function(){with(this)return function(){"use strict";return function(e,t,n){var r=e("@babel/runtime/helpers/interopRequireDefault"),s=r(e("@babel/runtime/helpers/slicedToArray")),i=r(e("@babel/runtime/regenerator")),a=r(e("@babel/runtime/helpers/defineProperty")),o=r(e("@babel/runtime/helpers/asyncToGenerator")),c=r(e("@babel/runtime/helpers/classCallCheck")),u=r(e("@babel/runtime/helpers/createClass"));function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(n,!0).forEach((function(t){(0,a.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var h=e("store"),f=e("ipfs"),p=e("orbit-db"),m=e("orbit-db-pubsub"),g=e("orbit-db-access-controllers"),y=e("3box-orbitdb-plugins"),v=y.LegacyIPFS3BoxAccessController,b=y.ThreadAccessController,w=y.ModeratorAccessController;g.addAccessController({AccessController:v}),g.addAccessController({AccessController:b}),g.addAccessController({AccessController:w});var k,_,E=e("./3id"),S=e("./publicStore"),P=e("./privateStore"),x=e("./verified"),M=e("./space"),j=e("./utils/index"),C=e("./utils/id"),T=e("./config.js"),A=e("./api"),O="ethereum-eoa",I=T.address_server_url,R=T.pinning_node,N=T.pinning_room,D=T.ipfs_options,B=T.orbitdb_options,L=function(){function e(t,n,r){var s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};(0,c.default)(this,e),this._3id=t,this._web3provider=n,this._ipfs=r,this._serverUrl=s.addressServer||I,this._onSyncDoneCB=function(){},this._boxSynced=!1,this.public=null,this.private=null,this.verified=new x(this),this.spaces={},this.spacesPubSubMessages={}}var t,n,r,a,l,f,g,y,v,b,w,T,D,L,F,q,$,H,G,K,V,z,W,J,Z,Y,Q,X,ee,te;return(0,u.default)(e,[{key:"_load",value:(te=(0,o.default)(i.default.mark((function e(){var t,n,r,a,c,u,l,h,f,g,y,v,b,w,k=this,E=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=E.length>0&&E[0]!==undefined?E[0]:{},n=this._3id.muportFingerprint+".root",this.pinningNode=t.pinningNode||R,this._ipfs.swarm.connect(this.pinningNode,(function(){})),e.t0=p,e.t1=this._ipfs,e.t2=t.orbitPath,e.next=9,this._3id.getOdbId();case 9:return e.t3=e.sent,e.t4={directory:e.t2,identity:e.t3},e.next=13,e.t0.createInstance.call(e.t0,e.t1,e.t4);case 13:return this._orbitdb=e.sent,_=this._orbitdb,r=this._3id.getKeyringBySpaceName(n).getPublicKeys(!0).signingKey,e.next=18,this._orbitdb.feed(n,d({},B,{format:"dag-pb",accessController:{write:[r],type:"legacy-ipfs-3box",skipManifest:!0}}));case 18:return this._rootStore=e.sent,a=this._rootStore.address.toString(),e.t5=m,e.t6=this._ipfs,e.next=24,this._ipfs.id();case 24:return e.t7=e.sent.id,this._pubsub=new e.t5(e.t6,e.t7),c=function(){var e=(0,o.default)(i.default.mark((function e(t,n){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n===k.pinningNode.split("/").pop()&&k._pubsub.publish(N,{type:"PIN_DB",odbAddress:a,did:k.DID});case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.public=new S(this._orbitdb,this._3id.muportFingerprint+".public",this._linkProfile.bind(this),this._ensurePinningNodeConnected.bind(this),this._3id),this.private=new P(this._orbitdb,this._3id.muportFingerprint+".private",this._ensurePinningNodeConnected.bind(this),this._3id),e.next=31,Promise.all([this.public._load(),this.private._load()]);case 31:return u=e.sent,l=(0,s.default)(u,2),h=l[0],f=l[1],g=[],y={},v=!0,b=!1,w=function(){var e=(0,o.default)(i.default.mark((function e(t,n){var r;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b||(b=!0,setTimeout((function(){v=!1}),3e3)),"HAS_ENTRIES"!==n.type){e.next=12;break}if(n.odbAddress!==f||y[f]||(g.push(k.private._sync(n.numEntries)),y[f]=!0),n.odbAddress!==h||y[h]||(g.push(k.public._sync(n.numEntries)),y[h]=!0),v&&!0===n.odbAddress.includes("space")&&(k.spacesPubSubMessages[n.odbAddress]=n),2!==g.length){e.next=12;break}return r=g,g=[],e.next=10,Promise.all(r);case 10:k._boxSynced=!0,k._onSyncDoneCB();case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this._pubsub.subscribe(N,w,c),e.next=43,this._createRootStore(a,f,h,this.pinningNode);case 43:case"end":return e.stop()}}),e,this)}))),function(){return te.apply(this,arguments)})},{key:"_createRootStore",value:(ee=(0,o.default)(i.default.mark((function e(t,n,r){var s,a,c=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._rootStore.load();case 2:return e.next=4,this._rootStore.iterator({limit:-1}).collect();case 4:if((s=e.sent).find((function(e){return e.payload.value.odbAddress===r}))){e.next=8;break}return e.next=8,this._rootStore.add({odbAddress:r});case 8:if(s.find((function(e){return e.payload.value.odbAddress===n}))){e.next=11;break}return e.next=11,this._rootStore.add({odbAddress:n});case 11:this._publishRootStore(t),a=function(){var e=(0,o.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s.filter((function(e){return"address-link"===e.payload.value.type})).map((function(e){c._ipfs.dag.get(e.payload.value.data)}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),a();case 14:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return ee.apply(this,arguments)})},{key:"openSpace",value:(X=(0,o.default)(i.default.mark((function e(t){var n,r=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.length>1&&r[1]!==undefined?r[1]:{},this.spaces[t]){e.next=23;break}return this.spaces[t]=new M(t,this._3id,this._orbitdb,this._rootStore,this._ensurePinningNodeConnected.bind(this)),e.prev=3,n=Object.assign({numEntriesMessages:this.spacesPubSubMessages},n),e.next=7,this.spaces[t].open(n);case 7:return e.next=9,this.isAddressLinked();case 9:if(e.sent){e.next=11;break}this.linkAddress();case 11:e.next=21;break;case 13:if(e.prev=13,e.t0=e.catch(3),delete this.spaces[t],!e.t0.message.includes("User denied message signature.")){e.next=20;break}throw new Error("User denied space consent.");case 20:throw new Error("An error occured while opening space: ",e.t0.message);case 21:e.next=24;break;case 23:n.onSyncDone&&n.onSyncDone();case 24:return e.abrupt("return",this.spaces[t]);case 25:case"end":return e.stop()}}),e,this,[[3,13]])}))),function(e){return X.apply(this,arguments)})},{key:"onSyncDone",value:function(e){this._onSyncDoneCB=e,this._boxSynced&&this._onSyncDoneCB()}},{key:"_publishRootStore",value:(Q=(0,o.default)(i.default.mark((function e(t){var n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._3id.signJWT({rootStoreAddress:t});case 2:return n=e.sent,e.prev=3,e.next=6,j.fetchJson(this._serverUrl+"/odbAddress",{address_token:n});case 6:e.next=12;break;case 8:if(e.prev=8,e.t0=e.catch(3),e.t0.statusCode){e.next=12;break}throw new Error(e.t0);case 12:return e.abrupt("return",!0);case 13:case"end":return e.stop()}}),e,this,[[3,8]])}))),function(e){return Q.apply(this,arguments)})},{key:"linkAddress",value:(Y=(0,o.default)(i.default.mark((function e(){var t,n=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=n.length>0&&n[0]!==undefined?n[0]:{}).proof){e.next=5;break}return e.next=4,this._writeAddressLink(t.proof);case 4:return e.abrupt("return");case 5:if(t.type&&t.type!==O){e.next=8;break}return e.next=8,this._linkProfile();case 8:case"end":return e.stop()}}),e,this)}))),function(){return Y.apply(this,arguments)})},{key:"linkAccount",value:(Z=(0,o.default)(i.default.mark((function e(){var t,n=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&n[0]!==undefined?n[0]:O,console.warn("linkAccount: deprecated, please use linkAddress going forward"),e.next=4,this.linkAddress(t);case 4:case"end":return e.stop()}}),e,this)}))),function(){return Z.apply(this,arguments)})},{key:"removeAddressLink",value:(J=(0,o.default)(i.default.mark((function e(t){var n,r;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t.toLowerCase(),e.next=3,this.isAddressLinked({address:t});case 3:if(e.sent){e.next=6;break}throw new Error("removeAddressLink: link for given address does not exist");case 6:return n={address:t,type:"delete-address-link"},e.next=10,this._3id.signJWT(n,{expiresIn:3600});case 10:return r=e.sent,e.prev=11,e.next=14,j.fetchJson(this._serverUrl+"/linkdelete",{delete_token:r});case 14:e.next=20;break;case 16:if(e.prev=16,e.t0=e.catch(11),e.t0.statusCode){e.next=20;break}throw new Error(e.t0);case 20:return e.next=22,this._deleteAddressLink(t);case 22:return e.abrupt("return",!0);case 23:case"end":return e.stop()}}),e,this,[[11,16]])}))),function(e){return J.apply(this,arguments)})},{key:"isAddressLinked",value:(W=(0,o.default)(i.default.mark((function e(){var t,n,r,s=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=s.length>0&&s[0]!==undefined?s[0]:{}).address&&(t.address=t.address.toLowerCase()),e.next=4,this._readAddressLinks();case 4:return n=e.sent,r=n.find((function(e){var n=!t.address||e.address===t.address;return t.type?n&&e.type===t.type:n})),e.abrupt("return",Boolean(r));case 7:case"end":return e.stop()}}),e,this)}))),function(){return W.apply(this,arguments)})},{key:"isAccountLinked",value:(z=(0,o.default)(i.default.mark((function e(){var t,n=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&n[0]!==undefined?n[0]:O,console.warn("isAccountLinked: deprecated, please use isAddressLinked going forward"),e.abrupt("return",this.isAddressLinked(t));case 3:case"end":return e.stop()}}),e,this)}))),function(){return z.apply(this,arguments)})},{key:"listAddressLinks",value:(V=(0,o.default)(i.default.mark((function e(){var t;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._readAddressLinks();case 2:return t=e.sent,e.abrupt("return",t.reduce((function(e,t){var n=Object.assign({},t);return n.linkId=n.entry.hash,delete n.entry,n}),[]));case 4:case"end":return e.stop()}}),e,this)}))),function(){return V.apply(this,arguments)})},{key:"_linkProfile",value:(K=(0,o.default)(i.default.mark((function e(){var t,n,r,s;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._3id.managementAddress,e.next=3,this._readAddressLink(t);case 3:if(n=e.sent){e.next=19;break}return r=this.DID,e.prev=6,e.next=9,j.getLinkConsent(t,r,this._web3provider);case 9:s=e.sent,e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(6),console.log(e.t0),new Error("Link consent message must be signed before adding data, to link address to store");case 16:return n={version:1,type:O,message:s.msg,signature:s.sig,timestamp:s.timestamp},e.next=19,this._writeAddressLink(n);case 19:return e.next=21,this.public.get("proof_did");case 21:if(e.sent){e.next=29;break}return e.t1=this.public,e.next=25,this._3id.signJWT();case 25:return e.t2=e.sent,e.t3={noLink:!0},e.next=29,e.t1.set.call(e.t1,"proof_did",e.t2,e.t3);case 29:j.fetchJson(this._serverUrl+"/link",n).catch(console.error);case 30:case"end":return e.stop()}}),e,this,[[6,12]])}))),function(){return K.apply(this,arguments)})},{key:"_writeAddressLink",value:(G=(0,o.default)(i.default.mark((function e(t){var n,r;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ipfs.dag.put(t);case 2:return n=e.sent.toBaseEncodedString(),e.next=5,this._linkCIDExists(n);case 5:if(!e.sent){e.next=8;break}return e.abrupt("return");case 8:return r={type:"address-link",data:n},e.next=11,this._rootStore.add(r);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return G.apply(this,arguments)})},{key:"_linkCIDExists",value:(H=(0,o.default)(i.default.mark((function e(t){var n,r;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._rootStore.iterator({limit:-1}).collect();case 2:return n=e.sent,r=n.filter((function(e){return"address-link"===e.payload.value.type})),e.abrupt("return",r.find((function(e){return e.data===t})));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return H.apply(this,arguments)})},{key:"_deleteAddressLink",value:($=(0,o.default)(i.default.mark((function e(t){var n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t.toLowerCase(),e.next=3,this._readAddressLink(t);case 3:if(n=e.sent){e.next=6;break}throw new Error("_deleteAddressLink: link for given address does not exist");case 6:return e.abrupt("return",this._rootStore.remove(n.entry.hash));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return $.apply(this,arguments)})},{key:"_readAddressLinks",value:(q=(0,o.default)(i.default.mark((function e(){var t,n,r,s=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._rootStore.iterator({limit:-1}).collect();case 2:return t=e.sent,n=t.filter((function(e){return"address-link"===e.payload.value.type})),r=n.map(function(){var e=(0,o.default)(i.default.mark((function e(t){var n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s._ipfs.dag.get(t.payload.value.data);case 2:if((n=e.sent.value).address){e.next=7;break}return e.next=6,j.recoverPersonalSign(n.message,n.signature);case 6:n.address=e.sent;case 7:return n.entry=t,e.abrupt("return",n);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",Promise.all(r));case 6:case"end":return e.stop()}}),e,this)}))),function(){return q.apply(this,arguments)})},{key:"_readAddressLink",value:(F=(0,o.default)(i.default.mark((function e(t){var n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t.toLowerCase(),e.next=3,this._readAddressLinks();case 3:return n=e.sent,e.abrupt("return",n.find((function(e){return e.address.toLowerCase()===t})));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"_ensurePinningNodeConnected",value:(L=(0,o.default)(i.default.mark((function e(t,n){var r,s=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ipfs.pubsub.peers(t);case 2:e.sent.find((function(e){return e===s.pinningNode.split("/").pop()}))||(this._ipfs.swarm.connect(this.pinningNode,(function(){})),r=this._rootStore.address.toString(),n?this._pubsub.publish(N,{type:"SYNC_DB",odbAddress:t,thread:!0}):this._pubsub.publish(N,{type:"PIN_DB",odbAddress:r}));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return L.apply(this,arguments)})},{key:"close",value:(D=(0,o.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._orbitdb.stop();case 2:return e.next=4,this._pubsub.disconnect();case 4:_=null;case 5:case"end":return e.stop()}}),e,this)}))),function(){return D.apply(this,arguments)})},{key:"logout",value:(T=(0,o.default)(i.default.mark((function e(){var t;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.close();case 2:this._3id.logout(),t=this._3id.managementAddress,h.remove("linkConsent_"+t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return T.apply(this,arguments)})},{key:"DID",get:function(){return this._3id.muportDID}}],[{key:"getProfile",value:(w=(0,o.default)(i.default.mark((function e(t){var n,r,s,a,o=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>1&&o[1]!==undefined?o[1]:{},r=n.metadata,!(n=Object.assign({useCacheService:!0},n)).useCacheService){e.next=9;break}return e.next=6,A.getProfile(t,n.profileServer,{metadata:r});case 6:s=e.sent,e.next=15;break;case 9:if(!r){e.next=11;break}throw new Error("getting metadata is not yet supported outside of the API");case 11:return a=t.toLowerCase(),e.next=14,this._getProfileOrbit(a,n);case 14:s=e.sent;case 15:return e.abrupt("return",s);case 16:case"end":return e.stop()}}),e,this)}))),function(e){return w.apply(this,arguments)})},{key:"getProfiles",value:(b=(0,o.default)(i.default.mark((function e(t){var n,r=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&r[1]!==undefined?r[1]:{},e.abrupt("return",A.getProfiles(t,n));case 2:case"end":return e.stop()}}),e)}))),function(e){return b.apply(this,arguments)})},{key:"getSpace",value:(v=(0,o.default)(i.default.mark((function e(t,n){var r,s=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&s[2]!==undefined?s[2]:{},e.abrupt("return",A.getSpace(t,n,r.profileServer,r));case 2:case"end":return e.stop()}}),e)}))),function(e,t){return v.apply(this,arguments)})},{key:"getThread",value:(y=(0,o.default)(i.default.mark((function e(t,n,r,s){var a,o=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>4&&o[4]!==undefined?o[4]:{},e.abrupt("return",A.getThread(t,n,r,s,a));case 2:case"end":return e.stop()}}),e)}))),function(e,t,n,r){return y.apply(this,arguments)})},{key:"getThreadByAddress",value:(g=(0,o.default)(i.default.mark((function e(t){var n,r=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&r[1]!==undefined?r[1]:{},e.abrupt("return",A.getThreadByAddress(t,n));case 2:case"end":return e.stop()}}),e)}))),function(e){return g.apply(this,arguments)})},{key:"getConfig",value:(f=(0,o.default)(i.default.mark((function e(t){var n,r=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&r[1]!==undefined?r[1]:{},e.abrupt("return",A.getConfig(t,n));case 2:case"end":return e.stop()}}),e)}))),function(e){return f.apply(this,arguments)})},{key:"listSpaces",value:(l=(0,o.default)(i.default.mark((function e(t){var n,r=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&r[1]!==undefined?r[1]:{},e.abrupt("return",A.listSpaces(t,n.profileServer));case 2:case"end":return e.stop()}}),e)}))),function(e){return l.apply(this,arguments)})},{key:"_getProfileOrbit",value:(a=(0,o.default)(i.default.mark((function e(t){var n,r,s,a,c,u,l,d,h,f,m,g,y=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=y.length>1&&y[1]!==undefined?y[1]:{},!C.isMuportDID(t)){e.next=3;break}throw new Error("DID are supported in the cached version only");case 3:return e.next=5,A.getRootStoreAddress(t.toLowerCase(),n.addressServer);case 5:if(r=e.sent,!k){e.next=12;break}s=k,e.next=15;break;case 12:return e.next=14,U(n.ipfs,n.iframeStore,n.ipfsOptions);case 14:s=e.sent;case 15:if(_?a=_:(c=null,a=new p(s,n.orbitPath,{cache:c})),u=n.pinningNode||R,s.swarm.connect(u,(function(){})),l=new S(a),!r){e.next=41;break}return e.next=22,a.open(r);case 22:return d=e.sent,h=new Promise((function(e,t){d.events.on("ready",e)})),d.load(),e.next=27,h;case 27:if(d.iterator({limit:-1}).collect().length){e.next=30;break}return e.next=30,new Promise((function(e,t){d.events.on("replicate.progress",(function(t,n,r,s,i){s===i&&d.events.on("replicated",e)}))}));case 30:return f=d.iterator({limit:-1}).collect().find((function(e){return"public"===e.payload.value.odbAddress.split(".")[1]})),e.next=33,l._load(f.payload.value.odbAddress);case 33:return e.next=35,l._sync();case 35:return m=l.all(),g=function(){var e=(0,o.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.close();case 2:return e.next=4,l.close();case 4:case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),g(),e.abrupt("return",m);case 41:return e.abrupt("return",null);case 42:case"end":return e.stop()}}),e)}))),function(e){return a.apply(this,arguments)})},{key:"profileGraphQL",value:(r=(0,o.default)(i.default.mark((function e(t){var n,r=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&r[1]!==undefined?r[1]:{},e.abrupt("return",A.profileGraphQL(t,n.graphqlServer));case 2:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"getVerifiedAccounts",value:(n=(0,o.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",A.getVerifiedAccounts(t));case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"openBox",value:(t=(0,o.default)(i.default.mark((function t(n,r){var s,a,o,c,u=arguments;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=u.length>2&&u[2]!==undefined?u[2]:{},t.t0=k,t.t0){t.next=6;break}return t.next=5,U(s.ipfs,s.iframeStore,s.ipfsOptions);case 5:t.t0=t.sent;case 6:return a=t.t0,k=a,t.next=10,E.getIdFromEthAddress(n,r,a,s);case 10:return o=t.sent,c=new e(o,r,a,s),t.next=14,c._load(s);case 14:return t.abrupt("return",c);case 15:case"end":return t.stop()}}),t)}))),function(e,n){return t.apply(this,arguments)})},{key:"isLoggedIn",value:function(e){return E.isLoggedIn(e)}}]),e}();function U(e,t,n){return F.apply(this,arguments)}function F(){return(F=(0,o.default)(i.default.mark((function e(t,n,r){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&n&&console.log("Warning: iframeStore true, orbit db cache in iframe, but the given ipfs object is being used, and may not be running in same iframe."),!t){e.next=5;break}return e.abrupt("return",t);case 5:return e.abrupt("return",new Promise((function(e,n){(t=new f(r||D)).on("error",(function(e){console.error(e),n(e)})),t.on("ready",(function(){return e(t)}))})));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}L.idUtils=C,t.exports=L}}},{package:"3box",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/3box/lib/3box.js"}],[163,{"../config.js":166,"../utils/index":173,"./keyring":164,"3box-orbitdb-plugins":157,"3id-resolver":179,"@babel/runtime/helpers/asyncToGenerator":185,"@babel/runtime/helpers/classCallCheck":186,"@babel/runtime/helpers/createClass":188,"@babel/runtime/helpers/interopRequireDefault":195,"@babel/runtime/regenerator":215,buffer:2081,"did-jwt":176,ethers:178,"ipfs-did-document":4442,"ipfs-mini":4485,"orbit-db-identity-provider":5330,store:5864},function(){with(this)return function(){"use strict";return function(e,t,n){(function(n){(function(){var r=e("@babel/runtime/helpers/interopRequireDefault"),s=r(e("@babel/runtime/regenerator")),i=r(e("@babel/runtime/helpers/asyncToGenerator")),a=r(e("@babel/runtime/helpers/classCallCheck")),o=r(e("@babel/runtime/helpers/createClass")),c=e("ethers").utils.HDNode,u=e("did-jwt"),l=e("ipfs-did-document"),d=e("ipfs-mini"),h=e("store"),f=e("orbit-db-identity-provider"),p=e("3box-orbitdb-plugins").OdbIdentityProvider;f.addIdentityProvider(p);var m=e("3id-resolver"),g=e("../utils/index"),y=e("./keyring"),v=e("../config.js"),b="serialized3id_",w={host:v.muport_ipfs_host,port:v.muport_ipfs_port,protocol:v.muport_ipfs_protocol},k=function(){function e(t,n,r,s){(0,a.default)(this,e),this._ethereum=n,this._ipfs=r,this._keyrings={},this._initKeys(t,s),m(r),h.set(b+this.managementAddress,this.serializeState())}var t,r,p,v,k,E,S;return(0,o.default)(e,[{key:"signJWT",value:(S=(0,i.default)(s.default.mark((function e(t){var n,r,i,a,o,c,l,d=arguments;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=d.length>1&&d[1]!==undefined?d[1]:{},r=n.use3ID,i=n.space,a=n.expiresIn,o=i?this._keyrings[i]:this._mainKeyring,c=this.muportDID,r?c=this.DID:i&&(c=this._subDIDs[i]),l={signer:o.getJWTSigner(),issuer:c,expiresIn:a},e.abrupt("return",u.createJWT(t,l));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return S.apply(this,arguments)})},{key:"getSubDID",value:function(e){return this._subDIDs[e]}},{key:"getOdbId",value:(E=(0,i.default)(s.default.mark((function e(t){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",f.createIdentity({type:"3ID",threeId:this,space:t}));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{key:"serializeState",value:function(){var e=this,t={managementAddress:this.managementAddress,seed:this._mainKeyring.serialize(),spaceSeeds:{}};return Object.keys(this._keyrings).map((function(n){t.spaceSeeds[n]=e._keyrings[n].serialize()})),JSON.stringify(t)}},{key:"_initKeys",value:function(e){var t=this,n=JSON.parse(e);this.managementAddress=n.managementAddress.toLowerCase(),this._mainKeyring=new y(n.seed),Object.keys(n.spaceSeeds).map((function(e){t._keyrings[e]=new y(n.spaceSeeds[e])}))}},{key:"_initDID",value:(k=(0,i.default)(s.default.mark((function e(t){var n,r,i,a=this;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._initMuport(t),e.next=3,this._init3ID();case 3:return this._rootDID=e.sent,r=Object.keys(this._keyrings),e.next=7,Promise.all(r.map((function(e){return a._init3ID(e)})));case 7:return i=e.sent,this._subDIDs={},r.map((function(e,t){a._subDIDs[e]=i[t]})),e.next=12,n;case 12:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)})},{key:"_init3ID",value:(v=(0,i.default)(s.default.mark((function e(t){var n,r,i,a,o;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new l(this._ipfs,"3"),t){e.next=9;break}r=this._mainKeyring.getPublicKeys(!0),n.addPublicKey("signingKey","Secp256k1VerificationKey2018","publicKeyHex",r.signingKey),n.addPublicKey("encryptionKey","Curve25519EncryptionPublicKey","publicKeyBase64",r.asymEncryptionKey),n.addPublicKey("managementKey","Secp256k1VerificationKey2018","ethereumAddress",this.managementAddress),n.addAuthentication("Secp256k1SignatureAuthentication2018","signingKey"),e.next=20;break;case 9:return i=this._keyrings[t].getPublicKeys(!0),n.addPublicKey("subSigningKey","Secp256k1VerificationKey2018","publicKeyHex",i.signingKey),n.addPublicKey("subEncryptionKey","Curve25519EncryptionPublicKey","publicKeyBase64",i.asymEncryptionKey),n.addAuthentication("Secp256k1SignatureAuthentication2018","subSigningKey"),n.addCustomProperty("space",t),n.addCustomProperty("root",this.DID),a={subSigningKey:i.signingKey,subEncryptionKey:i.asymEncryptionKey,space:t,iat:null},e.next=18,this.signJWT(a,{use3ID:!0});case 18:o=e.sent.split(".")[2],n.addCustomProperty("proof",{alg:"ES256K",signature:o});case 20:return e.next=22,n.commit({noTimestamp:!0});case 22:return e.abrupt("return",n.DID);case 23:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"_initMuport",value:(p=(0,i.default)(s.default.mark((function e(t){var r,a,o,c;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._mainKeyring.getPublicKeys(),a=_(r.signingKey,this.managementAddress,r.asymEncryptionKey),e.next=4,this._ipfs.add(n.from(JSON.stringify(a)));case 4:o=e.sent[0].hash,this._muportDID="did:muport:"+o,this.muportFingerprint=g.sha256Multihash(this.muportDID),c=function(){var e=(0,i.default)(s.default.mark((function e(){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:new d(t).addJSON(a,(function(e,t){e&&console.error(e)}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),c();case 9:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"getKeyringBySpaceName",value:function(e){var t=e.split(".");return t[0]===this.muportFingerprint?this._mainKeyring:this._keyrings[t[2]]}},{key:"initKeyringByName",value:(r=(0,i.default)(s.default.mark((function e(t){var n,r,i;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._keyrings[t]){e.next=14;break}return e.next=3,g.openSpaceConsent(this.managementAddress,this._ethereum,t);case 3:return n=e.sent,r="0x"+g.sha256(n.slice(2)),i=c.mnemonicToSeed(c.entropyToMnemonic(r)),this._keyrings[t]=new y(i),e.next=9,this._init3ID(t);case 9:return this._subDIDs[t]=e.sent,h.set(b+this.managementAddress,this.serializeState()),e.abrupt("return",!0);case 14:return e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"logout",value:function(){h.remove(b+this.managementAddress)}},{key:"DID",get:function(){return this._rootDID}},{key:"muportDID",get:function(){return this._muportDID}}],[{key:"isLoggedIn",value:function(e){return Boolean(h.get(b+e.toLowerCase()))}},{key:"getIdFromEthAddress",value:(t=(0,i.default)(s.default.mark((function t(n,r,i){var a,o,u,l,d,f,p,m,y=arguments;return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=y.length>3&&y[3]!==undefined?y[3]:{},o=n.toLowerCase(),!(u=h.get(b+o))){t.next=7;break}a.consentCallback&&a.consentCallback(!1),t.next=19;break;case 7:if(!a.contentSignature){t.next=11;break}l=a.contentSignature,t.next=14;break;case 11:return t.next=13,g.openBoxConsent(o,r);case 13:l=t.sent;case 14:a.consentCallback&&a.consentCallback(!0),d="0x"+g.sha256(l.slice(2)),f=c.entropyToMnemonic(d),p=c.mnemonicToSeed(f),u=JSON.stringify({managementAddress:o,seed:p,spaceSeeds:{}});case 19:return m=new e(u,r,i,a),t.next=22,m._initDID(a.muportIpfs||w);case 22:return t.abrupt("return",m);case 23:case"end":return t.stop()}}),t)}))),function(e,n,r){return t.apply(this,arguments)})}]),e}(),_=function(e,t,n){return{version:1,signingKey:e,managementKey:t,asymEncryptionKey:n}};t.exports=k}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"3box",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/3box/lib/3id/index.js"}],[164,{"../utils/index":173,"@babel/runtime/helpers/classCallCheck":186,"@babel/runtime/helpers/createClass":188,"@babel/runtime/helpers/interopRequireDefault":195,buffer:2081,"did-jwt":176,elliptic:2315,ethers:178,tweetnacl:5992,"tweetnacl-util":5991},function(){with(this)return function(){"use strict";return function(e,t,n){(function(n){(function(){var r=e("@babel/runtime/helpers/interopRequireDefault"),s=r(e("@babel/runtime/helpers/classCallCheck")),i=r(e("@babel/runtime/helpers/createClass")),a=e("ethers").utils.HDNode,o=e("tweetnacl");o.util=e("tweetnacl-util");var c=e("did-jwt").SimpleSigner,u=e("../utils/index").sha256,l=new(0,e("elliptic").ec)("secp256k1"),d=function(){function e(t){(0,s.default)(this,e),this._seed=t;var r=a.fromSeed(this._seed),i=r.derivePath("m/7696500'/0'/0'");this.signingKey=i.derivePath("0");var c=n.from(i.derivePath("2").privateKey.slice(2),"hex");this.asymEncryptionKey=o.box.keyPair.fromSecretKey(new Uint8Array(c)),this.symEncryptionKey=new Uint8Array(n.from(i.derivePath("3").privateKey.slice(2),"hex")),this.ethereumKey=r.derivePath("m/44'/60'/0'/0").derivePath("0")}return(0,i.default)(e,[{key:"asymEncrypt",value:function(e,t,n){n=n||h(),t=o.util.decodeBase64(t),"string"==typeof e&&(e=o.util.decodeUTF8(e));var r=o.box(e,n,t,this.asymEncryptionKey.secretKey);return{nonce:o.util.encodeBase64(n),ciphertext:o.util.encodeBase64(r)}}},{key:"asymDecrypt",value:function(e,t,r,s){t=o.util.decodeBase64(t),e=o.util.decodeBase64(e),r=o.util.decodeBase64(r);var i=o.box.open(e,r,t,this.asymEncryptionKey.secretKey);return s?i?n.from(i):null:i?o.util.encodeUTF8(i):null}},{key:"symEncrypt",value:function(e,t){return f(e,this.symEncryptionKey,t)}},{key:"symDecrypt",value:function(e,t,n){return p(e,this.symEncryptionKey,t,n)}},{key:"getJWTSigner",value:function(){return c(this.signingKey.privateKey.slice(2))}},{key:"getDBSalt",value:function(){return u(this.signingKey.derivePath("0").privateKey.slice(2))}},{key:"getPublicKeys",value:function(e){var t=this.signingKey.publicKey.slice(2),r=this.ethereumKey.publicKey.slice(2);return e&&(t=l.keyFromPublic(n.from(t,"hex")).getPublic(!1,"hex"),r=l.keyFromPublic(n.from(r,"hex")).getPublic(!1,"hex")),{signingKey:t,ethereumKey:r,asymEncryptionKey:o.util.encodeBase64(this.asymEncryptionKey.publicKey)}}},{key:"serialize",value:function(){return this._seed}}]),e}(),h=function(){return o.randomBytes(24)},f=function(e,t,n){n=n||h(),"string"==typeof e&&(e=o.util.decodeUTF8(e));var r=o.secretbox(e,n,t);return{nonce:o.util.encodeBase64(n),ciphertext:o.util.encodeBase64(r)}},p=function(e,t,r,s){e=o.util.decodeBase64(e),r=o.util.decodeBase64(r);var i=o.secretbox.open(e,r,t);return s?i?n.from(i):null:i?o.util.encodeUTF8(i):null};t.exports=d}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"3box",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/3box/lib/3id/keyring.js"}],[165,{"./config.js":166,"./utils/id":172,"./utils/index":173,"./utils/verifier":174,"@babel/runtime/helpers/asyncToGenerator":185,"@babel/runtime/helpers/interopRequireDefault":195,"@babel/runtime/regenerator":215,"graphql-request":4318},function(){with(this)return function(){"use strict";return function(e,t,n){var r=e("@babel/runtime/helpers/interopRequireDefault"),s=r(e("@babel/runtime/regenerator")),i=r(e("@babel/runtime/helpers/asyncToGenerator")),a=e("graphql-request").request,o=e("./utils/index"),c=e("./utils/verifier"),u=e("./utils/id").isMuportDID,l=e("./config.js"),d=l.graphql_server_url,h=l.profile_server_url,f=l.address_server_url;function p(){return p=(0,i.default)(s.default.mark((function e(t){var n,r,i=arguments;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&i[1]!==undefined?i[1]:f,e.next=3,o.fetchJson(n+"/odbAddress/"+t);case 3:return r=e.sent,e.abrupt("return",r.data.rootStoreAddress);case 5:case"end":return e.stop()}}),e)}))),p.apply(this,arguments)}function m(){return m=(0,i.default)(s.default.mark((function e(t){var n,r=arguments;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.length>1&&r[1]!==undefined?r[1]:h,e.prev=1,!u(t)){e.next=8;break}return e.next=5,o.fetchJson(n+"/list-spaces?did="+encodeURIComponent(t));case 5:case 10:return e.abrupt("return",e.sent);case 8:return e.next=10,o.fetchJson(n+"/list-spaces?address="+encodeURIComponent(t));case 11:e.next=16;break;case 13:return e.prev=13,e.t0=e.catch(1),e.abrupt("return",[]);case 16:case"end":return e.stop()}}),e,null,[[1,13]])}))),m.apply(this,arguments)}function g(){return g=(0,i.default)(s.default.mark((function e(t,n){var r,i,a,c,l,d=arguments;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=d.length>2&&d[2]!==undefined?d[2]:h,i=d.length>3&&d[3]!==undefined?d[3]:{},a=i.metadata,!(c=i.blocklist)||!c(t)){e.next=4;break}throw new Error("user with ".concat(t," is blocked"));case 4:return l="".concat(r,"/space"),e.prev=5,l=u(t)?"".concat(l,"?did=").concat(encodeURIComponent(t)):"".concat(l,"?address=").concat(encodeURIComponent(t.toLowerCase())),l="".concat(l,"&name=").concat(encodeURIComponent(n)),a&&(l="".concat(l,"&metadata=").concat(encodeURIComponent(a))),e.next=11,o.fetchJson(l);case 11:return e.abrupt("return",e.sent);case 14:return e.prev=14,e.t0=e.catch(5),e.abrupt("return",{});case 17:case"end":return e.stop()}}),e,null,[[5,14]])}))),g.apply(this,arguments)}function y(e,t){return v.apply(this,arguments)}function v(){return v=(0,i.default)(s.default.mark((function e(t,n){var r,i,a=arguments;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&a[2]!==undefined?a[2]:{},e.next=3,k(t,r);case 3:if((i=e.sent).spaces[n]&&i.spaces[n].DID){e.next=6;break}throw new Error("Could not find appropriate DID for address ".concat(t));case 6:return e.abrupt("return",i.spaces[n].DID);case 7:case"end":return e.stop()}}),e)}))),v.apply(this,arguments)}function b(){return b=(0,i.default)(s.default.mark((function e(t,n,r,i){var a,c,u,l=arguments;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=l.length>4&&l[4]!==undefined?l[4]:{},c=a.profileServer||h,!r.startsWith("0x")){e.next=6;break}return e.next=5,y(r,t,a);case 5:r=e.sent;case 6:return e.prev=6,u="".concat(c,"/thread?space=").concat(encodeURIComponent(t),"&name=").concat(encodeURIComponent(n)),u+="&mod=".concat(encodeURIComponent(r),"&members=").concat(encodeURIComponent(i)),e.next=11,o.fetchJson(u);case 11:return e.abrupt("return",e.sent);case 14:throw e.prev=14,e.t0=e.catch(6),new Error(e.t0);case 17:case"end":return e.stop()}}),e,null,[[6,14]])}))),b.apply(this,arguments)}function w(){return w=(0,i.default)(s.default.mark((function e(t){var n,r,i=arguments;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&i[1]!==undefined?i[1]:{},r=n.profileServer||h,e.prev=2,e.next=5,o.fetchJson("".concat(r,"/thread?address=").concat(encodeURIComponent(t)));case 5:return e.abrupt("return",e.sent);case 8:throw e.prev=8,e.t0=e.catch(2),new Error(e.t0);case 11:case"end":return e.stop()}}),e,null,[[2,8]])}))),w.apply(this,arguments)}function k(e){return _.apply(this,arguments)}function _(){return _=(0,i.default)(s.default.mark((function e(t){var n,r,i=arguments;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&i[1]!==undefined?i[1]:{},r=n.profileServer||h,e.prev=2,e.next=5,o.fetchJson("".concat(r,"/config?address=").concat(encodeURIComponent(t)));case 5:return e.abrupt("return",e.sent);case 8:throw e.prev=8,e.t0=e.catch(2),new Error(e.t0);case 11:case"end":return e.stop()}}),e,null,[[2,8]])}))),_.apply(this,arguments)}function E(){return E=(0,i.default)(s.default.mark((function e(t){var n,r,i,a,c,l=arguments;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l.length>1&&l[1]!==undefined?l[1]:h,r=l.length>2&&l[2]!==undefined?l[2]:{},i=r.metadata,!(a=r.blocklist)||!a(t)){e.next=4;break}throw new Error("user with ".concat(t," is blocked"));case 4:return c="".concat(n,"/profile"),e.prev=5,c=u(t)?"".concat(c,"?did=").concat(encodeURIComponent(t)):"".concat(c,"?address=").concat(encodeURIComponent(t.toLowerCase())),i&&(c="".concat(c,"&metadata=").concat(encodeURIComponent(i))),e.next=10,o.fetchJson(c);case 10:return e.abrupt("return",e.sent);case 13:return e.prev=13,e.t0=e.catch(5),e.abrupt("return",{});case 16:case"end":return e.stop()}}),e,null,[[5,13]])}))),E.apply(this,arguments)}function S(){return S=(0,i.default)(s.default.mark((function e(t){var n,r,i,a=arguments;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&a[1]!==undefined?a[1]:{},n=Object.assign({profileServer:h},n),r={addressList:[],didList:[]},t.forEach((function(e){u(e)?r.didList.push(e):r.addressList.push(e)})),i="".concat(n.profileServer,"/profileList"),e.abrupt("return",o.fetchJson(i,r));case 6:case"end":return e.stop()}}),e)}))),S.apply(this,arguments)}function P(){return P=(0,i.default)(s.default.mark((function e(t){var n,r=arguments;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&r[1]!==undefined?r[1]:{},n=Object.assign({graphqlServer:d},n),e.abrupt("return",a(n.graphqlServer,t));case 3:case"end":return e.stop()}}),e)}))),P.apply(this,arguments)}function x(){return(x=(0,i.default)(s.default.mark((function e(t){var n,r;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={},e.prev=1,e.next=4,c.verifyDID(t.proof_did);case 4:if(r=e.sent,n.did=r,!t.proof_github){e.next=15;break}return e.prev=7,e.next=10,c.verifyGithub(r,t.proof_github);case 10:n.github=e.sent,e.next=15;break;case 13:e.prev=13,e.t0=e.catch(7);case 15:if(!t.proof_twitter){e.next=24;break}return e.prev=16,e.next=19,c.verifyTwitter(r,t.proof_twitter);case 19:n.twitter=e.sent,e.next=24;break;case 22:e.prev=22,e.t1=e.catch(16);case 24:if(!t.ethereum_proof){e.next=33;break}return e.prev=25,e.next=28,c.verifyEthereum(t.ethereum_proof,r);case 28:n.ethereum=e.sent,e.next=33;break;case 31:e.prev=31,e.t2=e.catch(25);case 33:e.next=37;break;case 35:e.prev=35,e.t3=e.catch(1);case 37:return e.abrupt("return",n);case 38:case"end":return e.stop()}}),e,null,[[1,35],[7,13],[16,22],[25,31]])})))).apply(this,arguments)}t.exports={profileGraphQL:function(e){return P.apply(this,arguments)},getProfile:function(e){return E.apply(this,arguments)},getSpace:function(e,t){return g.apply(this,arguments)},listSpaces:function(e){return m.apply(this,arguments)},getThread:function(e,t,n,r){return b.apply(this,arguments)},getThreadByAddress:function(e){return w.apply(this,arguments)},getConfig:k,getRootStoreAddress:function(e){return p.apply(this,arguments)},getProfiles:function(e){return S.apply(this,arguments)},getVerifiedAccounts:function(e){return x.apply(this,arguments)},getSpaceDID:y}}}},{package:"3box",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/3box/lib/api.js"}],[166,{_process:5420,"ipfs-log":4453},function(){with(this)return function(){"use strict";return function(e,t,n){(function(n){(function(){var r=e("ipfs-log"),s="0.0.3";t.exports={address_server_url:n.env.ADDRESS_SERVER_URL||"https://beta.3box.io/address-server",pinning_node:n.env.PINNING_NODE||"/dnsaddr/ipfs.3box.io/tcp/443/wss/ipfs/QmZvxEpiVNjmNbEKyQGvFzAY1BwmGuuvdUTmcTstQPhyVC",pinning_room:n.env.PINNING_ROOM||"3box-pinning",iframe_store_version:n.env.IFRAME_STORE_VERSION||s,iframe_store_url:n.env.IFRAME_STORE_URL||"https://iframe.3box.io/".concat(s,"/iframe.html"),ipfs_options:{EXPERIMENTAL:{pubsub:!0},preload:{enabled:!1},config:{Bootstrap:[]}},orbitdb_options:{syncLocal:!0,sortFn:r.Sorting.SortByEntryHash},graphql_server_url:n.env.GRAPHQL_SERVER_URL||"https://api.3box.io/graph/",profile_server_url:n.env.PROFILE_SERVER_URL||"https://ipfs.3box.io",muport_ipfs_host:n.env.MUPORT_IPFS_HOST||"ipfs.infura.io",muport_ipfs_port:n.env.MUPORT_IPFS_PORT||5001,muport_ipfs_protocol:n.env.MUPORT_IPFS_PROTOCOL||"https"}}).call(this)}).call(this,e("_process"))}}},{package:"3box",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/3box/lib/config.js"}],[167,{"./config":166,"./utils/index":173,"@babel/runtime/helpers/asyncToGenerator":185,"@babel/runtime/helpers/classCallCheck":186,"@babel/runtime/helpers/createClass":188,"@babel/runtime/helpers/defineProperty":189,"@babel/runtime/helpers/interopRequireDefault":195,"@babel/runtime/regenerator":215},function(){with(this)return function(){"use strict";return function(e,t,n){var r=e("@babel/runtime/helpers/interopRequireDefault"),s=r(e("@babel/runtime/regenerator")),i=r(e("@babel/runtime/helpers/defineProperty")),a=r(e("@babel/runtime/helpers/asyncToGenerator")),o=r(e("@babel/runtime/helpers/classCallCheck")),c=r(e("@babel/runtime/helpers/createClass"));function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(n,!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d=e("./utils/index"),h=d.throwIfUndefined,f=d.throwIfNotEqualLenArrays,p=e("./config").orbitdb_options,m=function(){function e(t,n,r,s){(0,o.default)(this,e),this._orbitdb=t,this._name=n,this._name.startsWith("3box.space.")&&(this._space=this._name.split(".")[2]),this._ensureConnected=r,this._3id=s}var t,n,r,i,u,d,m,g,y,v;return(0,c.default)(e,[{key:"get",value:(v=(0,a.default)(s.default.mark((function e(t){var n,r,i,a=arguments;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&a[1]!==undefined?a[1]:{},e.next=3,this._get(t);case 3:if(r=e.sent){e.next=6;break}return e.abrupt("return",r);case 6:if(!n.metadata){e.next=9;break}return i=this._extractMetadata(r),e.abrupt("return",l({},i,{value:r.value}));case 9:return e.abrupt("return",r.value);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"getMetadata",value:(y=(0,a.default)(s.default.mark((function e(t){var n;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._get(t);case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return",n);case 5:return e.abrupt("return",this._extractMetadata(n));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"set",value:(g=(0,a.default)(s.default.mark((function e(t,n){var r;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h(t,"key"),this._requireLoad(),this._ensureConnected(),r=(new Date).getTime(),e.next=6,this._db.put(t,{value:n,timeStamp:r});case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return g.apply(this,arguments)})},{key:"setMultiple",value:(m=(0,a.default)(s.default.mark((function e(t,n){var r=this;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f(t,n),this._requireLoad(),this._ensureConnected(),e.prev=3,e.next=6,t.reduce(function(){var e=(0,a.default)(s.default.mark((function e(t,i,a){var o;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:return h(i,"key"),o=(new Date).getTime(),e.abrupt("return",r._db.put(i,{value:n[a],timeStamp:o}));case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Promise.resolve());case 6:return e.abrupt("return",!0);case 9:throw e.prev=9,e.t0=e.catch(3),new Error(e.t0);case 12:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(e,t){return m.apply(this,arguments)})},{key:"remove",value:(d=(0,a.default)(s.default.mark((function e(t){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h(t,"key"),this._requireLoad(),this._ensureConnected(),e.next=5,this._db.del(t);case 5:return e.abrupt("return",!0);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"_extractMetadata",value:function(e){return{timestamp:Math.floor(e.timeStamp/1e3)}}},{key:"_get",value:(u=(0,a.default)(s.default.mark((function e(t){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._requireLoad(),e.abrupt("return",this._db.get(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"_sync",value:(i=(0,a.default)(s.default.mark((function e(t){var n=this;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._requireLoad(),!(null!==t&&t!==undefined&&t<=this._db._oplog.values.length)){e.next=4;break}return e.abrupt("return",Promise.resolve());case 4:return e.next=6,new Promise((function(e,r){t||setTimeout((function(){n._db.events.removeAllListeners("replicated"),n._db.events.removeAllListeners("replicate.progress"),e()}),3e3),n._db.events.on("replicated",(function(){t<=n._db._oplog.values.length&&e()}))}));case 6:return e.abrupt("return",this._db.address.toString());case 7:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"_load",value:(r=(0,a.default)(s.default.mark((function e(t){var n,r;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._3id.getKeyringBySpaceName(this._name).getPublicKeys(!0).signingKey,r=l({},p,{format:"dag-pb",accessController:{write:[n],type:"legacy-ipfs-3box",skipManifest:!0}}),!this._space){e.next=6;break}return e.next=5,this._3id.getOdbId(this._space);case 5:r.identity=e.sent;case 6:return e.next=8,this._orbitdb.keyvalue(t||this._name,r);case 8:return this._db=e.sent,e.next=11,this._db.load();case 11:return e.abrupt("return",this._db.address.toString());case 12:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_requireLoad",value:function(){if(!this._db)throw new Error("_load must be called before interacting with the store")}},{key:"close",value:(n=(0,a.default)(s.default.mark((function e(){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._requireLoad(),e.next=3,this._db.close();case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"all",value:(t=(0,a.default)(s.default.mark((function e(){var t,n,r,i=this,a=arguments;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&a[0]!==undefined?a[0]:{},this._requireLoad(),n=this._db.all,r={},Object.keys(n).map((function(e){var s=n[e];t.metadata?r[e]=l({},i._extractMetadata(s),{value:s.value}):r[e]=s.value})),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"log",get:function(){return this._db._oplog.values.map((function(e){return{op:e.payload.op,key:e.payload.key,value:e.payload.value?e.payload.value.value:null,timeStamp:e.payload.value?e.payload.value.timeStamp:null}}))}}]),e}();t.exports=m}}},{package:"3box",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/3box/lib/keyValueStore.js"}],[1670,{},function(){with(this)return function(){"use strict";return function(e,t,n){function r(e){if("object"!=typeof e||null===e)throw new TypeError("First argument must be an abstract-leveldown compliant store");this.db=e,this._operations=[],this._written=!1}r.prototype._checkWritten=function(){if(this._written)throw new Error("write() already called on this batch")},r.prototype.put=function(e,t){this._checkWritten();var n=this.db._checkKey(e)||this.db._checkValue(t);if(n)throw n;return e=this.db._serializeKey(e),t=this.db._serializeValue(t),this._put(e,t),this},r.prototype._put=function(e,t){this._operations.push({type:"put",key:e,value:t})},r.prototype.del=function(e){this._checkWritten();var t=this.db._checkKey(e);if(t)throw t;return e=this.db._serializeKey(e),this._del(e),this},r.prototype._del=function(e){this._operations.push({type:"del",key:e})},r.prototype.clear=function(){return this._checkWritten(),this._clear(),this},r.prototype._clear=function(){this._operations=[]},r.prototype.write=function(e,t){if(this._checkWritten(),"function"==typeof e&&(t=e),"function"!=typeof t)throw new Error("write() requires a callback argument");"object"==typeof e&&null!==e||(e={}),this._written=!0,this._write(e,t)},r.prototype._write=function(e,t){this.db._batch(this._operations,e,t)},t.exports=r}}},{package:"abstract-leveldown",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/abstract-leveldown/abstract-chained-batch.js"}],[1671,{_process:5420},function(){with(this)return function(){"use strict";return function(e,t,n){(function(e){(function(){function n(e){if("object"!=typeof e||null===e)throw new TypeError("First argument must be an abstract-leveldown compliant store");this.db=e,this._ended=!1,this._nexting=!1}n.prototype.next=function(t){var n=this;if("function"!=typeof t)throw new Error("next() requires a callback argument");return n._ended?(e.nextTick(t,new Error("cannot call next() after end()")),n):n._nexting?(e.nextTick(t,new Error("cannot call next() before previous next() has completed")),n):(n._nexting=!0,n._next((function(){n._nexting=!1,t.apply(null,arguments)})),n)},n.prototype._next=function(t){e.nextTick(t)},n.prototype.seek=function(e){if(this._ended)throw new Error("cannot call seek() after end()");if(this._nexting)throw new Error("cannot call seek() before next() has completed");e=this.db._serializeKey(e),this._seek(e)},n.prototype._seek=function(e){},n.prototype.end=function(t){if("function"!=typeof t)throw new Error("end() requires a callback argument");if(this._ended)return e.nextTick(t,new Error("end() already called on iterator"));this._ended=!0,this._end(t)},n.prototype._end=function(t){e.nextTick(t)},t.exports=n}).call(this)}).call(this,e("_process"))}}},{package:"abstract-leveldown",file:"/Users/danfinlay/Documents/MetaMask/metamask-extension/node_modules/abstract-leveldown/abstract-iterator.js"}]],[],{});